function UI(t,i){for(var l=0;l<i.length;l++){const d=i[l];if(typeof d!="string"&&!Array.isArray(d)){for(const g in d)if(g!=="default"&&!(g in t)){const w=Object.getOwnPropertyDescriptor(d,g);w&&Object.defineProperty(t,g,w.get?w:{enumerable:!0,get:()=>d[g]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))d(g);new MutationObserver(g=>{for(const w of g)if(w.type==="childList")for(const E of w.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&d(E)}).observe(document,{childList:!0,subtree:!0});function l(g){const w={};return g.integrity&&(w.integrity=g.integrity),g.referrerPolicy&&(w.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?w.credentials="include":g.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function d(g){if(g.ep)return;g.ep=!0;const w=l(g);fetch(g.href,w)}})();var VI=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pE(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var mE={exports:{}},Dg={},gE={exports:{}},cn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lf=Symbol.for("react.element"),NI=Symbol.for("react.portal"),jI=Symbol.for("react.fragment"),GI=Symbol.for("react.strict_mode"),$I=Symbol.for("react.profiler"),ZI=Symbol.for("react.provider"),qI=Symbol.for("react.context"),WI=Symbol.for("react.forward_ref"),XI=Symbol.for("react.suspense"),HI=Symbol.for("react.memo"),KI=Symbol.for("react.lazy"),Fb=Symbol.iterator;function YI(t){return t===null||typeof t!="object"?null:(t=Fb&&t[Fb]||t["@@iterator"],typeof t=="function"?t:null)}var _E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},yE=Object.assign,vE={};function Hu(t,i,l){this.props=t,this.context=i,this.refs=vE,this.updater=l||_E}Hu.prototype.isReactComponent={};Hu.prototype.setState=function(t,i){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,i,"setState")};Hu.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function xE(){}xE.prototype=Hu.prototype;function jv(t,i,l){this.props=t,this.context=i,this.refs=vE,this.updater=l||_E}var Gv=jv.prototype=new xE;Gv.constructor=jv;yE(Gv,Hu.prototype);Gv.isPureReactComponent=!0;var Ob=Array.isArray,wE=Object.prototype.hasOwnProperty,$v={current:null},bE={key:!0,ref:!0,__self:!0,__source:!0};function TE(t,i,l){var d,g={},w=null,E=null;if(i!=null)for(d in i.ref!==void 0&&(E=i.ref),i.key!==void 0&&(w=""+i.key),i)wE.call(i,d)&&!bE.hasOwnProperty(d)&&(g[d]=i[d]);var s=arguments.length-2;if(s===1)g.children=l;else if(1<s){for(var A=Array(s),z=0;z<s;z++)A[z]=arguments[z+2];g.children=A}if(t&&t.defaultProps)for(d in s=t.defaultProps,s)g[d]===void 0&&(g[d]=s[d]);return{$$typeof:Lf,type:t,key:w,ref:E,props:g,_owner:$v.current}}function JI(t,i){return{$$typeof:Lf,type:t.type,key:i,ref:t.ref,props:t.props,_owner:t._owner}}function Zv(t){return typeof t=="object"&&t!==null&&t.$$typeof===Lf}function QI(t){var i={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(l){return i[l]})}var Ub=/\/+/g;function Ny(t,i){return typeof t=="object"&&t!==null&&t.key!=null?QI(""+t.key):i.toString(36)}function Fm(t,i,l,d,g){var w=typeof t;(w==="undefined"||w==="boolean")&&(t=null);var E=!1;if(t===null)E=!0;else switch(w){case"string":case"number":E=!0;break;case"object":switch(t.$$typeof){case Lf:case NI:E=!0}}if(E)return E=t,g=g(E),t=d===""?"."+Ny(E,0):d,Ob(g)?(l="",t!=null&&(l=t.replace(Ub,"$&/")+"/"),Fm(g,i,l,"",function(z){return z})):g!=null&&(Zv(g)&&(g=JI(g,l+(!g.key||E&&E.key===g.key?"":(""+g.key).replace(Ub,"$&/")+"/")+t)),i.push(g)),1;if(E=0,d=d===""?".":d+":",Ob(t))for(var s=0;s<t.length;s++){w=t[s];var A=d+Ny(w,s);E+=Fm(w,i,l,A,g)}else if(A=YI(t),typeof A=="function")for(t=A.call(t),s=0;!(w=t.next()).done;)w=w.value,A=d+Ny(w,s++),E+=Fm(w,i,l,A,g);else if(w==="object")throw i=String(t),Error("Objects are not valid as a React child (found: "+(i==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return E}function mm(t,i,l){if(t==null)return t;var d=[],g=0;return Fm(t,d,"","",function(w){return i.call(l,w,g++)}),d}function ek(t){if(t._status===-1){var i=t._result;i=i(),i.then(function(l){(t._status===0||t._status===-1)&&(t._status=1,t._result=l)},function(l){(t._status===0||t._status===-1)&&(t._status=2,t._result=l)}),t._status===-1&&(t._status=0,t._result=i)}if(t._status===1)return t._result.default;throw t._result}var _r={current:null},Om={transition:null},tk={ReactCurrentDispatcher:_r,ReactCurrentBatchConfig:Om,ReactCurrentOwner:$v};cn.Children={map:mm,forEach:function(t,i,l){mm(t,function(){i.apply(this,arguments)},l)},count:function(t){var i=0;return mm(t,function(){i++}),i},toArray:function(t){return mm(t,function(i){return i})||[]},only:function(t){if(!Zv(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};cn.Component=Hu;cn.Fragment=jI;cn.Profiler=$I;cn.PureComponent=jv;cn.StrictMode=GI;cn.Suspense=XI;cn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tk;cn.cloneElement=function(t,i,l){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var d=yE({},t.props),g=t.key,w=t.ref,E=t._owner;if(i!=null){if(i.ref!==void 0&&(w=i.ref,E=$v.current),i.key!==void 0&&(g=""+i.key),t.type&&t.type.defaultProps)var s=t.type.defaultProps;for(A in i)wE.call(i,A)&&!bE.hasOwnProperty(A)&&(d[A]=i[A]===void 0&&s!==void 0?s[A]:i[A])}var A=arguments.length-2;if(A===1)d.children=l;else if(1<A){s=Array(A);for(var z=0;z<A;z++)s[z]=arguments[z+2];d.children=s}return{$$typeof:Lf,type:t.type,key:g,ref:w,props:d,_owner:E}};cn.createContext=function(t){return t={$$typeof:qI,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:ZI,_context:t},t.Consumer=t};cn.createElement=TE;cn.createFactory=function(t){var i=TE.bind(null,t);return i.type=t,i};cn.createRef=function(){return{current:null}};cn.forwardRef=function(t){return{$$typeof:WI,render:t}};cn.isValidElement=Zv;cn.lazy=function(t){return{$$typeof:KI,_payload:{_status:-1,_result:t},_init:ek}};cn.memo=function(t,i){return{$$typeof:HI,type:t,compare:i===void 0?null:i}};cn.startTransition=function(t){var i=Om.transition;Om.transition={};try{t()}finally{Om.transition=i}};cn.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};cn.useCallback=function(t,i){return _r.current.useCallback(t,i)};cn.useContext=function(t){return _r.current.useContext(t)};cn.useDebugValue=function(){};cn.useDeferredValue=function(t){return _r.current.useDeferredValue(t)};cn.useEffect=function(t,i){return _r.current.useEffect(t,i)};cn.useId=function(){return _r.current.useId()};cn.useImperativeHandle=function(t,i,l){return _r.current.useImperativeHandle(t,i,l)};cn.useInsertionEffect=function(t,i){return _r.current.useInsertionEffect(t,i)};cn.useLayoutEffect=function(t,i){return _r.current.useLayoutEffect(t,i)};cn.useMemo=function(t,i){return _r.current.useMemo(t,i)};cn.useReducer=function(t,i,l){return _r.current.useReducer(t,i,l)};cn.useRef=function(t){return _r.current.useRef(t)};cn.useState=function(t){return _r.current.useState(t)};cn.useSyncExternalStore=function(t,i,l){return _r.current.useSyncExternalStore(t,i,l)};cn.useTransition=function(){return _r.current.useTransition()};cn.version="18.2.0";gE.exports=cn;var De=gE.exports;const zg=pE(De),nk=UI({__proto__:null,default:zg},[De]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ik=De,rk=Symbol.for("react.element"),ok=Symbol.for("react.fragment"),sk=Object.prototype.hasOwnProperty,ak=ik.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,lk={key:!0,ref:!0,__self:!0,__source:!0};function EE(t,i,l){var d,g={},w=null,E=null;l!==void 0&&(w=""+l),i.key!==void 0&&(w=""+i.key),i.ref!==void 0&&(E=i.ref);for(d in i)sk.call(i,d)&&!lk.hasOwnProperty(d)&&(g[d]=i[d]);if(t&&t.defaultProps)for(d in i=t.defaultProps,i)g[d]===void 0&&(g[d]=i[d]);return{$$typeof:rk,type:t,key:w,ref:E,props:g,_owner:ak.current}}Dg.Fragment=ok;Dg.jsx=EE;Dg.jsxs=EE;mE.exports=Dg;var qe=mE.exports;var M0={},SE={exports:{}},Xr={},CE={exports:{}},AE={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function i(Xe,Mt){var Tt=Xe.length;Xe.push(Mt);e:for(;0<Tt;){var wt=Tt-1>>>1,nn=Xe[wt];if(0<g(nn,Mt))Xe[wt]=Mt,Xe[Tt]=nn,Tt=wt;else break e}}function l(Xe){return Xe.length===0?null:Xe[0]}function d(Xe){if(Xe.length===0)return null;var Mt=Xe[0],Tt=Xe.pop();if(Tt!==Mt){Xe[0]=Tt;e:for(var wt=0,nn=Xe.length,fn=nn>>>1;wt<fn;){var Qt=2*(wt+1)-1,mi=Xe[Qt],Un=Qt+1,gi=Xe[Un];if(0>g(mi,Tt))Un<nn&&0>g(gi,mi)?(Xe[wt]=gi,Xe[Un]=Tt,wt=Un):(Xe[wt]=mi,Xe[Qt]=Tt,wt=Qt);else if(Un<nn&&0>g(gi,Tt))Xe[wt]=gi,Xe[Un]=Tt,wt=Un;else break e}}return Mt}function g(Xe,Mt){var Tt=Xe.sortIndex-Mt.sortIndex;return Tt!==0?Tt:Xe.id-Mt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var w=performance;t.unstable_now=function(){return w.now()}}else{var E=Date,s=E.now();t.unstable_now=function(){return E.now()-s}}var A=[],z=[],V=1,j=null,G=3,re=!1,he=!1,ve=!1,Ue=typeof setTimeout=="function"?setTimeout:null,ae=typeof clearTimeout=="function"?clearTimeout:null,J=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function se(Xe){for(var Mt=l(z);Mt!==null;){if(Mt.callback===null)d(z);else if(Mt.startTime<=Xe)d(z),Mt.sortIndex=Mt.expirationTime,i(A,Mt);else break;Mt=l(z)}}function oe(Xe){if(ve=!1,se(Xe),!he)if(l(A)!==null)he=!0,Bn(Be);else{var Mt=l(z);Mt!==null&&Xn(oe,Mt.startTime-Xe)}}function Be(Xe,Mt){he=!1,ve&&(ve=!1,ae(He),He=-1),re=!0;var Tt=G;try{for(se(Mt),j=l(A);j!==null&&(!(j.expirationTime>Mt)||Xe&&!dn());){var wt=j.callback;if(typeof wt=="function"){j.callback=null,G=j.priorityLevel;var nn=wt(j.expirationTime<=Mt);Mt=t.unstable_now(),typeof nn=="function"?j.callback=nn:j===l(A)&&d(A),se(Mt)}else d(A);j=l(A)}if(j!==null)var fn=!0;else{var Qt=l(z);Qt!==null&&Xn(oe,Qt.startTime-Mt),fn=!1}return fn}finally{j=null,G=Tt,re=!1}}var at=!1,Ye=null,He=-1,ze=5,kt=-1;function dn(){return!(t.unstable_now()-kt<ze)}function gt(){if(Ye!==null){var Xe=t.unstable_now();kt=Xe;var Mt=!0;try{Mt=Ye(!0,Xe)}finally{Mt?Jt():(at=!1,Ye=null)}}else at=!1}var Jt;if(typeof J=="function")Jt=function(){J(gt)};else if(typeof MessageChannel<"u"){var Sn=new MessageChannel,un=Sn.port2;Sn.port1.onmessage=gt,Jt=function(){un.postMessage(null)}}else Jt=function(){Ue(gt,0)};function Bn(Xe){Ye=Xe,at||(at=!0,Jt())}function Xn(Xe,Mt){He=Ue(function(){Xe(t.unstable_now())},Mt)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Xe){Xe.callback=null},t.unstable_continueExecution=function(){he||re||(he=!0,Bn(Be))},t.unstable_forceFrameRate=function(Xe){0>Xe||125<Xe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ze=0<Xe?Math.floor(1e3/Xe):5},t.unstable_getCurrentPriorityLevel=function(){return G},t.unstable_getFirstCallbackNode=function(){return l(A)},t.unstable_next=function(Xe){switch(G){case 1:case 2:case 3:var Mt=3;break;default:Mt=G}var Tt=G;G=Mt;try{return Xe()}finally{G=Tt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Xe,Mt){switch(Xe){case 1:case 2:case 3:case 4:case 5:break;default:Xe=3}var Tt=G;G=Xe;try{return Mt()}finally{G=Tt}},t.unstable_scheduleCallback=function(Xe,Mt,Tt){var wt=t.unstable_now();switch(typeof Tt=="object"&&Tt!==null?(Tt=Tt.delay,Tt=typeof Tt=="number"&&0<Tt?wt+Tt:wt):Tt=wt,Xe){case 1:var nn=-1;break;case 2:nn=250;break;case 5:nn=1073741823;break;case 4:nn=1e4;break;default:nn=5e3}return nn=Tt+nn,Xe={id:V++,callback:Mt,priorityLevel:Xe,startTime:Tt,expirationTime:nn,sortIndex:-1},Tt>wt?(Xe.sortIndex=Tt,i(z,Xe),l(A)===null&&Xe===l(z)&&(ve?(ae(He),He=-1):ve=!0,Xn(oe,Tt-wt))):(Xe.sortIndex=nn,i(A,Xe),he||re||(he=!0,Bn(Be))),Xe},t.unstable_shouldYield=dn,t.unstable_wrapCallback=function(Xe){var Mt=G;return function(){var Tt=G;G=Mt;try{return Xe.apply(this,arguments)}finally{G=Tt}}}})(AE);CE.exports=AE;var ck=CE.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ME=De,qr=ck;function ct(t){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+t,l=1;l<arguments.length;l++)i+="&args[]="+encodeURIComponent(arguments[l]);return"Minified React error #"+t+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var PE=new Set,hf={};function lc(t,i){Uu(t,i),Uu(t+"Capture",i)}function Uu(t,i){for(hf[t]=i,t=0;t<i.length;t++)PE.add(i[t])}var Ws=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),P0=Object.prototype.hasOwnProperty,uk=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Vb={},Nb={};function hk(t){return P0.call(Nb,t)?!0:P0.call(Vb,t)?!1:uk.test(t)?Nb[t]=!0:(Vb[t]=!0,!1)}function dk(t,i,l,d){if(l!==null&&l.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return d?!1:l!==null?!l.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function fk(t,i,l,d){if(i===null||typeof i>"u"||dk(t,i,l,d))return!0;if(d)return!1;if(l!==null)switch(l.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function yr(t,i,l,d,g,w,E){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=d,this.attributeNamespace=g,this.mustUseProperty=l,this.propertyName=t,this.type=i,this.sanitizeURL=w,this.removeEmptyString=E}var Xi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Xi[t]=new yr(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var i=t[0];Xi[i]=new yr(i,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Xi[t]=new yr(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Xi[t]=new yr(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Xi[t]=new yr(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Xi[t]=new yr(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Xi[t]=new yr(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Xi[t]=new yr(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Xi[t]=new yr(t,5,!1,t.toLowerCase(),null,!1,!1)});var qv=/[\-:]([a-z])/g;function Wv(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var i=t.replace(qv,Wv);Xi[i]=new yr(i,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var i=t.replace(qv,Wv);Xi[i]=new yr(i,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var i=t.replace(qv,Wv);Xi[i]=new yr(i,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Xi[t]=new yr(t,1,!1,t.toLowerCase(),null,!1,!1)});Xi.xlinkHref=new yr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Xi[t]=new yr(t,1,!1,t.toLowerCase(),null,!0,!0)});function Xv(t,i,l,d){var g=Xi.hasOwnProperty(i)?Xi[i]:null;(g!==null?g.type!==0:d||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(fk(i,l,g,d)&&(l=null),d||g===null?hk(i)&&(l===null?t.removeAttribute(i):t.setAttribute(i,""+l)):g.mustUseProperty?t[g.propertyName]=l===null?g.type===3?!1:"":l:(i=g.attributeName,d=g.attributeNamespace,l===null?t.removeAttribute(i):(g=g.type,l=g===3||g===4&&l===!0?"":""+l,d?t.setAttributeNS(d,i,l):t.setAttribute(i,l))))}var Js=ME.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,gm=Symbol.for("react.element"),fu=Symbol.for("react.portal"),pu=Symbol.for("react.fragment"),Hv=Symbol.for("react.strict_mode"),I0=Symbol.for("react.profiler"),IE=Symbol.for("react.provider"),kE=Symbol.for("react.context"),Kv=Symbol.for("react.forward_ref"),k0=Symbol.for("react.suspense"),D0=Symbol.for("react.suspense_list"),Yv=Symbol.for("react.memo"),ka=Symbol.for("react.lazy"),DE=Symbol.for("react.offscreen"),jb=Symbol.iterator;function kd(t){return t===null||typeof t!="object"?null:(t=jb&&t[jb]||t["@@iterator"],typeof t=="function"?t:null)}var di=Object.assign,jy;function Zd(t){if(jy===void 0)try{throw Error()}catch(l){var i=l.stack.trim().match(/\n( *(at )?)/);jy=i&&i[1]||""}return`
`+jy+t}var Gy=!1;function $y(t,i){if(!t||Gy)return"";Gy=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(z){var d=z}Reflect.construct(t,[],i)}else{try{i.call()}catch(z){d=z}t.call(i.prototype)}else{try{throw Error()}catch(z){d=z}t()}}catch(z){if(z&&d&&typeof z.stack=="string"){for(var g=z.stack.split(`
`),w=d.stack.split(`
`),E=g.length-1,s=w.length-1;1<=E&&0<=s&&g[E]!==w[s];)s--;for(;1<=E&&0<=s;E--,s--)if(g[E]!==w[s]){if(E!==1||s!==1)do if(E--,s--,0>s||g[E]!==w[s]){var A=`
`+g[E].replace(" at new "," at ");return t.displayName&&A.includes("<anonymous>")&&(A=A.replace("<anonymous>",t.displayName)),A}while(1<=E&&0<=s);break}}}finally{Gy=!1,Error.prepareStackTrace=l}return(t=t?t.displayName||t.name:"")?Zd(t):""}function pk(t){switch(t.tag){case 5:return Zd(t.type);case 16:return Zd("Lazy");case 13:return Zd("Suspense");case 19:return Zd("SuspenseList");case 0:case 2:case 15:return t=$y(t.type,!1),t;case 11:return t=$y(t.type.render,!1),t;case 1:return t=$y(t.type,!0),t;default:return""}}function z0(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case pu:return"Fragment";case fu:return"Portal";case I0:return"Profiler";case Hv:return"StrictMode";case k0:return"Suspense";case D0:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case kE:return(t.displayName||"Context")+".Consumer";case IE:return(t._context.displayName||"Context")+".Provider";case Kv:var i=t.render;return t=t.displayName,t||(t=i.displayName||i.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Yv:return i=t.displayName||null,i!==null?i:z0(t.type)||"Memo";case ka:i=t._payload,t=t._init;try{return z0(t(i))}catch{}}return null}function mk(t){var i=t.type;switch(t.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=i.render,t=t.displayName||t.name||"",i.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return z0(i);case 8:return i===Hv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function Xa(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function zE(t){var i=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function gk(t){var i=zE(t)?"checked":"value",l=Object.getOwnPropertyDescriptor(t.constructor.prototype,i),d=""+t[i];if(!t.hasOwnProperty(i)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var g=l.get,w=l.set;return Object.defineProperty(t,i,{configurable:!0,get:function(){return g.call(this)},set:function(E){d=""+E,w.call(this,E)}}),Object.defineProperty(t,i,{enumerable:l.enumerable}),{getValue:function(){return d},setValue:function(E){d=""+E},stopTracking:function(){t._valueTracker=null,delete t[i]}}}}function _m(t){t._valueTracker||(t._valueTracker=gk(t))}function LE(t){if(!t)return!1;var i=t._valueTracker;if(!i)return!0;var l=i.getValue(),d="";return t&&(d=zE(t)?t.checked?"true":"false":t.value),t=d,t!==l?(i.setValue(t),!0):!1}function Jm(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function L0(t,i){var l=i.checked;return di({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:l??t._wrapperState.initialChecked})}function Gb(t,i){var l=i.defaultValue==null?"":i.defaultValue,d=i.checked!=null?i.checked:i.defaultChecked;l=Xa(i.value!=null?i.value:l),t._wrapperState={initialChecked:d,initialValue:l,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function RE(t,i){i=i.checked,i!=null&&Xv(t,"checked",i,!1)}function R0(t,i){RE(t,i);var l=Xa(i.value),d=i.type;if(l!=null)d==="number"?(l===0&&t.value===""||t.value!=l)&&(t.value=""+l):t.value!==""+l&&(t.value=""+l);else if(d==="submit"||d==="reset"){t.removeAttribute("value");return}i.hasOwnProperty("value")?B0(t,i.type,l):i.hasOwnProperty("defaultValue")&&B0(t,i.type,Xa(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(t.defaultChecked=!!i.defaultChecked)}function $b(t,i,l){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var d=i.type;if(!(d!=="submit"&&d!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+t._wrapperState.initialValue,l||i===t.value||(t.value=i),t.defaultValue=i}l=t.name,l!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,l!==""&&(t.name=l)}function B0(t,i,l){(i!=="number"||Jm(t.ownerDocument)!==t)&&(l==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+l&&(t.defaultValue=""+l))}var qd=Array.isArray;function ku(t,i,l,d){if(t=t.options,i){i={};for(var g=0;g<l.length;g++)i["$"+l[g]]=!0;for(l=0;l<t.length;l++)g=i.hasOwnProperty("$"+t[l].value),t[l].selected!==g&&(t[l].selected=g),g&&d&&(t[l].defaultSelected=!0)}else{for(l=""+Xa(l),i=null,g=0;g<t.length;g++){if(t[g].value===l){t[g].selected=!0,d&&(t[g].defaultSelected=!0);return}i!==null||t[g].disabled||(i=t[g])}i!==null&&(i.selected=!0)}}function F0(t,i){if(i.dangerouslySetInnerHTML!=null)throw Error(ct(91));return di({},i,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Zb(t,i){var l=i.value;if(l==null){if(l=i.children,i=i.defaultValue,l!=null){if(i!=null)throw Error(ct(92));if(qd(l)){if(1<l.length)throw Error(ct(93));l=l[0]}i=l}i==null&&(i=""),l=i}t._wrapperState={initialValue:Xa(l)}}function BE(t,i){var l=Xa(i.value),d=Xa(i.defaultValue);l!=null&&(l=""+l,l!==t.value&&(t.value=l),i.defaultValue==null&&t.defaultValue!==l&&(t.defaultValue=l)),d!=null&&(t.defaultValue=""+d)}function qb(t){var i=t.textContent;i===t._wrapperState.initialValue&&i!==""&&i!==null&&(t.value=i)}function FE(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function O0(t,i){return t==null||t==="http://www.w3.org/1999/xhtml"?FE(i):t==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ym,OE=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,l,d,g){MSApp.execUnsafeLocalFunction(function(){return t(i,l,d,g)})}:t}(function(t,i){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=i;else{for(ym=ym||document.createElement("div"),ym.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=ym.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;i.firstChild;)t.appendChild(i.firstChild)}});function df(t,i){if(i){var l=t.firstChild;if(l&&l===t.lastChild&&l.nodeType===3){l.nodeValue=i;return}}t.textContent=i}var Kd={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},_k=["Webkit","ms","Moz","O"];Object.keys(Kd).forEach(function(t){_k.forEach(function(i){i=i+t.charAt(0).toUpperCase()+t.substring(1),Kd[i]=Kd[t]})});function UE(t,i,l){return i==null||typeof i=="boolean"||i===""?"":l||typeof i!="number"||i===0||Kd.hasOwnProperty(t)&&Kd[t]?(""+i).trim():i+"px"}function VE(t,i){t=t.style;for(var l in i)if(i.hasOwnProperty(l)){var d=l.indexOf("--")===0,g=UE(l,i[l],d);l==="float"&&(l="cssFloat"),d?t.setProperty(l,g):t[l]=g}}var yk=di({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function U0(t,i){if(i){if(yk[t]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(ct(137,t));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(ct(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(ct(61))}if(i.style!=null&&typeof i.style!="object")throw Error(ct(62))}}function V0(t,i){if(t.indexOf("-")===-1)return typeof i.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var N0=null;function Jv(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var j0=null,Du=null,zu=null;function Wb(t){if(t=Ff(t)){if(typeof j0!="function")throw Error(ct(280));var i=t.stateNode;i&&(i=Og(i),j0(t.stateNode,t.type,i))}}function NE(t){Du?zu?zu.push(t):zu=[t]:Du=t}function jE(){if(Du){var t=Du,i=zu;if(zu=Du=null,Wb(t),i)for(t=0;t<i.length;t++)Wb(i[t])}}function GE(t,i){return t(i)}function $E(){}var Zy=!1;function ZE(t,i,l){if(Zy)return t(i,l);Zy=!0;try{return GE(t,i,l)}finally{Zy=!1,(Du!==null||zu!==null)&&($E(),jE())}}function ff(t,i){var l=t.stateNode;if(l===null)return null;var d=Og(l);if(d===null)return null;l=d[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(t=t.type,d=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!d;break e;default:t=!1}if(t)return null;if(l&&typeof l!="function")throw Error(ct(231,i,typeof l));return l}var G0=!1;if(Ws)try{var Dd={};Object.defineProperty(Dd,"passive",{get:function(){G0=!0}}),window.addEventListener("test",Dd,Dd),window.removeEventListener("test",Dd,Dd)}catch{G0=!1}function vk(t,i,l,d,g,w,E,s,A){var z=Array.prototype.slice.call(arguments,3);try{i.apply(l,z)}catch(V){this.onError(V)}}var Yd=!1,Qm=null,eg=!1,$0=null,xk={onError:function(t){Yd=!0,Qm=t}};function wk(t,i,l,d,g,w,E,s,A){Yd=!1,Qm=null,vk.apply(xk,arguments)}function bk(t,i,l,d,g,w,E,s,A){if(wk.apply(this,arguments),Yd){if(Yd){var z=Qm;Yd=!1,Qm=null}else throw Error(ct(198));eg||(eg=!0,$0=z)}}function cc(t){var i=t,l=t;if(t.alternate)for(;i.return;)i=i.return;else{t=i;do i=t,i.flags&4098&&(l=i.return),t=i.return;while(t)}return i.tag===3?l:null}function qE(t){if(t.tag===13){var i=t.memoizedState;if(i===null&&(t=t.alternate,t!==null&&(i=t.memoizedState)),i!==null)return i.dehydrated}return null}function Xb(t){if(cc(t)!==t)throw Error(ct(188))}function Tk(t){var i=t.alternate;if(!i){if(i=cc(t),i===null)throw Error(ct(188));return i!==t?null:t}for(var l=t,d=i;;){var g=l.return;if(g===null)break;var w=g.alternate;if(w===null){if(d=g.return,d!==null){l=d;continue}break}if(g.child===w.child){for(w=g.child;w;){if(w===l)return Xb(g),t;if(w===d)return Xb(g),i;w=w.sibling}throw Error(ct(188))}if(l.return!==d.return)l=g,d=w;else{for(var E=!1,s=g.child;s;){if(s===l){E=!0,l=g,d=w;break}if(s===d){E=!0,d=g,l=w;break}s=s.sibling}if(!E){for(s=w.child;s;){if(s===l){E=!0,l=w,d=g;break}if(s===d){E=!0,d=w,l=g;break}s=s.sibling}if(!E)throw Error(ct(189))}}if(l.alternate!==d)throw Error(ct(190))}if(l.tag!==3)throw Error(ct(188));return l.stateNode.current===l?t:i}function WE(t){return t=Tk(t),t!==null?XE(t):null}function XE(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var i=XE(t);if(i!==null)return i;t=t.sibling}return null}var HE=qr.unstable_scheduleCallback,Hb=qr.unstable_cancelCallback,Ek=qr.unstable_shouldYield,Sk=qr.unstable_requestPaint,_i=qr.unstable_now,Ck=qr.unstable_getCurrentPriorityLevel,Qv=qr.unstable_ImmediatePriority,KE=qr.unstable_UserBlockingPriority,tg=qr.unstable_NormalPriority,Ak=qr.unstable_LowPriority,YE=qr.unstable_IdlePriority,Lg=null,ps=null;function Mk(t){if(ps&&typeof ps.onCommitFiberRoot=="function")try{ps.onCommitFiberRoot(Lg,t,void 0,(t.current.flags&128)===128)}catch{}}var $o=Math.clz32?Math.clz32:kk,Pk=Math.log,Ik=Math.LN2;function kk(t){return t>>>=0,t===0?32:31-(Pk(t)/Ik|0)|0}var vm=64,xm=4194304;function Wd(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function ng(t,i){var l=t.pendingLanes;if(l===0)return 0;var d=0,g=t.suspendedLanes,w=t.pingedLanes,E=l&268435455;if(E!==0){var s=E&~g;s!==0?d=Wd(s):(w&=E,w!==0&&(d=Wd(w)))}else E=l&~g,E!==0?d=Wd(E):w!==0&&(d=Wd(w));if(d===0)return 0;if(i!==0&&i!==d&&!(i&g)&&(g=d&-d,w=i&-i,g>=w||g===16&&(w&4194240)!==0))return i;if(d&4&&(d|=l&16),i=t.entangledLanes,i!==0)for(t=t.entanglements,i&=d;0<i;)l=31-$o(i),g=1<<l,d|=t[l],i&=~g;return d}function Dk(t,i){switch(t){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zk(t,i){for(var l=t.suspendedLanes,d=t.pingedLanes,g=t.expirationTimes,w=t.pendingLanes;0<w;){var E=31-$o(w),s=1<<E,A=g[E];A===-1?(!(s&l)||s&d)&&(g[E]=Dk(s,i)):A<=i&&(t.expiredLanes|=s),w&=~s}}function Z0(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function JE(){var t=vm;return vm<<=1,!(vm&4194240)&&(vm=64),t}function qy(t){for(var i=[],l=0;31>l;l++)i.push(t);return i}function Rf(t,i,l){t.pendingLanes|=i,i!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,i=31-$o(i),t[i]=l}function Lk(t,i){var l=t.pendingLanes&~i;t.pendingLanes=i,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=i,t.mutableReadLanes&=i,t.entangledLanes&=i,i=t.entanglements;var d=t.eventTimes;for(t=t.expirationTimes;0<l;){var g=31-$o(l),w=1<<g;i[g]=0,d[g]=-1,t[g]=-1,l&=~w}}function ex(t,i){var l=t.entangledLanes|=i;for(t=t.entanglements;l;){var d=31-$o(l),g=1<<d;g&i|t[d]&i&&(t[d]|=i),l&=~g}}var Rn=0;function QE(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var eS,tx,tS,nS,iS,q0=!1,wm=[],Oa=null,Ua=null,Va=null,pf=new Map,mf=new Map,La=[],Rk="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Kb(t,i){switch(t){case"focusin":case"focusout":Oa=null;break;case"dragenter":case"dragleave":Ua=null;break;case"mouseover":case"mouseout":Va=null;break;case"pointerover":case"pointerout":pf.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":mf.delete(i.pointerId)}}function zd(t,i,l,d,g,w){return t===null||t.nativeEvent!==w?(t={blockedOn:i,domEventName:l,eventSystemFlags:d,nativeEvent:w,targetContainers:[g]},i!==null&&(i=Ff(i),i!==null&&tx(i)),t):(t.eventSystemFlags|=d,i=t.targetContainers,g!==null&&i.indexOf(g)===-1&&i.push(g),t)}function Bk(t,i,l,d,g){switch(i){case"focusin":return Oa=zd(Oa,t,i,l,d,g),!0;case"dragenter":return Ua=zd(Ua,t,i,l,d,g),!0;case"mouseover":return Va=zd(Va,t,i,l,d,g),!0;case"pointerover":var w=g.pointerId;return pf.set(w,zd(pf.get(w)||null,t,i,l,d,g)),!0;case"gotpointercapture":return w=g.pointerId,mf.set(w,zd(mf.get(w)||null,t,i,l,d,g)),!0}return!1}function rS(t){var i=Xl(t.target);if(i!==null){var l=cc(i);if(l!==null){if(i=l.tag,i===13){if(i=qE(l),i!==null){t.blockedOn=i,iS(t.priority,function(){tS(l)});return}}else if(i===3&&l.stateNode.current.memoizedState.isDehydrated){t.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Um(t){if(t.blockedOn!==null)return!1;for(var i=t.targetContainers;0<i.length;){var l=W0(t.domEventName,t.eventSystemFlags,i[0],t.nativeEvent);if(l===null){l=t.nativeEvent;var d=new l.constructor(l.type,l);N0=d,l.target.dispatchEvent(d),N0=null}else return i=Ff(l),i!==null&&tx(i),t.blockedOn=l,!1;i.shift()}return!0}function Yb(t,i,l){Um(t)&&l.delete(i)}function Fk(){q0=!1,Oa!==null&&Um(Oa)&&(Oa=null),Ua!==null&&Um(Ua)&&(Ua=null),Va!==null&&Um(Va)&&(Va=null),pf.forEach(Yb),mf.forEach(Yb)}function Ld(t,i){t.blockedOn===i&&(t.blockedOn=null,q0||(q0=!0,qr.unstable_scheduleCallback(qr.unstable_NormalPriority,Fk)))}function gf(t){function i(g){return Ld(g,t)}if(0<wm.length){Ld(wm[0],t);for(var l=1;l<wm.length;l++){var d=wm[l];d.blockedOn===t&&(d.blockedOn=null)}}for(Oa!==null&&Ld(Oa,t),Ua!==null&&Ld(Ua,t),Va!==null&&Ld(Va,t),pf.forEach(i),mf.forEach(i),l=0;l<La.length;l++)d=La[l],d.blockedOn===t&&(d.blockedOn=null);for(;0<La.length&&(l=La[0],l.blockedOn===null);)rS(l),l.blockedOn===null&&La.shift()}var Lu=Js.ReactCurrentBatchConfig,ig=!0;function Ok(t,i,l,d){var g=Rn,w=Lu.transition;Lu.transition=null;try{Rn=1,nx(t,i,l,d)}finally{Rn=g,Lu.transition=w}}function Uk(t,i,l,d){var g=Rn,w=Lu.transition;Lu.transition=null;try{Rn=4,nx(t,i,l,d)}finally{Rn=g,Lu.transition=w}}function nx(t,i,l,d){if(ig){var g=W0(t,i,l,d);if(g===null)n0(t,i,d,rg,l),Kb(t,d);else if(Bk(g,t,i,l,d))d.stopPropagation();else if(Kb(t,d),i&4&&-1<Rk.indexOf(t)){for(;g!==null;){var w=Ff(g);if(w!==null&&eS(w),w=W0(t,i,l,d),w===null&&n0(t,i,d,rg,l),w===g)break;g=w}g!==null&&d.stopPropagation()}else n0(t,i,d,null,l)}}var rg=null;function W0(t,i,l,d){if(rg=null,t=Jv(d),t=Xl(t),t!==null)if(i=cc(t),i===null)t=null;else if(l=i.tag,l===13){if(t=qE(i),t!==null)return t;t=null}else if(l===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;t=null}else i!==t&&(t=null);return rg=t,null}function oS(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ck()){case Qv:return 1;case KE:return 4;case tg:case Ak:return 16;case YE:return 536870912;default:return 16}default:return 16}}var Ba=null,ix=null,Vm=null;function sS(){if(Vm)return Vm;var t,i=ix,l=i.length,d,g="value"in Ba?Ba.value:Ba.textContent,w=g.length;for(t=0;t<l&&i[t]===g[t];t++);var E=l-t;for(d=1;d<=E&&i[l-d]===g[w-d];d++);return Vm=g.slice(t,1<d?1-d:void 0)}function Nm(t){var i=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&i===13&&(t=13)):t=i,t===10&&(t=13),32<=t||t===13?t:0}function bm(){return!0}function Jb(){return!1}function Hr(t){function i(l,d,g,w,E){this._reactName=l,this._targetInst=g,this.type=d,this.nativeEvent=w,this.target=E,this.currentTarget=null;for(var s in t)t.hasOwnProperty(s)&&(l=t[s],this[s]=l?l(w):w[s]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?bm:Jb,this.isPropagationStopped=Jb,this}return di(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=bm)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=bm)},persist:function(){},isPersistent:bm}),i}var Ku={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rx=Hr(Ku),Bf=di({},Ku,{view:0,detail:0}),Vk=Hr(Bf),Wy,Xy,Rd,Rg=di({},Bf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ox,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Rd&&(Rd&&t.type==="mousemove"?(Wy=t.screenX-Rd.screenX,Xy=t.screenY-Rd.screenY):Xy=Wy=0,Rd=t),Wy)},movementY:function(t){return"movementY"in t?t.movementY:Xy}}),Qb=Hr(Rg),Nk=di({},Rg,{dataTransfer:0}),jk=Hr(Nk),Gk=di({},Bf,{relatedTarget:0}),Hy=Hr(Gk),$k=di({},Ku,{animationName:0,elapsedTime:0,pseudoElement:0}),Zk=Hr($k),qk=di({},Ku,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Wk=Hr(qk),Xk=di({},Ku,{data:0}),eT=Hr(Xk),Hk={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Kk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Yk={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Jk(t){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(t):(t=Yk[t])?!!i[t]:!1}function ox(){return Jk}var Qk=di({},Bf,{key:function(t){if(t.key){var i=Hk[t.key]||t.key;if(i!=="Unidentified")return i}return t.type==="keypress"?(t=Nm(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Kk[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ox,charCode:function(t){return t.type==="keypress"?Nm(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Nm(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),eD=Hr(Qk),tD=di({},Rg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),tT=Hr(tD),nD=di({},Bf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ox}),iD=Hr(nD),rD=di({},Ku,{propertyName:0,elapsedTime:0,pseudoElement:0}),oD=Hr(rD),sD=di({},Rg,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),aD=Hr(sD),lD=[9,13,27,32],sx=Ws&&"CompositionEvent"in window,Jd=null;Ws&&"documentMode"in document&&(Jd=document.documentMode);var cD=Ws&&"TextEvent"in window&&!Jd,aS=Ws&&(!sx||Jd&&8<Jd&&11>=Jd),nT=String.fromCharCode(32),iT=!1;function lS(t,i){switch(t){case"keyup":return lD.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function cS(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var mu=!1;function uD(t,i){switch(t){case"compositionend":return cS(i);case"keypress":return i.which!==32?null:(iT=!0,nT);case"textInput":return t=i.data,t===nT&&iT?null:t;default:return null}}function hD(t,i){if(mu)return t==="compositionend"||!sx&&lS(t,i)?(t=sS(),Vm=ix=Ba=null,mu=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return aS&&i.locale!=="ko"?null:i.data;default:return null}}var dD={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function rT(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i==="input"?!!dD[t.type]:i==="textarea"}function uS(t,i,l,d){NE(d),i=og(i,"onChange"),0<i.length&&(l=new rx("onChange","change",null,l,d),t.push({event:l,listeners:i}))}var Qd=null,_f=null;function fD(t){wS(t,0)}function Bg(t){var i=yu(t);if(LE(i))return t}function pD(t,i){if(t==="change")return i}var hS=!1;if(Ws){var Ky;if(Ws){var Yy="oninput"in document;if(!Yy){var oT=document.createElement("div");oT.setAttribute("oninput","return;"),Yy=typeof oT.oninput=="function"}Ky=Yy}else Ky=!1;hS=Ky&&(!document.documentMode||9<document.documentMode)}function sT(){Qd&&(Qd.detachEvent("onpropertychange",dS),_f=Qd=null)}function dS(t){if(t.propertyName==="value"&&Bg(_f)){var i=[];uS(i,_f,t,Jv(t)),ZE(fD,i)}}function mD(t,i,l){t==="focusin"?(sT(),Qd=i,_f=l,Qd.attachEvent("onpropertychange",dS)):t==="focusout"&&sT()}function gD(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Bg(_f)}function _D(t,i){if(t==="click")return Bg(i)}function yD(t,i){if(t==="input"||t==="change")return Bg(i)}function vD(t,i){return t===i&&(t!==0||1/t===1/i)||t!==t&&i!==i}var qo=typeof Object.is=="function"?Object.is:vD;function yf(t,i){if(qo(t,i))return!0;if(typeof t!="object"||t===null||typeof i!="object"||i===null)return!1;var l=Object.keys(t),d=Object.keys(i);if(l.length!==d.length)return!1;for(d=0;d<l.length;d++){var g=l[d];if(!P0.call(i,g)||!qo(t[g],i[g]))return!1}return!0}function aT(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function lT(t,i){var l=aT(t);t=0;for(var d;l;){if(l.nodeType===3){if(d=t+l.textContent.length,t<=i&&d>=i)return{node:l,offset:i-t};t=d}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=aT(l)}}function fS(t,i){return t&&i?t===i?!0:t&&t.nodeType===3?!1:i&&i.nodeType===3?fS(t,i.parentNode):"contains"in t?t.contains(i):t.compareDocumentPosition?!!(t.compareDocumentPosition(i)&16):!1:!1}function pS(){for(var t=window,i=Jm();i instanceof t.HTMLIFrameElement;){try{var l=typeof i.contentWindow.location.href=="string"}catch{l=!1}if(l)t=i.contentWindow;else break;i=Jm(t.document)}return i}function ax(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i&&(i==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||i==="textarea"||t.contentEditable==="true")}function xD(t){var i=pS(),l=t.focusedElem,d=t.selectionRange;if(i!==l&&l&&l.ownerDocument&&fS(l.ownerDocument.documentElement,l)){if(d!==null&&ax(l)){if(i=d.start,t=d.end,t===void 0&&(t=i),"selectionStart"in l)l.selectionStart=i,l.selectionEnd=Math.min(t,l.value.length);else if(t=(i=l.ownerDocument||document)&&i.defaultView||window,t.getSelection){t=t.getSelection();var g=l.textContent.length,w=Math.min(d.start,g);d=d.end===void 0?w:Math.min(d.end,g),!t.extend&&w>d&&(g=d,d=w,w=g),g=lT(l,w);var E=lT(l,d);g&&E&&(t.rangeCount!==1||t.anchorNode!==g.node||t.anchorOffset!==g.offset||t.focusNode!==E.node||t.focusOffset!==E.offset)&&(i=i.createRange(),i.setStart(g.node,g.offset),t.removeAllRanges(),w>d?(t.addRange(i),t.extend(E.node,E.offset)):(i.setEnd(E.node,E.offset),t.addRange(i)))}}for(i=[],t=l;t=t.parentNode;)t.nodeType===1&&i.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<i.length;l++)t=i[l],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var wD=Ws&&"documentMode"in document&&11>=document.documentMode,gu=null,X0=null,ef=null,H0=!1;function cT(t,i,l){var d=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;H0||gu==null||gu!==Jm(d)||(d=gu,"selectionStart"in d&&ax(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),ef&&yf(ef,d)||(ef=d,d=og(X0,"onSelect"),0<d.length&&(i=new rx("onSelect","select",null,i,l),t.push({event:i,listeners:d}),i.target=gu)))}function Tm(t,i){var l={};return l[t.toLowerCase()]=i.toLowerCase(),l["Webkit"+t]="webkit"+i,l["Moz"+t]="moz"+i,l}var _u={animationend:Tm("Animation","AnimationEnd"),animationiteration:Tm("Animation","AnimationIteration"),animationstart:Tm("Animation","AnimationStart"),transitionend:Tm("Transition","TransitionEnd")},Jy={},mS={};Ws&&(mS=document.createElement("div").style,"AnimationEvent"in window||(delete _u.animationend.animation,delete _u.animationiteration.animation,delete _u.animationstart.animation),"TransitionEvent"in window||delete _u.transitionend.transition);function Fg(t){if(Jy[t])return Jy[t];if(!_u[t])return t;var i=_u[t],l;for(l in i)if(i.hasOwnProperty(l)&&l in mS)return Jy[t]=i[l];return t}var gS=Fg("animationend"),_S=Fg("animationiteration"),yS=Fg("animationstart"),vS=Fg("transitionend"),xS=new Map,uT="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ja(t,i){xS.set(t,i),lc(i,[t])}for(var Qy=0;Qy<uT.length;Qy++){var e0=uT[Qy],bD=e0.toLowerCase(),TD=e0[0].toUpperCase()+e0.slice(1);Ja(bD,"on"+TD)}Ja(gS,"onAnimationEnd");Ja(_S,"onAnimationIteration");Ja(yS,"onAnimationStart");Ja("dblclick","onDoubleClick");Ja("focusin","onFocus");Ja("focusout","onBlur");Ja(vS,"onTransitionEnd");Uu("onMouseEnter",["mouseout","mouseover"]);Uu("onMouseLeave",["mouseout","mouseover"]);Uu("onPointerEnter",["pointerout","pointerover"]);Uu("onPointerLeave",["pointerout","pointerover"]);lc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));lc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));lc("onBeforeInput",["compositionend","keypress","textInput","paste"]);lc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));lc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));lc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ED=new Set("cancel close invalid load scroll toggle".split(" ").concat(Xd));function hT(t,i,l){var d=t.type||"unknown-event";t.currentTarget=l,bk(d,i,void 0,t),t.currentTarget=null}function wS(t,i){i=(i&4)!==0;for(var l=0;l<t.length;l++){var d=t[l],g=d.event;d=d.listeners;e:{var w=void 0;if(i)for(var E=d.length-1;0<=E;E--){var s=d[E],A=s.instance,z=s.currentTarget;if(s=s.listener,A!==w&&g.isPropagationStopped())break e;hT(g,s,z),w=A}else for(E=0;E<d.length;E++){if(s=d[E],A=s.instance,z=s.currentTarget,s=s.listener,A!==w&&g.isPropagationStopped())break e;hT(g,s,z),w=A}}}if(eg)throw t=$0,eg=!1,$0=null,t}function qn(t,i){var l=i[ev];l===void 0&&(l=i[ev]=new Set);var d=t+"__bubble";l.has(d)||(bS(i,t,2,!1),l.add(d))}function t0(t,i,l){var d=0;i&&(d|=4),bS(l,t,d,i)}var Em="_reactListening"+Math.random().toString(36).slice(2);function vf(t){if(!t[Em]){t[Em]=!0,PE.forEach(function(l){l!=="selectionchange"&&(ED.has(l)||t0(l,!1,t),t0(l,!0,t))});var i=t.nodeType===9?t:t.ownerDocument;i===null||i[Em]||(i[Em]=!0,t0("selectionchange",!1,i))}}function bS(t,i,l,d){switch(oS(i)){case 1:var g=Ok;break;case 4:g=Uk;break;default:g=nx}l=g.bind(null,i,l,t),g=void 0,!G0||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(g=!0),d?g!==void 0?t.addEventListener(i,l,{capture:!0,passive:g}):t.addEventListener(i,l,!0):g!==void 0?t.addEventListener(i,l,{passive:g}):t.addEventListener(i,l,!1)}function n0(t,i,l,d,g){var w=d;if(!(i&1)&&!(i&2)&&d!==null)e:for(;;){if(d===null)return;var E=d.tag;if(E===3||E===4){var s=d.stateNode.containerInfo;if(s===g||s.nodeType===8&&s.parentNode===g)break;if(E===4)for(E=d.return;E!==null;){var A=E.tag;if((A===3||A===4)&&(A=E.stateNode.containerInfo,A===g||A.nodeType===8&&A.parentNode===g))return;E=E.return}for(;s!==null;){if(E=Xl(s),E===null)return;if(A=E.tag,A===5||A===6){d=w=E;continue e}s=s.parentNode}}d=d.return}ZE(function(){var z=w,V=Jv(l),j=[];e:{var G=xS.get(t);if(G!==void 0){var re=rx,he=t;switch(t){case"keypress":if(Nm(l)===0)break e;case"keydown":case"keyup":re=eD;break;case"focusin":he="focus",re=Hy;break;case"focusout":he="blur",re=Hy;break;case"beforeblur":case"afterblur":re=Hy;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":re=Qb;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":re=jk;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":re=iD;break;case gS:case _S:case yS:re=Zk;break;case vS:re=oD;break;case"scroll":re=Vk;break;case"wheel":re=aD;break;case"copy":case"cut":case"paste":re=Wk;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":re=tT}var ve=(i&4)!==0,Ue=!ve&&t==="scroll",ae=ve?G!==null?G+"Capture":null:G;ve=[];for(var J=z,se;J!==null;){se=J;var oe=se.stateNode;if(se.tag===5&&oe!==null&&(se=oe,ae!==null&&(oe=ff(J,ae),oe!=null&&ve.push(xf(J,oe,se)))),Ue)break;J=J.return}0<ve.length&&(G=new re(G,he,null,l,V),j.push({event:G,listeners:ve}))}}if(!(i&7)){e:{if(G=t==="mouseover"||t==="pointerover",re=t==="mouseout"||t==="pointerout",G&&l!==N0&&(he=l.relatedTarget||l.fromElement)&&(Xl(he)||he[Xs]))break e;if((re||G)&&(G=V.window===V?V:(G=V.ownerDocument)?G.defaultView||G.parentWindow:window,re?(he=l.relatedTarget||l.toElement,re=z,he=he?Xl(he):null,he!==null&&(Ue=cc(he),he!==Ue||he.tag!==5&&he.tag!==6)&&(he=null)):(re=null,he=z),re!==he)){if(ve=Qb,oe="onMouseLeave",ae="onMouseEnter",J="mouse",(t==="pointerout"||t==="pointerover")&&(ve=tT,oe="onPointerLeave",ae="onPointerEnter",J="pointer"),Ue=re==null?G:yu(re),se=he==null?G:yu(he),G=new ve(oe,J+"leave",re,l,V),G.target=Ue,G.relatedTarget=se,oe=null,Xl(V)===z&&(ve=new ve(ae,J+"enter",he,l,V),ve.target=se,ve.relatedTarget=Ue,oe=ve),Ue=oe,re&&he)t:{for(ve=re,ae=he,J=0,se=ve;se;se=hu(se))J++;for(se=0,oe=ae;oe;oe=hu(oe))se++;for(;0<J-se;)ve=hu(ve),J--;for(;0<se-J;)ae=hu(ae),se--;for(;J--;){if(ve===ae||ae!==null&&ve===ae.alternate)break t;ve=hu(ve),ae=hu(ae)}ve=null}else ve=null;re!==null&&dT(j,G,re,ve,!1),he!==null&&Ue!==null&&dT(j,Ue,he,ve,!0)}}e:{if(G=z?yu(z):window,re=G.nodeName&&G.nodeName.toLowerCase(),re==="select"||re==="input"&&G.type==="file")var Be=pD;else if(rT(G))if(hS)Be=yD;else{Be=gD;var at=mD}else(re=G.nodeName)&&re.toLowerCase()==="input"&&(G.type==="checkbox"||G.type==="radio")&&(Be=_D);if(Be&&(Be=Be(t,z))){uS(j,Be,l,V);break e}at&&at(t,G,z),t==="focusout"&&(at=G._wrapperState)&&at.controlled&&G.type==="number"&&B0(G,"number",G.value)}switch(at=z?yu(z):window,t){case"focusin":(rT(at)||at.contentEditable==="true")&&(gu=at,X0=z,ef=null);break;case"focusout":ef=X0=gu=null;break;case"mousedown":H0=!0;break;case"contextmenu":case"mouseup":case"dragend":H0=!1,cT(j,l,V);break;case"selectionchange":if(wD)break;case"keydown":case"keyup":cT(j,l,V)}var Ye;if(sx)e:{switch(t){case"compositionstart":var He="onCompositionStart";break e;case"compositionend":He="onCompositionEnd";break e;case"compositionupdate":He="onCompositionUpdate";break e}He=void 0}else mu?lS(t,l)&&(He="onCompositionEnd"):t==="keydown"&&l.keyCode===229&&(He="onCompositionStart");He&&(aS&&l.locale!=="ko"&&(mu||He!=="onCompositionStart"?He==="onCompositionEnd"&&mu&&(Ye=sS()):(Ba=V,ix="value"in Ba?Ba.value:Ba.textContent,mu=!0)),at=og(z,He),0<at.length&&(He=new eT(He,t,null,l,V),j.push({event:He,listeners:at}),Ye?He.data=Ye:(Ye=cS(l),Ye!==null&&(He.data=Ye)))),(Ye=cD?uD(t,l):hD(t,l))&&(z=og(z,"onBeforeInput"),0<z.length&&(V=new eT("onBeforeInput","beforeinput",null,l,V),j.push({event:V,listeners:z}),V.data=Ye))}wS(j,i)})}function xf(t,i,l){return{instance:t,listener:i,currentTarget:l}}function og(t,i){for(var l=i+"Capture",d=[];t!==null;){var g=t,w=g.stateNode;g.tag===5&&w!==null&&(g=w,w=ff(t,l),w!=null&&d.unshift(xf(t,w,g)),w=ff(t,i),w!=null&&d.push(xf(t,w,g))),t=t.return}return d}function hu(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function dT(t,i,l,d,g){for(var w=i._reactName,E=[];l!==null&&l!==d;){var s=l,A=s.alternate,z=s.stateNode;if(A!==null&&A===d)break;s.tag===5&&z!==null&&(s=z,g?(A=ff(l,w),A!=null&&E.unshift(xf(l,A,s))):g||(A=ff(l,w),A!=null&&E.push(xf(l,A,s)))),l=l.return}E.length!==0&&t.push({event:i,listeners:E})}var SD=/\r\n?/g,CD=/\u0000|\uFFFD/g;function fT(t){return(typeof t=="string"?t:""+t).replace(SD,`
`).replace(CD,"")}function Sm(t,i,l){if(i=fT(i),fT(t)!==i&&l)throw Error(ct(425))}function sg(){}var K0=null,Y0=null;function J0(t,i){return t==="textarea"||t==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var Q0=typeof setTimeout=="function"?setTimeout:void 0,AD=typeof clearTimeout=="function"?clearTimeout:void 0,pT=typeof Promise=="function"?Promise:void 0,MD=typeof queueMicrotask=="function"?queueMicrotask:typeof pT<"u"?function(t){return pT.resolve(null).then(t).catch(PD)}:Q0;function PD(t){setTimeout(function(){throw t})}function i0(t,i){var l=i,d=0;do{var g=l.nextSibling;if(t.removeChild(l),g&&g.nodeType===8)if(l=g.data,l==="/$"){if(d===0){t.removeChild(g),gf(i);return}d--}else l!=="$"&&l!=="$?"&&l!=="$!"||d++;l=g}while(l);gf(i)}function Na(t){for(;t!=null;t=t.nextSibling){var i=t.nodeType;if(i===1||i===3)break;if(i===8){if(i=t.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return t}function mT(t){t=t.previousSibling;for(var i=0;t;){if(t.nodeType===8){var l=t.data;if(l==="$"||l==="$!"||l==="$?"){if(i===0)return t;i--}else l==="/$"&&i++}t=t.previousSibling}return null}var Yu=Math.random().toString(36).slice(2),fs="__reactFiber$"+Yu,wf="__reactProps$"+Yu,Xs="__reactContainer$"+Yu,ev="__reactEvents$"+Yu,ID="__reactListeners$"+Yu,kD="__reactHandles$"+Yu;function Xl(t){var i=t[fs];if(i)return i;for(var l=t.parentNode;l;){if(i=l[Xs]||l[fs]){if(l=i.alternate,i.child!==null||l!==null&&l.child!==null)for(t=mT(t);t!==null;){if(l=t[fs])return l;t=mT(t)}return i}t=l,l=t.parentNode}return null}function Ff(t){return t=t[fs]||t[Xs],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function yu(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ct(33))}function Og(t){return t[wf]||null}var tv=[],vu=-1;function Qa(t){return{current:t}}function Wn(t){0>vu||(t.current=tv[vu],tv[vu]=null,vu--)}function Gn(t,i){vu++,tv[vu]=t.current,t.current=i}var Ha={},lr=Qa(Ha),kr=Qa(!1),nc=Ha;function Vu(t,i){var l=t.type.contextTypes;if(!l)return Ha;var d=t.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===i)return d.__reactInternalMemoizedMaskedChildContext;var g={},w;for(w in l)g[w]=i[w];return d&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=g),g}function Dr(t){return t=t.childContextTypes,t!=null}function ag(){Wn(kr),Wn(lr)}function gT(t,i,l){if(lr.current!==Ha)throw Error(ct(168));Gn(lr,i),Gn(kr,l)}function TS(t,i,l){var d=t.stateNode;if(i=i.childContextTypes,typeof d.getChildContext!="function")return l;d=d.getChildContext();for(var g in d)if(!(g in i))throw Error(ct(108,mk(t)||"Unknown",g));return di({},l,d)}function lg(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Ha,nc=lr.current,Gn(lr,t),Gn(kr,kr.current),!0}function _T(t,i,l){var d=t.stateNode;if(!d)throw Error(ct(169));l?(t=TS(t,i,nc),d.__reactInternalMemoizedMergedChildContext=t,Wn(kr),Wn(lr),Gn(lr,t)):Wn(kr),Gn(kr,l)}var Us=null,Ug=!1,r0=!1;function ES(t){Us===null?Us=[t]:Us.push(t)}function DD(t){Ug=!0,ES(t)}function el(){if(!r0&&Us!==null){r0=!0;var t=0,i=Rn;try{var l=Us;for(Rn=1;t<l.length;t++){var d=l[t];do d=d(!0);while(d!==null)}Us=null,Ug=!1}catch(g){throw Us!==null&&(Us=Us.slice(t+1)),HE(Qv,el),g}finally{Rn=i,r0=!1}}return null}var xu=[],wu=0,cg=null,ug=0,co=[],uo=0,ic=null,Vs=1,Ns="";function $l(t,i){xu[wu++]=ug,xu[wu++]=cg,cg=t,ug=i}function SS(t,i,l){co[uo++]=Vs,co[uo++]=Ns,co[uo++]=ic,ic=t;var d=Vs;t=Ns;var g=32-$o(d)-1;d&=~(1<<g),l+=1;var w=32-$o(i)+g;if(30<w){var E=g-g%5;w=(d&(1<<E)-1).toString(32),d>>=E,g-=E,Vs=1<<32-$o(i)+g|l<<g|d,Ns=w+t}else Vs=1<<w|l<<g|d,Ns=t}function lx(t){t.return!==null&&($l(t,1),SS(t,1,0))}function cx(t){for(;t===cg;)cg=xu[--wu],xu[wu]=null,ug=xu[--wu],xu[wu]=null;for(;t===ic;)ic=co[--uo],co[uo]=null,Ns=co[--uo],co[uo]=null,Vs=co[--uo],co[uo]=null}var Zr=null,$r=null,Jn=!1,Go=null;function CS(t,i){var l=ho(5,null,null,0);l.elementType="DELETED",l.stateNode=i,l.return=t,i=t.deletions,i===null?(t.deletions=[l],t.flags|=16):i.push(l)}function yT(t,i){switch(t.tag){case 5:var l=t.type;return i=i.nodeType!==1||l.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(t.stateNode=i,Zr=t,$r=Na(i.firstChild),!0):!1;case 6:return i=t.pendingProps===""||i.nodeType!==3?null:i,i!==null?(t.stateNode=i,Zr=t,$r=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(l=ic!==null?{id:Vs,overflow:Ns}:null,t.memoizedState={dehydrated:i,treeContext:l,retryLane:1073741824},l=ho(18,null,null,0),l.stateNode=i,l.return=t,t.child=l,Zr=t,$r=null,!0):!1;default:return!1}}function nv(t){return(t.mode&1)!==0&&(t.flags&128)===0}function iv(t){if(Jn){var i=$r;if(i){var l=i;if(!yT(t,i)){if(nv(t))throw Error(ct(418));i=Na(l.nextSibling);var d=Zr;i&&yT(t,i)?CS(d,l):(t.flags=t.flags&-4097|2,Jn=!1,Zr=t)}}else{if(nv(t))throw Error(ct(418));t.flags=t.flags&-4097|2,Jn=!1,Zr=t}}}function vT(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Zr=t}function Cm(t){if(t!==Zr)return!1;if(!Jn)return vT(t),Jn=!0,!1;var i;if((i=t.tag!==3)&&!(i=t.tag!==5)&&(i=t.type,i=i!=="head"&&i!=="body"&&!J0(t.type,t.memoizedProps)),i&&(i=$r)){if(nv(t))throw AS(),Error(ct(418));for(;i;)CS(t,i),i=Na(i.nextSibling)}if(vT(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ct(317));e:{for(t=t.nextSibling,i=0;t;){if(t.nodeType===8){var l=t.data;if(l==="/$"){if(i===0){$r=Na(t.nextSibling);break e}i--}else l!=="$"&&l!=="$!"&&l!=="$?"||i++}t=t.nextSibling}$r=null}}else $r=Zr?Na(t.stateNode.nextSibling):null;return!0}function AS(){for(var t=$r;t;)t=Na(t.nextSibling)}function Nu(){$r=Zr=null,Jn=!1}function ux(t){Go===null?Go=[t]:Go.push(t)}var zD=Js.ReactCurrentBatchConfig;function Vo(t,i){if(t&&t.defaultProps){i=di({},i),t=t.defaultProps;for(var l in t)i[l]===void 0&&(i[l]=t[l]);return i}return i}var hg=Qa(null),dg=null,bu=null,hx=null;function dx(){hx=bu=dg=null}function fx(t){var i=hg.current;Wn(hg),t._currentValue=i}function rv(t,i,l){for(;t!==null;){var d=t.alternate;if((t.childLanes&i)!==i?(t.childLanes|=i,d!==null&&(d.childLanes|=i)):d!==null&&(d.childLanes&i)!==i&&(d.childLanes|=i),t===l)break;t=t.return}}function Ru(t,i){dg=t,hx=bu=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&i&&(Ir=!0),t.firstContext=null)}function po(t){var i=t._currentValue;if(hx!==t)if(t={context:t,memoizedValue:i,next:null},bu===null){if(dg===null)throw Error(ct(308));bu=t,dg.dependencies={lanes:0,firstContext:t}}else bu=bu.next=t;return i}var Hl=null;function px(t){Hl===null?Hl=[t]:Hl.push(t)}function MS(t,i,l,d){var g=i.interleaved;return g===null?(l.next=l,px(i)):(l.next=g.next,g.next=l),i.interleaved=l,Hs(t,d)}function Hs(t,i){t.lanes|=i;var l=t.alternate;for(l!==null&&(l.lanes|=i),l=t,t=t.return;t!==null;)t.childLanes|=i,l=t.alternate,l!==null&&(l.childLanes|=i),l=t,t=t.return;return l.tag===3?l.stateNode:null}var Da=!1;function mx(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function PS(t,i){t=t.updateQueue,i.updateQueue===t&&(i.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Gs(t,i){return{eventTime:t,lane:i,tag:0,payload:null,callback:null,next:null}}function ja(t,i,l){var d=t.updateQueue;if(d===null)return null;if(d=d.shared,mn&2){var g=d.pending;return g===null?i.next=i:(i.next=g.next,g.next=i),d.pending=i,Hs(t,l)}return g=d.interleaved,g===null?(i.next=i,px(d)):(i.next=g.next,g.next=i),d.interleaved=i,Hs(t,l)}function jm(t,i,l){if(i=i.updateQueue,i!==null&&(i=i.shared,(l&4194240)!==0)){var d=i.lanes;d&=t.pendingLanes,l|=d,i.lanes=l,ex(t,l)}}function xT(t,i){var l=t.updateQueue,d=t.alternate;if(d!==null&&(d=d.updateQueue,l===d)){var g=null,w=null;if(l=l.firstBaseUpdate,l!==null){do{var E={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};w===null?g=w=E:w=w.next=E,l=l.next}while(l!==null);w===null?g=w=i:w=w.next=i}else g=w=i;l={baseState:d.baseState,firstBaseUpdate:g,lastBaseUpdate:w,shared:d.shared,effects:d.effects},t.updateQueue=l;return}t=l.lastBaseUpdate,t===null?l.firstBaseUpdate=i:t.next=i,l.lastBaseUpdate=i}function fg(t,i,l,d){var g=t.updateQueue;Da=!1;var w=g.firstBaseUpdate,E=g.lastBaseUpdate,s=g.shared.pending;if(s!==null){g.shared.pending=null;var A=s,z=A.next;A.next=null,E===null?w=z:E.next=z,E=A;var V=t.alternate;V!==null&&(V=V.updateQueue,s=V.lastBaseUpdate,s!==E&&(s===null?V.firstBaseUpdate=z:s.next=z,V.lastBaseUpdate=A))}if(w!==null){var j=g.baseState;E=0,V=z=A=null,s=w;do{var G=s.lane,re=s.eventTime;if((d&G)===G){V!==null&&(V=V.next={eventTime:re,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var he=t,ve=s;switch(G=i,re=l,ve.tag){case 1:if(he=ve.payload,typeof he=="function"){j=he.call(re,j,G);break e}j=he;break e;case 3:he.flags=he.flags&-65537|128;case 0:if(he=ve.payload,G=typeof he=="function"?he.call(re,j,G):he,G==null)break e;j=di({},j,G);break e;case 2:Da=!0}}s.callback!==null&&s.lane!==0&&(t.flags|=64,G=g.effects,G===null?g.effects=[s]:G.push(s))}else re={eventTime:re,lane:G,tag:s.tag,payload:s.payload,callback:s.callback,next:null},V===null?(z=V=re,A=j):V=V.next=re,E|=G;if(s=s.next,s===null){if(s=g.shared.pending,s===null)break;G=s,s=G.next,G.next=null,g.lastBaseUpdate=G,g.shared.pending=null}}while(1);if(V===null&&(A=j),g.baseState=A,g.firstBaseUpdate=z,g.lastBaseUpdate=V,i=g.shared.interleaved,i!==null){g=i;do E|=g.lane,g=g.next;while(g!==i)}else w===null&&(g.shared.lanes=0);oc|=E,t.lanes=E,t.memoizedState=j}}function wT(t,i,l){if(t=i.effects,i.effects=null,t!==null)for(i=0;i<t.length;i++){var d=t[i],g=d.callback;if(g!==null){if(d.callback=null,d=l,typeof g!="function")throw Error(ct(191,g));g.call(d)}}}var IS=new ME.Component().refs;function ov(t,i,l,d){i=t.memoizedState,l=l(d,i),l=l==null?i:di({},i,l),t.memoizedState=l,t.lanes===0&&(t.updateQueue.baseState=l)}var Vg={isMounted:function(t){return(t=t._reactInternals)?cc(t)===t:!1},enqueueSetState:function(t,i,l){t=t._reactInternals;var d=gr(),g=$a(t),w=Gs(d,g);w.payload=i,l!=null&&(w.callback=l),i=ja(t,w,g),i!==null&&(Zo(i,t,g,d),jm(i,t,g))},enqueueReplaceState:function(t,i,l){t=t._reactInternals;var d=gr(),g=$a(t),w=Gs(d,g);w.tag=1,w.payload=i,l!=null&&(w.callback=l),i=ja(t,w,g),i!==null&&(Zo(i,t,g,d),jm(i,t,g))},enqueueForceUpdate:function(t,i){t=t._reactInternals;var l=gr(),d=$a(t),g=Gs(l,d);g.tag=2,i!=null&&(g.callback=i),i=ja(t,g,d),i!==null&&(Zo(i,t,d,l),jm(i,t,d))}};function bT(t,i,l,d,g,w,E){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(d,w,E):i.prototype&&i.prototype.isPureReactComponent?!yf(l,d)||!yf(g,w):!0}function kS(t,i,l){var d=!1,g=Ha,w=i.contextType;return typeof w=="object"&&w!==null?w=po(w):(g=Dr(i)?nc:lr.current,d=i.contextTypes,w=(d=d!=null)?Vu(t,g):Ha),i=new i(l,w),t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=Vg,t.stateNode=i,i._reactInternals=t,d&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=g,t.__reactInternalMemoizedMaskedChildContext=w),i}function TT(t,i,l,d){t=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(l,d),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(l,d),i.state!==t&&Vg.enqueueReplaceState(i,i.state,null)}function sv(t,i,l,d){var g=t.stateNode;g.props=l,g.state=t.memoizedState,g.refs=IS,mx(t);var w=i.contextType;typeof w=="object"&&w!==null?g.context=po(w):(w=Dr(i)?nc:lr.current,g.context=Vu(t,w)),g.state=t.memoizedState,w=i.getDerivedStateFromProps,typeof w=="function"&&(ov(t,i,w,l),g.state=t.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(i=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),i!==g.state&&Vg.enqueueReplaceState(g,g.state,null),fg(t,l,g,d),g.state=t.memoizedState),typeof g.componentDidMount=="function"&&(t.flags|=4194308)}function Bd(t,i,l){if(t=l.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(l._owner){if(l=l._owner,l){if(l.tag!==1)throw Error(ct(309));var d=l.stateNode}if(!d)throw Error(ct(147,t));var g=d,w=""+t;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===w?i.ref:(i=function(E){var s=g.refs;s===IS&&(s=g.refs={}),E===null?delete s[w]:s[w]=E},i._stringRef=w,i)}if(typeof t!="string")throw Error(ct(284));if(!l._owner)throw Error(ct(290,t))}return t}function Am(t,i){throw t=Object.prototype.toString.call(i),Error(ct(31,t==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":t))}function ET(t){var i=t._init;return i(t._payload)}function DS(t){function i(ae,J){if(t){var se=ae.deletions;se===null?(ae.deletions=[J],ae.flags|=16):se.push(J)}}function l(ae,J){if(!t)return null;for(;J!==null;)i(ae,J),J=J.sibling;return null}function d(ae,J){for(ae=new Map;J!==null;)J.key!==null?ae.set(J.key,J):ae.set(J.index,J),J=J.sibling;return ae}function g(ae,J){return ae=Za(ae,J),ae.index=0,ae.sibling=null,ae}function w(ae,J,se){return ae.index=se,t?(se=ae.alternate,se!==null?(se=se.index,se<J?(ae.flags|=2,J):se):(ae.flags|=2,J)):(ae.flags|=1048576,J)}function E(ae){return t&&ae.alternate===null&&(ae.flags|=2),ae}function s(ae,J,se,oe){return J===null||J.tag!==6?(J=h0(se,ae.mode,oe),J.return=ae,J):(J=g(J,se),J.return=ae,J)}function A(ae,J,se,oe){var Be=se.type;return Be===pu?V(ae,J,se.props.children,oe,se.key):J!==null&&(J.elementType===Be||typeof Be=="object"&&Be!==null&&Be.$$typeof===ka&&ET(Be)===J.type)?(oe=g(J,se.props),oe.ref=Bd(ae,J,se),oe.return=ae,oe):(oe=Xm(se.type,se.key,se.props,null,ae.mode,oe),oe.ref=Bd(ae,J,se),oe.return=ae,oe)}function z(ae,J,se,oe){return J===null||J.tag!==4||J.stateNode.containerInfo!==se.containerInfo||J.stateNode.implementation!==se.implementation?(J=d0(se,ae.mode,oe),J.return=ae,J):(J=g(J,se.children||[]),J.return=ae,J)}function V(ae,J,se,oe,Be){return J===null||J.tag!==7?(J=tc(se,ae.mode,oe,Be),J.return=ae,J):(J=g(J,se),J.return=ae,J)}function j(ae,J,se){if(typeof J=="string"&&J!==""||typeof J=="number")return J=h0(""+J,ae.mode,se),J.return=ae,J;if(typeof J=="object"&&J!==null){switch(J.$$typeof){case gm:return se=Xm(J.type,J.key,J.props,null,ae.mode,se),se.ref=Bd(ae,null,J),se.return=ae,se;case fu:return J=d0(J,ae.mode,se),J.return=ae,J;case ka:var oe=J._init;return j(ae,oe(J._payload),se)}if(qd(J)||kd(J))return J=tc(J,ae.mode,se,null),J.return=ae,J;Am(ae,J)}return null}function G(ae,J,se,oe){var Be=J!==null?J.key:null;if(typeof se=="string"&&se!==""||typeof se=="number")return Be!==null?null:s(ae,J,""+se,oe);if(typeof se=="object"&&se!==null){switch(se.$$typeof){case gm:return se.key===Be?A(ae,J,se,oe):null;case fu:return se.key===Be?z(ae,J,se,oe):null;case ka:return Be=se._init,G(ae,J,Be(se._payload),oe)}if(qd(se)||kd(se))return Be!==null?null:V(ae,J,se,oe,null);Am(ae,se)}return null}function re(ae,J,se,oe,Be){if(typeof oe=="string"&&oe!==""||typeof oe=="number")return ae=ae.get(se)||null,s(J,ae,""+oe,Be);if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case gm:return ae=ae.get(oe.key===null?se:oe.key)||null,A(J,ae,oe,Be);case fu:return ae=ae.get(oe.key===null?se:oe.key)||null,z(J,ae,oe,Be);case ka:var at=oe._init;return re(ae,J,se,at(oe._payload),Be)}if(qd(oe)||kd(oe))return ae=ae.get(se)||null,V(J,ae,oe,Be,null);Am(J,oe)}return null}function he(ae,J,se,oe){for(var Be=null,at=null,Ye=J,He=J=0,ze=null;Ye!==null&&He<se.length;He++){Ye.index>He?(ze=Ye,Ye=null):ze=Ye.sibling;var kt=G(ae,Ye,se[He],oe);if(kt===null){Ye===null&&(Ye=ze);break}t&&Ye&&kt.alternate===null&&i(ae,Ye),J=w(kt,J,He),at===null?Be=kt:at.sibling=kt,at=kt,Ye=ze}if(He===se.length)return l(ae,Ye),Jn&&$l(ae,He),Be;if(Ye===null){for(;He<se.length;He++)Ye=j(ae,se[He],oe),Ye!==null&&(J=w(Ye,J,He),at===null?Be=Ye:at.sibling=Ye,at=Ye);return Jn&&$l(ae,He),Be}for(Ye=d(ae,Ye);He<se.length;He++)ze=re(Ye,ae,He,se[He],oe),ze!==null&&(t&&ze.alternate!==null&&Ye.delete(ze.key===null?He:ze.key),J=w(ze,J,He),at===null?Be=ze:at.sibling=ze,at=ze);return t&&Ye.forEach(function(dn){return i(ae,dn)}),Jn&&$l(ae,He),Be}function ve(ae,J,se,oe){var Be=kd(se);if(typeof Be!="function")throw Error(ct(150));if(se=Be.call(se),se==null)throw Error(ct(151));for(var at=Be=null,Ye=J,He=J=0,ze=null,kt=se.next();Ye!==null&&!kt.done;He++,kt=se.next()){Ye.index>He?(ze=Ye,Ye=null):ze=Ye.sibling;var dn=G(ae,Ye,kt.value,oe);if(dn===null){Ye===null&&(Ye=ze);break}t&&Ye&&dn.alternate===null&&i(ae,Ye),J=w(dn,J,He),at===null?Be=dn:at.sibling=dn,at=dn,Ye=ze}if(kt.done)return l(ae,Ye),Jn&&$l(ae,He),Be;if(Ye===null){for(;!kt.done;He++,kt=se.next())kt=j(ae,kt.value,oe),kt!==null&&(J=w(kt,J,He),at===null?Be=kt:at.sibling=kt,at=kt);return Jn&&$l(ae,He),Be}for(Ye=d(ae,Ye);!kt.done;He++,kt=se.next())kt=re(Ye,ae,He,kt.value,oe),kt!==null&&(t&&kt.alternate!==null&&Ye.delete(kt.key===null?He:kt.key),J=w(kt,J,He),at===null?Be=kt:at.sibling=kt,at=kt);return t&&Ye.forEach(function(gt){return i(ae,gt)}),Jn&&$l(ae,He),Be}function Ue(ae,J,se,oe){if(typeof se=="object"&&se!==null&&se.type===pu&&se.key===null&&(se=se.props.children),typeof se=="object"&&se!==null){switch(se.$$typeof){case gm:e:{for(var Be=se.key,at=J;at!==null;){if(at.key===Be){if(Be=se.type,Be===pu){if(at.tag===7){l(ae,at.sibling),J=g(at,se.props.children),J.return=ae,ae=J;break e}}else if(at.elementType===Be||typeof Be=="object"&&Be!==null&&Be.$$typeof===ka&&ET(Be)===at.type){l(ae,at.sibling),J=g(at,se.props),J.ref=Bd(ae,at,se),J.return=ae,ae=J;break e}l(ae,at);break}else i(ae,at);at=at.sibling}se.type===pu?(J=tc(se.props.children,ae.mode,oe,se.key),J.return=ae,ae=J):(oe=Xm(se.type,se.key,se.props,null,ae.mode,oe),oe.ref=Bd(ae,J,se),oe.return=ae,ae=oe)}return E(ae);case fu:e:{for(at=se.key;J!==null;){if(J.key===at)if(J.tag===4&&J.stateNode.containerInfo===se.containerInfo&&J.stateNode.implementation===se.implementation){l(ae,J.sibling),J=g(J,se.children||[]),J.return=ae,ae=J;break e}else{l(ae,J);break}else i(ae,J);J=J.sibling}J=d0(se,ae.mode,oe),J.return=ae,ae=J}return E(ae);case ka:return at=se._init,Ue(ae,J,at(se._payload),oe)}if(qd(se))return he(ae,J,se,oe);if(kd(se))return ve(ae,J,se,oe);Am(ae,se)}return typeof se=="string"&&se!==""||typeof se=="number"?(se=""+se,J!==null&&J.tag===6?(l(ae,J.sibling),J=g(J,se),J.return=ae,ae=J):(l(ae,J),J=h0(se,ae.mode,oe),J.return=ae,ae=J),E(ae)):l(ae,J)}return Ue}var ju=DS(!0),zS=DS(!1),Of={},ms=Qa(Of),bf=Qa(Of),Tf=Qa(Of);function Kl(t){if(t===Of)throw Error(ct(174));return t}function gx(t,i){switch(Gn(Tf,i),Gn(bf,t),Gn(ms,Of),t=i.nodeType,t){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:O0(null,"");break;default:t=t===8?i.parentNode:i,i=t.namespaceURI||null,t=t.tagName,i=O0(i,t)}Wn(ms),Gn(ms,i)}function Gu(){Wn(ms),Wn(bf),Wn(Tf)}function LS(t){Kl(Tf.current);var i=Kl(ms.current),l=O0(i,t.type);i!==l&&(Gn(bf,t),Gn(ms,l))}function _x(t){bf.current===t&&(Wn(ms),Wn(bf))}var ci=Qa(0);function pg(t){for(var i=t;i!==null;){if(i.tag===13){var l=i.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var o0=[];function yx(){for(var t=0;t<o0.length;t++)o0[t]._workInProgressVersionPrimary=null;o0.length=0}var Gm=Js.ReactCurrentDispatcher,s0=Js.ReactCurrentBatchConfig,rc=0,hi=null,zi=null,Vi=null,mg=!1,tf=!1,Ef=0,LD=0;function or(){throw Error(ct(321))}function vx(t,i){if(i===null)return!1;for(var l=0;l<i.length&&l<t.length;l++)if(!qo(t[l],i[l]))return!1;return!0}function xx(t,i,l,d,g,w){if(rc=w,hi=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,Gm.current=t===null||t.memoizedState===null?OD:UD,t=l(d,g),tf){w=0;do{if(tf=!1,Ef=0,25<=w)throw Error(ct(301));w+=1,Vi=zi=null,i.updateQueue=null,Gm.current=VD,t=l(d,g)}while(tf)}if(Gm.current=gg,i=zi!==null&&zi.next!==null,rc=0,Vi=zi=hi=null,mg=!1,i)throw Error(ct(300));return t}function wx(){var t=Ef!==0;return Ef=0,t}function hs(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Vi===null?hi.memoizedState=Vi=t:Vi=Vi.next=t,Vi}function mo(){if(zi===null){var t=hi.alternate;t=t!==null?t.memoizedState:null}else t=zi.next;var i=Vi===null?hi.memoizedState:Vi.next;if(i!==null)Vi=i,zi=t;else{if(t===null)throw Error(ct(310));zi=t,t={memoizedState:zi.memoizedState,baseState:zi.baseState,baseQueue:zi.baseQueue,queue:zi.queue,next:null},Vi===null?hi.memoizedState=Vi=t:Vi=Vi.next=t}return Vi}function Sf(t,i){return typeof i=="function"?i(t):i}function a0(t){var i=mo(),l=i.queue;if(l===null)throw Error(ct(311));l.lastRenderedReducer=t;var d=zi,g=d.baseQueue,w=l.pending;if(w!==null){if(g!==null){var E=g.next;g.next=w.next,w.next=E}d.baseQueue=g=w,l.pending=null}if(g!==null){w=g.next,d=d.baseState;var s=E=null,A=null,z=w;do{var V=z.lane;if((rc&V)===V)A!==null&&(A=A.next={lane:0,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null}),d=z.hasEagerState?z.eagerState:t(d,z.action);else{var j={lane:V,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null};A===null?(s=A=j,E=d):A=A.next=j,hi.lanes|=V,oc|=V}z=z.next}while(z!==null&&z!==w);A===null?E=d:A.next=s,qo(d,i.memoizedState)||(Ir=!0),i.memoizedState=d,i.baseState=E,i.baseQueue=A,l.lastRenderedState=d}if(t=l.interleaved,t!==null){g=t;do w=g.lane,hi.lanes|=w,oc|=w,g=g.next;while(g!==t)}else g===null&&(l.lanes=0);return[i.memoizedState,l.dispatch]}function l0(t){var i=mo(),l=i.queue;if(l===null)throw Error(ct(311));l.lastRenderedReducer=t;var d=l.dispatch,g=l.pending,w=i.memoizedState;if(g!==null){l.pending=null;var E=g=g.next;do w=t(w,E.action),E=E.next;while(E!==g);qo(w,i.memoizedState)||(Ir=!0),i.memoizedState=w,i.baseQueue===null&&(i.baseState=w),l.lastRenderedState=w}return[w,d]}function RS(){}function BS(t,i){var l=hi,d=mo(),g=i(),w=!qo(d.memoizedState,g);if(w&&(d.memoizedState=g,Ir=!0),d=d.queue,bx(US.bind(null,l,d,t),[t]),d.getSnapshot!==i||w||Vi!==null&&Vi.memoizedState.tag&1){if(l.flags|=2048,Cf(9,OS.bind(null,l,d,g,i),void 0,null),Ni===null)throw Error(ct(349));rc&30||FS(l,i,g)}return g}function FS(t,i,l){t.flags|=16384,t={getSnapshot:i,value:l},i=hi.updateQueue,i===null?(i={lastEffect:null,stores:null},hi.updateQueue=i,i.stores=[t]):(l=i.stores,l===null?i.stores=[t]:l.push(t))}function OS(t,i,l,d){i.value=l,i.getSnapshot=d,VS(i)&&NS(t)}function US(t,i,l){return l(function(){VS(i)&&NS(t)})}function VS(t){var i=t.getSnapshot;t=t.value;try{var l=i();return!qo(t,l)}catch{return!0}}function NS(t){var i=Hs(t,1);i!==null&&Zo(i,t,1,-1)}function ST(t){var i=hs();return typeof t=="function"&&(t=t()),i.memoizedState=i.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Sf,lastRenderedState:t},i.queue=t,t=t.dispatch=FD.bind(null,hi,t),[i.memoizedState,t]}function Cf(t,i,l,d){return t={tag:t,create:i,destroy:l,deps:d,next:null},i=hi.updateQueue,i===null?(i={lastEffect:null,stores:null},hi.updateQueue=i,i.lastEffect=t.next=t):(l=i.lastEffect,l===null?i.lastEffect=t.next=t:(d=l.next,l.next=t,t.next=d,i.lastEffect=t)),t}function jS(){return mo().memoizedState}function $m(t,i,l,d){var g=hs();hi.flags|=t,g.memoizedState=Cf(1|i,l,void 0,d===void 0?null:d)}function Ng(t,i,l,d){var g=mo();d=d===void 0?null:d;var w=void 0;if(zi!==null){var E=zi.memoizedState;if(w=E.destroy,d!==null&&vx(d,E.deps)){g.memoizedState=Cf(i,l,w,d);return}}hi.flags|=t,g.memoizedState=Cf(1|i,l,w,d)}function CT(t,i){return $m(8390656,8,t,i)}function bx(t,i){return Ng(2048,8,t,i)}function GS(t,i){return Ng(4,2,t,i)}function $S(t,i){return Ng(4,4,t,i)}function ZS(t,i){if(typeof i=="function")return t=t(),i(t),function(){i(null)};if(i!=null)return t=t(),i.current=t,function(){i.current=null}}function qS(t,i,l){return l=l!=null?l.concat([t]):null,Ng(4,4,ZS.bind(null,i,t),l)}function Tx(){}function WS(t,i){var l=mo();i=i===void 0?null:i;var d=l.memoizedState;return d!==null&&i!==null&&vx(i,d[1])?d[0]:(l.memoizedState=[t,i],t)}function XS(t,i){var l=mo();i=i===void 0?null:i;var d=l.memoizedState;return d!==null&&i!==null&&vx(i,d[1])?d[0]:(t=t(),l.memoizedState=[t,i],t)}function HS(t,i,l){return rc&21?(qo(l,i)||(l=JE(),hi.lanes|=l,oc|=l,t.baseState=!0),i):(t.baseState&&(t.baseState=!1,Ir=!0),t.memoizedState=l)}function RD(t,i){var l=Rn;Rn=l!==0&&4>l?l:4,t(!0);var d=s0.transition;s0.transition={};try{t(!1),i()}finally{Rn=l,s0.transition=d}}function KS(){return mo().memoizedState}function BD(t,i,l){var d=$a(t);if(l={lane:d,action:l,hasEagerState:!1,eagerState:null,next:null},YS(t))JS(i,l);else if(l=MS(t,i,l,d),l!==null){var g=gr();Zo(l,t,d,g),QS(l,i,d)}}function FD(t,i,l){var d=$a(t),g={lane:d,action:l,hasEagerState:!1,eagerState:null,next:null};if(YS(t))JS(i,g);else{var w=t.alternate;if(t.lanes===0&&(w===null||w.lanes===0)&&(w=i.lastRenderedReducer,w!==null))try{var E=i.lastRenderedState,s=w(E,l);if(g.hasEagerState=!0,g.eagerState=s,qo(s,E)){var A=i.interleaved;A===null?(g.next=g,px(i)):(g.next=A.next,A.next=g),i.interleaved=g;return}}catch{}finally{}l=MS(t,i,g,d),l!==null&&(g=gr(),Zo(l,t,d,g),QS(l,i,d))}}function YS(t){var i=t.alternate;return t===hi||i!==null&&i===hi}function JS(t,i){tf=mg=!0;var l=t.pending;l===null?i.next=i:(i.next=l.next,l.next=i),t.pending=i}function QS(t,i,l){if(l&4194240){var d=i.lanes;d&=t.pendingLanes,l|=d,i.lanes=l,ex(t,l)}}var gg={readContext:po,useCallback:or,useContext:or,useEffect:or,useImperativeHandle:or,useInsertionEffect:or,useLayoutEffect:or,useMemo:or,useReducer:or,useRef:or,useState:or,useDebugValue:or,useDeferredValue:or,useTransition:or,useMutableSource:or,useSyncExternalStore:or,useId:or,unstable_isNewReconciler:!1},OD={readContext:po,useCallback:function(t,i){return hs().memoizedState=[t,i===void 0?null:i],t},useContext:po,useEffect:CT,useImperativeHandle:function(t,i,l){return l=l!=null?l.concat([t]):null,$m(4194308,4,ZS.bind(null,i,t),l)},useLayoutEffect:function(t,i){return $m(4194308,4,t,i)},useInsertionEffect:function(t,i){return $m(4,2,t,i)},useMemo:function(t,i){var l=hs();return i=i===void 0?null:i,t=t(),l.memoizedState=[t,i],t},useReducer:function(t,i,l){var d=hs();return i=l!==void 0?l(i):i,d.memoizedState=d.baseState=i,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:i},d.queue=t,t=t.dispatch=BD.bind(null,hi,t),[d.memoizedState,t]},useRef:function(t){var i=hs();return t={current:t},i.memoizedState=t},useState:ST,useDebugValue:Tx,useDeferredValue:function(t){return hs().memoizedState=t},useTransition:function(){var t=ST(!1),i=t[0];return t=RD.bind(null,t[1]),hs().memoizedState=t,[i,t]},useMutableSource:function(){},useSyncExternalStore:function(t,i,l){var d=hi,g=hs();if(Jn){if(l===void 0)throw Error(ct(407));l=l()}else{if(l=i(),Ni===null)throw Error(ct(349));rc&30||FS(d,i,l)}g.memoizedState=l;var w={value:l,getSnapshot:i};return g.queue=w,CT(US.bind(null,d,w,t),[t]),d.flags|=2048,Cf(9,OS.bind(null,d,w,l,i),void 0,null),l},useId:function(){var t=hs(),i=Ni.identifierPrefix;if(Jn){var l=Ns,d=Vs;l=(d&~(1<<32-$o(d)-1)).toString(32)+l,i=":"+i+"R"+l,l=Ef++,0<l&&(i+="H"+l.toString(32)),i+=":"}else l=LD++,i=":"+i+"r"+l.toString(32)+":";return t.memoizedState=i},unstable_isNewReconciler:!1},UD={readContext:po,useCallback:WS,useContext:po,useEffect:bx,useImperativeHandle:qS,useInsertionEffect:GS,useLayoutEffect:$S,useMemo:XS,useReducer:a0,useRef:jS,useState:function(){return a0(Sf)},useDebugValue:Tx,useDeferredValue:function(t){var i=mo();return HS(i,zi.memoizedState,t)},useTransition:function(){var t=a0(Sf)[0],i=mo().memoizedState;return[t,i]},useMutableSource:RS,useSyncExternalStore:BS,useId:KS,unstable_isNewReconciler:!1},VD={readContext:po,useCallback:WS,useContext:po,useEffect:bx,useImperativeHandle:qS,useInsertionEffect:GS,useLayoutEffect:$S,useMemo:XS,useReducer:l0,useRef:jS,useState:function(){return l0(Sf)},useDebugValue:Tx,useDeferredValue:function(t){var i=mo();return zi===null?i.memoizedState=t:HS(i,zi.memoizedState,t)},useTransition:function(){var t=l0(Sf)[0],i=mo().memoizedState;return[t,i]},useMutableSource:RS,useSyncExternalStore:BS,useId:KS,unstable_isNewReconciler:!1};function $u(t,i){try{var l="",d=i;do l+=pk(d),d=d.return;while(d);var g=l}catch(w){g=`
Error generating stack: `+w.message+`
`+w.stack}return{value:t,source:i,stack:g,digest:null}}function c0(t,i,l){return{value:t,source:null,stack:l??null,digest:i??null}}function av(t,i){try{console.error(i.value)}catch(l){setTimeout(function(){throw l})}}var ND=typeof WeakMap=="function"?WeakMap:Map;function eC(t,i,l){l=Gs(-1,l),l.tag=3,l.payload={element:null};var d=i.value;return l.callback=function(){yg||(yg=!0,_v=d),av(t,i)},l}function tC(t,i,l){l=Gs(-1,l),l.tag=3;var d=t.type.getDerivedStateFromError;if(typeof d=="function"){var g=i.value;l.payload=function(){return d(g)},l.callback=function(){av(t,i)}}var w=t.stateNode;return w!==null&&typeof w.componentDidCatch=="function"&&(l.callback=function(){av(t,i),typeof d!="function"&&(Ga===null?Ga=new Set([this]):Ga.add(this));var E=i.stack;this.componentDidCatch(i.value,{componentStack:E!==null?E:""})}),l}function AT(t,i,l){var d=t.pingCache;if(d===null){d=t.pingCache=new ND;var g=new Set;d.set(i,g)}else g=d.get(i),g===void 0&&(g=new Set,d.set(i,g));g.has(l)||(g.add(l),t=tz.bind(null,t,i,l),i.then(t,t))}function MT(t){do{var i;if((i=t.tag===13)&&(i=t.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return t;t=t.return}while(t!==null);return null}function PT(t,i,l,d,g){return t.mode&1?(t.flags|=65536,t.lanes=g,t):(t===i?t.flags|=65536:(t.flags|=128,l.flags|=131072,l.flags&=-52805,l.tag===1&&(l.alternate===null?l.tag=17:(i=Gs(-1,1),i.tag=2,ja(l,i,1))),l.lanes|=1),t)}var jD=Js.ReactCurrentOwner,Ir=!1;function mr(t,i,l,d){i.child=t===null?zS(i,null,l,d):ju(i,t.child,l,d)}function IT(t,i,l,d,g){l=l.render;var w=i.ref;return Ru(i,g),d=xx(t,i,l,d,w,g),l=wx(),t!==null&&!Ir?(i.updateQueue=t.updateQueue,i.flags&=-2053,t.lanes&=~g,Ks(t,i,g)):(Jn&&l&&lx(i),i.flags|=1,mr(t,i,d,g),i.child)}function kT(t,i,l,d,g){if(t===null){var w=l.type;return typeof w=="function"&&!kx(w)&&w.defaultProps===void 0&&l.compare===null&&l.defaultProps===void 0?(i.tag=15,i.type=w,nC(t,i,w,d,g)):(t=Xm(l.type,null,d,i,i.mode,g),t.ref=i.ref,t.return=i,i.child=t)}if(w=t.child,!(t.lanes&g)){var E=w.memoizedProps;if(l=l.compare,l=l!==null?l:yf,l(E,d)&&t.ref===i.ref)return Ks(t,i,g)}return i.flags|=1,t=Za(w,d),t.ref=i.ref,t.return=i,i.child=t}function nC(t,i,l,d,g){if(t!==null){var w=t.memoizedProps;if(yf(w,d)&&t.ref===i.ref)if(Ir=!1,i.pendingProps=d=w,(t.lanes&g)!==0)t.flags&131072&&(Ir=!0);else return i.lanes=t.lanes,Ks(t,i,g)}return lv(t,i,l,d,g)}function iC(t,i,l){var d=i.pendingProps,g=d.children,w=t!==null?t.memoizedState:null;if(d.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},Gn(Eu,Gr),Gr|=l;else{if(!(l&1073741824))return t=w!==null?w.baseLanes|l:l,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:t,cachePool:null,transitions:null},i.updateQueue=null,Gn(Eu,Gr),Gr|=t,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=w!==null?w.baseLanes:l,Gn(Eu,Gr),Gr|=d}else w!==null?(d=w.baseLanes|l,i.memoizedState=null):d=l,Gn(Eu,Gr),Gr|=d;return mr(t,i,g,l),i.child}function rC(t,i){var l=i.ref;(t===null&&l!==null||t!==null&&t.ref!==l)&&(i.flags|=512,i.flags|=2097152)}function lv(t,i,l,d,g){var w=Dr(l)?nc:lr.current;return w=Vu(i,w),Ru(i,g),l=xx(t,i,l,d,w,g),d=wx(),t!==null&&!Ir?(i.updateQueue=t.updateQueue,i.flags&=-2053,t.lanes&=~g,Ks(t,i,g)):(Jn&&d&&lx(i),i.flags|=1,mr(t,i,l,g),i.child)}function DT(t,i,l,d,g){if(Dr(l)){var w=!0;lg(i)}else w=!1;if(Ru(i,g),i.stateNode===null)Zm(t,i),kS(i,l,d),sv(i,l,d,g),d=!0;else if(t===null){var E=i.stateNode,s=i.memoizedProps;E.props=s;var A=E.context,z=l.contextType;typeof z=="object"&&z!==null?z=po(z):(z=Dr(l)?nc:lr.current,z=Vu(i,z));var V=l.getDerivedStateFromProps,j=typeof V=="function"||typeof E.getSnapshotBeforeUpdate=="function";j||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(s!==d||A!==z)&&TT(i,E,d,z),Da=!1;var G=i.memoizedState;E.state=G,fg(i,d,E,g),A=i.memoizedState,s!==d||G!==A||kr.current||Da?(typeof V=="function"&&(ov(i,l,V,d),A=i.memoizedState),(s=Da||bT(i,l,s,d,G,A,z))?(j||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(i.flags|=4194308)):(typeof E.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=d,i.memoizedState=A),E.props=d,E.state=A,E.context=z,d=s):(typeof E.componentDidMount=="function"&&(i.flags|=4194308),d=!1)}else{E=i.stateNode,PS(t,i),s=i.memoizedProps,z=i.type===i.elementType?s:Vo(i.type,s),E.props=z,j=i.pendingProps,G=E.context,A=l.contextType,typeof A=="object"&&A!==null?A=po(A):(A=Dr(l)?nc:lr.current,A=Vu(i,A));var re=l.getDerivedStateFromProps;(V=typeof re=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(s!==j||G!==A)&&TT(i,E,d,A),Da=!1,G=i.memoizedState,E.state=G,fg(i,d,E,g);var he=i.memoizedState;s!==j||G!==he||kr.current||Da?(typeof re=="function"&&(ov(i,l,re,d),he=i.memoizedState),(z=Da||bT(i,l,z,d,G,he,A)||!1)?(V||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(d,he,A),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(d,he,A)),typeof E.componentDidUpdate=="function"&&(i.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof E.componentDidUpdate!="function"||s===t.memoizedProps&&G===t.memoizedState||(i.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&G===t.memoizedState||(i.flags|=1024),i.memoizedProps=d,i.memoizedState=he),E.props=d,E.state=he,E.context=A,d=z):(typeof E.componentDidUpdate!="function"||s===t.memoizedProps&&G===t.memoizedState||(i.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&G===t.memoizedState||(i.flags|=1024),d=!1)}return cv(t,i,l,d,w,g)}function cv(t,i,l,d,g,w){rC(t,i);var E=(i.flags&128)!==0;if(!d&&!E)return g&&_T(i,l,!1),Ks(t,i,w);d=i.stateNode,jD.current=i;var s=E&&typeof l.getDerivedStateFromError!="function"?null:d.render();return i.flags|=1,t!==null&&E?(i.child=ju(i,t.child,null,w),i.child=ju(i,null,s,w)):mr(t,i,s,w),i.memoizedState=d.state,g&&_T(i,l,!0),i.child}function oC(t){var i=t.stateNode;i.pendingContext?gT(t,i.pendingContext,i.pendingContext!==i.context):i.context&&gT(t,i.context,!1),gx(t,i.containerInfo)}function zT(t,i,l,d,g){return Nu(),ux(g),i.flags|=256,mr(t,i,l,d),i.child}var uv={dehydrated:null,treeContext:null,retryLane:0};function hv(t){return{baseLanes:t,cachePool:null,transitions:null}}function sC(t,i,l){var d=i.pendingProps,g=ci.current,w=!1,E=(i.flags&128)!==0,s;if((s=E)||(s=t!==null&&t.memoizedState===null?!1:(g&2)!==0),s?(w=!0,i.flags&=-129):(t===null||t.memoizedState!==null)&&(g|=1),Gn(ci,g&1),t===null)return iv(i),t=i.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(i.mode&1?t.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(E=d.children,t=d.fallback,w?(d=i.mode,w=i.child,E={mode:"hidden",children:E},!(d&1)&&w!==null?(w.childLanes=0,w.pendingProps=E):w=$g(E,d,0,null),t=tc(t,d,l,null),w.return=i,t.return=i,w.sibling=t,i.child=w,i.child.memoizedState=hv(l),i.memoizedState=uv,t):Ex(i,E));if(g=t.memoizedState,g!==null&&(s=g.dehydrated,s!==null))return GD(t,i,E,d,s,g,l);if(w){w=d.fallback,E=i.mode,g=t.child,s=g.sibling;var A={mode:"hidden",children:d.children};return!(E&1)&&i.child!==g?(d=i.child,d.childLanes=0,d.pendingProps=A,i.deletions=null):(d=Za(g,A),d.subtreeFlags=g.subtreeFlags&14680064),s!==null?w=Za(s,w):(w=tc(w,E,l,null),w.flags|=2),w.return=i,d.return=i,d.sibling=w,i.child=d,d=w,w=i.child,E=t.child.memoizedState,E=E===null?hv(l):{baseLanes:E.baseLanes|l,cachePool:null,transitions:E.transitions},w.memoizedState=E,w.childLanes=t.childLanes&~l,i.memoizedState=uv,d}return w=t.child,t=w.sibling,d=Za(w,{mode:"visible",children:d.children}),!(i.mode&1)&&(d.lanes=l),d.return=i,d.sibling=null,t!==null&&(l=i.deletions,l===null?(i.deletions=[t],i.flags|=16):l.push(t)),i.child=d,i.memoizedState=null,d}function Ex(t,i){return i=$g({mode:"visible",children:i},t.mode,0,null),i.return=t,t.child=i}function Mm(t,i,l,d){return d!==null&&ux(d),ju(i,t.child,null,l),t=Ex(i,i.pendingProps.children),t.flags|=2,i.memoizedState=null,t}function GD(t,i,l,d,g,w,E){if(l)return i.flags&256?(i.flags&=-257,d=c0(Error(ct(422))),Mm(t,i,E,d)):i.memoizedState!==null?(i.child=t.child,i.flags|=128,null):(w=d.fallback,g=i.mode,d=$g({mode:"visible",children:d.children},g,0,null),w=tc(w,g,E,null),w.flags|=2,d.return=i,w.return=i,d.sibling=w,i.child=d,i.mode&1&&ju(i,t.child,null,E),i.child.memoizedState=hv(E),i.memoizedState=uv,w);if(!(i.mode&1))return Mm(t,i,E,null);if(g.data==="$!"){if(d=g.nextSibling&&g.nextSibling.dataset,d)var s=d.dgst;return d=s,w=Error(ct(419)),d=c0(w,d,void 0),Mm(t,i,E,d)}if(s=(E&t.childLanes)!==0,Ir||s){if(d=Ni,d!==null){switch(E&-E){case 4:g=2;break;case 16:g=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:g=32;break;case 536870912:g=268435456;break;default:g=0}g=g&(d.suspendedLanes|E)?0:g,g!==0&&g!==w.retryLane&&(w.retryLane=g,Hs(t,g),Zo(d,t,g,-1))}return Ix(),d=c0(Error(ct(421))),Mm(t,i,E,d)}return g.data==="$?"?(i.flags|=128,i.child=t.child,i=nz.bind(null,t),g._reactRetry=i,null):(t=w.treeContext,$r=Na(g.nextSibling),Zr=i,Jn=!0,Go=null,t!==null&&(co[uo++]=Vs,co[uo++]=Ns,co[uo++]=ic,Vs=t.id,Ns=t.overflow,ic=i),i=Ex(i,d.children),i.flags|=4096,i)}function LT(t,i,l){t.lanes|=i;var d=t.alternate;d!==null&&(d.lanes|=i),rv(t.return,i,l)}function u0(t,i,l,d,g){var w=t.memoizedState;w===null?t.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:d,tail:l,tailMode:g}:(w.isBackwards=i,w.rendering=null,w.renderingStartTime=0,w.last=d,w.tail=l,w.tailMode=g)}function aC(t,i,l){var d=i.pendingProps,g=d.revealOrder,w=d.tail;if(mr(t,i,d.children,l),d=ci.current,d&2)d=d&1|2,i.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=i.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&LT(t,l,i);else if(t.tag===19)LT(t,l,i);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===i)break e;for(;t.sibling===null;){if(t.return===null||t.return===i)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}d&=1}if(Gn(ci,d),!(i.mode&1))i.memoizedState=null;else switch(g){case"forwards":for(l=i.child,g=null;l!==null;)t=l.alternate,t!==null&&pg(t)===null&&(g=l),l=l.sibling;l=g,l===null?(g=i.child,i.child=null):(g=l.sibling,l.sibling=null),u0(i,!1,g,l,w);break;case"backwards":for(l=null,g=i.child,i.child=null;g!==null;){if(t=g.alternate,t!==null&&pg(t)===null){i.child=g;break}t=g.sibling,g.sibling=l,l=g,g=t}u0(i,!0,l,null,w);break;case"together":u0(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function Zm(t,i){!(i.mode&1)&&t!==null&&(t.alternate=null,i.alternate=null,i.flags|=2)}function Ks(t,i,l){if(t!==null&&(i.dependencies=t.dependencies),oc|=i.lanes,!(l&i.childLanes))return null;if(t!==null&&i.child!==t.child)throw Error(ct(153));if(i.child!==null){for(t=i.child,l=Za(t,t.pendingProps),i.child=l,l.return=i;t.sibling!==null;)t=t.sibling,l=l.sibling=Za(t,t.pendingProps),l.return=i;l.sibling=null}return i.child}function $D(t,i,l){switch(i.tag){case 3:oC(i),Nu();break;case 5:LS(i);break;case 1:Dr(i.type)&&lg(i);break;case 4:gx(i,i.stateNode.containerInfo);break;case 10:var d=i.type._context,g=i.memoizedProps.value;Gn(hg,d._currentValue),d._currentValue=g;break;case 13:if(d=i.memoizedState,d!==null)return d.dehydrated!==null?(Gn(ci,ci.current&1),i.flags|=128,null):l&i.child.childLanes?sC(t,i,l):(Gn(ci,ci.current&1),t=Ks(t,i,l),t!==null?t.sibling:null);Gn(ci,ci.current&1);break;case 19:if(d=(l&i.childLanes)!==0,t.flags&128){if(d)return aC(t,i,l);i.flags|=128}if(g=i.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),Gn(ci,ci.current),d)break;return null;case 22:case 23:return i.lanes=0,iC(t,i,l)}return Ks(t,i,l)}var lC,dv,cC,uC;lC=function(t,i){for(var l=i.child;l!==null;){if(l.tag===5||l.tag===6)t.appendChild(l.stateNode);else if(l.tag!==4&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===i)break;for(;l.sibling===null;){if(l.return===null||l.return===i)return;l=l.return}l.sibling.return=l.return,l=l.sibling}};dv=function(){};cC=function(t,i,l,d){var g=t.memoizedProps;if(g!==d){t=i.stateNode,Kl(ms.current);var w=null;switch(l){case"input":g=L0(t,g),d=L0(t,d),w=[];break;case"select":g=di({},g,{value:void 0}),d=di({},d,{value:void 0}),w=[];break;case"textarea":g=F0(t,g),d=F0(t,d),w=[];break;default:typeof g.onClick!="function"&&typeof d.onClick=="function"&&(t.onclick=sg)}U0(l,d);var E;l=null;for(z in g)if(!d.hasOwnProperty(z)&&g.hasOwnProperty(z)&&g[z]!=null)if(z==="style"){var s=g[z];for(E in s)s.hasOwnProperty(E)&&(l||(l={}),l[E]="")}else z!=="dangerouslySetInnerHTML"&&z!=="children"&&z!=="suppressContentEditableWarning"&&z!=="suppressHydrationWarning"&&z!=="autoFocus"&&(hf.hasOwnProperty(z)?w||(w=[]):(w=w||[]).push(z,null));for(z in d){var A=d[z];if(s=g!=null?g[z]:void 0,d.hasOwnProperty(z)&&A!==s&&(A!=null||s!=null))if(z==="style")if(s){for(E in s)!s.hasOwnProperty(E)||A&&A.hasOwnProperty(E)||(l||(l={}),l[E]="");for(E in A)A.hasOwnProperty(E)&&s[E]!==A[E]&&(l||(l={}),l[E]=A[E])}else l||(w||(w=[]),w.push(z,l)),l=A;else z==="dangerouslySetInnerHTML"?(A=A?A.__html:void 0,s=s?s.__html:void 0,A!=null&&s!==A&&(w=w||[]).push(z,A)):z==="children"?typeof A!="string"&&typeof A!="number"||(w=w||[]).push(z,""+A):z!=="suppressContentEditableWarning"&&z!=="suppressHydrationWarning"&&(hf.hasOwnProperty(z)?(A!=null&&z==="onScroll"&&qn("scroll",t),w||s===A||(w=[])):(w=w||[]).push(z,A))}l&&(w=w||[]).push("style",l);var z=w;(i.updateQueue=z)&&(i.flags|=4)}};uC=function(t,i,l,d){l!==d&&(i.flags|=4)};function Fd(t,i){if(!Jn)switch(t.tailMode){case"hidden":i=t.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?t.tail=null:l.sibling=null;break;case"collapsed":l=t.tail;for(var d=null;l!==null;)l.alternate!==null&&(d=l),l=l.sibling;d===null?i||t.tail===null?t.tail=null:t.tail.sibling=null:d.sibling=null}}function sr(t){var i=t.alternate!==null&&t.alternate.child===t.child,l=0,d=0;if(i)for(var g=t.child;g!==null;)l|=g.lanes|g.childLanes,d|=g.subtreeFlags&14680064,d|=g.flags&14680064,g.return=t,g=g.sibling;else for(g=t.child;g!==null;)l|=g.lanes|g.childLanes,d|=g.subtreeFlags,d|=g.flags,g.return=t,g=g.sibling;return t.subtreeFlags|=d,t.childLanes=l,i}function ZD(t,i,l){var d=i.pendingProps;switch(cx(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return sr(i),null;case 1:return Dr(i.type)&&ag(),sr(i),null;case 3:return d=i.stateNode,Gu(),Wn(kr),Wn(lr),yx(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(t===null||t.child===null)&&(Cm(i)?i.flags|=4:t===null||t.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,Go!==null&&(xv(Go),Go=null))),dv(t,i),sr(i),null;case 5:_x(i);var g=Kl(Tf.current);if(l=i.type,t!==null&&i.stateNode!=null)cC(t,i,l,d,g),t.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!d){if(i.stateNode===null)throw Error(ct(166));return sr(i),null}if(t=Kl(ms.current),Cm(i)){d=i.stateNode,l=i.type;var w=i.memoizedProps;switch(d[fs]=i,d[wf]=w,t=(i.mode&1)!==0,l){case"dialog":qn("cancel",d),qn("close",d);break;case"iframe":case"object":case"embed":qn("load",d);break;case"video":case"audio":for(g=0;g<Xd.length;g++)qn(Xd[g],d);break;case"source":qn("error",d);break;case"img":case"image":case"link":qn("error",d),qn("load",d);break;case"details":qn("toggle",d);break;case"input":Gb(d,w),qn("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!w.multiple},qn("invalid",d);break;case"textarea":Zb(d,w),qn("invalid",d)}U0(l,w),g=null;for(var E in w)if(w.hasOwnProperty(E)){var s=w[E];E==="children"?typeof s=="string"?d.textContent!==s&&(w.suppressHydrationWarning!==!0&&Sm(d.textContent,s,t),g=["children",s]):typeof s=="number"&&d.textContent!==""+s&&(w.suppressHydrationWarning!==!0&&Sm(d.textContent,s,t),g=["children",""+s]):hf.hasOwnProperty(E)&&s!=null&&E==="onScroll"&&qn("scroll",d)}switch(l){case"input":_m(d),$b(d,w,!0);break;case"textarea":_m(d),qb(d);break;case"select":case"option":break;default:typeof w.onClick=="function"&&(d.onclick=sg)}d=g,i.updateQueue=d,d!==null&&(i.flags|=4)}else{E=g.nodeType===9?g:g.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=FE(l)),t==="http://www.w3.org/1999/xhtml"?l==="script"?(t=E.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof d.is=="string"?t=E.createElement(l,{is:d.is}):(t=E.createElement(l),l==="select"&&(E=t,d.multiple?E.multiple=!0:d.size&&(E.size=d.size))):t=E.createElementNS(t,l),t[fs]=i,t[wf]=d,lC(t,i,!1,!1),i.stateNode=t;e:{switch(E=V0(l,d),l){case"dialog":qn("cancel",t),qn("close",t),g=d;break;case"iframe":case"object":case"embed":qn("load",t),g=d;break;case"video":case"audio":for(g=0;g<Xd.length;g++)qn(Xd[g],t);g=d;break;case"source":qn("error",t),g=d;break;case"img":case"image":case"link":qn("error",t),qn("load",t),g=d;break;case"details":qn("toggle",t),g=d;break;case"input":Gb(t,d),g=L0(t,d),qn("invalid",t);break;case"option":g=d;break;case"select":t._wrapperState={wasMultiple:!!d.multiple},g=di({},d,{value:void 0}),qn("invalid",t);break;case"textarea":Zb(t,d),g=F0(t,d),qn("invalid",t);break;default:g=d}U0(l,g),s=g;for(w in s)if(s.hasOwnProperty(w)){var A=s[w];w==="style"?VE(t,A):w==="dangerouslySetInnerHTML"?(A=A?A.__html:void 0,A!=null&&OE(t,A)):w==="children"?typeof A=="string"?(l!=="textarea"||A!=="")&&df(t,A):typeof A=="number"&&df(t,""+A):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(hf.hasOwnProperty(w)?A!=null&&w==="onScroll"&&qn("scroll",t):A!=null&&Xv(t,w,A,E))}switch(l){case"input":_m(t),$b(t,d,!1);break;case"textarea":_m(t),qb(t);break;case"option":d.value!=null&&t.setAttribute("value",""+Xa(d.value));break;case"select":t.multiple=!!d.multiple,w=d.value,w!=null?ku(t,!!d.multiple,w,!1):d.defaultValue!=null&&ku(t,!!d.multiple,d.defaultValue,!0);break;default:typeof g.onClick=="function"&&(t.onclick=sg)}switch(l){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return sr(i),null;case 6:if(t&&i.stateNode!=null)uC(t,i,t.memoizedProps,d);else{if(typeof d!="string"&&i.stateNode===null)throw Error(ct(166));if(l=Kl(Tf.current),Kl(ms.current),Cm(i)){if(d=i.stateNode,l=i.memoizedProps,d[fs]=i,(w=d.nodeValue!==l)&&(t=Zr,t!==null))switch(t.tag){case 3:Sm(d.nodeValue,l,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Sm(d.nodeValue,l,(t.mode&1)!==0)}w&&(i.flags|=4)}else d=(l.nodeType===9?l:l.ownerDocument).createTextNode(d),d[fs]=i,i.stateNode=d}return sr(i),null;case 13:if(Wn(ci),d=i.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Jn&&$r!==null&&i.mode&1&&!(i.flags&128))AS(),Nu(),i.flags|=98560,w=!1;else if(w=Cm(i),d!==null&&d.dehydrated!==null){if(t===null){if(!w)throw Error(ct(318));if(w=i.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(ct(317));w[fs]=i}else Nu(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;sr(i),w=!1}else Go!==null&&(xv(Go),Go=null),w=!0;if(!w)return i.flags&65536?i:null}return i.flags&128?(i.lanes=l,i):(d=d!==null,d!==(t!==null&&t.memoizedState!==null)&&d&&(i.child.flags|=8192,i.mode&1&&(t===null||ci.current&1?Ri===0&&(Ri=3):Ix())),i.updateQueue!==null&&(i.flags|=4),sr(i),null);case 4:return Gu(),dv(t,i),t===null&&vf(i.stateNode.containerInfo),sr(i),null;case 10:return fx(i.type._context),sr(i),null;case 17:return Dr(i.type)&&ag(),sr(i),null;case 19:if(Wn(ci),w=i.memoizedState,w===null)return sr(i),null;if(d=(i.flags&128)!==0,E=w.rendering,E===null)if(d)Fd(w,!1);else{if(Ri!==0||t!==null&&t.flags&128)for(t=i.child;t!==null;){if(E=pg(t),E!==null){for(i.flags|=128,Fd(w,!1),d=E.updateQueue,d!==null&&(i.updateQueue=d,i.flags|=4),i.subtreeFlags=0,d=l,l=i.child;l!==null;)w=l,t=d,w.flags&=14680066,E=w.alternate,E===null?(w.childLanes=0,w.lanes=t,w.child=null,w.subtreeFlags=0,w.memoizedProps=null,w.memoizedState=null,w.updateQueue=null,w.dependencies=null,w.stateNode=null):(w.childLanes=E.childLanes,w.lanes=E.lanes,w.child=E.child,w.subtreeFlags=0,w.deletions=null,w.memoizedProps=E.memoizedProps,w.memoizedState=E.memoizedState,w.updateQueue=E.updateQueue,w.type=E.type,t=E.dependencies,w.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),l=l.sibling;return Gn(ci,ci.current&1|2),i.child}t=t.sibling}w.tail!==null&&_i()>Zu&&(i.flags|=128,d=!0,Fd(w,!1),i.lanes=4194304)}else{if(!d)if(t=pg(E),t!==null){if(i.flags|=128,d=!0,l=t.updateQueue,l!==null&&(i.updateQueue=l,i.flags|=4),Fd(w,!0),w.tail===null&&w.tailMode==="hidden"&&!E.alternate&&!Jn)return sr(i),null}else 2*_i()-w.renderingStartTime>Zu&&l!==1073741824&&(i.flags|=128,d=!0,Fd(w,!1),i.lanes=4194304);w.isBackwards?(E.sibling=i.child,i.child=E):(l=w.last,l!==null?l.sibling=E:i.child=E,w.last=E)}return w.tail!==null?(i=w.tail,w.rendering=i,w.tail=i.sibling,w.renderingStartTime=_i(),i.sibling=null,l=ci.current,Gn(ci,d?l&1|2:l&1),i):(sr(i),null);case 22:case 23:return Px(),d=i.memoizedState!==null,t!==null&&t.memoizedState!==null!==d&&(i.flags|=8192),d&&i.mode&1?Gr&1073741824&&(sr(i),i.subtreeFlags&6&&(i.flags|=8192)):sr(i),null;case 24:return null;case 25:return null}throw Error(ct(156,i.tag))}function qD(t,i){switch(cx(i),i.tag){case 1:return Dr(i.type)&&ag(),t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 3:return Gu(),Wn(kr),Wn(lr),yx(),t=i.flags,t&65536&&!(t&128)?(i.flags=t&-65537|128,i):null;case 5:return _x(i),null;case 13:if(Wn(ci),t=i.memoizedState,t!==null&&t.dehydrated!==null){if(i.alternate===null)throw Error(ct(340));Nu()}return t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 19:return Wn(ci),null;case 4:return Gu(),null;case 10:return fx(i.type._context),null;case 22:case 23:return Px(),null;case 24:return null;default:return null}}var Pm=!1,ar=!1,WD=typeof WeakSet=="function"?WeakSet:Set,St=null;function Tu(t,i){var l=t.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(d){pi(t,i,d)}else l.current=null}function fv(t,i,l){try{l()}catch(d){pi(t,i,d)}}var RT=!1;function XD(t,i){if(K0=ig,t=pS(),ax(t)){if("selectionStart"in t)var l={start:t.selectionStart,end:t.selectionEnd};else e:{l=(l=t.ownerDocument)&&l.defaultView||window;var d=l.getSelection&&l.getSelection();if(d&&d.rangeCount!==0){l=d.anchorNode;var g=d.anchorOffset,w=d.focusNode;d=d.focusOffset;try{l.nodeType,w.nodeType}catch{l=null;break e}var E=0,s=-1,A=-1,z=0,V=0,j=t,G=null;t:for(;;){for(var re;j!==l||g!==0&&j.nodeType!==3||(s=E+g),j!==w||d!==0&&j.nodeType!==3||(A=E+d),j.nodeType===3&&(E+=j.nodeValue.length),(re=j.firstChild)!==null;)G=j,j=re;for(;;){if(j===t)break t;if(G===l&&++z===g&&(s=E),G===w&&++V===d&&(A=E),(re=j.nextSibling)!==null)break;j=G,G=j.parentNode}j=re}l=s===-1||A===-1?null:{start:s,end:A}}else l=null}l=l||{start:0,end:0}}else l=null;for(Y0={focusedElem:t,selectionRange:l},ig=!1,St=i;St!==null;)if(i=St,t=i.child,(i.subtreeFlags&1028)!==0&&t!==null)t.return=i,St=t;else for(;St!==null;){i=St;try{var he=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(he!==null){var ve=he.memoizedProps,Ue=he.memoizedState,ae=i.stateNode,J=ae.getSnapshotBeforeUpdate(i.elementType===i.type?ve:Vo(i.type,ve),Ue);ae.__reactInternalSnapshotBeforeUpdate=J}break;case 3:var se=i.stateNode.containerInfo;se.nodeType===1?se.textContent="":se.nodeType===9&&se.documentElement&&se.removeChild(se.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ct(163))}}catch(oe){pi(i,i.return,oe)}if(t=i.sibling,t!==null){t.return=i.return,St=t;break}St=i.return}return he=RT,RT=!1,he}function nf(t,i,l){var d=i.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var g=d=d.next;do{if((g.tag&t)===t){var w=g.destroy;g.destroy=void 0,w!==void 0&&fv(i,l,w)}g=g.next}while(g!==d)}}function jg(t,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var l=i=i.next;do{if((l.tag&t)===t){var d=l.create;l.destroy=d()}l=l.next}while(l!==i)}}function pv(t){var i=t.ref;if(i!==null){var l=t.stateNode;switch(t.tag){case 5:t=l;break;default:t=l}typeof i=="function"?i(t):i.current=t}}function hC(t){var i=t.alternate;i!==null&&(t.alternate=null,hC(i)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(i=t.stateNode,i!==null&&(delete i[fs],delete i[wf],delete i[ev],delete i[ID],delete i[kD])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function dC(t){return t.tag===5||t.tag===3||t.tag===4}function BT(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||dC(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function mv(t,i,l){var d=t.tag;if(d===5||d===6)t=t.stateNode,i?l.nodeType===8?l.parentNode.insertBefore(t,i):l.insertBefore(t,i):(l.nodeType===8?(i=l.parentNode,i.insertBefore(t,l)):(i=l,i.appendChild(t)),l=l._reactRootContainer,l!=null||i.onclick!==null||(i.onclick=sg));else if(d!==4&&(t=t.child,t!==null))for(mv(t,i,l),t=t.sibling;t!==null;)mv(t,i,l),t=t.sibling}function gv(t,i,l){var d=t.tag;if(d===5||d===6)t=t.stateNode,i?l.insertBefore(t,i):l.appendChild(t);else if(d!==4&&(t=t.child,t!==null))for(gv(t,i,l),t=t.sibling;t!==null;)gv(t,i,l),t=t.sibling}var qi=null,No=!1;function Pa(t,i,l){for(l=l.child;l!==null;)fC(t,i,l),l=l.sibling}function fC(t,i,l){if(ps&&typeof ps.onCommitFiberUnmount=="function")try{ps.onCommitFiberUnmount(Lg,l)}catch{}switch(l.tag){case 5:ar||Tu(l,i);case 6:var d=qi,g=No;qi=null,Pa(t,i,l),qi=d,No=g,qi!==null&&(No?(t=qi,l=l.stateNode,t.nodeType===8?t.parentNode.removeChild(l):t.removeChild(l)):qi.removeChild(l.stateNode));break;case 18:qi!==null&&(No?(t=qi,l=l.stateNode,t.nodeType===8?i0(t.parentNode,l):t.nodeType===1&&i0(t,l),gf(t)):i0(qi,l.stateNode));break;case 4:d=qi,g=No,qi=l.stateNode.containerInfo,No=!0,Pa(t,i,l),qi=d,No=g;break;case 0:case 11:case 14:case 15:if(!ar&&(d=l.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){g=d=d.next;do{var w=g,E=w.destroy;w=w.tag,E!==void 0&&(w&2||w&4)&&fv(l,i,E),g=g.next}while(g!==d)}Pa(t,i,l);break;case 1:if(!ar&&(Tu(l,i),d=l.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=l.memoizedProps,d.state=l.memoizedState,d.componentWillUnmount()}catch(s){pi(l,i,s)}Pa(t,i,l);break;case 21:Pa(t,i,l);break;case 22:l.mode&1?(ar=(d=ar)||l.memoizedState!==null,Pa(t,i,l),ar=d):Pa(t,i,l);break;default:Pa(t,i,l)}}function FT(t){var i=t.updateQueue;if(i!==null){t.updateQueue=null;var l=t.stateNode;l===null&&(l=t.stateNode=new WD),i.forEach(function(d){var g=iz.bind(null,t,d);l.has(d)||(l.add(d),d.then(g,g))})}}function Uo(t,i){var l=i.deletions;if(l!==null)for(var d=0;d<l.length;d++){var g=l[d];try{var w=t,E=i,s=E;e:for(;s!==null;){switch(s.tag){case 5:qi=s.stateNode,No=!1;break e;case 3:qi=s.stateNode.containerInfo,No=!0;break e;case 4:qi=s.stateNode.containerInfo,No=!0;break e}s=s.return}if(qi===null)throw Error(ct(160));fC(w,E,g),qi=null,No=!1;var A=g.alternate;A!==null&&(A.return=null),g.return=null}catch(z){pi(g,i,z)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)pC(i,t),i=i.sibling}function pC(t,i){var l=t.alternate,d=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Uo(i,t),us(t),d&4){try{nf(3,t,t.return),jg(3,t)}catch(ve){pi(t,t.return,ve)}try{nf(5,t,t.return)}catch(ve){pi(t,t.return,ve)}}break;case 1:Uo(i,t),us(t),d&512&&l!==null&&Tu(l,l.return);break;case 5:if(Uo(i,t),us(t),d&512&&l!==null&&Tu(l,l.return),t.flags&32){var g=t.stateNode;try{df(g,"")}catch(ve){pi(t,t.return,ve)}}if(d&4&&(g=t.stateNode,g!=null)){var w=t.memoizedProps,E=l!==null?l.memoizedProps:w,s=t.type,A=t.updateQueue;if(t.updateQueue=null,A!==null)try{s==="input"&&w.type==="radio"&&w.name!=null&&RE(g,w),V0(s,E);var z=V0(s,w);for(E=0;E<A.length;E+=2){var V=A[E],j=A[E+1];V==="style"?VE(g,j):V==="dangerouslySetInnerHTML"?OE(g,j):V==="children"?df(g,j):Xv(g,V,j,z)}switch(s){case"input":R0(g,w);break;case"textarea":BE(g,w);break;case"select":var G=g._wrapperState.wasMultiple;g._wrapperState.wasMultiple=!!w.multiple;var re=w.value;re!=null?ku(g,!!w.multiple,re,!1):G!==!!w.multiple&&(w.defaultValue!=null?ku(g,!!w.multiple,w.defaultValue,!0):ku(g,!!w.multiple,w.multiple?[]:"",!1))}g[wf]=w}catch(ve){pi(t,t.return,ve)}}break;case 6:if(Uo(i,t),us(t),d&4){if(t.stateNode===null)throw Error(ct(162));g=t.stateNode,w=t.memoizedProps;try{g.nodeValue=w}catch(ve){pi(t,t.return,ve)}}break;case 3:if(Uo(i,t),us(t),d&4&&l!==null&&l.memoizedState.isDehydrated)try{gf(i.containerInfo)}catch(ve){pi(t,t.return,ve)}break;case 4:Uo(i,t),us(t);break;case 13:Uo(i,t),us(t),g=t.child,g.flags&8192&&(w=g.memoizedState!==null,g.stateNode.isHidden=w,!w||g.alternate!==null&&g.alternate.memoizedState!==null||(Ax=_i())),d&4&&FT(t);break;case 22:if(V=l!==null&&l.memoizedState!==null,t.mode&1?(ar=(z=ar)||V,Uo(i,t),ar=z):Uo(i,t),us(t),d&8192){if(z=t.memoizedState!==null,(t.stateNode.isHidden=z)&&!V&&t.mode&1)for(St=t,V=t.child;V!==null;){for(j=St=V;St!==null;){switch(G=St,re=G.child,G.tag){case 0:case 11:case 14:case 15:nf(4,G,G.return);break;case 1:Tu(G,G.return);var he=G.stateNode;if(typeof he.componentWillUnmount=="function"){d=G,l=G.return;try{i=d,he.props=i.memoizedProps,he.state=i.memoizedState,he.componentWillUnmount()}catch(ve){pi(d,l,ve)}}break;case 5:Tu(G,G.return);break;case 22:if(G.memoizedState!==null){UT(j);continue}}re!==null?(re.return=G,St=re):UT(j)}V=V.sibling}e:for(V=null,j=t;;){if(j.tag===5){if(V===null){V=j;try{g=j.stateNode,z?(w=g.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none"):(s=j.stateNode,A=j.memoizedProps.style,E=A!=null&&A.hasOwnProperty("display")?A.display:null,s.style.display=UE("display",E))}catch(ve){pi(t,t.return,ve)}}}else if(j.tag===6){if(V===null)try{j.stateNode.nodeValue=z?"":j.memoizedProps}catch(ve){pi(t,t.return,ve)}}else if((j.tag!==22&&j.tag!==23||j.memoizedState===null||j===t)&&j.child!==null){j.child.return=j,j=j.child;continue}if(j===t)break e;for(;j.sibling===null;){if(j.return===null||j.return===t)break e;V===j&&(V=null),j=j.return}V===j&&(V=null),j.sibling.return=j.return,j=j.sibling}}break;case 19:Uo(i,t),us(t),d&4&&FT(t);break;case 21:break;default:Uo(i,t),us(t)}}function us(t){var i=t.flags;if(i&2){try{e:{for(var l=t.return;l!==null;){if(dC(l)){var d=l;break e}l=l.return}throw Error(ct(160))}switch(d.tag){case 5:var g=d.stateNode;d.flags&32&&(df(g,""),d.flags&=-33);var w=BT(t);gv(t,w,g);break;case 3:case 4:var E=d.stateNode.containerInfo,s=BT(t);mv(t,s,E);break;default:throw Error(ct(161))}}catch(A){pi(t,t.return,A)}t.flags&=-3}i&4096&&(t.flags&=-4097)}function HD(t,i,l){St=t,mC(t)}function mC(t,i,l){for(var d=(t.mode&1)!==0;St!==null;){var g=St,w=g.child;if(g.tag===22&&d){var E=g.memoizedState!==null||Pm;if(!E){var s=g.alternate,A=s!==null&&s.memoizedState!==null||ar;s=Pm;var z=ar;if(Pm=E,(ar=A)&&!z)for(St=g;St!==null;)E=St,A=E.child,E.tag===22&&E.memoizedState!==null?VT(g):A!==null?(A.return=E,St=A):VT(g);for(;w!==null;)St=w,mC(w),w=w.sibling;St=g,Pm=s,ar=z}OT(t)}else g.subtreeFlags&8772&&w!==null?(w.return=g,St=w):OT(t)}}function OT(t){for(;St!==null;){var i=St;if(i.flags&8772){var l=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:ar||jg(5,i);break;case 1:var d=i.stateNode;if(i.flags&4&&!ar)if(l===null)d.componentDidMount();else{var g=i.elementType===i.type?l.memoizedProps:Vo(i.type,l.memoizedProps);d.componentDidUpdate(g,l.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var w=i.updateQueue;w!==null&&wT(i,w,d);break;case 3:var E=i.updateQueue;if(E!==null){if(l=null,i.child!==null)switch(i.child.tag){case 5:l=i.child.stateNode;break;case 1:l=i.child.stateNode}wT(i,E,l)}break;case 5:var s=i.stateNode;if(l===null&&i.flags&4){l=s;var A=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":A.autoFocus&&l.focus();break;case"img":A.src&&(l.src=A.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var z=i.alternate;if(z!==null){var V=z.memoizedState;if(V!==null){var j=V.dehydrated;j!==null&&gf(j)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ct(163))}ar||i.flags&512&&pv(i)}catch(G){pi(i,i.return,G)}}if(i===t){St=null;break}if(l=i.sibling,l!==null){l.return=i.return,St=l;break}St=i.return}}function UT(t){for(;St!==null;){var i=St;if(i===t){St=null;break}var l=i.sibling;if(l!==null){l.return=i.return,St=l;break}St=i.return}}function VT(t){for(;St!==null;){var i=St;try{switch(i.tag){case 0:case 11:case 15:var l=i.return;try{jg(4,i)}catch(A){pi(i,l,A)}break;case 1:var d=i.stateNode;if(typeof d.componentDidMount=="function"){var g=i.return;try{d.componentDidMount()}catch(A){pi(i,g,A)}}var w=i.return;try{pv(i)}catch(A){pi(i,w,A)}break;case 5:var E=i.return;try{pv(i)}catch(A){pi(i,E,A)}}}catch(A){pi(i,i.return,A)}if(i===t){St=null;break}var s=i.sibling;if(s!==null){s.return=i.return,St=s;break}St=i.return}}var KD=Math.ceil,_g=Js.ReactCurrentDispatcher,Sx=Js.ReactCurrentOwner,fo=Js.ReactCurrentBatchConfig,mn=0,Ni=null,Ai=null,Wi=0,Gr=0,Eu=Qa(0),Ri=0,Af=null,oc=0,Gg=0,Cx=0,rf=null,Pr=null,Ax=0,Zu=1/0,Os=null,yg=!1,_v=null,Ga=null,Im=!1,Fa=null,vg=0,of=0,yv=null,qm=-1,Wm=0;function gr(){return mn&6?_i():qm!==-1?qm:qm=_i()}function $a(t){return t.mode&1?mn&2&&Wi!==0?Wi&-Wi:zD.transition!==null?(Wm===0&&(Wm=JE()),Wm):(t=Rn,t!==0||(t=window.event,t=t===void 0?16:oS(t.type)),t):1}function Zo(t,i,l,d){if(50<of)throw of=0,yv=null,Error(ct(185));Rf(t,l,d),(!(mn&2)||t!==Ni)&&(t===Ni&&(!(mn&2)&&(Gg|=l),Ri===4&&Ra(t,Wi)),zr(t,d),l===1&&mn===0&&!(i.mode&1)&&(Zu=_i()+500,Ug&&el()))}function zr(t,i){var l=t.callbackNode;zk(t,i);var d=ng(t,t===Ni?Wi:0);if(d===0)l!==null&&Hb(l),t.callbackNode=null,t.callbackPriority=0;else if(i=d&-d,t.callbackPriority!==i){if(l!=null&&Hb(l),i===1)t.tag===0?DD(NT.bind(null,t)):ES(NT.bind(null,t)),MD(function(){!(mn&6)&&el()}),l=null;else{switch(QE(d)){case 1:l=Qv;break;case 4:l=KE;break;case 16:l=tg;break;case 536870912:l=YE;break;default:l=tg}l=TC(l,gC.bind(null,t))}t.callbackPriority=i,t.callbackNode=l}}function gC(t,i){if(qm=-1,Wm=0,mn&6)throw Error(ct(327));var l=t.callbackNode;if(Bu()&&t.callbackNode!==l)return null;var d=ng(t,t===Ni?Wi:0);if(d===0)return null;if(d&30||d&t.expiredLanes||i)i=xg(t,d);else{i=d;var g=mn;mn|=2;var w=yC();(Ni!==t||Wi!==i)&&(Os=null,Zu=_i()+500,ec(t,i));do try{QD();break}catch(s){_C(t,s)}while(1);dx(),_g.current=w,mn=g,Ai!==null?i=0:(Ni=null,Wi=0,i=Ri)}if(i!==0){if(i===2&&(g=Z0(t),g!==0&&(d=g,i=vv(t,g))),i===1)throw l=Af,ec(t,0),Ra(t,d),zr(t,_i()),l;if(i===6)Ra(t,d);else{if(g=t.current.alternate,!(d&30)&&!YD(g)&&(i=xg(t,d),i===2&&(w=Z0(t),w!==0&&(d=w,i=vv(t,w))),i===1))throw l=Af,ec(t,0),Ra(t,d),zr(t,_i()),l;switch(t.finishedWork=g,t.finishedLanes=d,i){case 0:case 1:throw Error(ct(345));case 2:Zl(t,Pr,Os);break;case 3:if(Ra(t,d),(d&130023424)===d&&(i=Ax+500-_i(),10<i)){if(ng(t,0)!==0)break;if(g=t.suspendedLanes,(g&d)!==d){gr(),t.pingedLanes|=t.suspendedLanes&g;break}t.timeoutHandle=Q0(Zl.bind(null,t,Pr,Os),i);break}Zl(t,Pr,Os);break;case 4:if(Ra(t,d),(d&4194240)===d)break;for(i=t.eventTimes,g=-1;0<d;){var E=31-$o(d);w=1<<E,E=i[E],E>g&&(g=E),d&=~w}if(d=g,d=_i()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*KD(d/1960))-d,10<d){t.timeoutHandle=Q0(Zl.bind(null,t,Pr,Os),d);break}Zl(t,Pr,Os);break;case 5:Zl(t,Pr,Os);break;default:throw Error(ct(329))}}}return zr(t,_i()),t.callbackNode===l?gC.bind(null,t):null}function vv(t,i){var l=rf;return t.current.memoizedState.isDehydrated&&(ec(t,i).flags|=256),t=xg(t,i),t!==2&&(i=Pr,Pr=l,i!==null&&xv(i)),t}function xv(t){Pr===null?Pr=t:Pr.push.apply(Pr,t)}function YD(t){for(var i=t;;){if(i.flags&16384){var l=i.updateQueue;if(l!==null&&(l=l.stores,l!==null))for(var d=0;d<l.length;d++){var g=l[d],w=g.getSnapshot;g=g.value;try{if(!qo(w(),g))return!1}catch{return!1}}}if(l=i.child,i.subtreeFlags&16384&&l!==null)l.return=i,i=l;else{if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Ra(t,i){for(i&=~Cx,i&=~Gg,t.suspendedLanes|=i,t.pingedLanes&=~i,t=t.expirationTimes;0<i;){var l=31-$o(i),d=1<<l;t[l]=-1,i&=~d}}function NT(t){if(mn&6)throw Error(ct(327));Bu();var i=ng(t,0);if(!(i&1))return zr(t,_i()),null;var l=xg(t,i);if(t.tag!==0&&l===2){var d=Z0(t);d!==0&&(i=d,l=vv(t,d))}if(l===1)throw l=Af,ec(t,0),Ra(t,i),zr(t,_i()),l;if(l===6)throw Error(ct(345));return t.finishedWork=t.current.alternate,t.finishedLanes=i,Zl(t,Pr,Os),zr(t,_i()),null}function Mx(t,i){var l=mn;mn|=1;try{return t(i)}finally{mn=l,mn===0&&(Zu=_i()+500,Ug&&el())}}function sc(t){Fa!==null&&Fa.tag===0&&!(mn&6)&&Bu();var i=mn;mn|=1;var l=fo.transition,d=Rn;try{if(fo.transition=null,Rn=1,t)return t()}finally{Rn=d,fo.transition=l,mn=i,!(mn&6)&&el()}}function Px(){Gr=Eu.current,Wn(Eu)}function ec(t,i){t.finishedWork=null,t.finishedLanes=0;var l=t.timeoutHandle;if(l!==-1&&(t.timeoutHandle=-1,AD(l)),Ai!==null)for(l=Ai.return;l!==null;){var d=l;switch(cx(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&ag();break;case 3:Gu(),Wn(kr),Wn(lr),yx();break;case 5:_x(d);break;case 4:Gu();break;case 13:Wn(ci);break;case 19:Wn(ci);break;case 10:fx(d.type._context);break;case 22:case 23:Px()}l=l.return}if(Ni=t,Ai=t=Za(t.current,null),Wi=Gr=i,Ri=0,Af=null,Cx=Gg=oc=0,Pr=rf=null,Hl!==null){for(i=0;i<Hl.length;i++)if(l=Hl[i],d=l.interleaved,d!==null){l.interleaved=null;var g=d.next,w=l.pending;if(w!==null){var E=w.next;w.next=g,d.next=E}l.pending=d}Hl=null}return t}function _C(t,i){do{var l=Ai;try{if(dx(),Gm.current=gg,mg){for(var d=hi.memoizedState;d!==null;){var g=d.queue;g!==null&&(g.pending=null),d=d.next}mg=!1}if(rc=0,Vi=zi=hi=null,tf=!1,Ef=0,Sx.current=null,l===null||l.return===null){Ri=1,Af=i,Ai=null;break}e:{var w=t,E=l.return,s=l,A=i;if(i=Wi,s.flags|=32768,A!==null&&typeof A=="object"&&typeof A.then=="function"){var z=A,V=s,j=V.tag;if(!(V.mode&1)&&(j===0||j===11||j===15)){var G=V.alternate;G?(V.updateQueue=G.updateQueue,V.memoizedState=G.memoizedState,V.lanes=G.lanes):(V.updateQueue=null,V.memoizedState=null)}var re=MT(E);if(re!==null){re.flags&=-257,PT(re,E,s,w,i),re.mode&1&&AT(w,z,i),i=re,A=z;var he=i.updateQueue;if(he===null){var ve=new Set;ve.add(A),i.updateQueue=ve}else he.add(A);break e}else{if(!(i&1)){AT(w,z,i),Ix();break e}A=Error(ct(426))}}else if(Jn&&s.mode&1){var Ue=MT(E);if(Ue!==null){!(Ue.flags&65536)&&(Ue.flags|=256),PT(Ue,E,s,w,i),ux($u(A,s));break e}}w=A=$u(A,s),Ri!==4&&(Ri=2),rf===null?rf=[w]:rf.push(w),w=E;do{switch(w.tag){case 3:w.flags|=65536,i&=-i,w.lanes|=i;var ae=eC(w,A,i);xT(w,ae);break e;case 1:s=A;var J=w.type,se=w.stateNode;if(!(w.flags&128)&&(typeof J.getDerivedStateFromError=="function"||se!==null&&typeof se.componentDidCatch=="function"&&(Ga===null||!Ga.has(se)))){w.flags|=65536,i&=-i,w.lanes|=i;var oe=tC(w,s,i);xT(w,oe);break e}}w=w.return}while(w!==null)}xC(l)}catch(Be){i=Be,Ai===l&&l!==null&&(Ai=l=l.return);continue}break}while(1)}function yC(){var t=_g.current;return _g.current=gg,t===null?gg:t}function Ix(){(Ri===0||Ri===3||Ri===2)&&(Ri=4),Ni===null||!(oc&268435455)&&!(Gg&268435455)||Ra(Ni,Wi)}function xg(t,i){var l=mn;mn|=2;var d=yC();(Ni!==t||Wi!==i)&&(Os=null,ec(t,i));do try{JD();break}catch(g){_C(t,g)}while(1);if(dx(),mn=l,_g.current=d,Ai!==null)throw Error(ct(261));return Ni=null,Wi=0,Ri}function JD(){for(;Ai!==null;)vC(Ai)}function QD(){for(;Ai!==null&&!Ek();)vC(Ai)}function vC(t){var i=bC(t.alternate,t,Gr);t.memoizedProps=t.pendingProps,i===null?xC(t):Ai=i,Sx.current=null}function xC(t){var i=t;do{var l=i.alternate;if(t=i.return,i.flags&32768){if(l=qD(l,i),l!==null){l.flags&=32767,Ai=l;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ri=6,Ai=null;return}}else if(l=ZD(l,i,Gr),l!==null){Ai=l;return}if(i=i.sibling,i!==null){Ai=i;return}Ai=i=t}while(i!==null);Ri===0&&(Ri=5)}function Zl(t,i,l){var d=Rn,g=fo.transition;try{fo.transition=null,Rn=1,ez(t,i,l,d)}finally{fo.transition=g,Rn=d}return null}function ez(t,i,l,d){do Bu();while(Fa!==null);if(mn&6)throw Error(ct(327));l=t.finishedWork;var g=t.finishedLanes;if(l===null)return null;if(t.finishedWork=null,t.finishedLanes=0,l===t.current)throw Error(ct(177));t.callbackNode=null,t.callbackPriority=0;var w=l.lanes|l.childLanes;if(Lk(t,w),t===Ni&&(Ai=Ni=null,Wi=0),!(l.subtreeFlags&2064)&&!(l.flags&2064)||Im||(Im=!0,TC(tg,function(){return Bu(),null})),w=(l.flags&15990)!==0,l.subtreeFlags&15990||w){w=fo.transition,fo.transition=null;var E=Rn;Rn=1;var s=mn;mn|=4,Sx.current=null,XD(t,l),pC(l,t),xD(Y0),ig=!!K0,Y0=K0=null,t.current=l,HD(l),Sk(),mn=s,Rn=E,fo.transition=w}else t.current=l;if(Im&&(Im=!1,Fa=t,vg=g),w=t.pendingLanes,w===0&&(Ga=null),Mk(l.stateNode),zr(t,_i()),i!==null)for(d=t.onRecoverableError,l=0;l<i.length;l++)g=i[l],d(g.value,{componentStack:g.stack,digest:g.digest});if(yg)throw yg=!1,t=_v,_v=null,t;return vg&1&&t.tag!==0&&Bu(),w=t.pendingLanes,w&1?t===yv?of++:(of=0,yv=t):of=0,el(),null}function Bu(){if(Fa!==null){var t=QE(vg),i=fo.transition,l=Rn;try{if(fo.transition=null,Rn=16>t?16:t,Fa===null)var d=!1;else{if(t=Fa,Fa=null,vg=0,mn&6)throw Error(ct(331));var g=mn;for(mn|=4,St=t.current;St!==null;){var w=St,E=w.child;if(St.flags&16){var s=w.deletions;if(s!==null){for(var A=0;A<s.length;A++){var z=s[A];for(St=z;St!==null;){var V=St;switch(V.tag){case 0:case 11:case 15:nf(8,V,w)}var j=V.child;if(j!==null)j.return=V,St=j;else for(;St!==null;){V=St;var G=V.sibling,re=V.return;if(hC(V),V===z){St=null;break}if(G!==null){G.return=re,St=G;break}St=re}}}var he=w.alternate;if(he!==null){var ve=he.child;if(ve!==null){he.child=null;do{var Ue=ve.sibling;ve.sibling=null,ve=Ue}while(ve!==null)}}St=w}}if(w.subtreeFlags&2064&&E!==null)E.return=w,St=E;else e:for(;St!==null;){if(w=St,w.flags&2048)switch(w.tag){case 0:case 11:case 15:nf(9,w,w.return)}var ae=w.sibling;if(ae!==null){ae.return=w.return,St=ae;break e}St=w.return}}var J=t.current;for(St=J;St!==null;){E=St;var se=E.child;if(E.subtreeFlags&2064&&se!==null)se.return=E,St=se;else e:for(E=J;St!==null;){if(s=St,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:jg(9,s)}}catch(Be){pi(s,s.return,Be)}if(s===E){St=null;break e}var oe=s.sibling;if(oe!==null){oe.return=s.return,St=oe;break e}St=s.return}}if(mn=g,el(),ps&&typeof ps.onPostCommitFiberRoot=="function")try{ps.onPostCommitFiberRoot(Lg,t)}catch{}d=!0}return d}finally{Rn=l,fo.transition=i}}return!1}function jT(t,i,l){i=$u(l,i),i=eC(t,i,1),t=ja(t,i,1),i=gr(),t!==null&&(Rf(t,1,i),zr(t,i))}function pi(t,i,l){if(t.tag===3)jT(t,t,l);else for(;i!==null;){if(i.tag===3){jT(i,t,l);break}else if(i.tag===1){var d=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Ga===null||!Ga.has(d))){t=$u(l,t),t=tC(i,t,1),i=ja(i,t,1),t=gr(),i!==null&&(Rf(i,1,t),zr(i,t));break}}i=i.return}}function tz(t,i,l){var d=t.pingCache;d!==null&&d.delete(i),i=gr(),t.pingedLanes|=t.suspendedLanes&l,Ni===t&&(Wi&l)===l&&(Ri===4||Ri===3&&(Wi&130023424)===Wi&&500>_i()-Ax?ec(t,0):Cx|=l),zr(t,i)}function wC(t,i){i===0&&(t.mode&1?(i=xm,xm<<=1,!(xm&130023424)&&(xm=4194304)):i=1);var l=gr();t=Hs(t,i),t!==null&&(Rf(t,i,l),zr(t,l))}function nz(t){var i=t.memoizedState,l=0;i!==null&&(l=i.retryLane),wC(t,l)}function iz(t,i){var l=0;switch(t.tag){case 13:var d=t.stateNode,g=t.memoizedState;g!==null&&(l=g.retryLane);break;case 19:d=t.stateNode;break;default:throw Error(ct(314))}d!==null&&d.delete(i),wC(t,l)}var bC;bC=function(t,i,l){if(t!==null)if(t.memoizedProps!==i.pendingProps||kr.current)Ir=!0;else{if(!(t.lanes&l)&&!(i.flags&128))return Ir=!1,$D(t,i,l);Ir=!!(t.flags&131072)}else Ir=!1,Jn&&i.flags&1048576&&SS(i,ug,i.index);switch(i.lanes=0,i.tag){case 2:var d=i.type;Zm(t,i),t=i.pendingProps;var g=Vu(i,lr.current);Ru(i,l),g=xx(null,i,d,t,g,l);var w=wx();return i.flags|=1,typeof g=="object"&&g!==null&&typeof g.render=="function"&&g.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,Dr(d)?(w=!0,lg(i)):w=!1,i.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,mx(i),g.updater=Vg,i.stateNode=g,g._reactInternals=i,sv(i,d,t,l),i=cv(null,i,d,!0,w,l)):(i.tag=0,Jn&&w&&lx(i),mr(null,i,g,l),i=i.child),i;case 16:d=i.elementType;e:{switch(Zm(t,i),t=i.pendingProps,g=d._init,d=g(d._payload),i.type=d,g=i.tag=oz(d),t=Vo(d,t),g){case 0:i=lv(null,i,d,t,l);break e;case 1:i=DT(null,i,d,t,l);break e;case 11:i=IT(null,i,d,t,l);break e;case 14:i=kT(null,i,d,Vo(d.type,t),l);break e}throw Error(ct(306,d,""))}return i;case 0:return d=i.type,g=i.pendingProps,g=i.elementType===d?g:Vo(d,g),lv(t,i,d,g,l);case 1:return d=i.type,g=i.pendingProps,g=i.elementType===d?g:Vo(d,g),DT(t,i,d,g,l);case 3:e:{if(oC(i),t===null)throw Error(ct(387));d=i.pendingProps,w=i.memoizedState,g=w.element,PS(t,i),fg(i,d,null,l);var E=i.memoizedState;if(d=E.element,w.isDehydrated)if(w={element:d,isDehydrated:!1,cache:E.cache,pendingSuspenseBoundaries:E.pendingSuspenseBoundaries,transitions:E.transitions},i.updateQueue.baseState=w,i.memoizedState=w,i.flags&256){g=$u(Error(ct(423)),i),i=zT(t,i,d,l,g);break e}else if(d!==g){g=$u(Error(ct(424)),i),i=zT(t,i,d,l,g);break e}else for($r=Na(i.stateNode.containerInfo.firstChild),Zr=i,Jn=!0,Go=null,l=zS(i,null,d,l),i.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(Nu(),d===g){i=Ks(t,i,l);break e}mr(t,i,d,l)}i=i.child}return i;case 5:return LS(i),t===null&&iv(i),d=i.type,g=i.pendingProps,w=t!==null?t.memoizedProps:null,E=g.children,J0(d,g)?E=null:w!==null&&J0(d,w)&&(i.flags|=32),rC(t,i),mr(t,i,E,l),i.child;case 6:return t===null&&iv(i),null;case 13:return sC(t,i,l);case 4:return gx(i,i.stateNode.containerInfo),d=i.pendingProps,t===null?i.child=ju(i,null,d,l):mr(t,i,d,l),i.child;case 11:return d=i.type,g=i.pendingProps,g=i.elementType===d?g:Vo(d,g),IT(t,i,d,g,l);case 7:return mr(t,i,i.pendingProps,l),i.child;case 8:return mr(t,i,i.pendingProps.children,l),i.child;case 12:return mr(t,i,i.pendingProps.children,l),i.child;case 10:e:{if(d=i.type._context,g=i.pendingProps,w=i.memoizedProps,E=g.value,Gn(hg,d._currentValue),d._currentValue=E,w!==null)if(qo(w.value,E)){if(w.children===g.children&&!kr.current){i=Ks(t,i,l);break e}}else for(w=i.child,w!==null&&(w.return=i);w!==null;){var s=w.dependencies;if(s!==null){E=w.child;for(var A=s.firstContext;A!==null;){if(A.context===d){if(w.tag===1){A=Gs(-1,l&-l),A.tag=2;var z=w.updateQueue;if(z!==null){z=z.shared;var V=z.pending;V===null?A.next=A:(A.next=V.next,V.next=A),z.pending=A}}w.lanes|=l,A=w.alternate,A!==null&&(A.lanes|=l),rv(w.return,l,i),s.lanes|=l;break}A=A.next}}else if(w.tag===10)E=w.type===i.type?null:w.child;else if(w.tag===18){if(E=w.return,E===null)throw Error(ct(341));E.lanes|=l,s=E.alternate,s!==null&&(s.lanes|=l),rv(E,l,i),E=w.sibling}else E=w.child;if(E!==null)E.return=w;else for(E=w;E!==null;){if(E===i){E=null;break}if(w=E.sibling,w!==null){w.return=E.return,E=w;break}E=E.return}w=E}mr(t,i,g.children,l),i=i.child}return i;case 9:return g=i.type,d=i.pendingProps.children,Ru(i,l),g=po(g),d=d(g),i.flags|=1,mr(t,i,d,l),i.child;case 14:return d=i.type,g=Vo(d,i.pendingProps),g=Vo(d.type,g),kT(t,i,d,g,l);case 15:return nC(t,i,i.type,i.pendingProps,l);case 17:return d=i.type,g=i.pendingProps,g=i.elementType===d?g:Vo(d,g),Zm(t,i),i.tag=1,Dr(d)?(t=!0,lg(i)):t=!1,Ru(i,l),kS(i,d,g),sv(i,d,g,l),cv(null,i,d,!0,t,l);case 19:return aC(t,i,l);case 22:return iC(t,i,l)}throw Error(ct(156,i.tag))};function TC(t,i){return HE(t,i)}function rz(t,i,l,d){this.tag=t,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ho(t,i,l,d){return new rz(t,i,l,d)}function kx(t){return t=t.prototype,!(!t||!t.isReactComponent)}function oz(t){if(typeof t=="function")return kx(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Kv)return 11;if(t===Yv)return 14}return 2}function Za(t,i){var l=t.alternate;return l===null?(l=ho(t.tag,i,t.key,t.mode),l.elementType=t.elementType,l.type=t.type,l.stateNode=t.stateNode,l.alternate=t,t.alternate=l):(l.pendingProps=i,l.type=t.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=t.flags&14680064,l.childLanes=t.childLanes,l.lanes=t.lanes,l.child=t.child,l.memoizedProps=t.memoizedProps,l.memoizedState=t.memoizedState,l.updateQueue=t.updateQueue,i=t.dependencies,l.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},l.sibling=t.sibling,l.index=t.index,l.ref=t.ref,l}function Xm(t,i,l,d,g,w){var E=2;if(d=t,typeof t=="function")kx(t)&&(E=1);else if(typeof t=="string")E=5;else e:switch(t){case pu:return tc(l.children,g,w,i);case Hv:E=8,g|=8;break;case I0:return t=ho(12,l,i,g|2),t.elementType=I0,t.lanes=w,t;case k0:return t=ho(13,l,i,g),t.elementType=k0,t.lanes=w,t;case D0:return t=ho(19,l,i,g),t.elementType=D0,t.lanes=w,t;case DE:return $g(l,g,w,i);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case IE:E=10;break e;case kE:E=9;break e;case Kv:E=11;break e;case Yv:E=14;break e;case ka:E=16,d=null;break e}throw Error(ct(130,t==null?t:typeof t,""))}return i=ho(E,l,i,g),i.elementType=t,i.type=d,i.lanes=w,i}function tc(t,i,l,d){return t=ho(7,t,d,i),t.lanes=l,t}function $g(t,i,l,d){return t=ho(22,t,d,i),t.elementType=DE,t.lanes=l,t.stateNode={isHidden:!1},t}function h0(t,i,l){return t=ho(6,t,null,i),t.lanes=l,t}function d0(t,i,l){return i=ho(4,t.children!==null?t.children:[],t.key,i),i.lanes=l,i.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},i}function sz(t,i,l,d,g){this.tag=i,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=qy(0),this.expirationTimes=qy(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=qy(0),this.identifierPrefix=d,this.onRecoverableError=g,this.mutableSourceEagerHydrationData=null}function Dx(t,i,l,d,g,w,E,s,A){return t=new sz(t,i,l,s,A),i===1?(i=1,w===!0&&(i|=8)):i=0,w=ho(3,null,null,i),t.current=w,w.stateNode=t,w.memoizedState={element:d,isDehydrated:l,cache:null,transitions:null,pendingSuspenseBoundaries:null},mx(w),t}function az(t,i,l){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:fu,key:d==null?null:""+d,children:t,containerInfo:i,implementation:l}}function EC(t){if(!t)return Ha;t=t._reactInternals;e:{if(cc(t)!==t||t.tag!==1)throw Error(ct(170));var i=t;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(Dr(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(ct(171))}if(t.tag===1){var l=t.type;if(Dr(l))return TS(t,l,i)}return i}function SC(t,i,l,d,g,w,E,s,A){return t=Dx(l,d,!0,t,g,w,E,s,A),t.context=EC(null),l=t.current,d=gr(),g=$a(l),w=Gs(d,g),w.callback=i??null,ja(l,w,g),t.current.lanes=g,Rf(t,g,d),zr(t,d),t}function Zg(t,i,l,d){var g=i.current,w=gr(),E=$a(g);return l=EC(l),i.context===null?i.context=l:i.pendingContext=l,i=Gs(w,E),i.payload={element:t},d=d===void 0?null:d,d!==null&&(i.callback=d),t=ja(g,i,E),t!==null&&(Zo(t,g,E,w),jm(t,g,E)),E}function wg(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function GT(t,i){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var l=t.retryLane;t.retryLane=l!==0&&l<i?l:i}}function zx(t,i){GT(t,i),(t=t.alternate)&&GT(t,i)}function lz(){return null}var CC=typeof reportError=="function"?reportError:function(t){console.error(t)};function Lx(t){this._internalRoot=t}qg.prototype.render=Lx.prototype.render=function(t){var i=this._internalRoot;if(i===null)throw Error(ct(409));Zg(t,i,null,null)};qg.prototype.unmount=Lx.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var i=t.containerInfo;sc(function(){Zg(null,t,null,null)}),i[Xs]=null}};function qg(t){this._internalRoot=t}qg.prototype.unstable_scheduleHydration=function(t){if(t){var i=nS();t={blockedOn:null,target:t,priority:i};for(var l=0;l<La.length&&i!==0&&i<La[l].priority;l++);La.splice(l,0,t),l===0&&rS(t)}};function Rx(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Wg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function $T(){}function cz(t,i,l,d,g){if(g){if(typeof d=="function"){var w=d;d=function(){var z=wg(E);w.call(z)}}var E=SC(i,d,t,0,null,!1,!1,"",$T);return t._reactRootContainer=E,t[Xs]=E.current,vf(t.nodeType===8?t.parentNode:t),sc(),E}for(;g=t.lastChild;)t.removeChild(g);if(typeof d=="function"){var s=d;d=function(){var z=wg(A);s.call(z)}}var A=Dx(t,0,!1,null,null,!1,!1,"",$T);return t._reactRootContainer=A,t[Xs]=A.current,vf(t.nodeType===8?t.parentNode:t),sc(function(){Zg(i,A,l,d)}),A}function Xg(t,i,l,d,g){var w=l._reactRootContainer;if(w){var E=w;if(typeof g=="function"){var s=g;g=function(){var A=wg(E);s.call(A)}}Zg(i,E,t,g)}else E=cz(l,i,t,g,d);return wg(E)}eS=function(t){switch(t.tag){case 3:var i=t.stateNode;if(i.current.memoizedState.isDehydrated){var l=Wd(i.pendingLanes);l!==0&&(ex(i,l|1),zr(i,_i()),!(mn&6)&&(Zu=_i()+500,el()))}break;case 13:sc(function(){var d=Hs(t,1);if(d!==null){var g=gr();Zo(d,t,1,g)}}),zx(t,1)}};tx=function(t){if(t.tag===13){var i=Hs(t,134217728);if(i!==null){var l=gr();Zo(i,t,134217728,l)}zx(t,134217728)}};tS=function(t){if(t.tag===13){var i=$a(t),l=Hs(t,i);if(l!==null){var d=gr();Zo(l,t,i,d)}zx(t,i)}};nS=function(){return Rn};iS=function(t,i){var l=Rn;try{return Rn=t,i()}finally{Rn=l}};j0=function(t,i,l){switch(i){case"input":if(R0(t,l),i=l.name,l.type==="radio"&&i!=null){for(l=t;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<l.length;i++){var d=l[i];if(d!==t&&d.form===t.form){var g=Og(d);if(!g)throw Error(ct(90));LE(d),R0(d,g)}}}break;case"textarea":BE(t,l);break;case"select":i=l.value,i!=null&&ku(t,!!l.multiple,i,!1)}};GE=Mx;$E=sc;var uz={usingClientEntryPoint:!1,Events:[Ff,yu,Og,NE,jE,Mx]},Od={findFiberByHostInstance:Xl,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},hz={bundleType:Od.bundleType,version:Od.version,rendererPackageName:Od.rendererPackageName,rendererConfig:Od.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Js.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=WE(t),t===null?null:t.stateNode},findFiberByHostInstance:Od.findFiberByHostInstance||lz,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var km=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!km.isDisabled&&km.supportsFiber)try{Lg=km.inject(hz),ps=km}catch{}}Xr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=uz;Xr.createPortal=function(t,i){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Rx(i))throw Error(ct(200));return az(t,i,null,l)};Xr.createRoot=function(t,i){if(!Rx(t))throw Error(ct(299));var l=!1,d="",g=CC;return i!=null&&(i.unstable_strictMode===!0&&(l=!0),i.identifierPrefix!==void 0&&(d=i.identifierPrefix),i.onRecoverableError!==void 0&&(g=i.onRecoverableError)),i=Dx(t,1,!1,null,null,l,!1,d,g),t[Xs]=i.current,vf(t.nodeType===8?t.parentNode:t),new Lx(i)};Xr.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var i=t._reactInternals;if(i===void 0)throw typeof t.render=="function"?Error(ct(188)):(t=Object.keys(t).join(","),Error(ct(268,t)));return t=WE(i),t=t===null?null:t.stateNode,t};Xr.flushSync=function(t){return sc(t)};Xr.hydrate=function(t,i,l){if(!Wg(i))throw Error(ct(200));return Xg(null,t,i,!0,l)};Xr.hydrateRoot=function(t,i,l){if(!Rx(t))throw Error(ct(405));var d=l!=null&&l.hydratedSources||null,g=!1,w="",E=CC;if(l!=null&&(l.unstable_strictMode===!0&&(g=!0),l.identifierPrefix!==void 0&&(w=l.identifierPrefix),l.onRecoverableError!==void 0&&(E=l.onRecoverableError)),i=SC(i,null,t,1,l??null,g,!1,w,E),t[Xs]=i.current,vf(t),d)for(t=0;t<d.length;t++)l=d[t],g=l._getVersion,g=g(l._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[l,g]:i.mutableSourceEagerHydrationData.push(l,g);return new qg(i)};Xr.render=function(t,i,l){if(!Wg(i))throw Error(ct(200));return Xg(null,t,i,!1,l)};Xr.unmountComponentAtNode=function(t){if(!Wg(t))throw Error(ct(40));return t._reactRootContainer?(sc(function(){Xg(null,null,t,!1,function(){t._reactRootContainer=null,t[Xs]=null})}),!0):!1};Xr.unstable_batchedUpdates=Mx;Xr.unstable_renderSubtreeIntoContainer=function(t,i,l,d){if(!Wg(l))throw Error(ct(200));if(t==null||t._reactInternals===void 0)throw Error(ct(38));return Xg(t,i,l,!1,d)};Xr.version="18.2.0-next-9e3b772b8-20220608";function AC(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(AC)}catch(t){console.error(t)}}AC(),SE.exports=Xr;var dz=SE.exports,ZT=dz;M0.createRoot=ZT.createRoot,M0.hydrateRoot=ZT.hydrateRoot;/**
 * @remix-run/router v1.7.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Yn(){return Yn=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var l=arguments[i];for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(t[d]=l[d])}return t},Yn.apply(this,arguments)}var Ci;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Ci||(Ci={}));const qT="popstate";function fz(t){t===void 0&&(t={});function i(d,g){let{pathname:w,search:E,hash:s}=d.location;return Mf("",{pathname:w,search:E,hash:s},g.state&&g.state.usr||null,g.state&&g.state.key||"default")}function l(d,g){return typeof g=="string"?g:ac(g)}return mz(i,l,null,t)}function sn(t,i){if(t===!1||t===null||typeof t>"u")throw new Error(i)}function qu(t,i){if(!t){typeof console<"u"&&console.warn(i);try{throw new Error(i)}catch{}}}function pz(){return Math.random().toString(36).substr(2,8)}function WT(t,i){return{usr:t.state,key:t.key,idx:i}}function Mf(t,i,l,d){return l===void 0&&(l=null),Yn({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof i=="string"?Qs(i):i,{state:l,key:i&&i.key||d||pz()})}function ac(t){let{pathname:i="/",search:l="",hash:d=""}=t;return l&&l!=="?"&&(i+=l.charAt(0)==="?"?l:"?"+l),d&&d!=="#"&&(i+=d.charAt(0)==="#"?d:"#"+d),i}function Qs(t){let i={};if(t){let l=t.indexOf("#");l>=0&&(i.hash=t.substr(l),t=t.substr(0,l));let d=t.indexOf("?");d>=0&&(i.search=t.substr(d),t=t.substr(0,d)),t&&(i.pathname=t)}return i}function mz(t,i,l,d){d===void 0&&(d={});let{window:g=document.defaultView,v5Compat:w=!1}=d,E=g.history,s=Ci.Pop,A=null,z=V();z==null&&(z=0,E.replaceState(Yn({},E.state,{idx:z}),""));function V(){return(E.state||{idx:null}).idx}function j(){s=Ci.Pop;let Ue=V(),ae=Ue==null?null:Ue-z;z=Ue,A&&A({action:s,location:ve.location,delta:ae})}function G(Ue,ae){s=Ci.Push;let J=Mf(ve.location,Ue,ae);l&&l(J,Ue),z=V()+1;let se=WT(J,z),oe=ve.createHref(J);try{E.pushState(se,"",oe)}catch(Be){if(Be instanceof DOMException&&Be.name==="DataCloneError")throw Be;g.location.assign(oe)}w&&A&&A({action:s,location:ve.location,delta:1})}function re(Ue,ae){s=Ci.Replace;let J=Mf(ve.location,Ue,ae);l&&l(J,Ue),z=V();let se=WT(J,z),oe=ve.createHref(J);E.replaceState(se,"",oe),w&&A&&A({action:s,location:ve.location,delta:0})}function he(Ue){let ae=g.location.origin!=="null"?g.location.origin:g.location.href,J=typeof Ue=="string"?Ue:ac(Ue);return sn(ae,"No window.location.(origin|href) available to create URL for href: "+J),new URL(J,ae)}let ve={get action(){return s},get location(){return t(g,E)},listen(Ue){if(A)throw new Error("A history only accepts one active listener");return g.addEventListener(qT,j),A=Ue,()=>{g.removeEventListener(qT,j),A=null}},createHref(Ue){return i(g,Ue)},createURL:he,encodeLocation(Ue){let ae=he(Ue);return{pathname:ae.pathname,search:ae.search,hash:ae.hash}},push:G,replace:re,go(Ue){return E.go(Ue)}};return ve}var Di;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Di||(Di={}));const gz=new Set(["lazy","caseSensitive","path","id","index","children"]);function _z(t){return t.index===!0}function wv(t,i,l,d){return l===void 0&&(l=[]),d===void 0&&(d={}),t.map((g,w)=>{let E=[...l,w],s=typeof g.id=="string"?g.id:E.join("-");if(sn(g.index!==!0||!g.children,"Cannot specify children on an index route"),sn(!d[s],'Found a route id collision on id "'+s+`".  Route id's must be globally unique within Data Router usages`),_z(g)){let A=Yn({},g,i(g),{id:s});return d[s]=A,A}else{let A=Yn({},g,i(g),{id:s,children:void 0});return d[s]=A,g.children&&(A.children=wv(g.children,i,E,d)),A}})}function Su(t,i,l){l===void 0&&(l="/");let d=typeof i=="string"?Qs(i):i,g=Ju(d.pathname||"/",l);if(g==null)return null;let w=MC(t);yz(w);let E=null;for(let s=0;E==null&&s<w.length;++s)E=Az(w[s],Iz(g));return E}function MC(t,i,l,d){i===void 0&&(i=[]),l===void 0&&(l=[]),d===void 0&&(d="");let g=(w,E,s)=>{let A={relativePath:s===void 0?w.path||"":s,caseSensitive:w.caseSensitive===!0,childrenIndex:E,route:w};A.relativePath.startsWith("/")&&(sn(A.relativePath.startsWith(d),'Absolute route path "'+A.relativePath+'" nested under path '+('"'+d+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),A.relativePath=A.relativePath.slice(d.length));let z=$s([d,A.relativePath]),V=l.concat(A);w.children&&w.children.length>0&&(sn(w.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+z+'".')),MC(w.children,i,V,z)),!(w.path==null&&!w.index)&&i.push({path:z,score:Sz(z,w.index),routesMeta:V})};return t.forEach((w,E)=>{var s;if(w.path===""||!((s=w.path)!=null&&s.includes("?")))g(w,E);else for(let A of PC(w.path))g(w,E,A)}),i}function PC(t){let i=t.split("/");if(i.length===0)return[];let[l,...d]=i,g=l.endsWith("?"),w=l.replace(/\?$/,"");if(d.length===0)return g?[w,""]:[w];let E=PC(d.join("/")),s=[];return s.push(...E.map(A=>A===""?w:[w,A].join("/"))),g&&s.push(...E),s.map(A=>t.startsWith("/")&&A===""?"/":A)}function yz(t){t.sort((i,l)=>i.score!==l.score?l.score-i.score:Cz(i.routesMeta.map(d=>d.childrenIndex),l.routesMeta.map(d=>d.childrenIndex)))}const vz=/^:\w+$/,xz=3,wz=2,bz=1,Tz=10,Ez=-2,XT=t=>t==="*";function Sz(t,i){let l=t.split("/"),d=l.length;return l.some(XT)&&(d+=Ez),i&&(d+=wz),l.filter(g=>!XT(g)).reduce((g,w)=>g+(vz.test(w)?xz:w===""?bz:Tz),d)}function Cz(t,i){return t.length===i.length&&t.slice(0,-1).every((d,g)=>d===i[g])?t[t.length-1]-i[i.length-1]:0}function Az(t,i){let{routesMeta:l}=t,d={},g="/",w=[];for(let E=0;E<l.length;++E){let s=l[E],A=E===l.length-1,z=g==="/"?i:i.slice(g.length)||"/",V=Mz({path:s.relativePath,caseSensitive:s.caseSensitive,end:A},z);if(!V)return null;Object.assign(d,V.params);let j=s.route;w.push({params:d,pathname:$s([g,V.pathname]),pathnameBase:Lz($s([g,V.pathnameBase])),route:j}),V.pathnameBase!=="/"&&(g=$s([g,V.pathnameBase]))}return w}function Mz(t,i){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[l,d]=Pz(t.path,t.caseSensitive,t.end),g=i.match(l);if(!g)return null;let w=g[0],E=w.replace(/(.)\/+$/,"$1"),s=g.slice(1);return{params:d.reduce((z,V,j)=>{if(V==="*"){let G=s[j]||"";E=w.slice(0,w.length-G.length).replace(/(.)\/+$/,"$1")}return z[V]=kz(s[j]||"",V),z},{}),pathname:w,pathnameBase:E,pattern:t}}function Pz(t,i,l){i===void 0&&(i=!1),l===void 0&&(l=!0),qu(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let d=[],g="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(E,s)=>(d.push(s),"/([^\\/]+)"));return t.endsWith("*")?(d.push("*"),g+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):l?g+="\\/*$":t!==""&&t!=="/"&&(g+="(?:(?=\\/|$))"),[new RegExp(g,i?void 0:"i"),d]}function Iz(t){try{return decodeURI(t)}catch(i){return qu(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+i+").")),t}}function kz(t,i){try{return decodeURIComponent(t)}catch(l){return qu(!1,'The value for the URL param "'+i+'" will not be decoded because'+(' the string "'+t+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+l+").")),t}}function Ju(t,i){if(i==="/")return t;if(!t.toLowerCase().startsWith(i.toLowerCase()))return null;let l=i.endsWith("/")?i.length-1:i.length,d=t.charAt(l);return d&&d!=="/"?null:t.slice(l)||"/"}function Dz(t,i){i===void 0&&(i="/");let{pathname:l,search:d="",hash:g=""}=typeof t=="string"?Qs(t):t;return{pathname:l?l.startsWith("/")?l:zz(l,i):i,search:Rz(d),hash:Bz(g)}}function zz(t,i){let l=i.replace(/\/+$/,"").split("/");return t.split("/").forEach(g=>{g===".."?l.length>1&&l.pop():g!=="."&&l.push(g)}),l.length>1?l.join("/"):"/"}function f0(t,i,l,d){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+i+"` field ["+JSON.stringify(d)+"].  Please separate it out to the ")+("`to."+l+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Hg(t){return t.filter((i,l)=>l===0||i.route.path&&i.route.path.length>0)}function Bx(t,i,l,d){d===void 0&&(d=!1);let g;typeof t=="string"?g=Qs(t):(g=Yn({},t),sn(!g.pathname||!g.pathname.includes("?"),f0("?","pathname","search",g)),sn(!g.pathname||!g.pathname.includes("#"),f0("#","pathname","hash",g)),sn(!g.search||!g.search.includes("#"),f0("#","search","hash",g)));let w=t===""||g.pathname==="",E=w?"/":g.pathname,s;if(d||E==null)s=l;else{let j=i.length-1;if(E.startsWith("..")){let G=E.split("/");for(;G[0]==="..";)G.shift(),j-=1;g.pathname=G.join("/")}s=j>=0?i[j]:"/"}let A=Dz(g,s),z=E&&E!=="/"&&E.endsWith("/"),V=(w||E===".")&&l.endsWith("/");return!A.pathname.endsWith("/")&&(z||V)&&(A.pathname+="/"),A}const $s=t=>t.join("/").replace(/\/\/+/g,"/"),Lz=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Rz=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,Bz=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;class Fx{constructor(i,l,d,g){g===void 0&&(g=!1),this.status=i,this.statusText=l||"",this.internal=g,d instanceof Error?(this.data=d.toString(),this.error=d):this.data=d}}function IC(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const kC=["post","put","patch","delete"],Fz=new Set(kC),Oz=["get",...kC],Uz=new Set(Oz),Vz=new Set([301,302,303,307,308]),Nz=new Set([307,308]),p0={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},jz={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},Ud={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},DC=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Gz=t=>({hasErrorBoundary:!!t.hasErrorBoundary});function $z(t){const i=t.window?t.window:typeof window<"u"?window:void 0,l=typeof i<"u"&&typeof i.document<"u"&&typeof i.document.createElement<"u",d=!l;sn(t.routes.length>0,"You must provide a non-empty routes array to createRouter");let g;if(t.mapRouteProperties)g=t.mapRouteProperties;else if(t.detectErrorBoundary){let Le=t.detectErrorBoundary;g=Ve=>({hasErrorBoundary:Le(Ve)})}else g=Gz;let w={},E=wv(t.routes,g,void 0,w),s,A=t.basename||"/",z=Yn({v7_normalizeFormMethod:!1,v7_prependBasename:!1},t.future),V=null,j=new Set,G=null,re=null,he=null,ve=t.hydrationData!=null,Ue=Su(E,t.history.location,A),ae=null;if(Ue==null){let Le=lo(404,{pathname:t.history.location.pathname}),{matches:Ve,route:ot}=n2(E);Ue=Ve,ae={[ot.id]:Le}}let J=!Ue.some(Le=>Le.route.lazy)&&(!Ue.some(Le=>Le.route.loader)||t.hydrationData!=null),se,oe={historyAction:t.history.action,location:t.history.location,matches:Ue,initialized:J,navigation:p0,restoreScrollPosition:t.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:t.hydrationData&&t.hydrationData.loaderData||{},actionData:t.hydrationData&&t.hydrationData.actionData||null,errors:t.hydrationData&&t.hydrationData.errors||ae,fetchers:new Map,blockers:new Map},Be=Ci.Pop,at=!1,Ye,He=!1,ze=!1,kt=[],dn=[],gt=new Map,Jt=0,Sn=-1,un=new Map,Bn=new Set,Xn=new Map,Xe=new Map,Mt=new Map,Tt=!1;function wt(){return V=t.history.listen(Le=>{let{action:Ve,location:ot,delta:vt}=Le;if(Tt){Tt=!1;return}qu(Mt.size===0||vt!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let Ut=$i({currentLocation:oe.location,nextLocation:ot,historyAction:Ve});if(Ut&&vt!=null){Tt=!0,t.history.go(vt*-1),_o(Ut,{state:"blocked",location:ot,proceed(){_o(Ut,{state:"proceeding",proceed:void 0,reset:void 0,location:ot}),t.history.go(vt)},reset(){let ee=new Map(oe.blockers);ee.set(Ut,Ud),Qt({blockers:ee})}});return}return ji(Ve,ot)}),oe.initialized||ji(Ci.Pop,oe.location),se}function nn(){V&&V(),j.clear(),Ye&&Ye.abort(),oe.fetchers.forEach((Le,Ve)=>Mi(Ve)),oe.blockers.forEach((Le,Ve)=>ys(Ve))}function fn(Le){return j.add(Le),()=>j.delete(Le)}function Qt(Le){oe=Yn({},oe,Le),j.forEach(Ve=>Ve(oe))}function mi(Le,Ve){var ot,vt;let Ut=oe.actionData!=null&&oe.navigation.formMethod!=null&&jo(oe.navigation.formMethod)&&oe.navigation.state==="loading"&&((ot=Le.state)==null?void 0:ot._isRedirect)!==!0,ee;Ve.actionData?Object.keys(Ve.actionData).length>0?ee=Ve.actionData:ee=null:Ut?ee=oe.actionData:ee=null;let U=Ve.loaderData?t2(oe.loaderData,Ve.loaderData,Ve.matches||[],Ve.errors):oe.loaderData,N=oe.blockers;N.size>0&&(N=new Map(N),N.forEach((ce,de)=>N.set(de,Ud)));let X=at===!0||oe.navigation.formMethod!=null&&jo(oe.navigation.formMethod)&&((vt=Le.state)==null?void 0:vt._isRedirect)!==!0;s&&(E=s,s=void 0),He||Be===Ci.Pop||(Be===Ci.Push?t.history.push(Le,Le.state):Be===Ci.Replace&&t.history.replace(Le,Le.state)),Qt(Yn({},Ve,{actionData:ee,loaderData:U,historyAction:Be,location:Le,initialized:!0,navigation:p0,revalidation:"idle",restoreScrollPosition:Yo(Le,Ve.matches||oe.matches),preventScrollReset:X,blockers:N})),Be=Ci.Pop,at=!1,He=!1,ze=!1,kt=[],dn=[]}async function Un(Le,Ve){if(typeof Le=="number"){t.history.go(Le);return}let ot=bv(oe.location,oe.matches,A,z.v7_prependBasename,Le,Ve==null?void 0:Ve.fromRouteId,Ve==null?void 0:Ve.relative),{path:vt,submission:Ut,error:ee}=HT(z.v7_normalizeFormMethod,!1,ot,Ve),U=oe.location,N=Mf(oe.location,vt,Ve&&Ve.state);N=Yn({},N,t.history.encodeLocation(N));let X=Ve&&Ve.replace!=null?Ve.replace:void 0,ce=Ci.Push;X===!0?ce=Ci.Replace:X===!1||Ut!=null&&jo(Ut.formMethod)&&Ut.formAction===oe.location.pathname+oe.location.search&&(ce=Ci.Replace);let de=Ve&&"preventScrollReset"in Ve?Ve.preventScrollReset===!0:void 0,Te=$i({currentLocation:U,nextLocation:N,historyAction:ce});if(Te){_o(Te,{state:"blocked",location:N,proceed(){_o(Te,{state:"proceeding",proceed:void 0,reset:void 0,location:N}),Un(Le,Ve)},reset(){let we=new Map(oe.blockers);we.set(Te,Ud),Qt({blockers:we})}});return}return await ji(ce,N,{submission:Ut,pendingError:ee,preventScrollReset:de,replace:Ve&&Ve.replace})}function gi(){if(Wo(),Qt({revalidation:"loading"}),oe.navigation.state!=="submitting"){if(oe.navigation.state==="idle"){ji(oe.historyAction,oe.location,{startUninterruptedRevalidation:!0});return}ji(Be||oe.historyAction,oe.navigation.location,{overrideNavigation:oe.navigation})}}async function ji(Le,Ve,ot){Ye&&Ye.abort(),Ye=null,Be=Le,He=(ot&&ot.startUninterruptedRevalidation)===!0,Ko(oe.location,oe.matches),at=(ot&&ot.preventScrollReset)===!0;let vt=s||E,Ut=ot&&ot.overrideNavigation,ee=Su(vt,Ve,A);if(!ee){let we=lo(404,{pathname:Ve.pathname}),{matches:_e,route:Ce}=n2(vt);vr(),mi(Ve,{matches:_e,loaderData:{},errors:{[Ce.id]:we}});return}if(oe.initialized&&!ze&&Hz(oe.location,Ve)&&!(ot&&ot.submission&&jo(ot.submission.formMethod))){mi(Ve,{matches:ee});return}Ye=new AbortController;let U=Nd(t.history,Ve,Ye.signal,ot&&ot.submission),N,X;if(ot&&ot.pendingError)X={[Cu(ee).route.id]:ot.pendingError};else if(ot&&ot.submission&&jo(ot.submission.formMethod)){let we=await cr(U,Ve,ot.submission,ee,{replace:ot.replace});if(we.shortCircuited)return;N=we.pendingActionData,X=we.pendingActionError,Ut=Dm(Ve,ot.submission),U=new Request(U.url,{signal:U.signal})}let{shortCircuited:ce,loaderData:de,errors:Te}=await ur(U,Ve,ee,Ut,ot&&ot.submission,ot&&ot.fetcherSubmission,ot&&ot.replace,N,X);ce||(Ye=null,mi(Ve,Yn({matches:ee},N?{actionData:N}:{},{loaderData:de,errors:Te})))}async function cr(Le,Ve,ot,vt,Ut){Ut===void 0&&(Ut={}),Wo();let ee=eL(Ve,ot);Qt({navigation:ee});let U,N=Ev(vt,Ve);if(!N.route.action&&!N.route.lazy)U={type:Di.error,error:lo(405,{method:Le.method,pathname:Ve.pathname,routeId:N.route.id})};else if(U=await Vd("action",Le,N,vt,w,g,A),Le.signal.aborted)return{shortCircuited:!0};if(Fu(U)){let X;return Ut&&Ut.replace!=null?X=Ut.replace:X=U.location===oe.location.pathname+oe.location.search,await pn(oe,U,{submission:ot,replace:X}),{shortCircuited:!0}}if(sf(U)){let X=Cu(vt,N.route.id);return(Ut&&Ut.replace)!==!0&&(Be=Ci.Push),{pendingActionData:{},pendingActionError:{[X.route.id]:U.error}}}if(Yl(U))throw lo(400,{type:"defer-action"});return{pendingActionData:{[N.route.id]:U.data}}}async function ur(Le,Ve,ot,vt,Ut,ee,U,N,X){let ce=vt||Dm(Ve,Ut),de=Ut||ee||o2(ce),Te=s||E,[we,_e]=KT(t.history,oe,ot,de,Ve,ze,kt,dn,Xn,Bn,Te,A,N,X);if(vr($t=>!(ot&&ot.some(Cn=>Cn.route.id===$t))||we&&we.some(Cn=>Cn.route.id===$t)),we.length===0&&_e.length===0){let $t=Xo();return mi(Ve,Yn({matches:ot,loaderData:{},errors:X||null},N?{actionData:N}:{},$t?{fetchers:new Map(oe.fetchers)}:{})),{shortCircuited:!0}}if(!He){_e.forEach(Cn=>{let zn=oe.fetchers.get(Cn.key),kn=jd(void 0,zn?zn.data:void 0);oe.fetchers.set(Cn.key,kn)});let $t=N||oe.actionData;Qt(Yn({navigation:ce},$t?Object.keys($t).length===0?{actionData:null}:{actionData:$t}:{},_e.length>0?{fetchers:new Map(oe.fetchers)}:{}))}Sn=++Jt,_e.forEach($t=>{gt.has($t.key)&&Ki($t.key),$t.controller&&gt.set($t.key,$t.controller)});let Ce=()=>_e.forEach($t=>Ki($t.key));Ye&&Ye.signal.addEventListener("abort",Ce);let{results:nt,loaderResults:lt,fetcherResults:Je}=await Gi(oe.matches,ot,we,_e,Le);if(Le.signal.aborted)return{shortCircuited:!0};Ye&&Ye.signal.removeEventListener("abort",Ce),_e.forEach($t=>gt.delete($t.key));let It=i2(nt);if(It)return await pn(oe,It,{replace:U}),{shortCircuited:!0};let{loaderData:Rt,errors:Dt}=e2(oe,ot,we,lt,X,_e,Je,Xe);Xe.forEach(($t,Cn)=>{$t.subscribe(zn=>{(zn||$t.done)&&Xe.delete(Cn)})});let Vt=Xo(),Zt=Br(Sn),gn=Vt||Zt||_e.length>0;return Yn({loaderData:Rt,errors:Dt},gn?{fetchers:new Map(oe.fetchers)}:{})}function Lt(Le){return oe.fetchers.get(Le)||jz}function Rr(Le,Ve,ot,vt){if(d)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");gt.has(Le)&&Ki(Le);let Ut=s||E,ee=bv(oe.location,oe.matches,A,z.v7_prependBasename,ot,Ve,vt==null?void 0:vt.relative),U=Su(Ut,ee,A);if(!U){Hi(Le,Ve,lo(404,{pathname:ee}));return}let{path:N,submission:X,error:ce}=HT(z.v7_normalizeFormMethod,!0,ee,vt);if(ce){Hi(Le,Ve,ce);return}let de=Ev(U,N);if(at=(vt&&vt.preventScrollReset)===!0,X&&jo(X.formMethod)){yi(Le,Ve,N,de,U,X);return}Xn.set(Le,{routeId:Ve,path:N}),_s(Le,Ve,N,de,U,X)}async function yi(Le,Ve,ot,vt,Ut,ee){if(Wo(),Xn.delete(Le),!vt.route.action&&!vt.route.lazy){let kn=lo(405,{method:ee.formMethod,pathname:ot,routeId:Ve});Hi(Le,Ve,kn);return}let U=oe.fetchers.get(Le),N=tL(ee,U);oe.fetchers.set(Le,N),Qt({fetchers:new Map(oe.fetchers)});let X=new AbortController,ce=Nd(t.history,ot,X.signal,ee);gt.set(Le,X);let de=await Vd("action",ce,vt,Ut,w,g,A);if(ce.signal.aborted){gt.get(Le)===X&&gt.delete(Le);return}if(Fu(de)){gt.delete(Le),Bn.add(Le);let kn=jd(ee);return oe.fetchers.set(Le,kn),Qt({fetchers:new Map(oe.fetchers)}),pn(oe,de,{submission:ee,isFetchActionRedirect:!0})}if(sf(de)){Hi(Le,Ve,de.error);return}if(Yl(de))throw lo(400,{type:"defer-action"});let Te=oe.navigation.location||oe.location,we=Nd(t.history,Te,X.signal),_e=s||E,Ce=oe.navigation.state!=="idle"?Su(_e,oe.navigation.location,A):oe.matches;sn(Ce,"Didn't find any matches after fetcher action");let nt=++Jt;un.set(Le,nt);let lt=jd(ee,de.data);oe.fetchers.set(Le,lt);let[Je,It]=KT(t.history,oe,Ce,ee,Te,ze,kt,dn,Xn,Bn,_e,A,{[vt.route.id]:de.data},void 0);It.filter(kn=>kn.key!==Le).forEach(kn=>{let Nn=kn.key,vi=oe.fetchers.get(Nn),Jo=jd(void 0,vi?vi.data:void 0);oe.fetchers.set(Nn,Jo),gt.has(Nn)&&Ki(Nn),kn.controller&&gt.set(Nn,kn.controller)}),Qt({fetchers:new Map(oe.fetchers)});let Rt=()=>It.forEach(kn=>Ki(kn.key));X.signal.addEventListener("abort",Rt);let{results:Dt,loaderResults:Vt,fetcherResults:Zt}=await Gi(oe.matches,Ce,Je,It,we);if(X.signal.aborted)return;X.signal.removeEventListener("abort",Rt),un.delete(Le),gt.delete(Le),It.forEach(kn=>gt.delete(kn.key));let gn=i2(Dt);if(gn)return pn(oe,gn);let{loaderData:$t,errors:Cn}=e2(oe,oe.matches,Je,Vt,void 0,It,Zt,Xe);if(oe.fetchers.has(Le)){let kn=Hm(de.data);oe.fetchers.set(Le,kn)}let zn=Br(nt);oe.navigation.state==="loading"&&nt>Sn?(sn(Be,"Expected pending action"),Ye&&Ye.abort(),mi(oe.navigation.location,{matches:Ce,loaderData:$t,errors:Cn,fetchers:new Map(oe.fetchers)})):(Qt(Yn({errors:Cn,loaderData:t2(oe.loaderData,$t,Ce,Cn)},zn||It.length>0?{fetchers:new Map(oe.fetchers)}:{})),ze=!1)}async function _s(Le,Ve,ot,vt,Ut,ee){let U=oe.fetchers.get(Le),N=jd(ee,U?U.data:void 0);oe.fetchers.set(Le,N),Qt({fetchers:new Map(oe.fetchers)});let X=new AbortController,ce=Nd(t.history,ot,X.signal);gt.set(Le,X);let de=await Vd("loader",ce,vt,Ut,w,g,A);if(Yl(de)&&(de=await RC(de,ce.signal,!0)||de),gt.get(Le)===X&&gt.delete(Le),ce.signal.aborted)return;if(Fu(de)){Bn.add(Le),await pn(oe,de);return}if(sf(de)){let we=Cu(oe.matches,Ve);oe.fetchers.delete(Le),Qt({fetchers:new Map(oe.fetchers),errors:{[we.route.id]:de.error}});return}sn(!Yl(de),"Unhandled fetcher deferred data");let Te=Hm(de.data);oe.fetchers.set(Le,Te),Qt({fetchers:new Map(oe.fetchers)})}async function pn(Le,Ve,ot){let{submission:vt,replace:Ut,isFetchActionRedirect:ee}=ot===void 0?{}:ot;Ve.revalidate&&(ze=!0);let U=Mf(Le.location,Ve.location,Yn({_isRedirect:!0},ee?{_isFetchActionRedirect:!0}:{}));if(sn(U,"Expected a location on the redirect navigation"),DC.test(Ve.location)&&l){let ce=t.history.createURL(Ve.location),de=Ju(ce.pathname,A)==null;if(i.location.origin!==ce.origin||de){Ut?i.location.replace(Ve.location):i.location.assign(Ve.location);return}}Ye=null;let N=Ut===!0?Ci.Replace:Ci.Push,X=vt||o2(Le.navigation);if(Nz.has(Ve.status)&&X&&jo(X.formMethod))await ji(N,U,{submission:Yn({},X,{formAction:Ve.location}),preventScrollReset:at});else if(ee)await ji(N,U,{overrideNavigation:Dm(U),fetcherSubmission:X,preventScrollReset:at});else{let ce=Dm(U,X);await ji(N,U,{overrideNavigation:ce,preventScrollReset:at})}}async function Gi(Le,Ve,ot,vt,Ut){let ee=await Promise.all([...ot.map(X=>Vd("loader",Ut,X,Ve,w,g,A)),...vt.map(X=>X.matches&&X.match&&X.controller?Vd("loader",Nd(t.history,X.path,X.controller.signal),X.match,X.matches,w,g,A):{type:Di.error,error:lo(404,{pathname:X.path})})]),U=ee.slice(0,ot.length),N=ee.slice(ot.length);return await Promise.all([r2(Le,ot,U,U.map(()=>Ut.signal),!1,oe.loaderData),r2(Le,vt.map(X=>X.match),N,vt.map(X=>X.controller?X.controller.signal:null),!0)]),{results:ee,loaderResults:U,fetcherResults:N}}function Wo(){ze=!0,kt.push(...vr()),Xn.forEach((Le,Ve)=>{gt.has(Ve)&&(dn.push(Ve),Ki(Ve))})}function Hi(Le,Ve,ot){let vt=Cu(oe.matches,Ve);Mi(Le),Qt({errors:{[vt.route.id]:ot},fetchers:new Map(oe.fetchers)})}function Mi(Le){let Ve=oe.fetchers.get(Le);gt.has(Le)&&!(Ve&&Ve.state==="loading"&&un.has(Le))&&Ki(Le),Xn.delete(Le),un.delete(Le),Bn.delete(Le),oe.fetchers.delete(Le)}function Ki(Le){let Ve=gt.get(Le);sn(Ve,"Expected fetch controller: "+Le),Ve.abort(),gt.delete(Le)}function go(Le){for(let Ve of Le){let ot=Lt(Ve),vt=Hm(ot.data);oe.fetchers.set(Ve,vt)}}function Xo(){let Le=[],Ve=!1;for(let ot of Bn){let vt=oe.fetchers.get(ot);sn(vt,"Expected fetcher: "+ot),vt.state==="loading"&&(Bn.delete(ot),Le.push(ot),Ve=!0)}return go(Le),Ve}function Br(Le){let Ve=[];for(let[ot,vt]of un)if(vt<Le){let Ut=oe.fetchers.get(ot);sn(Ut,"Expected fetcher: "+ot),Ut.state==="loading"&&(Ki(ot),un.delete(ot),Ve.push(ot))}return go(Ve),Ve.length>0}function Ho(Le,Ve){let ot=oe.blockers.get(Le)||Ud;return Mt.get(Le)!==Ve&&Mt.set(Le,Ve),ot}function ys(Le){oe.blockers.delete(Le),Mt.delete(Le)}function _o(Le,Ve){let ot=oe.blockers.get(Le)||Ud;sn(ot.state==="unblocked"&&Ve.state==="blocked"||ot.state==="blocked"&&Ve.state==="blocked"||ot.state==="blocked"&&Ve.state==="proceeding"||ot.state==="blocked"&&Ve.state==="unblocked"||ot.state==="proceeding"&&Ve.state==="unblocked","Invalid blocker state transition: "+ot.state+" -> "+Ve.state);let vt=new Map(oe.blockers);vt.set(Le,Ve),Qt({blockers:vt})}function $i(Le){let{currentLocation:Ve,nextLocation:ot,historyAction:vt}=Le;if(Mt.size===0)return;Mt.size>1&&qu(!1,"A router only supports one blocker at a time");let Ut=Array.from(Mt.entries()),[ee,U]=Ut[Ut.length-1],N=oe.blockers.get(ee);if(!(N&&N.state==="proceeding")&&U({currentLocation:Ve,nextLocation:ot,historyAction:vt}))return ee}function vr(Le){let Ve=[];return Xe.forEach((ot,vt)=>{(!Le||Le(vt))&&(ot.cancel(),Ve.push(vt),Xe.delete(vt))}),Ve}function vs(Le,Ve,ot){if(G=Le,he=Ve,re=ot||null,!ve&&oe.navigation===p0){ve=!0;let vt=Yo(oe.location,oe.matches);vt!=null&&Qt({restoreScrollPosition:vt})}return()=>{G=null,he=null,re=null}}function Kr(Le,Ve){return re&&re(Le,Ve.map(vt=>Qz(vt,oe.loaderData)))||Le.key}function Ko(Le,Ve){if(G&&he){let ot=Kr(Le,Ve);G[ot]=he()}}function Yo(Le,Ve){if(G){let ot=Kr(Le,Ve),vt=G[ot];if(typeof vt=="number")return vt}return null}function yo(Le){w={},s=wv(Le,g,void 0,w)}return se={get basename(){return A},get state(){return oe},get routes(){return E},initialize:wt,subscribe:fn,enableScrollRestoration:vs,navigate:Un,fetch:Rr,revalidate:gi,createHref:Le=>t.history.createHref(Le),encodeLocation:Le=>t.history.encodeLocation(Le),getFetcher:Lt,deleteFetcher:Mi,dispose:nn,getBlocker:Ho,deleteBlocker:ys,_internalFetchControllers:gt,_internalActiveDeferreds:Xe,_internalSetRoutes:yo},se}function Zz(t){return t!=null&&("formData"in t&&t.formData!=null||"body"in t&&t.body!==void 0)}function bv(t,i,l,d,g,w,E){let s,A;if(w!=null&&E!=="path"){s=[];for(let V of i)if(s.push(V),V.route.id===w){A=V;break}}else s=i,A=i[i.length-1];let z=Bx(g||".",Hg(s).map(V=>V.pathnameBase),Ju(t.pathname,l)||t.pathname,E==="path");return g==null&&(z.search=t.search,z.hash=t.hash),(g==null||g===""||g===".")&&A&&A.route.index&&!Ox(z.search)&&(z.search=z.search?z.search.replace(/^\?/,"?index&"):"?index"),d&&l!=="/"&&(z.pathname=z.pathname==="/"?l:$s([l,z.pathname])),ac(z)}function HT(t,i,l,d){if(!d||!Zz(d))return{path:l};if(d.formMethod&&!Jz(d.formMethod))return{path:l,error:lo(405,{method:d.formMethod})};let g=()=>({path:l,error:lo(400,{type:"invalid-body"})}),w=d.formMethod||"get",E=t?w.toUpperCase():w.toLowerCase(),s=LC(l);if(d.body!==void 0){if(d.formEncType==="text/plain"){if(!jo(E))return g();let G=typeof d.body=="string"?d.body:d.body instanceof FormData||d.body instanceof URLSearchParams?Array.from(d.body.entries()).reduce((re,he)=>{let[ve,Ue]=he;return""+re+ve+"="+Ue+`
`},""):String(d.body);return{path:l,submission:{formMethod:E,formAction:s,formEncType:d.formEncType,formData:void 0,json:void 0,text:G}}}else if(d.formEncType==="application/json"){if(!jo(E))return g();try{let G=typeof d.body=="string"?JSON.parse(d.body):d.body;return{path:l,submission:{formMethod:E,formAction:s,formEncType:d.formEncType,formData:void 0,json:G,text:void 0}}}catch{return g()}}}sn(typeof FormData=="function","FormData is not available in this environment");let A,z;if(d.formData)A=Tv(d.formData),z=d.formData;else if(d.body instanceof FormData)A=Tv(d.body),z=d.body;else if(d.body instanceof URLSearchParams)A=d.body,z=QT(A);else if(d.body==null)A=new URLSearchParams,z=new FormData;else try{A=new URLSearchParams(d.body),z=QT(A)}catch{return g()}let V={formMethod:E,formAction:s,formEncType:d&&d.formEncType||"application/x-www-form-urlencoded",formData:z,json:void 0,text:void 0};if(jo(V.formMethod))return{path:l,submission:V};let j=Qs(l);return i&&j.search&&Ox(j.search)&&A.append("index",""),j.search="?"+A,{path:ac(j),submission:V}}function qz(t,i){let l=t;if(i){let d=t.findIndex(g=>g.route.id===i);d>=0&&(l=t.slice(0,d))}return l}function KT(t,i,l,d,g,w,E,s,A,z,V,j,G,re){let he=re?Object.values(re)[0]:G?Object.values(G)[0]:void 0,ve=t.createURL(i.location),Ue=t.createURL(g),ae=re?Object.keys(re)[0]:void 0,se=qz(l,ae).filter((Be,at)=>{if(Be.route.lazy)return!0;if(Be.route.loader==null)return!1;if(Wz(i.loaderData,i.matches[at],Be)||E.some(ze=>ze===Be.route.id))return!0;let Ye=i.matches[at],He=Be;return YT(Be,Yn({currentUrl:ve,currentParams:Ye.params,nextUrl:Ue,nextParams:He.params},d,{actionResult:he,defaultShouldRevalidate:w||ve.pathname+ve.search===Ue.pathname+Ue.search||ve.search!==Ue.search||zC(Ye,He)}))}),oe=[];return A.forEach((Be,at)=>{if(!l.some(gt=>gt.route.id===Be.routeId))return;let Ye=Su(V,Be.path,j);if(!Ye){oe.push({key:at,routeId:Be.routeId,path:Be.path,matches:null,match:null,controller:null});return}let He=i.fetchers.get(at),ze=He&&He.state!=="idle"&&He.data===void 0&&!z.has(at),kt=Ev(Ye,Be.path);(s.includes(at)||ze||YT(kt,Yn({currentUrl:ve,currentParams:i.matches[i.matches.length-1].params,nextUrl:Ue,nextParams:l[l.length-1].params},d,{actionResult:he,defaultShouldRevalidate:w})))&&oe.push({key:at,routeId:Be.routeId,path:Be.path,matches:Ye,match:kt,controller:new AbortController})}),[se,oe]}function Wz(t,i,l){let d=!i||l.route.id!==i.route.id,g=t[l.route.id]===void 0;return d||g}function zC(t,i){let l=t.route.path;return t.pathname!==i.pathname||l!=null&&l.endsWith("*")&&t.params["*"]!==i.params["*"]}function YT(t,i){if(t.route.shouldRevalidate){let l=t.route.shouldRevalidate(i);if(typeof l=="boolean")return l}return i.defaultShouldRevalidate}async function JT(t,i,l){if(!t.lazy)return;let d=await t.lazy();if(!t.lazy)return;let g=l[t.id];sn(g,"No route found in manifest");let w={};for(let E in d){let A=g[E]!==void 0&&E!=="hasErrorBoundary";qu(!A,'Route "'+g.id+'" has a static property "'+E+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+E+'" will be ignored.')),!A&&!gz.has(E)&&(w[E]=d[E])}Object.assign(g,w),Object.assign(g,Yn({},i(g),{lazy:void 0}))}async function Vd(t,i,l,d,g,w,E,s){s===void 0&&(s={});let A,z,V,j=he=>{let ve,Ue=new Promise((ae,J)=>ve=J);return V=()=>ve(),i.signal.addEventListener("abort",V),Promise.race([he({request:i,params:l.params,context:s.requestContext}),Ue])};try{let he=l.route[t];if(l.route.lazy)if(he)z=(await Promise.all([j(he),JT(l.route,w,g)]))[0];else if(await JT(l.route,w,g),he=l.route[t],he)z=await j(he);else if(t==="action"){let ve=new URL(i.url),Ue=ve.pathname+ve.search;throw lo(405,{method:i.method,pathname:Ue,routeId:l.route.id})}else return{type:Di.data,data:void 0};else if(he)z=await j(he);else{let ve=new URL(i.url),Ue=ve.pathname+ve.search;throw lo(404,{pathname:Ue})}sn(z!==void 0,"You defined "+(t==="action"?"an action":"a loader")+" for route "+('"'+l.route.id+"\" but didn't return anything from your `"+t+"` ")+"function. Please return a value or `null`.")}catch(he){A=Di.error,z=he}finally{V&&i.signal.removeEventListener("abort",V)}if(Yz(z)){let he=z.status;if(Vz.has(he)){let ae=z.headers.get("Location");if(sn(ae,"Redirects returned/thrown from loaders/actions must have a Location header"),!DC.test(ae))ae=bv(new URL(i.url),d.slice(0,d.indexOf(l)+1),E,!0,ae);else if(!s.isStaticRequest){let J=new URL(i.url),se=ae.startsWith("//")?new URL(J.protocol+ae):new URL(ae),oe=Ju(se.pathname,E)!=null;se.origin===J.origin&&oe&&(ae=se.pathname+se.search+se.hash)}if(s.isStaticRequest)throw z.headers.set("Location",ae),z;return{type:Di.redirect,status:he,location:ae,revalidate:z.headers.get("X-Remix-Revalidate")!==null}}if(s.isRouteRequest)throw{type:A||Di.data,response:z};let ve,Ue=z.headers.get("Content-Type");return Ue&&/\bapplication\/json\b/.test(Ue)?ve=await z.json():ve=await z.text(),A===Di.error?{type:A,error:new Fx(he,z.statusText,ve),headers:z.headers}:{type:Di.data,data:ve,statusCode:z.status,headers:z.headers}}if(A===Di.error)return{type:A,error:z};if(Kz(z)){var G,re;return{type:Di.deferred,deferredData:z,statusCode:(G=z.init)==null?void 0:G.status,headers:((re=z.init)==null?void 0:re.headers)&&new Headers(z.init.headers)}}return{type:Di.data,data:z}}function Nd(t,i,l,d){let g=t.createURL(LC(i)).toString(),w={signal:l};if(d&&jo(d.formMethod)){let{formMethod:E,formEncType:s}=d;w.method=E.toUpperCase(),s==="application/json"?(w.headers=new Headers({"Content-Type":s}),w.body=JSON.stringify(d.json)):s==="text/plain"?w.body=d.text:s==="application/x-www-form-urlencoded"&&d.formData?w.body=Tv(d.formData):w.body=d.formData}return new Request(g,w)}function Tv(t){let i=new URLSearchParams;for(let[l,d]of t.entries())i.append(l,typeof d=="string"?d:d.name);return i}function QT(t){let i=new FormData;for(let[l,d]of t.entries())i.append(l,d);return i}function Xz(t,i,l,d,g){let w={},E=null,s,A=!1,z={};return l.forEach((V,j)=>{let G=i[j].route.id;if(sn(!Fu(V),"Cannot handle redirect results in processLoaderData"),sf(V)){let re=Cu(t,G),he=V.error;d&&(he=Object.values(d)[0],d=void 0),E=E||{},E[re.route.id]==null&&(E[re.route.id]=he),w[G]=void 0,A||(A=!0,s=IC(V.error)?V.error.status:500),V.headers&&(z[G]=V.headers)}else Yl(V)?(g.set(G,V.deferredData),w[G]=V.deferredData.data):w[G]=V.data,V.statusCode!=null&&V.statusCode!==200&&!A&&(s=V.statusCode),V.headers&&(z[G]=V.headers)}),d&&(E=d,w[Object.keys(d)[0]]=void 0),{loaderData:w,errors:E,statusCode:s||200,loaderHeaders:z}}function e2(t,i,l,d,g,w,E,s){let{loaderData:A,errors:z}=Xz(i,l,d,g,s);for(let V=0;V<w.length;V++){let{key:j,match:G,controller:re}=w[V];sn(E!==void 0&&E[V]!==void 0,"Did not find corresponding fetcher result");let he=E[V];if(!(re&&re.signal.aborted))if(sf(he)){let ve=Cu(t.matches,G==null?void 0:G.route.id);z&&z[ve.route.id]||(z=Yn({},z,{[ve.route.id]:he.error})),t.fetchers.delete(j)}else if(Fu(he))sn(!1,"Unhandled fetcher revalidation redirect");else if(Yl(he))sn(!1,"Unhandled fetcher deferred data");else{let ve=Hm(he.data);t.fetchers.set(j,ve)}}return{loaderData:A,errors:z}}function t2(t,i,l,d){let g=Yn({},i);for(let w of l){let E=w.route.id;if(i.hasOwnProperty(E)?i[E]!==void 0&&(g[E]=i[E]):t[E]!==void 0&&w.route.loader&&(g[E]=t[E]),d&&d.hasOwnProperty(E))break}return g}function Cu(t,i){return(i?t.slice(0,t.findIndex(d=>d.route.id===i)+1):[...t]).reverse().find(d=>d.route.hasErrorBoundary===!0)||t[0]}function n2(t){let i=t.find(l=>l.index||!l.path||l.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:i}],route:i}}function lo(t,i){let{pathname:l,routeId:d,method:g,type:w}=i===void 0?{}:i,E="Unknown Server Error",s="Unknown @remix-run/router error";return t===400?(E="Bad Request",g&&l&&d?s="You made a "+g+' request to "'+l+'" but '+('did not provide a `loader` for route "'+d+'", ')+"so there is no way to handle the request.":w==="defer-action"?s="defer() is not supported in actions":w==="invalid-body"&&(s="Unable to encode submission body")):t===403?(E="Forbidden",s='Route "'+d+'" does not match URL "'+l+'"'):t===404?(E="Not Found",s='No route matches URL "'+l+'"'):t===405&&(E="Method Not Allowed",g&&l&&d?s="You made a "+g.toUpperCase()+' request to "'+l+'" but '+('did not provide an `action` for route "'+d+'", ')+"so there is no way to handle the request.":g&&(s='Invalid request method "'+g.toUpperCase()+'"')),new Fx(t||500,E,new Error(s),!0)}function i2(t){for(let i=t.length-1;i>=0;i--){let l=t[i];if(Fu(l))return l}}function LC(t){let i=typeof t=="string"?Qs(t):t;return ac(Yn({},i,{hash:""}))}function Hz(t,i){return t.pathname!==i.pathname||t.search!==i.search?!1:t.hash===""?i.hash!=="":t.hash===i.hash?!0:i.hash!==""}function Yl(t){return t.type===Di.deferred}function sf(t){return t.type===Di.error}function Fu(t){return(t&&t.type)===Di.redirect}function Kz(t){let i=t;return i&&typeof i=="object"&&typeof i.data=="object"&&typeof i.subscribe=="function"&&typeof i.cancel=="function"&&typeof i.resolveData=="function"}function Yz(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.headers=="object"&&typeof t.body<"u"}function Jz(t){return Uz.has(t.toLowerCase())}function jo(t){return Fz.has(t.toLowerCase())}async function r2(t,i,l,d,g,w){for(let E=0;E<l.length;E++){let s=l[E],A=i[E];if(!A)continue;let z=t.find(j=>j.route.id===A.route.id),V=z!=null&&!zC(z,A)&&(w&&w[A.route.id])!==void 0;if(Yl(s)&&(g||V)){let j=d[E];sn(j,"Expected an AbortSignal for revalidating fetcher deferred result"),await RC(s,j,g).then(G=>{G&&(l[E]=G||l[E])})}}}async function RC(t,i,l){if(l===void 0&&(l=!1),!await t.deferredData.resolveData(i)){if(l)try{return{type:Di.data,data:t.deferredData.unwrappedData}}catch(g){return{type:Di.error,error:g}}return{type:Di.data,data:t.deferredData.data}}}function Ox(t){return new URLSearchParams(t).getAll("index").some(i=>i==="")}function Qz(t,i){let{route:l,pathname:d,params:g}=t;return{id:l.id,pathname:d,params:g,data:i[l.id],handle:l.handle}}function Ev(t,i){let l=typeof i=="string"?Qs(i).search:i.search;if(t[t.length-1].route.index&&Ox(l||""))return t[t.length-1];let d=Hg(t);return d[d.length-1]}function o2(t){let{formMethod:i,formAction:l,formEncType:d,text:g,formData:w,json:E}=t;if(!(!i||!l||!d)){if(g!=null)return{formMethod:i,formAction:l,formEncType:d,formData:void 0,json:void 0,text:g};if(w!=null)return{formMethod:i,formAction:l,formEncType:d,formData:w,json:void 0,text:void 0};if(E!==void 0)return{formMethod:i,formAction:l,formEncType:d,formData:void 0,json:E,text:void 0}}}function Dm(t,i){return i?{state:"loading",location:t,formMethod:i.formMethod,formAction:i.formAction,formEncType:i.formEncType,formData:i.formData,json:i.json,text:i.text}:{state:"loading",location:t,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function eL(t,i){return{state:"submitting",location:t,formMethod:i.formMethod,formAction:i.formAction,formEncType:i.formEncType,formData:i.formData,json:i.json,text:i.text}}function jd(t,i){return t?{state:"loading",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:i," _hasFetcherDoneAnything ":!0}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:i," _hasFetcherDoneAnything ":!0}}function tL(t,i){return{state:"submitting",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:i?i.data:void 0," _hasFetcherDoneAnything ":!0}}function Hm(t){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:t," _hasFetcherDoneAnything ":!0}}/**
 * React Router v6.14.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function bg(){return bg=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var l=arguments[i];for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(t[d]=l[d])}return t},bg.apply(this,arguments)}const Kg=De.createContext(null),Ux=De.createContext(null),uc=De.createContext(null),Yg=De.createContext(null),hc=De.createContext({outlet:null,matches:[],isDataRoute:!1}),BC=De.createContext(null);function nL(t,i){let{relative:l}=i===void 0?{}:i;Uf()||sn(!1);let{basename:d,navigator:g}=De.useContext(uc),{hash:w,pathname:E,search:s}=Vx(t,{relative:l}),A=E;return d!=="/"&&(A=E==="/"?d:$s([d,E])),g.createHref({pathname:A,search:s,hash:w})}function Uf(){return De.useContext(Yg)!=null}function Qu(){return Uf()||sn(!1),De.useContext(Yg).location}function FC(t){De.useContext(uc).static||De.useLayoutEffect(t)}function iL(){let{isDataRoute:t}=De.useContext(hc);return t?mL():rL()}function rL(){Uf()||sn(!1);let t=De.useContext(Kg),{basename:i,navigator:l}=De.useContext(uc),{matches:d}=De.useContext(hc),{pathname:g}=Qu(),w=JSON.stringify(Hg(d).map(A=>A.pathnameBase)),E=De.useRef(!1);return FC(()=>{E.current=!0}),De.useCallback(function(A,z){if(z===void 0&&(z={}),!E.current)return;if(typeof A=="number"){l.go(A);return}let V=Bx(A,JSON.parse(w),g,z.relative==="path");t==null&&i!=="/"&&(V.pathname=V.pathname==="/"?i:$s([i,V.pathname])),(z.replace?l.replace:l.push)(V,z.state,z)},[i,l,w,g,t])}function Vx(t,i){let{relative:l}=i===void 0?{}:i,{matches:d}=De.useContext(hc),{pathname:g}=Qu(),w=JSON.stringify(Hg(d).map(E=>E.pathnameBase));return De.useMemo(()=>Bx(t,JSON.parse(w),g,l==="path"),[t,w,g,l])}function oL(t,i,l){Uf()||sn(!1);let{navigator:d}=De.useContext(uc),{matches:g}=De.useContext(hc),w=g[g.length-1],E=w?w.params:{};w&&w.pathname;let s=w?w.pathnameBase:"/";w&&w.route;let A=Qu(),z;if(i){var V;let ve=typeof i=="string"?Qs(i):i;s==="/"||(V=ve.pathname)!=null&&V.startsWith(s)||sn(!1),z=ve}else z=A;let j=z.pathname||"/",G=s==="/"?j:j.slice(s.length)||"/",re=Su(t,{pathname:G}),he=uL(re&&re.map(ve=>Object.assign({},ve,{params:Object.assign({},E,ve.params),pathname:$s([s,d.encodeLocation?d.encodeLocation(ve.pathname).pathname:ve.pathname]),pathnameBase:ve.pathnameBase==="/"?s:$s([s,d.encodeLocation?d.encodeLocation(ve.pathnameBase).pathname:ve.pathnameBase])})),g,l);return i&&he?De.createElement(Yg.Provider,{value:{location:bg({pathname:"/",search:"",hash:"",state:null,key:"default"},z),navigationType:Ci.Pop}},he):he}function sL(){let t=pL(),i=IC(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),l=t instanceof Error?t.stack:null,g={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},w=null;return De.createElement(De.Fragment,null,De.createElement("h2",null,"Unexpected Application Error!"),De.createElement("h3",{style:{fontStyle:"italic"}},i),l?De.createElement("pre",{style:g},l):null,w)}const aL=De.createElement(sL,null);class lL extends De.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,l){return l.location!==i.location||l.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error||l.error,location:l.location,revalidation:i.revalidation||l.revalidation}}componentDidCatch(i,l){console.error("React Router caught the following error during render",i,l)}render(){return this.state.error?De.createElement(hc.Provider,{value:this.props.routeContext},De.createElement(BC.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function cL(t){let{routeContext:i,match:l,children:d}=t,g=De.useContext(Kg);return g&&g.static&&g.staticContext&&(l.route.errorElement||l.route.ErrorBoundary)&&(g.staticContext._deepestRenderedBoundaryId=l.route.id),De.createElement(hc.Provider,{value:i},d)}function uL(t,i,l){var d;if(i===void 0&&(i=[]),l===void 0&&(l=null),t==null){var g;if((g=l)!=null&&g.errors)t=l.matches;else return null}let w=t,E=(d=l)==null?void 0:d.errors;if(E!=null){let s=w.findIndex(A=>A.route.id&&(E==null?void 0:E[A.route.id]));s>=0||sn(!1),w=w.slice(0,Math.min(w.length,s+1))}return w.reduceRight((s,A,z)=>{let V=A.route.id?E==null?void 0:E[A.route.id]:null,j=null;l&&(j=A.route.errorElement||aL);let G=i.concat(w.slice(0,z+1)),re=()=>{let he;return V?he=j:A.route.Component?he=De.createElement(A.route.Component,null):A.route.element?he=A.route.element:he=s,De.createElement(cL,{match:A,routeContext:{outlet:s,matches:G,isDataRoute:l!=null},children:he})};return l&&(A.route.ErrorBoundary||A.route.errorElement||z===0)?De.createElement(lL,{location:l.location,revalidation:l.revalidation,component:j,error:V,children:re(),routeContext:{outlet:null,matches:G,isDataRoute:!0}}):re()},null)}var Sv;(function(t){t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate"})(Sv||(Sv={}));var Pf;(function(t){t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId"})(Pf||(Pf={}));function hL(t){let i=De.useContext(Kg);return i||sn(!1),i}function dL(t){let i=De.useContext(Ux);return i||sn(!1),i}function fL(t){let i=De.useContext(hc);return i||sn(!1),i}function OC(t){let i=fL(),l=i.matches[i.matches.length-1];return l.route.id||sn(!1),l.route.id}function pL(){var t;let i=De.useContext(BC),l=dL(Pf.UseRouteError),d=OC(Pf.UseRouteError);return i||((t=l.errors)==null?void 0:t[d])}function mL(){let{router:t}=hL(Sv.UseNavigateStable),i=OC(Pf.UseNavigateStable),l=De.useRef(!1);return FC(()=>{l.current=!0}),De.useCallback(function(g,w){w===void 0&&(w={}),l.current&&(typeof g=="number"?t.navigate(g):t.navigate(g,bg({fromRouteId:i},w)))},[t,i])}const gL="startTransition",s2=nk[gL];function _L(t){let{fallbackElement:i,router:l,future:d}=t,[g,w]=De.useState(l.state),{v7_startTransition:E}=d||{},s=De.useCallback(j=>{E&&s2?s2(()=>w(j)):w(j)},[w,E]);De.useLayoutEffect(()=>l.subscribe(s),[l,s]);let A=De.useMemo(()=>({createHref:l.createHref,encodeLocation:l.encodeLocation,go:j=>l.navigate(j),push:(j,G,re)=>l.navigate(j,{state:G,preventScrollReset:re==null?void 0:re.preventScrollReset}),replace:(j,G,re)=>l.navigate(j,{replace:!0,state:G,preventScrollReset:re==null?void 0:re.preventScrollReset})}),[l]),z=l.basename||"/",V=De.useMemo(()=>({router:l,navigator:A,static:!1,basename:z}),[l,A,z]);return De.createElement(De.Fragment,null,De.createElement(Kg.Provider,{value:V},De.createElement(Ux.Provider,{value:g},De.createElement(vL,{basename:z,location:g.location,navigationType:g.historyAction,navigator:A},g.initialized?De.createElement(yL,{routes:l.routes,state:g}):i))),null)}function yL(t){let{routes:i,state:l}=t;return oL(i,void 0,l)}function vL(t){let{basename:i="/",children:l=null,location:d,navigationType:g=Ci.Pop,navigator:w,static:E=!1}=t;Uf()&&sn(!1);let s=i.replace(/^\/*/,"/"),A=De.useMemo(()=>({basename:s,navigator:w,static:E}),[s,w,E]);typeof d=="string"&&(d=Qs(d));let{pathname:z="/",search:V="",hash:j="",state:G=null,key:re="default"}=d,he=De.useMemo(()=>{let ve=Ju(z,s);return ve==null?null:{location:{pathname:ve,search:V,hash:j,state:G,key:re},navigationType:g}},[s,z,V,j,G,re,g]);return he==null?null:De.createElement(uc.Provider,{value:A},De.createElement(Yg.Provider,{children:l,value:he}))}var a2;(function(t){t[t.pending=0]="pending",t[t.success=1]="success",t[t.error=2]="error"})(a2||(a2={}));new Promise(()=>{});function xL(t){let i={hasErrorBoundary:t.ErrorBoundary!=null||t.errorElement!=null};return t.Component&&Object.assign(i,{element:De.createElement(t.Component),Component:void 0}),t.ErrorBoundary&&Object.assign(i,{errorElement:De.createElement(t.ErrorBoundary),ErrorBoundary:void 0}),i}/**
 * React Router DOM v6.14.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Wu(){return Wu=Object.assign?Object.assign.bind():function(t){for(var i=1;i<arguments.length;i++){var l=arguments[i];for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(t[d]=l[d])}return t},Wu.apply(this,arguments)}function UC(t,i){if(t==null)return{};var l={},d=Object.keys(t),g,w;for(w=0;w<d.length;w++)g=d[w],!(i.indexOf(g)>=0)&&(l[g]=t[g]);return l}function wL(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function bL(t,i){return t.button===0&&(!i||i==="_self")&&!wL(t)}const TL=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset"],EL=["aria-current","caseSensitive","className","end","style","to","children"];function SL(t,i){return $z({basename:i==null?void 0:i.basename,future:Wu({},i==null?void 0:i.future,{v7_prependBasename:!0}),history:fz({window:i==null?void 0:i.window}),hydrationData:(i==null?void 0:i.hydrationData)||CL(),routes:t,mapRouteProperties:xL}).initialize()}function CL(){var t;let i=(t=window)==null?void 0:t.__staticRouterHydrationData;return i&&i.errors&&(i=Wu({},i,{errors:AL(i.errors)})),i}function AL(t){if(!t)return null;let i=Object.entries(t),l={};for(let[d,g]of i)if(g&&g.__type==="RouteErrorResponse")l[d]=new Fx(g.status,g.statusText,g.data,g.internal===!0);else if(g&&g.__type==="Error"){let w=new Error(g.message);w.stack="",l[d]=w}else l[d]=g;return l}const ML=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",PL=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,IL=De.forwardRef(function(i,l){let{onClick:d,relative:g,reloadDocument:w,replace:E,state:s,target:A,to:z,preventScrollReset:V}=i,j=UC(i,TL),{basename:G}=De.useContext(uc),re,he=!1;if(typeof z=="string"&&PL.test(z)&&(re=z,ML))try{let J=new URL(window.location.href),se=z.startsWith("//")?new URL(J.protocol+z):new URL(z),oe=Ju(se.pathname,G);se.origin===J.origin&&oe!=null?z=oe+se.search+se.hash:he=!0}catch{}let ve=nL(z,{relative:g}),Ue=kL(z,{replace:E,state:s,target:A,preventScrollReset:V,relative:g});function ae(J){d&&d(J),J.defaultPrevented||Ue(J)}return De.createElement("a",Wu({},j,{href:re||ve,onClick:he||w?d:ae,ref:l,target:A}))}),Jl=De.forwardRef(function(i,l){let{"aria-current":d="page",caseSensitive:g=!1,className:w="",end:E=!1,style:s,to:A,children:z}=i,V=UC(i,EL),j=Vx(A,{relative:V.relative}),G=Qu(),re=De.useContext(Ux),{navigator:he}=De.useContext(uc),ve=he.encodeLocation?he.encodeLocation(j).pathname:j.pathname,Ue=G.pathname,ae=re&&re.navigation&&re.navigation.location?re.navigation.location.pathname:null;g||(Ue=Ue.toLowerCase(),ae=ae?ae.toLowerCase():null,ve=ve.toLowerCase());let J=Ue===ve||!E&&Ue.startsWith(ve)&&Ue.charAt(ve.length)==="/",se=ae!=null&&(ae===ve||!E&&ae.startsWith(ve)&&ae.charAt(ve.length)==="/"),oe=J?d:void 0,Be;typeof w=="function"?Be=w({isActive:J,isPending:se}):Be=[w,J?"active":null,se?"pending":null].filter(Boolean).join(" ");let at=typeof s=="function"?s({isActive:J,isPending:se}):s;return De.createElement(IL,Wu({},V,{"aria-current":oe,className:Be,ref:l,style:at,to:A}),typeof z=="function"?z({isActive:J,isPending:se}):z)});var l2;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher"})(l2||(l2={}));var c2;(function(t){t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(c2||(c2={}));function kL(t,i){let{target:l,replace:d,state:g,preventScrollReset:w,relative:E}=i===void 0?{}:i,s=iL(),A=Qu(),z=Vx(t,{relative:E});return De.useCallback(V=>{if(bL(V,l)){V.preventDefault();let j=d!==void 0?d:ac(A)===ac(z);s(t,{replace:j,state:g,preventScrollReset:w,relative:E})}},[A,s,z,d,g,l,t,w,E])}const DL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAABBCAYAAABB2f2GAAAACXBIWXMAAAsSAAALEgHS3X78AAAIDklEQVRogcVaXYwbRx3/2bu2b33+OCvW3XWjy50SQbRqqoZXchX0kbYS7QvqhwTXFySQEOEFqRKC5AEVVUhUQkoUXhqQgIoXEgn62kS0faNNReg+RBD7nFsu95Gcvbb3vN5do//crm9tr72zawd+kuX9mpnfzPzmP//5zyR6vR6mhaqqCwDOA/g6AO96GHcAHAC4pSjKrakLBRCbvKZpC+12+1vdbvd1AF+LkcVNADfopyjKQRwOkclrmrYG4BKAlx3Haeq6fjJOwT7UAbxLv6iV4CZPLQ3govsres8bjQZmIT2vEoqiXOJNwEVe0zTS8HUAzw6/a7fb6Ha7MbiOxecANhRFuRP2YZKD+AaAz4KIE0RR3Jolc7ecW6qqvhz24UTymqaRRN6b9I0oimIchiEgWf5ZVdWNSZ+NJa9pGmnvV2GlJJPJpWQytAPj4r1JFQjUvCuViS3uh2EYhmma0pOqAYBXFEW5MfxwhLw7OD+LkrNlWbVWq7UyA5LjQJbovKIoFf/7gf52zeFIDcMgimL5CRKHOwZGeA0PNhqgqzEylwRBgOM4yOVymJubQyaTAT2zbRudTgeHh4doNpvTzAnPqqp6UVGUd70Hfdm4M+f9OLmSwcnlct1sNpsK+1bXdezs7MA0zThFkXzWvJnYLxvumc1DIpFAoVDA4uIieIgT8vk8zpw5w9JQ+ogouupgYC3var3in/Z5iJfLZaRSXJwDQVKqVCqRpJRMJvWzZ88W4Gv5jf81cQKNjdXVU1w9kE6njVwu9zCfz+c1TWOzr0c+dCr2o1QqTU3cgyRl8dRTS+j1nJF3NPlJkrRXLBYNSZLIKCz5+YquZLj9cbIi1GLTwq7XcfD799l/6Y3XkEhY6PVEJBJJ1jCZTKYmCALNHUFmmJFPbG1t0ernQ14uy8vLmIU7sPW9H+DgD++z69TKClb//gnu3funVSot64lEosSRxVeS7tKNC+l0eibECd3NzePrWg2ZzByy85Jomi0e4oTzxGSNt0BJmp37MvfMuePrc0+z/2LxBIxDPVD/AVgT/1/kl3/xc+RfegHdag35l77Bni0slLG9vQnTbCOTyXGR54Ynmf0r17D91k9Gki28/ipOXv01d37z6xeA9eN7ISmw/w4n+VgCDiJO0P/yQZzsRmDbfMvKWOTJOvghFAqs1Vf++DvuPA7/cXfie8vqhOYRi/yX736Kp+u7yL94pFW70WByYTLgwM7b7+Bf68+z/ylQSbqRLC6Qa+uHnyyvZGhSenTlGrt26vWBd/XGoyhVYeS5Az2tVmvgfv65Y/L7V69x5bH79juspwhkbfzQ9UgxJ0Z+YtyQPD7TNI1ms/lwd3d34B3Zak//rY8+QeujjyeWRu/3r/6GXVO6YZnp+uP+tShmwsjfScqyHEieAkmtVqtGETHDMCTbtpdopfTo0WDXLr714/517bVvjx2I9JzeB6Uj7O9vs5UYQRBCnb66LMt3vAFLQU+2ZDMMY6/RaDymSJhlWSOLamp9rxDCwhuv9lufBm7lhW/2HS64GqeBSc9tVy7z619l6TzYjo2d3ePYVSadDSPP1rNsMVKtVr9rGMYve71ePiwVK3x+HqdOnerfkxwqL/J51WRWv3T3UwjF4+XDv+9/AcM4Gk/kVRYLS+x/Al6RZfkG+6Ldbv+px+lQwB24Dx48OK7M+gWcvBI+s1IPrX1wc4D4Zu1enziYyz0fRrxKxOHZeXdBe52XPNyFdLVahW1b7J5ksPbXGyMTmAeaxM58/GHfISOp3K+oAxaGtC7NFcKK7vPsRw/c3Y1I61gwfyeBEydKKJeX+s9IRq2/HVke6ZlzyD53YaC1Dw72sP1wk40xP/F8rhzW6ix6IMvyAYYjZqqqUgThZ1HIg5lTBx2zicXFZeRzRRQKCyPftNo6jHYTe/vb/d6KSJzwpizLoy3vq0AlZuAJh4c6OmZrIBpAnmguNx/4PZEljXNIhXBbluWBhVOQS7wRZVnox9xcnpExTQNm12DeIZlVig74K0QtTeYwnc7ytLaHi8MPAqPEqqpS13wnTgWGYVkmiwCk0ym2kOaYOYNwWZblkaDYuGpfdAfH1BDFNBVTJtIxiVfdDbcRBJJ3TedIN8XFlHtWG5514SLvVoCkc3tWFXAcJ87e1c1xvhc4FiMT94SiwDTNUIdlCPWw8ieSd3ciLs+CvGVZvPEYD5fGycUD1z7s5ubmF47jZC3LWqVZ0e9VRgHFHGnS5UgyYtODwBX6EEXx+2T7KWKGowXKY9q673a7Odu2S5ZlheaBo9bfE0WRZ++Ky1hE2b6faPsdx6laliValnVyXO9QmFoKj1wF2vQgRD17wO24Ue/Ytk29U7Ztm1ZizFWgnZEJIJt+PkzrHiKd+oi6PzsEw7btPVrwJBKJBdpsC8Dzk0zjVOTdCtyKeb6GwbbtWrPZJN0bgiDspVKpnCiKJUEQyKZH2uSIc25gI+6uIZhTJnibBSSlFden1zOZzA+j5hU5YibL8rS2n+3ZDuGnp0+frkbNaJpjWlP4/YePO52ON2ndVhSFe4PDj2m2OWK7DqlUqum7je0AxibvWoXfxknr0/1lnhNN4zDtBlNcv590/59xfjovpiLvTiaxuj2VSv0o7pFEDzM5FBrD9ke26UGY1fmqKIM31E/nxUzIR7T9oX46L2YiGw8ctp/LT+fFrI/lhclhZot6zJp8iO0nPz22TQ/CkzgQGWT7P5/Wpgdhppr34Ds0TTK6zrsyigQA/wUOj141V2e3DwAAAABJRU5ErkJggg==",zL="/assets/tui-logo-88081b47.svg",LL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAABCCAYAAADHTY8oAAAACXBIWXMAAAsSAAALEgHS3X78AAAIqUlEQVRogbVaS2zc1hU9nCHnZ81Idl2P9ewgso3WZgrULqoC6SJonEU3Beqgi25SoEKzSbqpXaBZ9aPUu3ZRd9Ekm9QOkFW7sbro0h900QB2G3tRs04cf2oNY9mSrNFYmhHJIYv7+DiiZjjDR3JygIHHI37Ou++8c++7pOJ5HsYFwzBeBjAjPv1YA3CDPrqur43jlpnI37lz5+u2bf8AwKsAjic49SaAKwAu6Lp+I+39U5E3TXMOwJzrusdarVY97c0FHgCY13X9QtITE5E3TZNkMQ/gO8FvrVYLrusmvW8UaBCndV2/KHuCFHnTNKcE6Z/1/63dbrctyypn597DAs2qzLrIxR1gmuYJoc8B4gRN05azMI3AKQD3DcM4EXfgSPIh4kMXYz6fnxgP5x2YBPCxYRhzow4aSj5EfHLUBRRF2Z3P58dBOArnRw0gkrws8QCqqj4dL+cdOC/yxwAGyIvFeUGWOHzdP/siWIdw0TCMgcQXFflzCRMO6f65MRAchUkR0B3YYZXCxy+nubplWajVaqhUKiiVSgN/73Q62NzcxOrqKmzbTjuIM7qunwv+00/+PoDnk1yNFmu1WuWkZdFsNvHkyZM0g2hS3RTkADVEfC4pcSJM0c7lcoDdgrd0CXh0GV7bBNZv+wd9aRZKmQH1k1D2v8J/mpyc5AM2TZNn6AQg+ZwWCXM78kmjTsSnpqb4d++Td+Hd+5B/5wRrR4HaMcBe9wexfhve0mWgPA3lhbd6gxD35TORAL3oc/LCGj9OTNxuwf3odWCzAeXQj/gHWjX6pLbpD3Lxb1AOvcYHkWQANLuFQqFZKBSokPrlgQMH3glkMzKThUEaJ6n0iNOFv/1nHm1v5TqwuABv5RrQ/tw/q3YUCkmHBnf8LFBm8D59j//LBwugXq9jY+MZHKc7cD9N01AsFh8KRwvs+7sA3gkiLy0ZijhFPoh47qW/8t+9W7/jUeUar5/0ZUNYugTv0SU+WCLL5VU5gNyL7++YpeXlJTx+vAxFyVHWpig/LRaLOUVRIvMNY0xRGo0Gmf892ahTlDyK7s1fI/fSX3hk3X/80JfO8bM79BwGlwxFvHZ0gHiAW8YNTOza81BVVZm8cZJkE1u9BZiY8GswIqIc/L4vlU/e9WcgkM69D/3oCtnwWSDJfPVNIaFvDV0X9fo01pvN51RVqtZ7OZeEfKFQ8N2j/bmvV7LHT9/rEfNu/grerd/z6Csvvg/lm3+A57TgffQ6lw6flWELGsCuShXtTgueJ7W5mVElDuqBFo+3eI1bHie7uACoE76WV677TnL8t1AOnuqdQ4RpJnjEY1AqVTjxztYzlEu1WPIU+ciKbSjsFl9wHDQLk2Jh0kBosYaI9wYwykIjYFmbUsfF7qRGwVu/DWXPLD+CsmrwPQs0rQjX7fLPF0qeyHqr1/3vVAIEJUEG2PYWP9l1HSnyyfomNP2bDf97hQHN//rfD57iJQBfB33g7mMnqmGkIy/dvaIqkC88skGSTP0VwHkmFuQst0/yf+7ptIAfXYJ3/TR3IJ7UYgawsbn992585NeI/H1Z8lSz86KrPO1HU6tC+cobvtfTYChJvfALP4mRPf7rDLdKciCarbgBdDrbC1VTi3F0bqgysqGmkmVZzXa7jSNHjkySr1OEFZF8SC7uP38CZfaP2wVaP4SVUt0zLAuvrCzFUdlBPqht1vr3rPS7bdvtra2tDdd19wa/M8Z4PS5d26xc89cB1TZfe4tbKU9YfZl2bW0ZDdOvUqi+mZqcjiN/KCB/UTR7uK4ty3roOE5kfUGJ6vDhw8h1N7arytlzfrUYU1XyY0RdRPIKZqjrdvHZZ//pOU2hUMGuyu5RxG8yxk5w8ouLiz/tdDpnbdumtl1s644iTzMwrnr+fw/voNXa7p5UJ/ZCHa35M4yxc72dlGEYA9KRGkDGnRRJhSQTgEgT+RgcYozdD5OnfeFvZMnzCFWrmJ7ej3xeTbSHJZBUGo17OyJOWq9V9yGXG9mBW2CMvYrwHtYwjClhm9LRB49UHlO7a/jy3v3S51CkHz8xexoPICEXwknG2BX0tz7SRB8iGzrdNvbt28/L2lptauAYSkDk42SH/aQp4hO79sgQ/4Ax1tuyDvTnDcNI3LsBt1a/lN3a2ugjpqBaHb65IMLkLDFSQdA1YIz1KoKowkx6M76TZI7X4KTZQqHMSUPkiyhoWonLhD4SxAnzYeIY9mTEMAzqC/44zSDCcBwL3a6NUrm4qWkab6lR2s/nNT7YBLjKGBvYdwy7wmkxTZmgqgUUi7uQz5UqNCv0IZkkJB7wGUDkVUQvMPKENHAcXiG2U57+NmMssv4aGgLxaPHquAbQ7XbTPLt6IFrukYibv1SLNwqWZcWmzaj79y/SMEaS13WdbPPtDJx7cBwn6ePOhSAZDYPUc9i7d+/+2/O8Y0QgywPjWq32lB7ASRw64OlRkOrblEqln4eemLRd1121bVt1HKfe7XaHenk/bNveLBQKMuQHPD0K0o/vTdMc6v2u6y65rmvZtr131OzQXkDiCUqkp2cln6Rwa5O72LY90e12dwur5FmXt8dH4xvDrDE1eWw/+jkvfUIIrus2SGr5fL6gquow6ZCnz8teM/ErK6ZpXgm/9ZEUruuarVaL5XK5hqqqjqZpz6sqX3rk6SdktJ6FvHQ/fxiiHuGUy+XvzczM/D3JdRIXGbT9yur9ItJhLCQljrS9SqHLB2nOhU8+3KBpps3kWRqtqUsHTdPCvbz5tC/MZXpBbpT3x0Ho/qqu68meD4SQqcWdpe4Xus9UdmciL2wtFYFisfinLK8lIqtsAqTw/sSeHoWssgmQdPGOrNNlMRbyCb0/tk6XxbgiD7Fdi/P+1J4ehbGRFzKIIyZVp8tirG9xw1+8vV5/H6TrdFmMUzYB5oZ4/9haKQHGTl7Igt5n+ED8dDXJBiMJxi6bMKh8Fk40fgD4P/NaHZcURdjjAAAAAElFTkSuQmCC",RL="/assets/cocus-logo-56efd417.svg",BL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAABBCAYAAABB2f2GAAAACXBIWXMAAAsSAAALEgHS3X78AAAJOUlEQVRogbVay4/cSBn/2VV2t/s5k8xkdj0KmR2xZC2BNuwNCYnHkQMKB1aIC8MBIYEQgSsSm/wF7G2PO3vigkT2gsQpiYQ4gTZLxHoPKMlkEmcy7353u/1AX7Xt6Ye723Z3flKpu912+Vdf/eqrr74qyfd9LArTNFcA3ADwXQDh93E8BHAO4L5hGPcXfimAzOQty1ppt9vv9/v9nwL4ToYqPgVwl4phGOdZOKQmb1nWFoDbAG56ntdsNBqbWV48hBqAD6mkbURi8mRpALeCUg2v1+t1LEN6YSMMw7id9IFE5C3LIg3vAnh3/L92u41+v5+B61R8DmDHMIyH826UExDfAfBZHHEC5/zFMpkH77lvmubNeTfOJG9ZFknk41n3cM55FoZzQLL8q2maO7Num0resizS3p/mvUWW5Q1ZntuBWfHxrAbEaj6QykyLD6PT6XRs29ZeVwsA/MgwjLvjFyfIB4PzszQ1O46z32q1ri6B5DSQJ7phGMbT4f9H+jtwhxMtnAfO+dprJI5gDEzwGh9sNECvZahcy+fzqFarKBQKoO/j6Ha7wq2enp5mda3vmqZ5yzCMD8MLkWyCmfNJ2hoZYyiXy4J0UtRqNRwdHWVpBMlnK5yJh2WTeGYLQYTX19dTESdQD21vb4tGp0Q1UIeAsHyg9afD034S4isrK2lfPgHLskRPJIUsy43r169XMKT5nazET379rZH/PF9CUymi4ebQbXrRdV7gqL6jY+3bP0D1vR9G13VdF5/zGqCqakdV1TpjbMOyrJu6rt8NZTN3Kg5BGq9UKrH/tVwFz+xVHNWUEeKyMnhN4/EB9v68iycf/QL9k/9F/29sXAHnbKI+mvw0TTuuVqsdTdM0Ij7MVw4kkzgeJ53GzagNaDjoluA6F/OGxCSwPBsqsii9oxr2dj9Az/qXuI8xjtXVKnx/0GBFUVAqlfbpXaqqkhsenwAH5KesemJBVo8bnPv1Pl7WRi2nFhkuX8vh6ntV6F8vorLBwXIMPGiMJAOHf/8IXvdU3L+2tgHOPbdSqZzROxhjsya9Kk2mcrB0S4RSqTRxW6vbx1lXAuNKZO3Lbyl442tEsovawQG8XhuXVnxsfoUhV7roCd910Xz0SVTX5bUrzLZbqwnpCPJbScmrqjp6wevjkVWDpl0SP0nbuaoLT2rDenKIk5fnaJ61cfD0EHuPD9Hr2bik9cG1iwa097+E3zsTzxcLZXS6jUg+c7CVijxpcYR75xXUYglM4QMymgxJsdHtuFALeVGUoga1qIHlFJweteBJQEXzEI4BmQP9w3uivny+IIjbdjsR+YVica/5HGouL4iQ1RmRyqmQJEloGiOfEiABtY6DVb8Ltq4NnlFkeG1rpN6e3UYuNynRpZL3e6dgTInIK5oEWVUHRGWIz7BAHjTElyWQP6IhIgfPSXIrqlNRcuj3e4nen528N4hLJC4JL8JU+pTFd0GYBYSZFP0m8uK6S7LhEXlZuRhLIXHH6YHz3GsiH4CVVHDSrkqFGjAgGFfk8Np5G3JRCYjTOEkXGwV4KgeZrEQYiQLlweBtHJ5GnkNWOeQcDV4FTBsUTqWgQCmq4EUVKpchVbXRyav0tqir1W6kIs+DFFwi9Hq9EY8jqRW0jo7hem9ByRUG1lcGPSBzCZIigTFZSEsm0ooE+bAL/vb60L3UmO+L+rrdRF5mxPIz84YUddq23Wk2m68ODg5G/pO0QahhfbF3Yf3coAdI0zzPwTQuLB9aX3nnyuDeXBAuVL4Z1Xdy8ir6Pk/vpBhZ1/VY8iSRVqu1TxmxTqejua67QdeGoz9W3gLXiqi/OMTxYyvy3TQGBuQG5EUpBCWSC1m+AKy8L+o6Pz+OBit5sDmo6br+MIywKOkJ13WJ6HG9Xj+jJZvjOBPxBa2APC+YAWUFlSDQ2/vnlzg0n0exC4usO/5bhsxojvCAtd+IZ13PxeHRha/PqXMHsFjPyoGV/1av1xvNZpMksub7/tT4gqw/Ip+DY6xvf0N8fXzvv3j0l3+j/vJsLJq8sLZ33EbtHyfwN/8AsMGa4MWLJ5HVJUmGmpC8WEkF+fVUKylaytFC4j+//DF4RYWtcTTqLUgyBVxtVDYLuPTVMtQ8x+pmGV7HQfe5h75zDes/+X1UzwvriZBMiHy+DC0fv14IsKfr+haGF+CmadKq/LdJySOI7d988w0Rj6cFSYUs3micRU+S1ivlK/NquqPr+u1x8qmtD+EVmFhIUDyeFGRp0vhwGEDEy6U1IZsZENkDXdfPMZ4xM02TWvRBWitSJOi4Hayvb4iwtlKZXJjTBER+nNzheOySkDjh57qu74Y/JtJ9pmk+zZh4QrfbQM9ujWw20JKxVCrG3k9kc7niPI2HeKDr+sjCKU6slEm4l4U8DTYiY9sd2P0OXLcv3CqFyMMNIkuTOySvksDaIW6NX4jNEpumSV3zsywNGIfj2CIDoKqKyGcmmDnjEA3SYUxr9q1gcCwMzincldeIdEbie8GG2wRiyQe5wIluyooF96x2Qu+SiHzQAJLOg2U1wPO8LHtXn06LvZBgQ23mnlAa2LaddsVRm/f+meSDnYg7yyDvOE7SfEyI29PkEiLRPuyzZ8++8Dyv4DjONYo8o6gyJSjnGJO6i8OET49DoqCEc/4r8v1h0sn3/TPauu/3+yXXdVcdx0nUCsdxjjnnSfauEjmLNNv3M32/53l7juNwx3E2p/UOpakp2zvnVbE+PQ5pzx4kDtyod1zXpd5Zc12XVmIiVJizG0I+/cY8rYdIdeoj7f7sGDqu6x77vl+WJGmFMs4x+N4s17gQ+aAB9zOerxFwXXe/2WyS7juMsWNFUUqc81XGGPn0xJscyJh02smyaxiCMRbu2ZKUrpKcKP2Ty+VSLYSQ5NTHOHRdX9T30/bM+LU/bm9v76WtaJFjWgvE/d2zXq8XTloPDMNIvMExjEWOa2QOHRRFaQ79zBwAZiYfeIVPEtw6gSHd30lyomkaFj0okzXuJ92/nBanJ8VC5IPJJFO3K4ryu6xHEkMs5VBoBt+f2qfHYVnnq9IM3rlxelIshXxK3z83Tk+KpcgmRALfnyhOT4plH8ubJ4elLeqxbPJzfD/F6Zl9ehxex4HION//+aI+PQ5L1XyIoUPTJKPdpCujVADwf71/nn3KsFA6AAAAAElFTkSuQmCC",FL="/assets/dish-logo-46c2f269.svg",OL="/assets/api-66463fbe.jpg",UL="/assets/web-ea09f186.jpg",VL="/assets/mobile-70705586.jpg",zm=[{title:"Cocus",logo:RL,marker:LL,description:"COCUS is a dynamic and innovative IT service provider with over 20 years of experience in digital transformation. They offer customized software solutions and are dedicated to helping their customers succeed in the ever-evolving digital landscape. With a team of over 250 employees from 19 different nationalities, COCUS combines pragmatism, flexibility, and creativity to deliver scalable and high-quality IT solutions. Their passion for IT, coupled with their agile approach and extensive project portfolio, makes them a trusted partner for businesses seeking individualized and future-oriented digital solutions.",coordinates:{latitude:39.16485037687972,longitude:-8.782462925436924},countries:["UK","PT","DE"]},{title:"Dish",logo:FL,marker:BL,description:"DISH has been supporting over 260,000 hospitality businesses in 16 countries, helping them thrive online. With easy-to-use digital solutions, restaurants attract more guests, streamline operations, and increase profitability. As part of Hospitality Digital, DISH understands the challenges faced by restaurateurs and offers tools for fast online ordering, reservations, menu profitability analysis, improved search rankings, and expanded online presence. With DISH, restaurants stay competitive in an evolving industry.",coordinates:{latitude:50.48165688469991,longitude:9.919781086957617},countries:["AT","BE","CZ","DE","ES","FR","HR","HU","IT","NL","PL","PT","RO","SK","TR","UA"]},{title:"TUI",logo:zL,marker:DL,description:"TUI is a leading travel brand with a commitment to providing personal service and unforgettable holiday experiences. They offer handpicked hotels, tailor-made tours, ocean and river cruises, and flights on their state-of-the-art aircraft. TUI prioritizes sustainability and actively works to protect the environment, support local communities, and reduce carbon emissions. With a strong presence in the UK and Ireland, as well as across the globe, TUI is dedicated to delivering exceptional holidays while promoting responsible travel practices. TUI is a leading travel brand with a commitment to providing personal service and unforgettable holiday experiences. They offer handpicked hotels, tailor-made tours, ocean and river cruises, and flights on their state-of-the-art aircraft.",coordinates:{latitude:51.5074,longitude:.1278},countries:["AD","AL","AT","AX","BA","BE","CH","CZ","DE","DK","EE","ES","FI","FO","FR","GB","GG","GL","GR","HR","HU","IE","IM","IS","IT","JE","LI","LT","LU","LV","ME","MK","NL","NO","PL","PT","SE","SI","SK","VA"]}],u2=[{short:"Web",pitch:"Transforming Ideas into Dynamic Websites",title:"Web Development",description:"We specialize in delivering high-quality web development solutions that cater to your unique business needs. With our expertise in cutting-edge technologies and attention to detail, we bring your vision to life on the digital landscape.",image:UL,list:["Custom Website Development","Responsive Design","E-commerce Solutions","Content Management Systems"]},{short:"Mobile",pitch:"Building Innovative and User-Friendly Mobile Experiences",title:"Mobile Development",description:"We specialize in crafting engaging and high-performance mobile applications that captivate users and drive business growth. With our expertise in mobile technologies and user-centric design, we create intuitive and visually stunning apps for iOS and Android platforms.",image:VL,list:["Custom Mobile App Development","User Interface (UI) and User Experience (UX) Design","Cross-Platform App Development","App Testing and Quality Assurance"]},{short:"Api",pitch:"Powering Seamless Integration and Collaboration",title:"API Development",description:"Unlock the true potential of your digital ecosystem with our comprehensive API development services. We specialize in creating secure and scalable APIs that facilitate seamless communication and data exchange between different software systems.",image:OL,list:["Custom API Development","Integration Solutions","API Documentation and Testing","Third-Party API Integration"]}],NL=[{author:"Da Vinci",comment:"Splendiferous's project management software, SwiftFlow, keeps everything organized and on track. It's like having a personal assistant who never lets you miss a deadline!"},{author:"Tony Stark",comment:"As an aspiring game developer, Splendiferous's game engine, SpectraForge, is my secret weapon. It's versatile, powerful, and takes my game ideas to the next level!"},{author:"Lara Croft",comment:"Splendiferous's debugging tool, EnigmaTracker, is an absolute lifesaver. It unravels the mysteries of bugs and guides you straight to the solution. Trust me, I've solved plenty!"},{author:"Sherlock Holmes",comment:"Splendiferous's code editor is like having a wizard's wand in your hands. It magically detects errors and suggests solutions, making coding a breeze!"},{author:"Hermione Granger",comment:"Splendiferous's collaboration tool, Syncode, has revolutionized the way my team works. Real-time code sharing and seamless collaboration have made our development process a true masterpiece!"},{author:"Alice",comment:"Splendiferous's UI design tool, ArtisanUI, is a dream come true for designers. It offers a wide range of intuitive features and helps bring ideas to life!"},{author:"Bob",comment:"Splendiferous's documentation tool, DocuVerse, is an invaluable resource. It provides comprehensive documentation and makes it easy to keep track of updates."},{author:"Eve",comment:"Splendiferous's performance optimization tool, VelocityBoost, significantly improved my application's speed and responsiveness. It's a game-changer!"},{author:"Max",comment:"Splendiferous's version control system, CodeSafe, ensures the safety and integrity of my codebase. I can confidently collaborate and revert changes when needed."},{author:"Olivia",comment:"Splendiferous's testing framework, TestCrafter, has saved me countless hours of manual testing. It automates the process and helps catch bugs early on."},{author:"Charlie",comment:"Splendiferous's mobile app builder, AppWizard, made it a breeze to develop and deploy my mobile application. The intuitive interface and pre-built components were a time-saver!"}];function Jg(){const[t,i]=De.useState(!1),[l,d]=De.useState("/"),g=Qu();return De.useEffect(()=>{d(g.pathname)},[g]),qe.jsxs(qe.Fragment,{children:[qe.jsx("div",{id:"menu",className:t?"active":"",children:qe.jsxs("ul",{children:[qe.jsx("li",{className:l==="/"?"menu-link active":"menu-link",children:qe.jsx(Jl,{to:"/",children:"Home"})}),qe.jsx("li",{className:l==="/partners"?"menu-link active":"menu-link",children:qe.jsx(Jl,{to:"/partners",children:"Partners"})}),qe.jsx("li",{className:l==="/services"?"menu-link active":"menu-link",children:qe.jsx(Jl,{to:"/services",children:"Services"})}),qe.jsx("li",{className:l==="/about"?"menu-link active":"menu-link",children:qe.jsx(Jl,{to:"/about",children:"About"})}),qe.jsx("li",{className:l==="/contacts"?"menu-link active":"menu-link"})]})}),qe.jsxs("nav",{children:[qe.jsx("h1",{className:"site-title",children:"Splendiferous"}),qe.jsx("div",{id:"menu-btm",className:t?"hamburger d-flex active":"hamburger d-flex",onClick:()=>i(!t),children:qe.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"70",height:"70",viewBox:"0 0 200 200",children:qe.jsxs("g",{"stroke-width":"6.5","stroke-linecap":"round",children:[qe.jsx("path",{d:"M72 82.286h28.75",fill:"#009100","fill-rule":"evenodd",stroke:"#fff"}),qe.jsx("path",{d:"M100.75 103.714l72.482-.143c.043 39.398-32.284 71.434-72.16 71.434-39.878 0-72.204-32.036-72.204-71.554",fill:"none",stroke:"#fff"}),qe.jsx("path",{d:"M72 125.143h28.75",fill:"#009100","fill-rule":"evenodd",stroke:"#fff"}),qe.jsx("path",{d:"M100.75 103.714l-71.908-.143c.026-39.638 32.352-71.674 72.23-71.674 39.876 0 72.203 32.036 72.203 71.554",fill:"none",stroke:"#fff"}),qe.jsx("path",{d:"M100.75 82.286h28.75",fill:"#009100","fill-rule":"evenodd",stroke:"#fff"}),qe.jsx("path",{d:"M100.75 125.143h28.75",fill:"#009100","fill-rule":"evenodd",stroke:"#fff"})]})})})]})]})}function jL(){return qe.jsxs(qe.Fragment,{children:[qe.jsx(Jg,{}),qe.jsx("main",{children:qe.jsxs("section",{className:"row about-section",children:[qe.jsxs("div",{className:"col about-us",children:[qe.jsxs("div",{className:"contacts",children:[qe.jsx("a",{href:"mailto:Dias.PedroRibeiro@gmail.com",target:"_blank",children:qe.jsx("h2",{children:"Talk With Us"})}),qe.jsxs("span",{className:"socials",children:[qe.jsx("i",{className:"fa-brands fa-facebook-f"}),qe.jsx("i",{className:"fa-brands fa-linkedin-in"}),qe.jsx("i",{className:"fa-brands fa-whatsapp"}),qe.jsx("i",{className:"fa-brands fa-twitter"}),qe.jsx("i",{className:"fa-regular fa-envelope"})]})]}),qe.jsx("div",{className:"aboutus-text",children:"Splendiferous, a dynamic startup hailing from Porto, thrives on cutting-edge technology to craft unparalleled products. With an unwavering commitment to innovation, they redefine excellence, delivering nothing but the best to their clientele. Born to revolutionize the industry, Splendiferous shines as a beacon of ingenuity, raising the bar for tech-driven solutions worldwide."}),qe.jsxs("div",{className:"copy",children:[qe.jsx("h1",{className:"site-title",children:"Splendiferous"}),qe.jsx("span",{children:"@Copy 2023"})]})]}),qe.jsx("div",{className:"col testimonies",children:qe.jsxs("div",{className:"phone-frame",children:[qe.jsx("div",{className:"phone-cam",children:qe.jsx("div",{className:"phone-cam-dot"})}),qe.jsx("div",{className:"phone-screen",children:NL.map((t,i)=>qe.jsxs("blockquote",{className:i%2==0?"chat-bubble tl":"chat-bubble tr",children:[qe.jsx("p",{children:t.comment}),qe.jsx("em",{children:t.author})]}))})]})})]})})]})}function GL(){return qe.jsxs(qe.Fragment,{children:[qe.jsx(Jg,{}),qe.jsxs("header",{children:[qe.jsx("div",{className:"arrow arrow--top",children:qe.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"270.11",height:"649.9",overflow:"visible",children:[qe.jsx("g",{className:"item-to bounce-1",children:qe.jsx("path",{className:"geo-arrow draw-in",d:"M135.06 142.564L267.995 275.5 135.06 408.434 2.125 275.499z"})}),qe.jsx("circle",{className:"geo-arrow item-to bounce-2",cx:"194.65",cy:"69.54",r:"7.96"}),qe.jsx("circle",{className:"geo-arrow draw-in",cx:"194.65",cy:"39.5",r:"7.96"}),qe.jsx("circle",{className:"geo-arrow item-to bounce-3",cx:"194.65",cy:"9.46",r:"7.96"}),qe.jsx("g",{className:"geo-arrow item-to bounce-2",children:qe.jsx("path",{className:"st0 draw-in",d:"M181.21 619.5l13.27 27 13.27-27zM194.48 644.5v-552"})})]})}),qe.jsx("div",{className:"arrow arrow--bottom",children:qe.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"31.35",height:"649.9",overflow:"visible",children:qe.jsxs("g",{className:"item-to bounce-1",children:[qe.jsx("circle",{className:"geo-arrow item-to bounce-3",cx:"15.5",cy:"580.36",r:"7.96"}),qe.jsx("circle",{className:"geo-arrow draw-in",cx:"15.5",cy:"610.4",r:"7.96"}),qe.jsx("circle",{className:"geo-arrow item-to bounce-2",cx:"15.5",cy:"640.44",r:"7.96"}),qe.jsx("g",{className:"item-to bounce-2",children:qe.jsx("path",{className:"geo-arrow draw-in",d:"M28.94 30.4l-13.26-27-13.27 27zM15.68 5.4v552"})})]})})}),qe.jsx(Jl,{to:"/partners",children:qe.jsx("div",{className:"main",children:qe.jsxs("div",{className:"main__text-wrapper",children:[qe.jsx("h1",{className:"main__title typewriter",children:"UI/UX Design"}),qe.jsx("h1",{className:"main__title typewriter",children:"Software Development"}),qe.jsx("h2",{className:"btn-header",children:"Get to know us"}),qe.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"dotted-circle",width:"352",height:"352",overflow:"visible",children:qe.jsx("circle",{cx:"176",cy:"176",r:"174",fill:"none",stroke:"#fff",strokeWidth:"2",strokeMiterlimit:"10",strokeDasharray:"12.921,11.9271"})})]})})})]})]})}var VC={exports:{}};(function(t,i){(function(l,d){t.exports=d()})(VI,function(){var l,d,g;function w(s,A){if(!l)l=A;else if(!d)d=A;else{var z="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+d+")(sharedChunk); self.onerror = null;",V={};l(V),g=A(V),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(g.workerUrl=window.URL.createObjectURL(new Blob([z],{type:"text/javascript"})))}}w(["exports"],function(s){var A=typeof self<"u"?self:{},z="2.15.0";let V;const j={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(V==null){const n=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{V={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):n}catch{V=n}}return V},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!j.API_URL)return null;try{const n=new URL(j.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},G={supported:!1,testSupport:function(n){!ve&&he&&(Ue?ae(n):re=n)}};let re,he,ve=!1,Ue=!1;function ae(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,he),n.isContextLost())return;G.supported=!0}catch{}n.deleteTexture(e),ve=!0}A.document&&(he=A.document.createElement("img"),he.onload=function(){re&&ae(re),re=null,Ue=!0},he.onerror=function(){ve=!0,re=null},he.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const J="01";function se(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var oe=Be;function Be(n,e,r,a){this.cx=3*n,this.bx=3*(r-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=e,this.p2x=r,this.p2y=a}Be.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,e){if(e===void 0&&(e=1e-6),n<0)return 0;if(n>1)return 1;for(var r=n,a=0;a<8;a++){var u=this.sampleCurveX(r)-n;if(Math.abs(u)<e)return r;var f=this.sampleCurveDerivativeX(r);if(Math.abs(f)<1e-6)break;r-=u/f}var m=0,y=1;for(r=n,a=0;a<20&&(u=this.sampleCurveX(r),!(Math.abs(u-n)<e));a++)n>u?m=r:y=r,r=.5*(y-m)+m;return r},solve:function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))}};var at=se(oe),Ye=He;function He(n,e){this.x=n,this.y=e}He.prototype={clone:function(){return new He(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,r=n.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),r=Math.sin(n),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(n,e){var r=Math.cos(n),a=Math.sin(n),u=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},He.convert=function(n){return n instanceof He?n:Array.isArray(n)?new He(n[0],n[1]):n};var ze=se(Ye);const kt=Math.PI/180,dn=180/Math.PI;function gt(n){return n*kt}function Jt(n){return n*dn}const Sn=[[0,0],[1,0],[1,1],[0,1]];function un(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,r=e*n;return 4*(n<.5?r:3*(n-e)+r-.75)}function Bn(n,e,r,a){const u=new at(n,e,r,a);return function(f){return u.solve(f)}}const Xn=Bn(.25,.1,.25,1);function Xe(n,e,r){return Math.min(r,Math.max(e,n))}function Mt(n,e,r){return(r=Xe((r-n)/(e-n),0,1))*r*(3-2*r)}function Tt(n,e,r){const a=r-e,u=((n-e)%a+a)%a+e;return u===e?r:u}function wt(n,e,r){if(!n.length)return r(null,[]);let a=n.length;const u=new Array(n.length);let f=null;n.forEach((m,y)=>{e(m,(x,b)=>{x&&(f=x),u[y]=b,--a==0&&r(f,u)})})}function nn(n){const e=[];for(const r in n)e.push(n[r]);return e}function fn(n,...e){for(const r of e)for(const a in r)n[a]=r[a];return n}let Qt=1;function mi(){return Qt++}function Un(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function gi(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function ji(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function cr(n,e){n.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function ur(n,e){return n.indexOf(e,n.length-e.length)!==-1}function Lt(n,e,r){const a={};for(const u in n)a[u]=e.call(r||this,n[u],u,n);return a}function Rr(n,e,r){const a={};for(const u in n)e.call(r||this,n[u],u,n)&&(a[u]=n[u]);return a}function yi(n){return Array.isArray(n)?n.map(yi):typeof n=="object"&&n?Lt(n,yi):n}const _s={};function pn(n){_s[n]||(typeof console<"u"&&console.warn(n),_s[n]=!0)}function Gi(n,e,r){return(r.y-n.y)*(e.x-n.x)>(e.y-n.y)*(r.x-n.x)}function Wo(n){let e=0;for(let r,a,u=0,f=n.length,m=f-1;u<f;m=u++)r=n[u],a=n[m],e+=(a.x-r.x)*(r.y+a.y);return e}function Hi(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Mi(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,u,f)=>{const m=u||f;return e[a]=!m||m.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Ki=null;function go(n){if(Ki==null){const e=n.navigator?n.navigator.userAgent:null;Ki=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ki}function Xo(n){try{const e=A[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Br(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}const Ho="mapbox-tiles";let ys=500,_o=50,$i,vr;function vs(){try{return A.caches}catch{}}function Kr(){vs()&&!$i&&($i=A.caches.open(Ho))}function Ko(n){const e=n.indexOf("?");if(e<0)return n;const r=function(u){const f=u.indexOf("?");return f>0?u.slice(f+1).split("&"):[]}(n),a=r.filter(u=>{const f=u.split("=");return f[0]==="language"||f[0]==="worldview"});return a.length?`${n.slice(0,e)}?${a.join("&")}`:n.slice(0,e)}let Yo=1/0;const yo={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(yo);class Le extends Error{constructor(e,r,a){r===401&&Te(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ve=Hi()?()=>self.worker&&self.worker.referrer:()=>(A.location.protocol==="blob:"?A.parent:A).location.href,ot=function(n,e){if(!(/^file:/.test(r=n.url)||/^file:/.test(Ve())&&!/^\w+:/.test(r))){if(A.fetch&&A.Request&&A.AbortController&&A.Request.prototype.hasOwnProperty("signal"))return function(a,u){const f=new A.AbortController,m=new A.Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Ve(),referrerPolicy:a.referrerPolicy,signal:f.signal});let y=!1,x=!1;const b=(C=m.url).indexOf("sku=")>0&&Te(C);var C;a.type==="json"&&m.headers.set("Accept","application/json");const P=(L,R,O)=>{if(x)return;if(L&&L.message!=="SecurityError"&&pn(L.toString()),R&&O)return I(R);const Z=Date.now();A.fetch(m).then(Q=>{if(Q.ok){const ue=b?Q.clone():null;return I(Q,ue,Z)}return u(new Le(Q.statusText,Q.status,a.url))}).catch(Q=>{Q.name!=="AbortError"&&u(new Error(`${Q.message} ${a.url}`))})},I=(L,R,O)=>{(a.type==="arrayBuffer"?L.arrayBuffer():a.type==="json"?L.json():L.text()).then(Z=>{x||(R&&O&&function(Q,ue,te){if(Kr(),!$i)return;const le={status:ue.status,statusText:ue.statusText,headers:new A.Headers};ue.headers.forEach((Pe,Se)=>le.headers.set(Se,Pe));const pe=Mi(ue.headers.get("Cache-Control")||"");if(pe["no-store"])return;pe["max-age"]&&le.headers.set("Expires",new Date(te+1e3*pe["max-age"]).toUTCString());const fe=le.headers.get("Expires");fe&&(new Date(fe).getTime()-te<42e4||function(Pe,Se){if(vr===void 0)try{new Response(new ReadableStream),vr=!0}catch{vr=!1}vr?Se(Pe.body):Pe.blob().then(Se)}(ue,Pe=>{const Se=new A.Response(Pe,le);Kr(),$i&&$i.then(Oe=>Oe.put(Ko(Q.url),Se)).catch(Oe=>pn(Oe.message))}))}(m,R,O),y=!0,u(null,Z,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(Z=>{x||u(new Error(Z.message))})};return b?function(L,R){if(Kr(),!$i)return R(null);const O=Ko(L.url);$i.then(Z=>{Z.match(O).then(Q=>{const ue=function(te){if(!te)return!1;const le=new Date(te.headers.get("Expires")||0),pe=Mi(te.headers.get("Cache-Control")||"");return le>Date.now()&&!pe["no-cache"]}(Q);Z.delete(O),ue&&Z.put(O,Q.clone()),R(null,Q,ue)}).catch(R)}).catch(R)}(m,P):P(null,null),{cancel:()=>{x=!0,y||f.abort()}}}(n,e);if(Hi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var r;return function(a,u){const f=new A.XMLHttpRequest;f.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const m in a.headers)f.setRequestHeader(m,a.headers[m]);return a.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=a.credentials==="include",f.onerror=()=>{u(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let m=f.response;if(a.type==="json")try{m=JSON.parse(f.response)}catch(y){return u(y)}u(null,m,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else u(new Le(f.statusText,f.status,a.url))},f.send(a.body),{cancel:()=>f.abort()}}(n,e)},vt=function(n,e){return ot(fn(n,{type:"arrayBuffer"}),e)};function Ut(n){const e=A.document.createElement("a");return e.href=n,e.protocol===A.document.location.protocol&&e.host===A.document.location.host}const ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let U,N;U=[],N=0;const X=function(n,e){if(G.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),N>=j.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return U.push(f),f}N++;let r=!1;const a=()=>{if(!r)for(r=!0,N--;U.length&&N<j.MAX_PARALLEL_IMAGE_REQUESTS;){const f=U.shift(),{requestParameters:m,callback:y,cancelled:x}=f;x||(f.cancel=X(m,y).cancel)}},u=vt(n,(f,m,y,x)=>{a(),f?e(f):m&&(A.createImageBitmap?function(b,C){const P=new A.Blob([new Uint8Array(b)],{type:"image/png"});A.createImageBitmap(P).then(I=>{C(null,I)}).catch(I=>{C(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(b,C)=>e(b,C,y,x)):function(b,C){const P=new A.Image,I=A.URL;P.onload=()=>{C(null,P),I.revokeObjectURL(P.src),P.onload=null,A.requestAnimationFrame(()=>{P.src=ee})},P.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new A.Blob([new Uint8Array(b)],{type:"image/png"});P.src=b.byteLength?I.createObjectURL(L):ee}(m,(b,C)=>e(b,C,y,x)))});return{cancel:()=>{u.cancel(),a()}}},ce="NO_ACCESS_TOKEN";function de(n){return n.indexOf("mapbox:")===0}function Te(n){return j.API_URL_REGEX.test(n)}function we(n){return j.API_CDN_URL_REGEX.test(n)}function _e(n){return j.API_STYLE_REGEX.test(n)&&!Ce(n)}function Ce(n){return j.API_SPRITE_REGEX.test(n)}const nt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function lt(n){const e=n.match(nt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Je(n){const e=n.params.length?`?${n.params.join("&")}`:"";return`${n.protocol}://${n.authority}${n.path}${e}`}const It="mapbox.eventData";function Rt(n){if(!n)return null;const e=n.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(A.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Dt{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=Rt(j.ACCESS_TOKEN);let a="";return a=r&&r.u?A.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(u,f)=>String.fromCharCode(+("0x"+f)))):j.ACCESS_TOKEN||"",e?`${It}.${e}:${a}`:`${It}:${a}`}fetchEventData(){const e=Xo("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{const u=A.localStorage.getItem(r);u&&(this.eventData=JSON.parse(u));const f=A.localStorage.getItem(a);f&&(this.anonId=f)}catch{pn("Unable to read from LocalStorage")}}saveEventData(){const e=Xo("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{A.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&A.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{pn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,a,u){if(!j.EVENTS_URL)return;const f=lt(j.EVENTS_URL);f.params.push(`access_token=${u||j.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(e).toISOString()},y=r?fn(m,r):m,x={url:Je(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=function(b,C){return ot(fn(b,{method:"POST"}),C)}(x,b=>{this.pendingRequest=null,a(b),this.saveEventData(),this.processRequests(u)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const Vt=new class extends Dt{constructor(n){super("appUserTurnstile"),this._customAccessToken=n}postTurnstileEvent(n,e){j.EVENTS_URL&&j.ACCESS_TOKEN&&Array.isArray(n)&&n.some(r=>de(r)||Te(r))&&this.queueRequest(Date.now(),e)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Rt(j.ACCESS_TOKEN),r=e?e.u:j.ACCESS_TOKEN;let a=r!==this.eventData.tokenU;ji(this.anonId)||(this.anonId=Un(),a=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),m=new Date(u),y=(u-this.eventData.lastSuccess)/864e5;a=a||y>=1||y<-1||f.getDate()!==m.getDate()}else a=!0;a?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:z,skuId:J,"enabled.telemetry":!1,userId:this.anonId},f=>{f||(this.eventData.lastSuccess=u,this.eventData.tokenU=r)},n):this.processRequests()}},Zt=Vt.postTurnstileEvent.bind(Vt),gn=new class extends Dt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(n,e,r,a){this.skuToken=e,this.errorCb=a,j.EVENTS_URL&&(r||j.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},r):this.errorCb(new Error(ce)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),ji(this.anonId)||(this.anonId=Un()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:z,skuId:J,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},n))}},$t=gn.postMapLoadEvent.bind(gn),Cn=new class extends Dt{constructor(){super("gljs.performance")}postPerformanceEvent(n,e){j.EVENTS_URL&&(n||j.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},n)}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:r}=this.queue.shift(),a=function(u){const f=A.performance.getEntriesByType("resource"),m=A.performance.getEntriesByType("mark"),y=function(I){const L={};if(I){for(const R in I)if(R!=="other")for(const O of I[R]){const Z=`${R}ResolveRangeMin`,Q=`${R}ResolveRangeMax`,ue=`${R}RequestCount`,te=`${R}RequestCachedCount`;L[Z]=Math.min(L[Z]||1/0,O.startTime),L[Q]=Math.max(L[Q]||-1/0,O.responseEnd);const le=pe=>{L[pe]===void 0&&(L[pe]=0),++L[pe]};O.transferSize!==void 0&&O.transferSize===0&&le(te),le(ue)}}return L}(function(I,L){const R={};if(I)for(const O of I){const Z=L(O);R[Z]===void 0&&(R[Z]=[]),R[Z].push(O)}return R}(f,$f)),x=A.devicePixelRatio,b=A.navigator.connection||A.navigator.mozConnection||A.navigator.webkitConnection,C={counters:[],metadata:[],attributes:[]},P=(I,L,R)=>{R!=null&&I.push({name:L,value:R.toString()})};for(const I in y)P(C.counters,I,y[I]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(P(C.counters,"interactionRangeMin",u.interactionRange[0]),P(C.counters,"interactionRangeMax",u.interactionRange[1])),m)for(const I of Object.keys(Jo)){const L=Jo[I],R=m.find(O=>O.name===L);R&&P(C.counters,L,R.startTime)}return P(C.counters,"visibilityHidden",u.visibilityHidden),P(C.attributes,"style",function(I){if(I)for(const L of I){const R=L.name.split("?")[0];if(_e(R)){const O=R.split("/").slice(-2);if(O.length===2)return`mapbox://styles/${O[0]}/${O[1]}`}}}(f)),P(C.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),P(C.attributes,"fogEnabled",u.fogEnabled?"true":"false"),P(C.attributes,"projection",u.projection),P(C.attributes,"zoom",u.zoom),P(C.metadata,"devicePixelRatio",x),P(C.metadata,"connectionEffectiveType",b?b.effectiveType:void 0),P(C.metadata,"navigatorUserAgent",A.navigator.userAgent),P(C.metadata,"screenWidth",A.screen.width),P(C.metadata,"screenHeight",A.screen.height),P(C.metadata,"windowWidth",A.innerWidth),P(C.metadata,"windowHeight",A.innerHeight),P(C.metadata,"mapWidth",u.width/x),P(C.metadata,"mapHeight",u.height/x),P(C.metadata,"webglRenderer",u.renderer),P(C.metadata,"webglVendor",u.vendor),P(C.metadata,"sdkVersion",z),P(C.metadata,"sdkIdentifier","mapbox-gl-js"),C}(r);for(const u of a.metadata);for(const u of a.counters);for(const u of a.attributes);this.postEvent(e,a,()=>{},n)}},zn=Cn.postPerformanceEvent.bind(Cn),kn=new class extends Dt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(n,e,r,a){if(!j.API_URL||!j.SESSION_PATH)return;const u=lt(j.API_URL+j.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${a||j.ACCESS_TOKEN||""}`);const f={url:Je(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(m,y){return ot(fn(m,{method:"GET"}),y)}(f,m=>{this.pendingRequest=null,r(m),this.saveEventData(),this.processRequests(a)})}getSessionAPI(n,e,r,a){this.skuToken=e,this.errorCb=a,j.SESSION_PATH&&j.API_URL&&(r||j.ACCESS_TOKEN?this.queueRequest({id:n,timestamp:Date.now()},r):this.errorCb(new Error(ce)))}processRequests(n){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},n)}},Nn=kn.getSessionAPI.bind(kn),vi=new Set,Jo={create:"create",load:"load",fullLoad:"fullLoad"},l_={mark(n){A.performance.mark(n)},measure(n,e,r){A.performance.measure(n,e,r)}};function $f(n){const e=n.name.split("?")[0];return we(e)&&e.includes("mapbox-gl.js")?"javascript":we(e)&&e.includes("mapbox-gl.css")?"css":function(r){return j.API_FONTS_REGEX.test(r)}(e)?"fontRange":Ce(e)?"sprite":_e(e)?"style":function(r){return j.API_TILEJSON_REGEX.test(r)}(e)?"tilejson":"other"}const an=A.performance;function eh(n){const e=n?n.url.toString():void 0;return an.getEntriesByName(e)}let nl,th,pc,Yr;const vo={now:()=>pc!==void 0?pc:A.performance.now(),setNow(n){pc=n},restoreNow(){pc=void 0},frame(n){const e=A.requestAnimationFrame(n);return{cancel:()=>A.cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:r,height:a}=n;Yr||(Yr=A.document.createElement("canvas"));const u=Yr.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(r>Yr.width||a>Yr.height)&&(Yr.width=r,Yr.height=a),u.clearRect(-e,-e,r+2*e,a+2*e),u.drawImage(n,0,0,r,a),u.getImageData(-e,-e,r+2*e,a+2*e)},resolveURL:n=>(nl||(nl=A.document.createElement("a")),nl.href=n,nl.href),get devicePixelRatio(){return A.devicePixelRatio},get prefersReducedMotion(){return!!A.matchMedia&&(th==null&&(th=A.matchMedia("(prefers-reduced-motion: reduce)")),th.matches)}};function nh(n,e,r){r[n]&&r[n].indexOf(e)!==-1||(r[n]=r[n]||[],r[n].push(e))}function ih(n,e,r){if(r&&r[n]){const a=r[n].indexOf(e);a!==-1&&r[n].splice(a,1)}}class xs{constructor(e,r={}){fn(this,r),this.type=e}}class xo extends xs{constructor(e,r={}){super("error",fn({error:e},r))}}class il{on(e,r){return this._listeners=this._listeners||{},nh(e,r,this._listeners),this}off(e,r){return ih(e,r,this._listeners),ih(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},nh(e,r,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,r){typeof e=="string"&&(e=new xs(e,r||{}));const a=e.type;if(this.listens(a)){e.target=this;const u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of u)y.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of f)ih(a,y,this._oneTimeListeners),y.call(this,e);const m=this._eventedParent;m&&(fn(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof xo&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var Fe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function wo(n,...e){for(const r of e)for(const a in r)n[a]=r[a];return n}function ei(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function xi(n){if(Array.isArray(n))return n.map(xi);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const r in n)e[r]=xi(n[r]);return e}return ei(n)}class Zf extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}var Jr=Zf;class rh{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,u]of r)this.bindings[a]=u}concat(e){return new rh(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var qf=rh;const ea={kind:"null"},ft={kind:"number"},Kt={kind:"string"},Wt={kind:"boolean"},hr={kind:"color"},Fr={kind:"object"},Xt={kind:"value"},dr={kind:"collator"},rl={kind:"formatted"},ws={kind:"resolvedImage"};function xr(n,e){return{kind:"array",itemType:n,N:e}}function Fn(n){if(n.kind==="array"){const e=Fn(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const Wf=[ea,ft,Kt,Wt,hr,rl,Fr,xr(Xt),ws];function bo(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!bo(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const r of Wf)if(!bo(r,e))return null}}return`Expected ${Fn(n)} but found ${Fn(e)} instead.`}function ol(n,e){return e.some(r=>r.kind===n.kind)}function sl(n,e){return e.some(r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n)}var oh,Xf={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function al(n){return(n=Math.round(n))<0?0:n>255?255:n}function ll(n){return al(n[n.length-1]==="%"?parseFloat(n)/100*255:parseInt(n))}function mc(n){return(e=n[n.length-1]==="%"?parseFloat(n)/100:parseFloat(n))<0?0:e>1?1:e;var e}function ta(n,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?n+(e-n)*r*6:2*r<1?e:3*r<2?n+(e-n)*(2/3-r)*6:n}try{oh={}.parseCSSColor=function(n){var e,r=n.replace(/ /g,"").toLowerCase();if(r in Xf)return Xf[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=r.indexOf("("),u=r.indexOf(")");if(a!==-1&&u+1===r.length){var f=r.substr(0,a),m=r.substr(a+1,u-(a+1)).split(","),y=1;switch(f){case"rgba":if(m.length!==4)return null;y=mc(m.pop());case"rgb":return m.length!==3?null:[ll(m[0]),ll(m[1]),ll(m[2]),y];case"hsla":if(m.length!==4)return null;y=mc(m.pop());case"hsl":if(m.length!==3)return null;var x=(parseFloat(m[0])%360+360)%360/360,b=mc(m[1]),C=mc(m[2]),P=C<=.5?C*(b+1):C+b-C*b,I=2*C-P;return[al(255*ta(I,P,x+1/3)),al(255*ta(I,P,x)),al(255*ta(I,P,x-1/3)),y];default:return null}}return null}}catch{}class Yi{constructor(e,r,a,u=1){this.r=e,this.g=r,this.b=a,this.a=u}static parse(e){if(!e)return;if(e instanceof Yi)return e;if(typeof e!="string")return;const r=oh(e);return r?new Yi(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,a,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(a)},${u})`}toArray(){const{r:e,g:r,b:a,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*r/u,255*a/u,u]}toArray01(){const{r:e,g:r,b:a,a:u}=this;return u===0?[0,0,0,0]:[e/u,r/u,a/u,u]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:a,a:u}=this;return[e,r,a,u]}}Yi.black=new Yi(0,0,0,1),Yi.white=new Yi(1,1,1,1),Yi.transparent=new Yi(0,0,0,0),Yi.red=new Yi(1,0,0,1),Yi.blue=new Yi(0,0,1,1);var Hn=Yi;class sh{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ah{constructor(e,r,a,u,f){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=a,this.fontStack=u,this.textColor=f}}class Ji{constructor(e){this.sections=e}static fromString(e){return new Ji([new ah(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Ji?e:Ji.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const a={};r.fontStack&&(a["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(a["font-scale"]=r.scale),r.textColor&&(a["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(a)}return e}}class wr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new wr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Hf(n,e,r,a){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[n,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[n,e,r,a]:[n,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function cl(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Hn||n instanceof sh||n instanceof Ji||n instanceof wr)return!0;if(Array.isArray(n)){for(const e of n)if(!cl(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!cl(n[e]))return!1;return!0}return!1}function $n(n){if(n===null)return ea;if(typeof n=="string")return Kt;if(typeof n=="boolean")return Wt;if(typeof n=="number")return ft;if(n instanceof Hn)return hr;if(n instanceof sh)return dr;if(n instanceof Ji)return rl;if(n instanceof wr)return ws;if(Array.isArray(n)){const e=n.length;let r;for(const a of n){const u=$n(a);if(r){if(r===u)continue;r=Xt;break}r=u}return xr(r||Xt,e)}return Fr}function ul(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Hn||n instanceof Ji||n instanceof wr?n.toString():JSON.stringify(n)}class lh{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!cl(e[1]))return r.error("invalid value");const a=e[1];let u=$n(a);const f=r.expectedType;return u.kind!=="array"||u.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(u=f),new lh(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Hn?["rgba"].concat(this.value.toArray()):this.value instanceof Ji?this.value.serialize():this.value}}var bs=lh,Pi=class{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}};const ch={string:Kt,number:ft,boolean:Wt,object:Fr};class uh{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,u=1;const f=e[0];if(f==="array"){let y,x;if(e.length>2){const b=e[1];if(typeof b!="string"||!(b in ch)||b==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=ch[b],u++}else y=Xt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);x=e[2],u++}a=xr(y,x)}else a=ch[f];const m=[];for(;u<e.length;u++){const y=r.parse(e[u],u,Xt);if(!y)return null;m.push(y)}return new uh(a,m)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!bo(this.type,$n(a)))return a;if(r===this.args.length-1)throw new Pi(`Expected value to be of type ${Fn(this.type)}, but found ${Fn($n(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){r.push(a.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&r.push(u)}}return r.concat(this.args.map(a=>a.serialize()))}}var To=uh;class Qo{constructor(e){this.type=rl,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const u=[];let f=!1;for(let m=1;m<=e.length-1;++m){const y=e[m];if(f&&typeof y=="object"&&!Array.isArray(y)){f=!1;let x=null;if(y["font-scale"]&&(x=r.parse(y["font-scale"],1,ft),!x))return null;let b=null;if(y["text-font"]&&(b=r.parse(y["text-font"],1,xr(Kt)),!b))return null;let C=null;if(y["text-color"]&&(C=r.parse(y["text-color"],1,hr),!C))return null;const P=u[u.length-1];P.scale=x,P.font=b,P.textColor=C}else{const x=r.parse(e[m],1,Xt);if(!x)return null;const b=x.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:x,scale:null,font:null,textColor:null})}}return new Qo(u)}evaluate(e){return new Ji(this.sections.map(r=>{const a=r.content.evaluate(e);return $n(a)===ws?new ah("",a,null,null,null):new ah(ul(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const a={};r.scale&&(a["font-scale"]=r.scale.serialize()),r.font&&(a["text-font"]=r.font.serialize()),r.textColor&&(a["text-color"]=r.textColor.serialize()),e.push(a)}return e}}class gc{constructor(e){this.type=ws,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const a=r.parse(e[1],1,Kt);return a?new gc(a):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),a=wr.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const c_={"to-boolean":Wt,"to-color":hr,"to-number":ft,"to-string":Kt};class hh{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0];if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");const u=c_[a],f=[];for(let m=1;m<e.length;m++){const y=r.parse(e[m],m,Xt);if(!y)return null;f.push(y)}return new hh(u,f)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,a;for(const u of this.args){if(r=u.evaluate(e),a=null,r instanceof Hn)return r;if(typeof r=="string"){const f=e.parseColor(r);if(f)return f}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Hf(r[0],r[1],r[2],r[3]),!a))return new Hn(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Pi(a||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new Pi(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Ji.fromString(ul(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?wr.fromString(ul(this.args[0].evaluate(e))):ul(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Qo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new gc(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}var na=hh;const Qr=["Unknown","Point","LineString","Polygon"];var dh=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Qr[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-n[0])+this.featureDistanceData.bearing[1]*(a*e-n[1])}return 0}parseColor(n){let e=this._parseColorCache[n];return e||(e=this._parseColorCache[n]=Hn.parse(n)),e}};class Ts{constructor(e,r,a,u){this.name=e,this.type=r,this._evaluate=a,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const a=e[0],u=Ts.definitions[a];if(!u)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=m.filter(([b])=>!Array.isArray(b)||b.length===e.length-1);let x=null;for(const[b,C]of y){x=new yh(r.registry,r.path,null,r.scope);const P=[];let I=!1;for(let L=1;L<e.length;L++){const R=e[L],O=Array.isArray(b)?b[L-1]:b.type,Z=x.parse(R,1+P.length,O);if(!Z){I=!0;break}P.push(Z)}if(!I)if(Array.isArray(b)&&b.length!==P.length)x.error(`Expected ${b.length} arguments, but found ${P.length} instead.`);else{for(let L=0;L<P.length;L++){const R=Array.isArray(b)?b[L]:b.type,O=P[L];x.concat(L+1).checkSubtype(R,O.type)}if(x.errors.length===0)return new Ts(a,f,C,P)}}if(y.length===1)r.errors.push(...x.errors);else{const b=(y.length?y:m).map(([P])=>{return I=P,Array.isArray(I)?`(${I.map(Fn).join(", ")})`:`(${Fn(I.type)}...)`;var I}).join(" | "),C=[];for(let P=1;P<e.length;P++){const I=r.parse(e[P],1+C.length);if(!I)return null;C.push(Fn(I.type))}r.error(`Expected arguments of type ${b}, but found (${C.join(", ")}) instead.`)}return null}static register(e,r){Ts.definitions=r;for(const a in r)e[a]=Ts}}var Eo=Ts;class hl{constructor(e,r,a){this.type=dr,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const u=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,Wt);if(!u)return null;const f=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,Wt);if(!f)return null;let m=null;return a.locale&&(m=r.parse(a.locale,1,Kt),!m)?null:new hl(u,f,m)}evaluate(e){return new sh(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const So=8192;function _c(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function ia(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function dl(n,e){const r=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(r*u*So),Math.round(a*u*So)]}function Kf(n,e,r){const a=n[0]-e[0],u=n[1]-e[1],f=n[0]-r[0],m=n[1]-r[1];return a*m-f*u==0&&a*f<=0&&u*m<=0}function yc(n,e){let r=!1;for(let m=0,y=e.length;m<y;m++){const x=e[m];for(let b=0,C=x.length;b<C-1;b++){if(Kf(n,x[b],x[b+1]))return!1;(u=x[b])[1]>(a=n)[1]!=(f=x[b+1])[1]>a[1]&&a[0]<(f[0]-u[0])*(a[1]-u[1])/(f[1]-u[1])+u[0]&&(r=!r)}}var a,u,f;return r}function fh(n,e){for(let r=0;r<e.length;r++)if(yc(n,e[r]))return!0;return!1}function ph(n,e,r,a){const u=a[0]-r[0],f=a[1]-r[1],m=(n[0]-r[0])*f-u*(n[1]-r[1]),y=(e[0]-r[0])*f-u*(e[1]-r[1]);return m>0&&y<0||m<0&&y>0}function ra(n,e,r){for(const b of r)for(let C=0;C<b.length-1;++C)if((y=[(m=b[C+1])[0]-(f=b[C])[0],m[1]-f[1]])[0]*(x=[(u=e)[0]-(a=n)[0],u[1]-a[1]])[1]-y[1]*x[0]!=0&&ph(a,u,f,m)&&ph(f,m,a,u))return!0;var a,u,f,m,y,x;return!1}function ln(n,e){for(let r=0;r<n.length;++r)if(!yc(n[r],e))return!1;for(let r=0;r<n.length-1;++r)if(ra(n[r],n[r+1],e))return!1;return!0}function u_(n,e){for(let r=0;r<e.length;r++)if(ln(n,e[r]))return!0;return!1}function mh(n,e,r){const a=[];for(let u=0;u<n.length;u++){const f=[];for(let m=0;m<n[u].length;m++){const y=dl(n[u][m],r);_c(e,y),f.push(y)}a.push(f)}return a}function Yf(n,e,r){const a=[];for(let u=0;u<n.length;u++){const f=mh(n[u],e,r);a.push(f)}return a}function gh(n,e,r,a){if(n[0]<r[0]||n[0]>r[2]){const u=.5*a;let f=n[0]-r[0]>u?-a:r[0]-n[0]>u?a:0;f===0&&(f=n[0]-r[2]>u?-a:r[2]-n[0]>u?a:0),n[0]+=f}_c(e,n)}function Jf(n,e,r,a){const u=Math.pow(2,a.z)*So,f=[a.x*So,a.y*So],m=[];if(!n)return m;for(const y of n)for(const x of y){const b=[x.x+f[0],x.y+f[1]];gh(b,e,r,u),m.push(b)}return m}function _h(n,e,r,a){const u=Math.pow(2,a.z)*So,f=[a.x*So,a.y*So],m=[];if(!n)return m;for(const x of n){const b=[];for(const C of x){const P=[C.x+f[0],C.y+f[1]];_c(e,P),b.push(P)}m.push(b)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of m)for(const b of x)gh(b,e,r,u)}var y;return m}class oa{constructor(e,r){this.type=Wt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(cl(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let u=0;u<a.features.length;++u){const f=a.features[u].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new oa(a,a.features[u].geometry)}else if(a.type==="Feature"){const u=a.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new oa(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new oa(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(!m)return!1;if(a.type==="Polygon"){const y=mh(a.coordinates,f,m),x=Jf(r.geometry(),u,f,m);if(!ia(u,f))return!1;for(const b of x)if(!yc(b,y))return!1}if(a.type==="MultiPolygon"){const y=Yf(a.coordinates,f,m),x=Jf(r.geometry(),u,f,m);if(!ia(u,f))return!1;for(const b of x)if(!fh(b,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(!m)return!1;if(a.type==="Polygon"){const y=mh(a.coordinates,f,m),x=_h(r.geometry(),u,f,m);if(!ia(u,f))return!1;for(const b of x)if(!ln(b,y))return!1}if(a.type==="MultiPolygon"){const y=Yf(a.coordinates,f,m),x=_h(r.geometry(),u,f,m);if(!ia(u,f))return!1;for(const b of x)if(!u_(b,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var vc=oa;function sa(n){if(n instanceof Eo&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof vc)return!1;let e=!0;return n.eachChild(r=>{e&&!sa(r)&&(e=!1)}),e}function Co(n){if(n instanceof Eo&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(r=>{e&&!Co(r)&&(e=!1)}),e}function Es(n,e){if(n instanceof Eo&&e.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(a=>{r&&!Es(a,e)&&(r=!1)}),r}class xc{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new xc(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Qf=xc;class fl{constructor(e,r=[],a,u=new qf,f=[]){this.registry=e,this.path=r,this.key=r.map(m=>`[${m}]`).join(""),this.scope=u,this.errors=f,this.expectedType=a}parse(e,r,a,u,f={}){return r?this.concat(r,a,u)._parse(e,f):this._parse(e,f)}_parse(e,r){function a(u,f,m){return m==="assert"?new To(f,[u]):m==="coerce"?new na(f,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let m=f.parse(e,this);if(!m)return null;if(this.expectedType){const y=this.expectedType,x=m.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(y,x))return null}else m=a(m,y,r.typeAnnotation||"coerce");else m=a(m,y,r.typeAnnotation||"assert")}if(!(m instanceof bs)&&m.type.kind!=="resolvedImage"&&vh(m)){const y=new dh;try{m=new bs(m.type,m.evaluate(y))}catch(x){return this.error(x.message),null}}return m}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){const u=typeof e=="number"?this.path.concat(e):this.path,f=a?this.scope.concat(a):this.scope;return new fl(this.registry,u,r||null,f,this.errors)}error(e,...r){const a=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new Jr(a,e))}checkSubtype(e,r){const a=bo(e,r);return a&&this.error(a),a}}var yh=fl;function vh(n){if(n instanceof Qf)return vh(n.boundExpression);if(n instanceof Eo&&n.name==="error"||n instanceof hl||n instanceof vc)return!1;const e=n instanceof na||n instanceof To;let r=!0;return n.eachChild(a=>{r=e?r&&vh(a):r&&a instanceof bs}),!!r&&sa(n)&&Es(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function wc(n,e){const r=n.length-1;let a,u,f=0,m=r,y=0;for(;f<=m;)if(y=Math.floor((f+m)/2),a=n[y],u=n[y+1],a<=e){if(y===r||e<u)return y;f=y+1}else{if(!(a>e))throw new Pi("Input is not a number.");m=y-1}return 0}class bc{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[u,f]of a)this.labels.push(u),this.outputs.push(f)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,ft);if(!a)return null;const u=[];let f=null;r.expectedType&&r.expectedType.kind!=="value"&&(f=r.expectedType);for(let m=1;m<e.length;m+=2){const y=m===1?-1/0:e[m],x=e[m+1],b=m,C=m+1;if(typeof y!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(u.length&&u[u.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);const P=r.parse(x,C,f);if(!P)return null;f=f||P.type,u.push([y,P])}return new bc(f,a,u)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return a[0].evaluate(e);const f=r.length;return u>=r[f-1]?a[f-1].evaluate(e):a[wc(r,u)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}var xh=bc;function Yt(n,e,r){return n*(1-r)+e*r}var pl=Object.freeze({__proto__:null,array:function(n,e,r){return n.map((a,u)=>Yt(a,e[u],r))},color:function(n,e,r){return new Hn(Yt(n.r,e.r,r),Yt(n.g,e.g,r),Yt(n.b,e.b,r),Yt(n.a,e.a,r))},number:Yt});const ep=.95047,wh=1.08883,tp=4/29,Ss=6/29,bh=3*Ss*Ss,h_=Ss*Ss*Ss,d_=Math.PI/180,f_=180/Math.PI;function Th(n){return n>h_?Math.pow(n,1/3):n/bh+tp}function Eh(n){return n>Ss?n*n*n:bh*(n-tp)}function Sh(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Tc(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function np(n){const e=Tc(n.r),r=Tc(n.g),a=Tc(n.b),u=Th((.4124564*e+.3575761*r+.1804375*a)/ep),f=Th((.2126729*e+.7151522*r+.072175*a)/1);return{l:116*f-16,a:500*(u-f),b:200*(f-Th((.0193339*e+.119192*r+.9503041*a)/wh)),alpha:n.a}}function ip(n){let e=(n.l+16)/116,r=isNaN(n.a)?e:e+n.a/500,a=isNaN(n.b)?e:e-n.b/200;return e=1*Eh(e),r=ep*Eh(r),a=wh*Eh(a),new Hn(Sh(3.2404542*r-1.5371385*e-.4985314*a),Sh(-.969266*r+1.8760108*e+.041556*a),Sh(.0556434*r-.2040259*e+1.0572252*a),n.alpha)}function p_(n,e,r){const a=e-n;return n+r*(a>180||a<-180?a-360*Math.round(a/360):a)}const ml={forward:np,reverse:ip,interpolate:function(n,e,r){return{l:Yt(n.l,e.l,r),a:Yt(n.a,e.a,r),b:Yt(n.b,e.b,r),alpha:Yt(n.alpha,e.alpha,r)}}},aa={forward:function(n){const{l:e,a:r,b:a}=np(n),u=Math.atan2(a,r)*f_;return{h:u<0?u+360:u,c:Math.sqrt(r*r+a*a),l:e,alpha:n.a}},reverse:function(n){const e=n.h*d_,r=n.c;return ip({l:n.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:n.alpha})},interpolate:function(n,e,r){return{h:p_(n.h,e.h,r),c:Yt(n.c,e.c,r),l:Yt(n.l,e.l,r),alpha:Yt(n.alpha,e.alpha,r)}}};var Ch=Object.freeze({__proto__:null,hcl:aa,lab:ml});class gl{constructor(e,r,a,u,f){this.type=e,this.operator=r,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(const[m,y]of f)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(e,r,a,u){let f=0;if(e.name==="exponential")f=Ah(r,e.base,a,u);else if(e.name==="linear")f=Ah(r,1,a,u);else if(e.name==="cubic-bezier"){const m=e.controlPoints;f=new at(m[0],m[1],m[2],m[3]).solve(Ah(r,1,a,u))}return f}static parse(e,r){let[a,u,f,...m]=e;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const b=u[1];if(typeof b!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:b}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const b=u.slice(1);if(b.length!==4||b.some(C=>typeof C!="number"||C<0||C>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(f=r.parse(f,2,ft),!f)return null;const y=[];let x=null;a==="interpolate-hcl"||a==="interpolate-lab"?x=hr:r.expectedType&&r.expectedType.kind!=="value"&&(x=r.expectedType);for(let b=0;b<m.length;b+=2){const C=m[b],P=m[b+1],I=b+3,L=b+4;if(typeof C!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(y.length&&y[y.length-1][0]>=C)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const R=r.parse(P,L,x);if(!R)return null;x=x||R.type,y.push([C,R])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new gl(x,a,u,f,y):r.error(`Type ${Fn(x)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return a[0].evaluate(e);const f=r.length;if(u>=r[f-1])return a[f-1].evaluate(e);const m=wc(r,u),y=gl.interpolationFactor(this.interpolation,u,r[m],r[m+1]),x=a[m].evaluate(e),b=a[m+1].evaluate(e);return this.operator==="interpolate"?pl[this.type.kind.toLowerCase()](x,b,y):this.operator==="interpolate-hcl"?aa.reverse(aa.interpolate(aa.forward(x),aa.forward(b),y)):ml.reverse(ml.interpolate(ml.forward(x),ml.forward(b),y))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)r.push(this.labels[a],this.outputs[a].serialize());return r}}function Ah(n,e,r,a){const u=a-r,f=n-r;return u===0?0:e===1?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}var eo=gl;class Ec{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null;const u=r.expectedType;u&&u.kind!=="value"&&(a=u);const f=[];for(const y of e.slice(1)){const x=r.parse(y,1+f.length,a,void 0,{typeAnnotation:"omit"});if(!x)return null;a=a||x.type,f.push(x)}const m=u&&f.some(y=>bo(u,y.type));return new Ec(m?Xt:a,f)}evaluate(e){let r,a=null,u=0;for(const f of this.args){if(u++,a=f.evaluate(e),a&&a instanceof wr&&!a.available&&(r||(r=a),a=null,u===this.args.length))return r;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var Mh=Ec;class Sc{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let f=1;f<e.length-1;f+=2){const m=e[f];if(typeof m!="string")return r.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=r.parse(e[f+1],f+1);if(!y)return null;a.push([m,y])}const u=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return u?new Sc(a,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,a]of this.bindings)e.push(r,a.serialize());return e.push(this.result.serialize()),e}}var rp=Sc;class Ph{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,ft),u=r.parse(e[2],2,xr(r.expectedType||Xt));return a&&u?new Ph(u.type.itemType,a,u):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new Pi(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Pi(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Pi(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var m_=Ph;class Ih{constructor(e,r){this.type=Wt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Xt),u=r.parse(e[2],2,Xt);return a&&u?ol(a.type,[Wt,Kt,ft,ea,Xt])?new Ih(a,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fn(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!sl(r,["boolean","string","number","null"]))throw new Pi(`Expected first argument to be of type boolean, string, number or null, but found ${Fn($n(r))} instead.`);if(!sl(a,["string","array"]))throw new Pi(`Expected second argument to be of type array or string, but found ${Fn($n(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Cc=Ih;class _l{constructor(e,r,a){this.type=ft,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Xt),u=r.parse(e[2],2,Xt);if(!a||!u)return null;if(!ol(a.type,[Wt,Kt,ft,ea,Xt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fn(a.type)} instead`);if(e.length===4){const f=r.parse(e[3],3,ft);return f?new _l(a,u,f):null}return new _l(a,u)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!sl(r,["boolean","string","number","null"]))throw new Pi(`Expected first argument to be of type boolean, string, number or null, but found ${Fn($n(r))} instead.`);if(!sl(a,["string","array"]))throw new Pi(`Expected second argument to be of type array or string, but found ${Fn($n(a))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return a.indexOf(r,u)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var op=_l;class kh{constructor(e,r,a,u,f,m){this.inputType=e,this.type=r,this.input=a,this.cases=u,this.outputs=f,this.otherwise=m}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const f={},m=[];for(let b=2;b<e.length-1;b+=2){let C=e[b];const P=e[b+1];Array.isArray(C)||(C=[C]);const I=r.concat(b);if(C.length===0)return I.error("Expected at least one branch label.");for(const R of C){if(typeof R!="number"&&typeof R!="string")return I.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return I.error("Numeric branch labels must be integer values.");if(a){if(I.checkSubtype(a,$n(R)))return null}else a=$n(R);if(f[String(R)]!==void 0)return I.error("Branch labels must be unique.");f[String(R)]=m.length}const L=r.parse(P,b,u);if(!L)return null;u=u||L.type,m.push(L)}const y=r.parse(e[1],1,Xt);if(!y)return null;const x=r.parse(e[e.length-1],e.length-1,u);return x?y.type.kind!=="value"&&r.concat(1).checkSubtype(a,y.type)?null:new kh(a,u,y,f,m,x):null}evaluate(e){const r=this.input.evaluate(e);return($n(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),a=[],u={};for(const m of r){const y=u[this.cases[m]];y===void 0?(u[this.cases[m]]=a.length,a.push([this.cases[m],[m]])):a[y][1].push(m)}const f=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,y]of a)e.push(y.length===1?f(y[0]):y.map(f)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}var g_=kh;class Dh{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const u=[];for(let m=1;m<e.length-1;m+=2){const y=r.parse(e[m],m,Wt);if(!y)return null;const x=r.parse(e[m+1],m+1,a);if(!x)return null;u.push([y,x]),a=a||x.type}const f=r.parse(e[e.length-1],e.length-1,a);return f?new Dh(a,u,f):null}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var sp=Dh;class yl{constructor(e,r,a,u){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Xt),u=r.parse(e[2],2,ft);if(!a||!u)return null;if(!ol(a.type,[xr(Xt),Kt,Xt]))return r.error(`Expected first argument to be of type array or string, but found ${Fn(a.type)} instead`);if(e.length===4){const f=r.parse(e[3],3,ft);return f?new yl(a.type,a,u,f):null}return new yl(a.type,a,u)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!sl(r,["string","array"]))throw new Pi(`Expected first argument to be of type array or string, but found ${Fn($n(r))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return r.slice(a,u)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var ap=yl;function Ac(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function lp(n,e,r,a){return a.compare(e,r)===0}function la(n,e,r){const a=n!=="=="&&n!=="!=";return class NC{constructor(f,m,y){this.type=Wt,this.lhs=f,this.rhs=m,this.collator=y,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");const y=f[0];let x=m.parse(f[1],1,Xt);if(!x)return null;if(!Ac(y,x.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${Fn(x.type)}'.`);let b=m.parse(f[2],2,Xt);if(!b)return null;if(!Ac(y,b.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${Fn(b.type)}'.`);if(x.type.kind!==b.type.kind&&x.type.kind!=="value"&&b.type.kind!=="value")return m.error(`Cannot compare types '${Fn(x.type)}' and '${Fn(b.type)}'.`);a&&(x.type.kind==="value"&&b.type.kind!=="value"?x=new To(b.type,[x]):x.type.kind!=="value"&&b.type.kind==="value"&&(b=new To(x.type,[b])));let C=null;if(f.length===4){if(x.type.kind!=="string"&&b.type.kind!=="string"&&x.type.kind!=="value"&&b.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(C=m.parse(f[3],3,dr),!C)return null}return new NC(x,b,C)}evaluate(f){const m=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(a&&this.hasUntypedArgument){const x=$n(m),b=$n(y);if(x.kind!==b.kind||x.kind!=="string"&&x.kind!=="number")throw new Pi(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${x.kind}, ${b.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const x=$n(m),b=$n(y);if(x.kind!=="string"||b.kind!=="string")return e(f,m,y)}return this.collator?r(f,m,y,this.collator.evaluate(f)):e(f,m,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[n];return this.eachChild(m=>{f.push(m.serialize())}),f}}}const __=la("==",function(n,e,r){return e===r},lp),y_=la("!=",function(n,e,r){return e!==r},function(n,e,r,a){return!lp(0,e,r,a)}),v_=la("<",function(n,e,r){return e<r},function(n,e,r,a){return a.compare(e,r)<0}),x_=la(">",function(n,e,r){return e>r},function(n,e,r,a){return a.compare(e,r)>0}),w_=la("<=",function(n,e,r){return e<=r},function(n,e,r,a){return a.compare(e,r)<=0}),cp=la(">=",function(n,e,r){return e>=r},function(n,e,r,a){return a.compare(e,r)>=0});class Mc{constructor(e,r,a,u,f,m){this.type=Kt,this.number=e,this.locale=r,this.currency=a,this.unit=u,this.minFractionDigits=f,this.maxFractionDigits=m}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,ft);if(!a)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=r.parse(u.locale,1,Kt),!f))return null;let m=null;if(u.currency&&(m=r.parse(u.currency,1,Kt),!m))return null;let y=null;if(u.unit&&(y=r.parse(u.unit,1,Kt),!y))return null;let x=null;if(u["min-fraction-digits"]&&(x=r.parse(u["min-fraction-digits"],1,ft),!x))return null;let b=null;return u["max-fraction-digits"]&&(b=r.parse(u["max-fraction-digits"],1,ft),!b)?null:new Mc(a,f,m,y,x,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class ca{constructor(e){this.type=ft,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Fn(a.type)} instead.`):new ca(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Pi(`Expected value to be of type string or array, but found ${Fn($n(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const up={"==":__,"!=":y_,">":x_,"<":v_,">=":cp,"<=":w_,array:To,at:m_,boolean:To,case:sp,coalesce:Mh,collator:hl,format:Qo,image:gc,in:Cc,"index-of":op,interpolate:eo,"interpolate-hcl":eo,"interpolate-lab":eo,length:ca,let:rp,literal:bs,match:g_,number:To,"number-format":Mc,object:To,slice:ap,step:xh,string:To,"to-boolean":na,"to-color":na,"to-number":na,"to-string":na,var:Qf,within:vc};function hp(n,[e,r,a,u]){e=e.evaluate(n),r=r.evaluate(n),a=a.evaluate(n);const f=u?u.evaluate(n):1,m=Hf(e,r,a,f);if(m)throw new Pi(m);return new Hn(e/255*f,r/255*f,a/255*f,f)}function Ao(n,e){return n in e}function Pc(n,e){const r=e[n];return r===void 0?null:r}function br(n){return{type:n}}Eo.register(up,{error:[{kind:"error"},[Kt],(n,[e])=>{throw new Pi(e.evaluate(n))}],typeof:[Kt,[Xt],(n,[e])=>Fn($n(e.evaluate(n)))],"to-rgba":[xr(ft,4),[hr],(n,[e])=>e.evaluate(n).toArray()],rgb:[hr,[ft,ft,ft],hp],rgba:[hr,[ft,ft,ft,ft],hp],has:{type:Wt,overloads:[[[Kt],(n,[e])=>Ao(e.evaluate(n),n.properties())],[[Kt,Fr],(n,[e,r])=>Ao(e.evaluate(n),r.evaluate(n))]]},get:{type:Xt,overloads:[[[Kt],(n,[e])=>Pc(e.evaluate(n),n.properties())],[[Kt,Fr],(n,[e,r])=>Pc(e.evaluate(n),r.evaluate(n))]]},"feature-state":[Xt,[Kt],(n,[e])=>Pc(e.evaluate(n),n.featureState||{})],properties:[Fr,[],n=>n.properties()],"geometry-type":[Kt,[],n=>n.geometryType()],id:[Xt,[],n=>n.id()],zoom:[ft,[],n=>n.globals.zoom],pitch:[ft,[],n=>n.globals.pitch||0],"distance-from-center":[ft,[],n=>n.distanceFromCenter()],"heatmap-density":[ft,[],n=>n.globals.heatmapDensity||0],"line-progress":[ft,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[ft,[],n=>n.globals.skyRadialProgress||0],accumulated:[Xt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[ft,br(ft),(n,e)=>{let r=0;for(const a of e)r+=a.evaluate(n);return r}],"*":[ft,br(ft),(n,e)=>{let r=1;for(const a of e)r*=a.evaluate(n);return r}],"-":{type:ft,overloads:[[[ft,ft],(n,[e,r])=>e.evaluate(n)-r.evaluate(n)],[[ft],(n,[e])=>-e.evaluate(n)]]},"/":[ft,[ft,ft],(n,[e,r])=>e.evaluate(n)/r.evaluate(n)],"%":[ft,[ft,ft],(n,[e,r])=>e.evaluate(n)%r.evaluate(n)],ln2:[ft,[],()=>Math.LN2],pi:[ft,[],()=>Math.PI],e:[ft,[],()=>Math.E],"^":[ft,[ft,ft],(n,[e,r])=>Math.pow(e.evaluate(n),r.evaluate(n))],sqrt:[ft,[ft],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[ft,[ft],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[ft,[ft],(n,[e])=>Math.log(e.evaluate(n))],log2:[ft,[ft],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[ft,[ft],(n,[e])=>Math.sin(e.evaluate(n))],cos:[ft,[ft],(n,[e])=>Math.cos(e.evaluate(n))],tan:[ft,[ft],(n,[e])=>Math.tan(e.evaluate(n))],asin:[ft,[ft],(n,[e])=>Math.asin(e.evaluate(n))],acos:[ft,[ft],(n,[e])=>Math.acos(e.evaluate(n))],atan:[ft,[ft],(n,[e])=>Math.atan(e.evaluate(n))],min:[ft,br(ft),(n,e)=>Math.min(...e.map(r=>r.evaluate(n)))],max:[ft,br(ft),(n,e)=>Math.max(...e.map(r=>r.evaluate(n)))],abs:[ft,[ft],(n,[e])=>Math.abs(e.evaluate(n))],round:[ft,[ft],(n,[e])=>{const r=e.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[ft,[ft],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[ft,[ft],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Wt,[Kt,Xt],(n,[e,r])=>n.properties()[e.value]===r.value],"filter-id-==":[Wt,[Xt],(n,[e])=>n.id()===e.value],"filter-type-==":[Wt,[Kt],(n,[e])=>n.geometryType()===e.value],"filter-<":[Wt,[Kt,Xt],(n,[e,r])=>{const a=n.properties()[e.value],u=r.value;return typeof a==typeof u&&a<u}],"filter-id-<":[Wt,[Xt],(n,[e])=>{const r=n.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[Wt,[Kt,Xt],(n,[e,r])=>{const a=n.properties()[e.value],u=r.value;return typeof a==typeof u&&a>u}],"filter-id->":[Wt,[Xt],(n,[e])=>{const r=n.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[Wt,[Kt,Xt],(n,[e,r])=>{const a=n.properties()[e.value],u=r.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[Wt,[Xt],(n,[e])=>{const r=n.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[Wt,[Kt,Xt],(n,[e,r])=>{const a=n.properties()[e.value],u=r.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[Wt,[Xt],(n,[e])=>{const r=n.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[Wt,[Xt],(n,[e])=>e.value in n.properties()],"filter-has-id":[Wt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Wt,[xr(Kt)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Wt,[xr(Xt)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Wt,[Kt,xr(Xt)],(n,[e,r])=>r.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Wt,[Kt,xr(Xt)],(n,[e,r])=>function(a,u,f,m){for(;f<=m;){const y=f+m>>1;if(u[y]===a)return!0;u[y]>a?m=y-1:f=y+1}return!1}(n.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Wt,overloads:[[[Wt,Wt],(n,[e,r])=>e.evaluate(n)&&r.evaluate(n)],[br(Wt),(n,e)=>{for(const r of e)if(!r.evaluate(n))return!1;return!0}]]},any:{type:Wt,overloads:[[[Wt,Wt],(n,[e,r])=>e.evaluate(n)||r.evaluate(n)],[br(Wt),(n,e)=>{for(const r of e)if(r.evaluate(n))return!0;return!1}]]},"!":[Wt,[Wt],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Wt,[Kt],(n,[e])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(e.evaluate(n))}],upcase:[Kt,[Kt],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Kt,[Kt],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Kt,br(Xt),(n,e)=>e.map(r=>ul(r.evaluate(n))).join("")],"resolved-locale":[Kt,[dr],(n,[e])=>e.evaluate(n).resolvedLocale()]});var vl=up;function dp(n){return{result:"success",value:n}}function Cs(n){return{result:"error",value:n}}function ua(n){return n["property-type"]==="data-driven"}function Ic(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function kc(n){return!!n.expression&&n.expression.interpolated}function en(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function xl(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function fp(n){return n}function Dc(n,e){const r=e.type==="color",a=n.stops&&typeof n.stops[0][0]=="object",u=a||!(a||n.property!==void 0),f=n.type||(kc(e)?"exponential":"interval");if(r&&((n=wo({},n)).stops&&(n.stops=n.stops.map(b=>[b[0],Hn.parse(b[1])])),n.default=Hn.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!Ch[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let m,y,x;if(f==="exponential")m=Mo;else if(f==="interval")m=zc;else if(f==="categorical"){m=pp,y=Object.create(null);for(const b of n.stops)y[b[0]]=b[1];x=typeof n.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);m=mp}if(a){const b={},C=[];for(let L=0;L<n.stops.length;L++){const R=n.stops[L],O=R[0].zoom;b[O]===void 0&&(b[O]={zoom:O,type:n.type,property:n.property,default:n.default,stops:[]},C.push(O)),b[O].stops.push([R[0].value,R[1]])}const P=[];for(const L of C)P.push([b[L].zoom,Dc(b[L],e)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:eo.interpolationFactor.bind(void 0,I),zoomStops:P.map(L=>L[0]),evaluate:({zoom:L},R)=>Mo({stops:P,base:n.base},e,L).evaluate(L,R)}}if(u){const b=f==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:eo.interpolationFactor.bind(void 0,b),zoomStops:n.stops.map(C=>C[0]),evaluate:({zoom:C})=>m(n,e,C,y,x)}}return{kind:"source",evaluate(b,C){const P=C&&C.properties?C.properties[n.property]:void 0;return P===void 0?ha(n.default,e.default):m(n,e,P,y,x)}}}function ha(n,e,r){return n!==void 0?n:e!==void 0?e:r!==void 0?r:void 0}function pp(n,e,r,a,u){return ha(typeof r===u?a[r]:void 0,n.default,e.default)}function zc(n,e,r){if(en(r)!=="number")return ha(n.default,e.default);const a=n.stops.length;if(a===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[a-1][0])return n.stops[a-1][1];const u=wc(n.stops.map(f=>f[0]),r);return n.stops[u][1]}function Mo(n,e,r){const a=n.base!==void 0?n.base:1;if(en(r)!=="number")return ha(n.default,e.default);const u=n.stops.length;if(u===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[u-1][0])return n.stops[u-1][1];const f=wc(n.stops.map(C=>C[0]),r),m=function(C,P,I,L){const R=L-I,O=C-I;return R===0?0:P===1?O/R:(Math.pow(P,O)-1)/(Math.pow(P,R)-1)}(r,a,n.stops[f][0],n.stops[f+1][0]),y=n.stops[f][1],x=n.stops[f+1][1];let b=pl[e.type]||fp;if(n.colorSpace&&n.colorSpace!=="rgb"){const C=Ch[n.colorSpace];b=(P,I)=>C.reverse(C.interpolate(C.forward(P),C.forward(I),m))}return typeof y.evaluate=="function"?{evaluate(...C){const P=y.evaluate.apply(void 0,C),I=x.evaluate.apply(void 0,C);if(P!==void 0&&I!==void 0)return b(P,I,m)}}:b(y,x,m)}function mp(n,e,r){return e.type==="color"?r=Hn.parse(r):e.type==="formatted"?r=Ji.fromString(r.toString()):e.type==="resolvedImage"?r=wr.fromString(r.toString()):en(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),ha(r,n.default,e.default)}class Lc{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new dh,this._defaultValue=r?function(a){return a.type==="color"&&(xl(a.default)||Array.isArray(a.default))?new Hn(0,0,0,0):a.type==="color"?Hn.parse(a.default)||null:a.default===void 0?null:a.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,a,u,f,m,y,x){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,u,f,m,y,x){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=x||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new Pi(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function da(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in vl}function fa(n,e){const r=new yh(vl,[],e?function(u){const f={color:hr,string:Kt,number:ft,enum:Kt,boolean:Wt,formatted:rl,resolvedImage:ws};return u.type==="array"?xr(f[u.value]||Xt,u.length):f[u.type]}(e):void 0),a=r.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?dp(new Lc(a,e)):Cs(r.errors)}class zh{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Co(r.expression)}evaluateWithoutErrorHandling(e,r,a,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,u,f,m)}evaluate(e,r,a,u,f,m){return this._styleExpression.evaluate(e,r,a,u,f,m)}}class wl{constructor(e,r,a,u){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Co(r.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,r,a,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,u,f,m)}evaluate(e,r,a,u,f,m){return this._styleExpression.evaluate(e,r,a,u,f,m)}interpolationFactor(e,r,a){return this.interpolationType?eo.interpolationFactor(this.interpolationType,e,r,a):0}}function bl(n,e){if((n=fa(n,e)).result==="error")return n;const r=n.value.expression,a=sa(r);if(!a&&!ua(e))return Cs([new Jr("","data expressions not supported")]);const u=Es(r,["zoom","pitch","distance-from-center"]);if(!u&&!Ic(e))return Cs([new Jr("","zoom expressions not supported")]);const f=Bc(r);return f||u?f instanceof Jr?Cs([f]):f instanceof eo&&!kc(e)?Cs([new Jr("",'"interpolate" expressions cannot be used with this property')]):dp(f?new wl(a?"camera":"composite",n.value,f.labels,f instanceof eo?f.interpolation:void 0):new zh(a?"constant":"source",n.value)):Cs([new Jr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Rc{constructor(e,r){this._parameters=e,this._specification=r,wo(this,Dc(this._parameters,this._specification))}static deserialize(e){return new Rc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Bc(n){let e=null;if(n instanceof rp)e=Bc(n.result);else if(n instanceof Mh){for(const r of n.args)if(e=Bc(r),e)break}else(n instanceof xh||n instanceof eo)&&n.input instanceof Eo&&n.input.name==="zoom"&&(e=n);return e instanceof Jr||n.eachChild(r=>{const a=Bc(r);a instanceof Jr?e=a:!e&&a?e=new Jr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new Jr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class pt{constructor(e,r,a,u){this.message=(e?`${e}: `:"")+a,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function Or(n){const e=n.key,r=n.value,a=n.valueSpec||{},u=n.objectElementValidators||{},f=n.style,m=n.styleSpec;let y=[];const x=en(r);if(x!=="object")return[new pt(e,r,`object expected, ${x} found`)];for(const b in r){const C=b.split(".")[0];let P;u[C]?P=u[C]:a[C]?P=Bi:u["*"]?P=u["*"]:a["*"]&&(P=Bi),P?y=y.concat(P({key:(e&&`${e}.`)+b,value:r[b],valueSpec:a[C]||a["*"],style:f,styleSpec:m,object:r,objectKey:b},r)):y.push(new pt(e,r[b],`unknown property "${b}"`))}for(const b in a)u[b]||a[b].required&&a[b].default===void 0&&r[b]===void 0&&y.push(new pt(e,r,`missing required property "${b}"`));return y}function gp(n){const e=n.value,r=n.valueSpec,a=n.style,u=n.styleSpec,f=n.key,m=n.arrayElementValidator||Bi;if(en(e)!=="array")return[new pt(f,e,`array expected, ${en(e)} found`)];if(r.length&&e.length!==r.length)return[new pt(f,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new pt(f,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let y={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};u.$version<7&&(y.function=r.function),en(r.value)==="object"&&(y=r.value);let x=[];for(let b=0;b<e.length;b++)x=x.concat(m({array:e,arrayIndex:b,value:e[b],valueSpec:y,style:a,styleSpec:u,key:`${f}[${b}]`}));return x}function Tl(n){const e=n.key,r=n.value,a=n.valueSpec;let u=en(r);if(u==="number"&&r!=r&&(u="NaN"),u!=="number")return[new pt(e,r,`number expected, ${u} found`)];if("minimum"in a){let f=a.minimum;if(en(a.minimum)==="array"&&(f=a.minimum[n.arrayIndex]),r<f)return[new pt(e,r,`${r} is less than the minimum value ${f}`)]}if("maximum"in a){let f=a.maximum;if(en(a.maximum)==="array"&&(f=a.maximum[n.arrayIndex]),r>f)return[new pt(e,r,`${r} is greater than the maximum value ${f}`)]}return[]}function El(n){const e=n.valueSpec,r=ei(n.value.type);let a,u,f,m={};const y=r!=="categorical"&&n.value.property===void 0,x=!y,b=en(n.value.stops)==="array"&&en(n.value.stops[0])==="array"&&en(n.value.stops[0][0])==="object",C=Or({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(L){if(r==="identity")return[new pt(L.key,L.value,'identity function may not have a "stops" property')];let R=[];const O=L.value;return R=R.concat(gp({key:L.key,value:O,valueSpec:L.valueSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:P})),en(O)==="array"&&O.length===0&&R.push(new pt(L.key,O,"array must have at least one stop")),R},default:function(L){return Bi({key:L.key,value:L.value,valueSpec:e,style:L.style,styleSpec:L.styleSpec})}}});return r==="identity"&&y&&C.push(new pt(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||C.push(new pt(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!kc(n.valueSpec)&&C.push(new pt(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(x&&!ua(n.valueSpec)?C.push(new pt(n.key,n.value,"property functions not supported")):y&&!Ic(n.valueSpec)&&C.push(new pt(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!b||n.value.property!==void 0||C.push(new pt(n.key,n.value,'"property" property is required')),C;function P(L){let R=[];const O=L.value,Z=L.key;if(en(O)!=="array")return[new pt(Z,O,`array expected, ${en(O)} found`)];if(O.length!==2)return[new pt(Z,O,`array length 2 expected, length ${O.length} found`)];if(b){if(en(O[0])!=="object")return[new pt(Z,O,`object expected, ${en(O[0])} found`)];if(O[0].zoom===void 0)return[new pt(Z,O,"object stop key must have zoom")];if(O[0].value===void 0)return[new pt(Z,O,"object stop key must have value")];const Q=ei(O[0].zoom);if(typeof Q!="number")return[new pt(Z,O[0].zoom,"stop zoom values must be numbers")];if(f&&f>Q)return[new pt(Z,O[0].zoom,"stop zoom values must appear in ascending order")];Q!==f&&(f=Q,u=void 0,m={}),R=R.concat(Or({key:`${Z}[0]`,value:O[0],valueSpec:{zoom:{}},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:Tl,value:I}}))}else R=R.concat(I({key:`${Z}[0]`,value:O[0],valueSpec:{},style:L.style,styleSpec:L.styleSpec},O));return da(xi(O[1]))?R.concat([new pt(`${Z}[1]`,O[1],"expressions are not allowed in function stops.")]):R.concat(Bi({key:`${Z}[1]`,value:O[1],valueSpec:e,style:L.style,styleSpec:L.styleSpec}))}function I(L,R){const O=en(L.value),Z=ei(L.value),Q=L.value!==null?L.value:R;if(a){if(O!==a)return[new pt(L.key,Q,`${O} stop domain type must match previous stop domain type ${a}`)]}else a=O;if(O!=="number"&&O!=="string"&&O!=="boolean"&&typeof Z!="number"&&typeof Z!="string"&&typeof Z!="boolean")return[new pt(L.key,Q,"stop domain value must be a number, string, or boolean")];if(O!=="number"&&r!=="categorical"){let ue=`number expected, ${O} found`;return ua(e)&&r===void 0&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new pt(L.key,Q,ue)]}return r!=="categorical"||O!=="number"||typeof Z=="number"&&isFinite(Z)&&Math.floor(Z)===Z?r!=="categorical"&&O==="number"&&typeof Z=="number"&&typeof u=="number"&&u!==void 0&&Z<u?[new pt(L.key,Q,"stop domain values must appear in ascending order")]:(u=Z,r==="categorical"&&Z in m?[new pt(L.key,Q,"stop domain values must be unique")]:(m[Z]=!0,[])):[new pt(L.key,Q,`integer expected, found ${String(Z)}`)]}}function wi(n){const e=(n.expressionContext==="property"?bl:fa)(xi(n.value),n.valueSpec);if(e.result==="error")return e.value.map(a=>new pt(`${n.key}${a.key}`,n.value,a.message));const r=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new pt(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Co(r))return[new pt(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter")return Sl(r,n);if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Es(r,["zoom","feature-state"]))return[new pt(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!sa(r))return[new pt(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Sl(n,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const u of e.valueSpec.expression.parameters)r.delete(u);if(r.size===0)return[];const a=[];return n instanceof Eo&&r.has(n.name)?[new pt(e.key,e.value,`["${n.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(n.eachChild(u=>{a.push(...Sl(u,e))}),a)}function Fc(n){const e=n.key,r=n.value,a=n.valueSpec,u=[];return Array.isArray(a.values)?a.values.indexOf(ei(r))===-1&&u.push(new pt(e,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(ei(r))===-1&&u.push(new pt(e,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),u}function Lh(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Lh(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Oc(n,e="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Lh(n)||(n=ma(n));const r=n;let a=!0;try{a=function(b){if(!pa(b))return b;let C=xi(b);return Uc(C),C=_p(C),C}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const u=Fe[`filter_${e}`],f=fa(a,u);let m=null;if(f.result==="error")throw new Error(f.value.map(b=>`${b.key}: ${b.message}`).join(", "));m=(b,C,P)=>f.value.evaluate(b,C,{},P);let y=null,x=null;if(a!==r){const b=fa(r,u);if(b.result==="error")throw new Error(b.value.map(C=>`${C.key}: ${C.message}`).join(", "));y=(C,P,I,L,R)=>b.value.evaluate(C,P,{},I,void 0,void 0,L,R),x=!sa(b.value.expression)}return{filter:m,dynamicFilter:y||void 0,needGeometry:yp(a),needFeature:!!x}}function _p(n){if(!Array.isArray(n))return n;const e=function(r){if(Rh.has(r[0])){for(let a=1;a<r.length;a++)if(pa(r[a]))return!0}return r}(n);return e===!0?e:e.map(r=>_p(r))}function Uc(n){let e=!1;const r=[];if(n[0]==="case"){for(let a=1;a<n.length-1;a+=2)e=e||pa(n[a]),r.push(n[a+1]);r.push(n[n.length-1])}else if(n[0]==="match"){e=e||pa(n[1]);for(let a=2;a<n.length-1;a+=2)r.push(n[a+1]);r.push(n[n.length-1])}else if(n[0]==="step"){e=e||pa(n[1]);for(let a=1;a<n.length-1;a+=2)r.push(n[a+1])}e&&(n.length=0,n.push("any",...r));for(let a=1;a<n.length;a++)Uc(n[a])}function pa(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<n.length;r++)if(pa(n[r]))return!0;return!1}const Rh=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function b_(n,e){return n<e?-1:n>e?1:0}function yp(n){if(!Array.isArray(n))return!1;if(n[0]==="within")return!0;for(let e=1;e<n.length;e++)if(yp(n[e]))return!0;return!1}function ma(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Bh(n[1],n[2],"=="):e==="!="?Vc(Bh(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Bh(n[1],n[2],e):e==="any"?(r=n.slice(1),["any"].concat(r.map(ma))):e==="all"?["all"].concat(n.slice(1).map(ma)):e==="none"?["all"].concat(n.slice(1).map(ma).map(Vc)):e==="in"?Fh(n[1],n.slice(2)):e==="!in"?Vc(Fh(n[1],n.slice(2))):e==="has"?Oh(n[1]):e==="!has"?Vc(Oh(n[1])):e!=="within"||n;var r}function Bh(n,e,r){switch(n){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,n,e]}}function Fh(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",n,["literal",e.sort(b_)]]:["filter-in-small",n,["literal",e]]}}function Oh(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Vc(n){return["!",n]}function Cl(n){return Lh(xi(n.value))?wi(wo({},n,{expressionContext:"filter",valueSpec:n.styleSpec[`filter_${n.layerType||"fill"}`]})):Al(n)}function Al(n){const e=n.value,r=n.key;if(en(e)!=="array")return[new pt(r,e,`array expected, ${en(e)} found`)];const a=n.styleSpec;let u,f=[];if(e.length<1)return[new pt(r,e,"filter array must have at least 1 element")];switch(f=f.concat(Fc({key:`${r}[0]`,value:e[0],valueSpec:a.filter_operator,style:n.style,styleSpec:n.styleSpec})),ei(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ei(e[1])==="$type"&&f.push(new pt(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new pt(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=en(e[1]),u!=="string"&&f.push(new pt(`${r}[1]`,e[1],`string expected, ${u} found`)));for(let m=2;m<e.length;m++)u=en(e[m]),ei(e[1])==="$type"?f=f.concat(Fc({key:`${r}[${m}]`,value:e[m],valueSpec:a.geometry_type,style:n.style,styleSpec:n.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&f.push(new pt(`${r}[${m}]`,e[m],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)f=f.concat(Al({key:`${r}[${m}]`,value:e[m],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":u=en(e[1]),e.length!==2?f.push(new pt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&f.push(new pt(`${r}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=en(e[1]),e.length!==2?f.push(new pt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="object"&&f.push(new pt(`${r}[1]`,e[1],`object expected, ${u} found`))}return f}function Uh(n,e){const r=n.key,a=n.style,u=n.styleSpec,f=n.value,m=n.objectKey,y=u[`${e}_${n.layerType}`];if(!y)return[];const x=m.match(/^(.*)-transition$/);if(e==="paint"&&x&&y[x[1]]&&y[x[1]].transition)return Bi({key:r,value:f,valueSpec:u.transition,style:a,styleSpec:u});const b=n.valueSpec||y[m];if(!b)return[new pt(r,f,`unknown property "${m}"`)];let C;if(en(f)==="string"&&ua(b)&&!b.tokens&&(C=/^{([^}]+)}$/.exec(f))){const I=`\`{ "type": "identity", "property": ${C?JSON.stringify(C[1]):'"_"'} }\``;return[new pt(r,f,`"${m}" does not support interpolation syntax
Use an identity property function instead: ${I}.`)]}const P=[];return n.layerType==="symbol"&&(m==="text-field"&&a&&!a.glyphs&&P.push(new pt(r,f,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&xl(xi(f))&&ei(f.type)==="identity"&&P.push(new pt(r,f,'"text-font" does not support identity functions'))),P.concat(Bi({key:n.key,value:f,valueSpec:b,style:a,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:m}))}function vp(n){return Uh(n,"paint")}function Vh(n){return Uh(n,"layout")}function xp(n){let e=[];const r=n.value,a=n.key,u=n.style,f=n.styleSpec;r.type||r.ref||e.push(new pt(a,r,'either "type" or "ref" is required'));let m=ei(r.type);const y=ei(r.ref);if(r.id){const x=ei(r.id);for(let b=0;b<n.arrayIndex;b++){const C=u.layers[b];ei(C.id)===x&&e.push(new pt(a,r.id,`duplicate layer id "${r.id}", previously used at line ${C.id.__line__}`))}}if("ref"in r){let x;["type","source","source-layer","filter","layout"].forEach(b=>{b in r&&e.push(new pt(a,r[b],`"${b}" is prohibited for ref layers`))}),u.layers.forEach(b=>{ei(b.id)===y&&(x=b)}),x?x.ref?e.push(new pt(a,r.ref,"ref cannot reference another ref layer")):m=ei(x.type):typeof y=="string"&&e.push(new pt(a,r.ref,`ref layer "${y}" not found`))}else if(m!=="background"&&m!=="sky")if(r.source){const x=u.sources&&u.sources[r.source],b=x&&ei(x.type);x?b==="vector"&&m==="raster"?e.push(new pt(a,r.source,`layer "${r.id}" requires a raster source`)):b==="raster"&&m!=="raster"?e.push(new pt(a,r.source,`layer "${r.id}" requires a vector source`)):b!=="vector"||r["source-layer"]?b==="raster-dem"&&m!=="hillshade"?e.push(new pt(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||b==="geojson"&&x.lineMetrics||e.push(new pt(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new pt(a,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new pt(a,r.source,`source "${r.source}" not found`))}else e.push(new pt(a,r,'missing required property "source"'));return e=e.concat(Or({key:a,value:r,valueSpec:f.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Bi({key:`${a}.type`,value:r.type,valueSpec:f.layer.type,style:n.style,styleSpec:n.styleSpec,object:r,objectKey:"type"}),filter:x=>Cl(wo({layerType:m},x)),layout:x=>Or({layer:r,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":b=>Vh(wo({layerType:m},b))}}),paint:x=>Or({layer:r,key:x.key,value:x.value,valueSpec:{},style:x.style,styleSpec:x.styleSpec,objectElementValidators:{"*":b=>vp(wo({layerType:m},b))}})}})),e}function es(n){const e=n.value,r=n.key,a=en(e);return a!=="string"?[new pt(r,e,`string expected, ${a} found`)]:[]}const wp={promoteId:function({key:n,value:e}){if(en(e)==="string")return es({key:n,value:e});{const r=[];for(const a in e)r.push(...es({key:`${n}.${a}`,value:e[a]}));return r}}};function bp(n){const e=n.value,r=n.key,a=n.styleSpec,u=n.style;if(!e.type)return[new pt(r,e,'"type" is required')];const f=ei(e.type);let m;switch(f){case"vector":case"raster":case"raster-dem":return m=Or({key:r,value:e,valueSpec:a[`source_${f.replace("-","_")}`],style:n.style,styleSpec:a,objectElementValidators:wp}),m;case"geojson":if(m=Or({key:r,value:e,valueSpec:a.source_geojson,style:u,styleSpec:a,objectElementValidators:wp}),e.cluster)for(const y in e.clusterProperties){const[x,b]=e.clusterProperties[y],C=typeof x=="string"?[x,["accumulated"],["get",y]]:x;m.push(...wi({key:`${r}.${y}.map`,value:b,expressionContext:"cluster-map"})),m.push(...wi({key:`${r}.${y}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return m;case"video":return Or({key:r,value:e,valueSpec:a.source_video,style:u,styleSpec:a});case"image":return Or({key:r,value:e,valueSpec:a.source_image,style:u,styleSpec:a});case"canvas":return[new pt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Fc({key:`${r}.type`,value:e.type,valueSpec:{values:T_(a)},style:u,styleSpec:a})}}function T_(n){return n.source.reduce((e,r)=>{const a=n[r];return a.type.type==="enum"&&(e=e.concat(Object.keys(a.type.values))),e},[])}function Tp(n){const e=n.value,r=n.styleSpec,a=r.light,u=n.style;let f=[];const m=en(e);if(e===void 0)return f;if(m!=="object")return f=f.concat([new pt("light",e,`object expected, ${m} found`)]),f;for(const y in e){const x=y.match(/^(.*)-transition$/);f=f.concat(x&&a[x[1]]&&a[x[1]].transition?Bi({key:y,value:e[y],valueSpec:r.transition,style:u,styleSpec:r}):a[y]?Bi({key:y,value:e[y],valueSpec:a[y],style:u,styleSpec:r}):[new pt(y,e[y],`unknown property "${y}"`)])}return f}function Nh(n){const e=n.value,r=n.key,a=n.style,u=n.styleSpec,f=u.terrain;let m=[];const y=en(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new pt("terrain",e,`object expected, ${y} found`)]),m;for(const x in e){const b=x.match(/^(.*)-transition$/);m=m.concat(b&&f[b[1]]&&f[b[1]].transition?Bi({key:x,value:e[x],valueSpec:u.transition,style:a,styleSpec:u}):f[x]?Bi({key:x,value:e[x],valueSpec:f[x],style:a,styleSpec:u}):[new pt(x,e[x],`unknown property "${x}"`)])}if(e.source){const x=a.sources&&a.sources[e.source],b=x&&ei(x.type);x?b!=="raster-dem"&&m.push(new pt(r,e.source,`terrain cannot be used with a source of type ${String(b)}, it only be used with a "raster-dem" source type`)):m.push(new pt(r,e.source,`source "${e.source}" not found`))}else m.push(new pt(r,e,'terrain is missing required property "source"'));return m}function Ep(n){const e=n.value,r=n.style,a=n.styleSpec,u=a.fog;let f=[];const m=en(e);if(e===void 0)return f;if(m!=="object")return f=f.concat([new pt("fog",e,`object expected, ${m} found`)]),f;for(const y in e){const x=y.match(/^(.*)-transition$/);f=f.concat(x&&u[x[1]]&&u[x[1]].transition?Bi({key:y,value:e[y],valueSpec:a.transition,style:r,styleSpec:a}):u[y]?Bi({key:y,value:e[y],valueSpec:u[y],style:r,styleSpec:a}):[new pt(y,e[y],`unknown property "${y}"`)])}return f}const Sp={"*":()=>[],array:gp,boolean:function(n){const e=n.value,r=n.key,a=en(e);return a!=="boolean"?[new pt(r,e,`boolean expected, ${a} found`)]:[]},number:Tl,color:function(n){const e=n.key,r=n.value,a=en(r);return a!=="string"?[new pt(e,r,`color expected, ${a} found`)]:oh(r)===null?[new pt(e,r,`color expected, "${r}" found`)]:[]},enum:Fc,filter:Cl,function:El,layer:xp,object:Or,source:bp,light:Tp,terrain:Nh,fog:Ep,string:es,formatted:function(n){return es(n).length===0?[]:wi(n)},resolvedImage:function(n){return es(n).length===0?[]:wi(n)},projection:function(n){const e=n.value,r=n.styleSpec,a=r.projection,u=n.style;let f=[];const m=en(e);if(m==="object")for(const y in e)f=f.concat(Bi({key:y,value:e[y],valueSpec:a[y],style:u,styleSpec:r}));else m!=="string"&&(f=f.concat([new pt("projection",e,`object or string expected, ${m} found`)]));return f}};function Bi(n){const e=n.value,r=n.valueSpec,a=n.styleSpec;return r.expression&&xl(ei(e))?El(n):r.expression&&da(xi(e))?wi(n):r.type&&Sp[r.type]?Sp[r.type](n):Or(wo({},n,{valueSpec:r.type?a[r.type]:r}))}function E_(n){const e=n.value,r=n.key,a=es(n);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new pt(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new pt(r,e,'"glyphs" url must include a "{range}" token'))),a}function Cp(n,e=Fe){return Tr(Bi({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,objectElementValidators:{glyphs:E_,"*":()=>[]}}))}const S_=n=>Tr(vp(n)),C_=n=>Tr(Vh(n));function Tr(n){return n.slice().sort((e,r)=>e.line&&r.line?e.line-r.line:0)}function Ap(n,e){let r=!1;if(e&&e.length)for(const a of e)n.fire(new xo(new Error(a.message))),r=!0;return r}var A_=to,Ur=3;function to(n,e,r){var a=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var u=new Int32Array(this.arrayBuffer);n=u[0],this.d=(e=u[1])+2*(r=u[2]);for(var f=0;f<this.d*this.d;f++){var m=u[Ur+f],y=u[Ur+f+1];a.push(m===y?null:u.subarray(m,y))}var x=u[Ur+a.length+1];this.keys=u.subarray(u[Ur+a.length],x),this.bboxes=u.subarray(x),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var b=0;b<this.d*this.d;b++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=n,this.padding=r,this.scale=e/n,this.uid=0;var C=r/e*n;this.min=-C,this.max=n+C}to.prototype.insert=function(n,e,r,a,u){this._forEachCell(e,r,a,u,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(u)},to.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},to.prototype._insertCell=function(n,e,r,a,u,f){this.cells[u].push(f)},to.prototype.query=function(n,e,r,a,u){var f=this.min,m=this.max;if(n<=f&&e<=f&&m<=r&&m<=a&&!u)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(n,e,r,a,this._queryCell,y,{},u),y},to.prototype._queryCell=function(n,e,r,a,u,f,m,y){var x=this.cells[u];if(x!==null)for(var b=this.keys,C=this.bboxes,P=0;P<x.length;P++){var I=x[P];if(m[I]===void 0){var L=4*I;(y?y(C[L+0],C[L+1],C[L+2],C[L+3]):n<=C[L+2]&&e<=C[L+3]&&r>=C[L+0]&&a>=C[L+1])?(m[I]=!0,f.push(b[I])):m[I]=!1}}},to.prototype._forEachCell=function(n,e,r,a,u,f,m,y){for(var x=this._convertToCellCoord(n),b=this._convertToCellCoord(e),C=this._convertToCellCoord(r),P=this._convertToCellCoord(a),I=x;I<=C;I++)for(var L=b;L<=P;L++){var R=this.d*L+I;if((!y||y(this._convertFromCellCoord(I),this._convertFromCellCoord(L),this._convertFromCellCoord(I+1),this._convertFromCellCoord(L+1)))&&u.call(this,n,e,r,a,R,f,m,y))return}},to.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},to.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},to.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,e=Ur+this.cells.length+1+1,r=0,a=0;a<this.cells.length;a++)r+=this.cells[a].length;var u=new Int32Array(e+r+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var f=e,m=0;m<n.length;m++){var y=n[m];u[Ur+m]=f,u.set(y,f),f+=y.length}return u[Ur+n.length]=f,u.set(this.keys,f),u[Ur+n.length+1]=f+=this.keys.length,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer};var As=se(A_);const Nc={};function mt(n,e,r={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writeable:!1}),Nc[e]={klass:n,omit:r.omit||[]}}mt(Object,"Object"),As.serialize=function(n,e){const r=n.toArrayBuffer();return e&&e.push(r),{buffer:r}},As.deserialize=function(n){return new As(n.buffer)},Object.defineProperty(As,"name",{value:"Grid"}),mt(As,"Grid"),mt(Hn,"Color"),mt(Error,"Error"),mt(Le,"AJAXError"),mt(wr,"ResolvedImage"),mt(Rc,"StylePropertyFunction"),mt(Lc,"StyleExpression",{omit:["_evaluator"]}),mt(wl,"ZoomDependentExpression"),mt(zh,"ZoomConstantExpression"),mt(Eo,"CompoundExpression",{omit:["_evaluate"]});for(const n in vl)Nc[vl[n]._classRegistryKey]||mt(vl[n],`Expression${n}`);function jh(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Gh(n){return A.ImageBitmap&&n instanceof A.ImageBitmap}function ga(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(jh(n)||Gh(n))return e&&e.push(n),n;if(ArrayBuffer.isView(n)){const r=n;return e&&e.push(r.buffer),r}if(n instanceof A.ImageData)return e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const r=[];for(const a of n)r.push(ga(a,e));return r}if(typeof n=="object"){const r=n.constructor,a=r._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);const u=r.serialize?r.serialize(n,e):{};if(!r.serialize){for(const f in n)n.hasOwnProperty(f)&&(Nc[a].omit.indexOf(f)>=0||(u[f]=ga(n[f],e)));n instanceof Error&&(u.message=n.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof n)}function Ms(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||jh(n)||Gh(n)||ArrayBuffer.isView(n)||n instanceof A.ImageData)return n;if(Array.isArray(n))return n.map(Ms);if(typeof n=="object"){const e=n.$name||"Object",{klass:r}=Nc[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(n);const a=Object.create(r.prototype);for(const u of Object.keys(n))u!=="$name"&&(a[u]=Ms(n[u]));return a}throw new Error("can't deserialize object of type "+typeof n)}const dt={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function $h(n){for(const e of n)if(Zh(e.charCodeAt(0)))return!0;return!1}function M_(n){for(const e of n)if(!Mp(e.charCodeAt(0)))return!1;return!0}function Mp(n){return!(dt.Arabic(n)||dt["Arabic Supplement"](n)||dt["Arabic Extended-A"](n)||dt["Arabic Presentation Forms-A"](n)||dt["Arabic Presentation Forms-B"](n))}function Zh(n){return!(n!==746&&n!==747&&(n<4352||!(dt["Bopomofo Extended"](n)||dt.Bopomofo(n)||dt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||dt["CJK Compatibility Ideographs"](n)||dt["CJK Compatibility"](n)||dt["CJK Radicals Supplement"](n)||dt["CJK Strokes"](n)||!(!dt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||dt["CJK Unified Ideographs Extension A"](n)||dt["CJK Unified Ideographs"](n)||dt["Enclosed CJK Letters and Months"](n)||dt["Hangul Compatibility Jamo"](n)||dt["Hangul Jamo Extended-A"](n)||dt["Hangul Jamo Extended-B"](n)||dt["Hangul Jamo"](n)||dt["Hangul Syllables"](n)||dt.Hiragana(n)||dt["Ideographic Description Characters"](n)||dt.Kanbun(n)||dt["Kangxi Radicals"](n)||dt["Katakana Phonetic Extensions"](n)||dt.Katakana(n)&&n!==12540||!(!dt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!dt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||dt["Unified Canadian Aboriginal Syllabics"](n)||dt["Unified Canadian Aboriginal Syllabics Extended"](n)||dt["Vertical Forms"](n)||dt["Yijing Hexagram Symbols"](n)||dt["Yi Syllables"](n)||dt["Yi Radicals"](n))))}function Pp(n){return!(Zh(n)||function(e){return!!(dt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||dt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||dt["Letterlike Symbols"](e)||dt["Number Forms"](e)||dt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||dt["Control Pictures"](e)&&e!==9251||dt["Optical Character Recognition"](e)||dt["Enclosed Alphanumerics"](e)||dt["Geometric Shapes"](e)||dt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||dt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||dt["CJK Symbols and Punctuation"](e)||dt.Katakana(e)||dt["Private Use Area"](e)||dt["CJK Compatibility Forms"](e)||dt["Small Form Variants"](e)||dt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function Ip(n){return n>=1424&&n<=2303||dt["Arabic Presentation Forms-A"](n)||dt["Arabic Presentation Forms-B"](n)}function P_(n,e){return!(!e&&Ip(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||dt.Khmer(n))}function I_(n){for(const e of n)if(Ip(e.charCodeAt(0)))return!0;return!1}const qh="deferred",Wh="loading",Xh="loaded";let _a=null,h="unavailable",o=null;const c=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(h="error"),_a&&_a(n)};function p(){_.fire(new xs("pluginStateChange",{pluginStatus:h,pluginURL:o}))}const _=new il,v=function(){return h},T=function(){if(h!==qh||!o)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");h=Wh,p(),o&&vt({url:o},n=>{n?c(n):(h=Xh,p())})},S={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>h===Xh||S.applyArabicShaping!=null,isLoading:()=>h===Wh,setState(n){h=n.pluginStatus,o=n.pluginURL},isParsed:()=>S.applyArabicShaping!=null&&S.processBidirectionalText!=null&&S.processStyledBidirectionalText!=null,getPluginURL:()=>o};class M{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,a){for(const u of r)if(!P_(u.charCodeAt(0),a))return!1;return!0}(e,S.isLoaded())}}class D{constructor(e,r){this.property=e,this.value=r,this.expression=function(a,u){if(xl(a))return new Rc(a,u);if(da(a)){const f=bl(a,u);if(f.result==="error")throw new Error(f.value.map(m=>`${m.key}: ${m.message}`).join(", "));return f.value}{let f=a;return typeof a=="string"&&u.type==="color"&&(f=Hn.parse(a)),{kind:"constant",evaluate:()=>f}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class k{constructor(e){this.property=e,this.value=new D(e,void 0)}transitioned(e,r){return new $(this.property,this.value,r,fn({},e.transition,this.transition),e.now)}untransitioned(){return new $(this.property,this.value,null,{},0)}}class B{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return yi(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new k(this._values[e].property)),this._values[e].value=new D(this._values[e].property,r===null?void 0:yi(r))}getTransition(e){return yi(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new k(this._values[e].property)),this._values[e].transition=yi(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const u=this.getTransition(r);u!==void 0&&(e[`${r}-transition`]=u)}return e}transitioned(e,r){const a=new W(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(e,r._values[u]);return a}untransitioned(){const e=new W(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class ${constructor(e,r,a,u,f){const m=u.delay||0,y=u.duration||0;f=f||0,this.property=e,this.value=r,this.begin=f+m,this.end=this.begin+y,e.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const u=e.now||0,f=this.value.possiblyEvaluate(e,r,a),m=this.prior;if(m){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return m.possiblyEvaluate(e,r,a);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,r,a),f,un(y))}}return f}}class W{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const u=new Y(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,r,a);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class K{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return yi(this._values[e].value)}setValue(e,r){this._values[e]=new D(this._values[e].property,r===null?void 0:yi(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const u=new Y(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,r,a);return u}}class H{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,u){return this.property.evaluate(this.value,this.parameters,e,r,a,u)}}class Y{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class F{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,a){const u=pl[this.specification.type];return u?u(e,r,a):e}}class q{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,u){return new H(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,u)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new H(this,{kind:"constant",value:void 0},e.parameters);const u=pl[this.specification.type];return u?new H(this,{kind:"constant",value:u(e.value.value,r.value.value,a)},e.parameters):e}evaluate(e,r,a,u,f,m){return e.kind==="constant"?e.value:e.evaluate(r,a,u,f,m)}}class ne{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,u){return!!e.expression.evaluate(r,null,{},a,u)}interpolate(){return!1}}class ie{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new M(0,{});for(const a in e){const u=e[a];u.specification.overridable&&this.overridableProperties.push(a);const f=this.defaultPropertyValues[a]=new D(u,void 0),m=this.defaultTransitionablePropertyValues[a]=new k(u);this.defaultTransitioningPropertyValues[a]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=f.possiblyEvaluate(r)}}}function me(n,e){return 256*(n=Xe(Math.floor(n),0,255))+Xe(Math.floor(e),0,255)}mt(q,"DataDrivenProperty"),mt(F,"DataConstantProperty"),mt(ne,"ColorRampProperty");const ye={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ge{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class be{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function xe(n,e=1){let r=0,a=0;return{members:n.map(u=>{const f=ye[u.type].BYTES_PER_ELEMENT,m=r=Me(r,Math.max(e,f)),y=u.components||1;return a=Math.max(a,f),r+=f*y,{name:u.name,type:u.type,components:y,offset:m}}),size:Me(r,Math.max(a,e)),alignment:e}}function Me(n,e){return Math.ceil(n/e)*e}class Qe extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.int16[u+0]=r,this.int16[u+1]=a,e}}Qe.prototype.bytesPerElement=4,mt(Qe,"StructArrayLayout2i4");class Ee extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const f=3*e;return this.int16[f+0]=r,this.int16[f+1]=a,this.int16[f+2]=u,e}}Ee.prototype.bytesPerElement=6,mt(Ee,"StructArrayLayout3i6");class je extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,u)}emplace(e,r,a,u,f){const m=4*e;return this.int16[m+0]=r,this.int16[m+1]=a,this.int16[m+2]=u,this.int16[m+3]=f,e}}je.prototype.bytesPerElement=8,mt(je,"StructArrayLayout4i8");class Ie extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,a,u,f,m,y)}emplace(e,r,a,u,f,m,y,x){const b=6*e,C=12*e,P=3*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.uint8[C+4]=u,this.uint8[C+5]=f,this.uint8[C+6]=m,this.uint8[C+7]=y,this.float32[P+2]=x,e}}Ie.prototype.bytesPerElement=12,mt(Ie,"StructArrayLayout2i4ub1f12");class Ke extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,u)}emplace(e,r,a,u,f){const m=4*e;return this.float32[m+0]=r,this.float32[m+1]=a,this.float32[m+2]=u,this.float32[m+3]=f,e}}Ke.prototype.bytesPerElement=16,mt(Ke,"StructArrayLayout4f16");class Ae extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,a,u,f)}emplace(e,r,a,u,f,m){const y=6*e,x=3*e;return this.uint16[y+0]=r,this.uint16[y+1]=a,this.uint16[y+2]=u,this.uint16[y+3]=f,this.float32[x+2]=m,e}}Ae.prototype.bytesPerElement=12,mt(Ae,"StructArrayLayout4ui1f12");class Ne extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,u)}emplace(e,r,a,u,f){const m=4*e;return this.uint16[m+0]=r,this.uint16[m+1]=a,this.uint16[m+2]=u,this.uint16[m+3]=f,e}}Ne.prototype.bytesPerElement=8,mt(Ne,"StructArrayLayout4ui8");class tt extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,u,f,m)}emplace(e,r,a,u,f,m,y){const x=6*e;return this.int16[x+0]=r,this.int16[x+1]=a,this.int16[x+2]=u,this.int16[x+3]=f,this.int16[x+4]=m,this.int16[x+5]=y,e}}tt.prototype.bytesPerElement=12,mt(tt,"StructArrayLayout6i12");class Ze extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f,m,y,x,b,C,P,I){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,a,u,f,m,y,x,b,C,P,I)}emplace(e,r,a,u,f,m,y,x,b,C,P,I,L){const R=12*e;return this.int16[R+0]=r,this.int16[R+1]=a,this.int16[R+2]=u,this.int16[R+3]=f,this.uint16[R+4]=m,this.uint16[R+5]=y,this.uint16[R+6]=x,this.uint16[R+7]=b,this.int16[R+8]=C,this.int16[R+9]=P,this.int16[R+10]=I,this.int16[R+11]=L,e}}Ze.prototype.bytesPerElement=24,mt(Ze,"StructArrayLayout4i4ui4i24");class it extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,u,f,m)}emplace(e,r,a,u,f,m,y){const x=10*e,b=5*e;return this.int16[x+0]=r,this.int16[x+1]=a,this.int16[x+2]=u,this.float32[b+2]=f,this.float32[b+3]=m,this.float32[b+4]=y,e}}it.prototype.bytesPerElement=20,mt(it,"StructArrayLayout3i3f20");class bt extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}bt.prototype.bytesPerElement=4,mt(bt,"StructArrayLayout1ul4");class zt extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f,m,y,x,b,C,P,I,L){const R=this.length;return this.resize(R+1),this.emplace(R,e,r,a,u,f,m,y,x,b,C,P,I,L)}emplace(e,r,a,u,f,m,y,x,b,C,P,I,L,R){const O=20*e,Z=10*e;return this.int16[O+0]=r,this.int16[O+1]=a,this.int16[O+2]=u,this.int16[O+3]=f,this.int16[O+4]=m,this.float32[Z+3]=y,this.float32[Z+4]=x,this.float32[Z+5]=b,this.float32[Z+6]=C,this.int16[O+14]=P,this.uint32[Z+8]=I,this.uint16[O+18]=L,this.uint16[O+19]=R,e}}zt.prototype.bytesPerElement=40,mt(zt,"StructArrayLayout5i4f1i1ul2ui40");class _t extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,r,a,u,f,m,y)}emplace(e,r,a,u,f,m,y,x){const b=8*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=u,this.int16[b+4]=f,this.int16[b+5]=m,this.int16[b+6]=y,this.int16[b+7]=x,e}}_t.prototype.bytesPerElement=16,mt(_t,"StructArrayLayout3i2i2i16");class At extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,a,u,f)}emplace(e,r,a,u,f,m){const y=4*e,x=8*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=u,this.int16[x+6]=f,this.int16[x+7]=m,e}}At.prototype.bytesPerElement=16,mt(At,"StructArrayLayout2f1f2i16");class Ht extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,u)}emplace(e,r,a,u,f){const m=12*e,y=3*e;return this.uint8[m+0]=r,this.uint8[m+1]=a,this.float32[y+1]=u,this.float32[y+2]=f,e}}Ht.prototype.bytesPerElement=12,mt(Ht,"StructArrayLayout2ub2f12");class qt extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const f=3*e;return this.float32[f+0]=r,this.float32[f+1]=a,this.float32[f+2]=u,e}}qt.prototype.bytesPerElement=12,mt(qt,"StructArrayLayout3f12");class xt extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const f=3*e;return this.uint16[f+0]=r,this.uint16[f+1]=a,this.uint16[f+2]=u,e}}xt.prototype.bytesPerElement=6,mt(xt,"StructArrayLayout3ui6");class hn extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f,m,y,x,b,C,P,I,L,R,O,Z,Q,ue,te,le,pe){const fe=this.length;return this.resize(fe+1),this.emplace(fe,e,r,a,u,f,m,y,x,b,C,P,I,L,R,O,Z,Q,ue,te,le,pe)}emplace(e,r,a,u,f,m,y,x,b,C,P,I,L,R,O,Z,Q,ue,te,le,pe,fe){const Pe=30*e,Se=15*e,Oe=60*e;return this.int16[Pe+0]=r,this.int16[Pe+1]=a,this.int16[Pe+2]=u,this.float32[Se+2]=f,this.float32[Se+3]=m,this.uint16[Pe+8]=y,this.uint16[Pe+9]=x,this.uint32[Se+5]=b,this.uint32[Se+6]=C,this.uint32[Se+7]=P,this.uint16[Pe+16]=I,this.uint16[Pe+17]=L,this.uint16[Pe+18]=R,this.float32[Se+10]=O,this.float32[Se+11]=Z,this.uint8[Oe+48]=Q,this.uint8[Oe+49]=ue,this.uint8[Oe+50]=te,this.uint32[Se+13]=le,this.int16[Pe+28]=pe,this.uint8[Oe+58]=fe,e}}hn.prototype.bytesPerElement=60,mt(hn,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class _n extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f,m,y,x,b,C,P,I,L,R,O,Z,Q,ue,te,le,pe,fe,Pe,Se,Oe,et,ke,Ge,$e,We){const rt=this.length;return this.resize(rt+1),this.emplace(rt,e,r,a,u,f,m,y,x,b,C,P,I,L,R,O,Z,Q,ue,te,le,pe,fe,Pe,Se,Oe,et,ke,Ge,$e,We)}emplace(e,r,a,u,f,m,y,x,b,C,P,I,L,R,O,Z,Q,ue,te,le,pe,fe,Pe,Se,Oe,et,ke,Ge,$e,We,rt){const Re=38*e,ut=19*e;return this.int16[Re+0]=r,this.int16[Re+1]=a,this.int16[Re+2]=u,this.float32[ut+2]=f,this.float32[ut+3]=m,this.int16[Re+8]=y,this.int16[Re+9]=x,this.int16[Re+10]=b,this.int16[Re+11]=C,this.int16[Re+12]=P,this.int16[Re+13]=I,this.uint16[Re+14]=L,this.uint16[Re+15]=R,this.uint16[Re+16]=O,this.uint16[Re+17]=Z,this.uint16[Re+18]=Q,this.uint16[Re+19]=ue,this.uint16[Re+20]=te,this.uint16[Re+21]=le,this.uint16[Re+22]=pe,this.uint16[Re+23]=fe,this.uint16[Re+24]=Pe,this.uint16[Re+25]=Se,this.uint16[Re+26]=Oe,this.uint16[Re+27]=et,this.uint16[Re+28]=ke,this.uint32[ut+15]=Ge,this.float32[ut+16]=$e,this.float32[ut+17]=We,this.float32[ut+18]=rt,e}}_n.prototype.bytesPerElement=76,mt(_n,"StructArrayLayout3i2f6i15ui1ul3f76");class yn extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}yn.prototype.bytesPerElement=4,mt(yn,"StructArrayLayout1f4");class vn extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,a,u,f)}emplace(e,r,a,u,f,m){const y=5*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=u,this.float32[y+3]=f,this.float32[y+4]=m,e}}vn.prototype.bytesPerElement=20,mt(vn,"StructArrayLayout5f20");class Fi extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,u)}emplace(e,r,a,u,f){const m=6*e;return this.uint32[3*e+0]=r,this.uint16[m+2]=a,this.uint16[m+3]=u,this.uint16[m+4]=f,e}}Fi.prototype.bytesPerElement=12,mt(Fi,"StructArrayLayout1ul3ui12");class bi extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.uint16[u+0]=r,this.uint16[u+1]=a,e}}bi.prototype.bytesPerElement=4,mt(bi,"StructArrayLayout2ui4");class Er extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Er.prototype.bytesPerElement=2,mt(Er,"StructArrayLayout1ui2");class no extends be{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.float32[u+0]=r,this.float32[u+1]=a,e}}no.prototype.bytesPerElement=8,mt(no,"StructArrayLayout2f8");class On extends ge{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}On.prototype.size=40;class xn extends zt{get(e){return new On(this,e)}}mt(xn,"CollisionBoxArray");class rn extends ge{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}rn.prototype.size=60;class ti extends hn{get(e){return new rn(this,e)}}mt(ti,"PlacedSymbolArray");class Zi extends ge{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Zi.prototype.size=76;class Ln extends _n{get(e){return new Zi(this,e)}}mt(Ln,"SymbolInstanceArray");class Qi extends yn{getoffsetX(e){return this.float32[1*e+0]}}mt(Qi,"GlyphOffsetArray");class jc extends Qe{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}mt(jc,"SymbolLineVertexArray");class Ps extends ge{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ps.prototype.size=12;class Ml extends Fi{get(e){return new Ps(this,e)}}mt(Ml,"FeatureIndexArray");class Po extends bi{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}mt(Po,"FillExtrusionCentroidArray");const ts=xe([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Is=xe([{name:"a_dash",components:4,type:"Uint16"}]);var Gc={exports:{}},Pl={exports:{}};Pl.exports=function(n,e){var r,a,u,f,m,y,x,b;for(a=n.length-(r=3&n.length),u=e,m=3432918353,y=461845907,b=0;b<a;)x=255&n.charCodeAt(b)|(255&n.charCodeAt(++b))<<8|(255&n.charCodeAt(++b))<<16|(255&n.charCodeAt(++b))<<24,++b,u=27492+(65535&(f=5*(65535&(u=(u^=x=(65535&(x=(x=(65535&x)*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(x=0,r){case 3:x^=(255&n.charCodeAt(b+2))<<16;case 2:x^=(255&n.charCodeAt(b+1))<<8;case 1:u^=x=(65535&(x=(x=(65535&(x^=255&n.charCodeAt(b)))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295}return u^=n.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var Hh=Pl.exports,a1={exports:{}};a1.exports=function(n,e){for(var r,a=n.length,u=e^a,f=0;a>=4;)r=1540483477*(65535&(r=255&n.charCodeAt(f)|(255&n.charCodeAt(++f))<<8|(255&n.charCodeAt(++f))<<16|(255&n.charCodeAt(++f))<<24))+((1540483477*(r>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++f;switch(a){case 3:u^=(255&n.charCodeAt(f+2))<<16;case 2:u^=(255&n.charCodeAt(f+1))<<8;case 1:u=1540483477*(65535&(u^=255&n.charCodeAt(f)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var l1=Hh,hM=a1.exports;Gc.exports=l1,Gc.exports.murmur3=l1,Gc.exports.murmur2=hM;var k_=se(Gc.exports);class kp{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,a,u){this.ids.push(c1(e)),this.positions.push(r,a,u)}getPositions(e){const r=c1(e);let a=0,u=this.ids.length-1;for(;a<u;){const m=a+u>>1;this.ids[m]>=r?u=m:a=m+1}const f=[];for(;this.ids[a]===r;)f.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return f}static serialize(e,r){const a=new Float64Array(e.ids),u=new Uint32Array(e.positions);return D_(a,u,0,a.length-1),r&&r.push(a.buffer,u.buffer),{ids:a,positions:u}}static deserialize(e){const r=new kp;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function c1(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:k_(String(n))}function D_(n,e,r,a){for(;r<a;){const u=n[r+a>>1];let f=r-1,m=a+1;for(;;){do f++;while(n[f]<u);do m--;while(n[m]>u);if(f>=m)break;Dp(n,f,m),Dp(e,3*f,3*m),Dp(e,3*f+1,3*m+1),Dp(e,3*f+2,3*m+2)}m-r<a-m?(D_(n,e,r,m),r=m+1):(D_(n,e,m+1,a),a=m)}}function Dp(n,e,r){const a=n[e];n[e]=n[r],n[r]=a}mt(kp,"FeaturePositionMap");class ks{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}}class zp extends ks{constructor(e){super(e),this.current=0}set(e,r,a){this.fetchUniformLocation(e,r)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class u1 extends ks{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class h1 extends ks{constructor(e){super(e),this.current=Hn.transparent}set(e,r,a){this.fetchUniformLocation(e,r)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const dM=new Float32Array(16),fM=new Float32Array(9),pM=new Float32Array(4);function z_(n){return[me(255*n.r,255*n.g),me(255*n.b,255*n.a)]}class Kh{constructor(e,r,a){this.value=e,this.uniformNames=r.map(u=>`u_${u}`),this.type=a}setUniform(e,r,a,u,f){r.set(e,f,u.constantOr(this.value))}getBinding(e,r){return this.type==="color"?new h1(e):new zp(e)}}class $c{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,a,u,f){const m=f==="u_pattern"||f==="u_dash"?this.pattern:f==="u_pixel_ratio"?this.pixelRatio:null;m&&r.set(e,f,m)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new u1(e):new zp(e)}}class Ds{constructor(e,r,a,u){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,r,a,u,f,m){const y=this.paintVertexArray.length,x=this.expression.evaluate(new M(0),r,{},f,u,m);this.paintVertexArray.resize(e),this._setPaintValue(y,e,x)}updatePaintArray(e,r,a,u,f){const m=this.expression.evaluate({zoom:0},a,u,void 0,f);this._setPaintValue(e,r,m)}_setPaintValue(e,r,a){if(this.type==="color"){const u=z_(a);for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=e;u<r;u++)this.paintVertexArray.emplace(u,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Io{constructor(e,r,a,u,f,m){this.expression=e,this.uniformNames=r.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,r,a,u,f,m){const y=this.expression.evaluate(new M(this.zoom),r,{},f,u,m),x=this.expression.evaluate(new M(this.zoom+1),r,{},f,u,m),b=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(b,e,y,x)}updatePaintArray(e,r,a,u,f){const m=this.expression.evaluate({zoom:this.zoom},a,u,void 0,f),y=this.expression.evaluate({zoom:this.zoom+1},a,u,void 0,f);this._setPaintValue(e,r,m,y)}_setPaintValue(e,r,a,u){if(this.type==="color"){const f=z_(a),m=z_(u);for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,f[0],f[1],m[0],m[1])}else{for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,a,u,f){const m=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,y=Xe(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);r.set(e,f,y)}getBinding(e,r){return new zp(e)}}class ya{constructor(e,r,a,u,f){this.expression=e,this.layerId=f,this.paintVertexAttributes=(a==="array"?Is:ts).members;for(let m=0;m<r.length;++m);this.paintVertexArray=new u}populatePaintArray(e,r,a){const u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,u,f,m){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],m)}_setPaintValues(e,r,a,u){if(!u||!a)return;const f=u[a];if(!f)return;const{tl:m,br:y,pixelRatio:x}=f;for(let b=e;b<r;b++)this.paintVertexArray.emplace(b,m[0],m[1],y[0],y[1],x)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class va{constructor(e,r,a=()=>!0){this.binders={},this._buffers=[];const u=[];for(const f in e.paint._values){if(!a(f))continue;const m=e.paint.get(f);if(!(m instanceof H&&ua(m.property.specification)))continue;const y=gM(f,e.type),x=m.value,b=m.property.specification.type,C=!!m.property.useIntegerZoom,P=f==="line-dasharray"||f.endsWith("pattern"),I=f==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(x.kind!=="constant"||I)if(x.kind==="source"||I||P){const L=d1(f,b,"source");this.binders[f]=P?new ya(x,y,b,L,e.id):new Ds(x,y,b,L),u.push(`/a_${f}`)}else{const L=d1(f,b,"composite");this.binders[f]=new Io(x,y,b,C,r,L),u.push(`/z_${f}`)}else this.binders[f]=P?new $c(x.value,y):new Kh(x.value,y,b),u.push(`/u_${f}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Ds||r instanceof Io?r.maxValue:0}populatePaintArrays(e,r,a,u,f,m){for(const y in this.binders){const x=this.binders[y];(x instanceof Ds||x instanceof Io||x instanceof ya)&&x.populatePaintArray(e,r,a,u,f,m)}}setConstantPatternPositions(e){for(const r in this.binders){const a=this.binders[r];a instanceof $c&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,r,a,u,f,m){let y=!1;for(const x in e){const b=r.getPositions(x);for(const C of b){const P=a.feature(C.index);for(const I in this.binders){const L=this.binders[I];if((L instanceof Ds||L instanceof Io||L instanceof ya)&&L.expression.isStateDependent===!0){const R=u.paint.get(I);L.expression=R.value,L.updatePaintArray(C.start,C.end,P,e[x],f,m),y=!0}}}}return y}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof Kh||a instanceof $c)&&e.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Ds||a instanceof Io||a instanceof ya)for(let u=0;u<a.paintVertexAttributes.length;u++)e.push(a.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Kh||a instanceof $c||a instanceof Io)for(const u of a.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof Kh||u instanceof $c||u instanceof Io)for(const f of u.uniformNames)r.push({name:f,property:a,binding:u.getBinding(e,f)})}return r}setUniforms(e,r,a,u,f){for(const{name:m,property:y,binding:x}of a)this.binders[y].setUniform(e,x,f,u.get(y),m)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof Ds||r instanceof Io||r instanceof ya)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof Ds||a instanceof Io||a instanceof ya)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Ds||r instanceof Io||r instanceof ya)&&r.destroy()}}}class Il{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new va(u,r,a);this.needsUpload=!1,this._featureMap=new kp,this._bufferOffset=0}populatePaintArrays(e,r,a,u,f,m,y){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,r,u,f,m,y);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,u,f){for(const m of a)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,r,m,u,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const mM={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function gM(n,e){return mM[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const _M={"line-pattern":{source:Ae,composite:Ae},"fill-pattern":{source:Ae,composite:Ae},"fill-extrusion-pattern":{source:Ae,composite:Ae},"line-dasharray":{source:Ne,composite:Ne}},yM={color:{source:no,composite:Ke},number:{source:yn,composite:no}};function d1(n,e,r){const a=_M[n];return a&&a[r]||yM[e][r]}mt(Kh,"ConstantBinder"),mt($c,"PatternConstantBinder"),mt(Ds,"SourceExpressionBinder"),mt(ya,"PatternCompositeBinder"),mt(Io,"CompositeExpressionBinder"),mt(va,"ProgramConfiguration",{omit:["_buffers"]}),mt(Il,"ProgramConfigurationSet");const f1="-transition";class ko extends il{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new K(r.layout)),r.paint)){this._transitionablePaint=new B(r.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Y(r.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,a={}){r!=null&&this._validate(C_,`layers.${this.id}.layout.${e}`,e,r,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return ur(e,f1)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,a={}){if(r!=null&&this._validate(S_,`layers.${this.id}.paint.${e}`,e,r,a))return!1;if(ur(e,f1))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const u=this._transitionablePaint._values[e],f=u.value.isDataDriven(),m=u.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const y=this._transitionablePaint._values[e].value,x=y.isDataDriven(),b=ur(e,"pattern")||e==="line-dasharray";return x||f||b||this._handleOverridablePaintPropertyUpdate(e,m,y)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Rr(e,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(e,r,a,u,f={}){return(!f||f.validate!==!1)&&Ap(this,e.call(Cp,{key:r,layerType:this.type,objectKey:a,value:u,styleSpec:Fe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof H&&ua(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Oc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const vM=xe([{name:"a_pos",components:2,type:"Int16"}],4),xM=xe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ni{constructor(e=[]){this.segments=e}prepareSegment(e,r,a,u){let f=this.segments[this.segments.length-1];return e>ni.MAX_VERTEX_ARRAY_LENGTH&&pn(`Max vertices per segment is ${ni.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>ni.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},u!==void 0&&(f.sortKey=u),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,u){return new ni([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}ni.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,mt(ni,"SegmentVector");var Ct=8192;class xa{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof wn?new wn(e.lng,e.lat):wn.convert(e),this}setSouthWest(e){return this._sw=e instanceof wn?new wn(e.lng,e.lat):wn.convert(e),this}extend(e){const r=this._sw,a=this._ne;let u,f;if(e instanceof wn)u=e,f=e;else{if(!(e instanceof xa))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(xa.convert(e)):this.extend(wn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(wn.convert(e)):this;if(u=e._sw,f=e._ne,!u||!f)return this}return r||a?(r.lng=Math.min(u.lng,r.lng),r.lat=Math.min(u.lat,r.lat),a.lng=Math.max(f.lng,a.lng),a.lat=Math.max(f.lat,a.lat)):(this._sw=new wn(u.lng,u.lat),this._ne=new wn(f.lng,f.lat)),this}getCenter(){return new wn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new wn(this.getWest(),this.getNorth())}getSouthEast(){return new wn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:a}=wn.convert(e);let u=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(e){return!e||e instanceof xa?e:new xa(e)}}var Lp=1e-6,Sr=typeof Float32Array<"u"?Float32Array:Array;function p1(){var n=new Sr(9);return Sr!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function m1(n,e,r){var a=e[0],u=e[1],f=e[2],m=e[3],y=e[4],x=e[5],b=e[6],C=e[7],P=e[8],I=r[0],L=r[1],R=r[2],O=r[3],Z=r[4],Q=r[5],ue=r[6],te=r[7],le=r[8];return n[0]=I*a+L*m+R*b,n[1]=I*u+L*y+R*C,n[2]=I*f+L*x+R*P,n[3]=O*a+Z*m+Q*b,n[4]=O*u+Z*y+Q*C,n[5]=O*f+Z*x+Q*P,n[6]=ue*a+te*m+le*b,n[7]=ue*u+te*y+le*C,n[8]=ue*f+te*x+le*P,n}function Do(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function L_(n,e){var r=e[0],a=e[1],u=e[2],f=e[3],m=e[4],y=e[5],x=e[6],b=e[7],C=e[8],P=e[9],I=e[10],L=e[11],R=e[12],O=e[13],Z=e[14],Q=e[15],ue=r*y-a*m,te=r*x-u*m,le=r*b-f*m,pe=a*x-u*y,fe=a*b-f*y,Pe=u*b-f*x,Se=C*O-P*R,Oe=C*Z-I*R,et=C*Q-L*R,ke=P*Z-I*O,Ge=P*Q-L*O,$e=I*Q-L*Z,We=ue*$e-te*Ge+le*ke+pe*et-fe*Oe+Pe*Se;return We?(n[0]=(y*$e-x*Ge+b*ke)*(We=1/We),n[1]=(u*Ge-a*$e-f*ke)*We,n[2]=(O*Pe-Z*fe+Q*pe)*We,n[3]=(I*fe-P*Pe-L*pe)*We,n[4]=(x*et-m*$e-b*Oe)*We,n[5]=(r*$e-u*et+f*Oe)*We,n[6]=(Z*le-R*Pe-Q*te)*We,n[7]=(C*Pe-I*le+L*te)*We,n[8]=(m*Ge-y*et+b*Se)*We,n[9]=(a*et-r*Ge-f*Se)*We,n[10]=(R*fe-O*le+Q*ue)*We,n[11]=(P*le-C*fe-L*ue)*We,n[12]=(y*Oe-m*ke-x*Se)*We,n[13]=(r*ke-a*Oe+u*Se)*We,n[14]=(O*te-R*pe-Z*ue)*We,n[15]=(C*pe-P*te+I*ue)*We,n):null}function kl(n,e,r){var a=e[0],u=e[1],f=e[2],m=e[3],y=e[4],x=e[5],b=e[6],C=e[7],P=e[8],I=e[9],L=e[10],R=e[11],O=e[12],Z=e[13],Q=e[14],ue=e[15],te=r[0],le=r[1],pe=r[2],fe=r[3];return n[0]=te*a+le*y+pe*P+fe*O,n[1]=te*u+le*x+pe*I+fe*Z,n[2]=te*f+le*b+pe*L+fe*Q,n[3]=te*m+le*C+pe*R+fe*ue,n[4]=(te=r[4])*a+(le=r[5])*y+(pe=r[6])*P+(fe=r[7])*O,n[5]=te*u+le*x+pe*I+fe*Z,n[6]=te*f+le*b+pe*L+fe*Q,n[7]=te*m+le*C+pe*R+fe*ue,n[8]=(te=r[8])*a+(le=r[9])*y+(pe=r[10])*P+(fe=r[11])*O,n[9]=te*u+le*x+pe*I+fe*Z,n[10]=te*f+le*b+pe*L+fe*Q,n[11]=te*m+le*C+pe*R+fe*ue,n[12]=(te=r[12])*a+(le=r[13])*y+(pe=r[14])*P+(fe=r[15])*O,n[13]=te*u+le*x+pe*I+fe*Z,n[14]=te*f+le*b+pe*L+fe*Q,n[15]=te*m+le*C+pe*R+fe*ue,n}function Yh(n,e,r){var a,u,f,m,y,x,b,C,P,I,L,R,O=r[0],Z=r[1],Q=r[2];return e===n?(n[12]=e[0]*O+e[4]*Z+e[8]*Q+e[12],n[13]=e[1]*O+e[5]*Z+e[9]*Q+e[13],n[14]=e[2]*O+e[6]*Z+e[10]*Q+e[14],n[15]=e[3]*O+e[7]*Z+e[11]*Q+e[15]):(u=e[1],f=e[2],m=e[3],y=e[4],x=e[5],b=e[6],C=e[7],P=e[8],I=e[9],L=e[10],R=e[11],n[0]=a=e[0],n[1]=u,n[2]=f,n[3]=m,n[4]=y,n[5]=x,n[6]=b,n[7]=C,n[8]=P,n[9]=I,n[10]=L,n[11]=R,n[12]=a*O+y*Z+P*Q+e[12],n[13]=u*O+x*Z+I*Q+e[13],n[14]=f*O+b*Z+L*Q+e[14],n[15]=m*O+C*Z+R*Q+e[15]),n}function Dl(n,e,r){var a=r[0],u=r[1],f=r[2];return n[0]=e[0]*a,n[1]=e[1]*a,n[2]=e[2]*a,n[3]=e[3]*a,n[4]=e[4]*u,n[5]=e[5]*u,n[6]=e[6]*u,n[7]=e[7]*u,n[8]=e[8]*f,n[9]=e[9]*f,n[10]=e[10]*f,n[11]=e[11]*f,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function R_(n,e,r){var a=Math.sin(r),u=Math.cos(r),f=e[4],m=e[5],y=e[6],x=e[7],b=e[8],C=e[9],P=e[10],I=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=f*u+b*a,n[5]=m*u+C*a,n[6]=y*u+P*a,n[7]=x*u+I*a,n[8]=b*u-f*a,n[9]=C*u-m*a,n[10]=P*u-y*a,n[11]=I*u-x*a,n}function Rp(n,e,r){var a=Math.sin(r),u=Math.cos(r),f=e[0],m=e[1],y=e[2],x=e[3],b=e[8],C=e[9],P=e[10],I=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u-b*a,n[1]=m*u-C*a,n[2]=y*u-P*a,n[3]=x*u-I*a,n[8]=f*a+b*u,n[9]=m*a+C*u,n[10]=y*a+P*u,n[11]=x*a+I*u,n}function g1(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function _1(n,e,r){var a,u,f,m=r[0],y=r[1],x=r[2],b=Math.hypot(m,y,x);return b<Lp?null:(m*=b=1/b,y*=b,x*=b,a=Math.sin(e),u=Math.cos(e),n[0]=m*m*(f=1-u)+u,n[1]=y*m*f+x*a,n[2]=x*m*f-y*a,n[3]=0,n[4]=m*y*f-x*a,n[5]=y*y*f+u,n[6]=x*y*f+m*a,n[7]=0,n[8]=m*x*f+y*a,n[9]=y*x*f-m*a,n[10]=x*x*f+u,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var wM=kl;function B_(){var n=new Sr(3);return Sr!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function y1(n){var e=new Sr(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Jh(n){return Math.hypot(n[0],n[1],n[2])}function Zc(n,e,r){var a=new Sr(3);return a[0]=n,a[1]=e,a[2]=r,a}function zs(n,e,r){return n[0]=e[0]+r[0],n[1]=e[1]+r[1],n[2]=e[2]+r[2],n}function F_(n,e,r){return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],n}function v1(n,e,r){return n[0]=e[0]*r[0],n[1]=e[1]*r[1],n[2]=e[2]*r[2],n}function Qh(n,e,r){return n[0]=Math.min(e[0],r[0]),n[1]=Math.min(e[1],r[1]),n[2]=Math.min(e[2],r[2]),n}function ed(n,e,r){return n[0]=Math.max(e[0],r[0]),n[1]=Math.max(e[1],r[1]),n[2]=Math.max(e[2],r[2]),n}function Vr(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n}function td(n,e,r,a){return n[0]=e[0]+r[0]*a,n[1]=e[1]+r[1]*a,n[2]=e[2]+r[2]*a,n}function er(n,e){var r=e[0],a=e[1],u=e[2],f=r*r+a*a+u*u;return f>0&&(f=1/Math.sqrt(f)),n[0]=e[0]*f,n[1]=e[1]*f,n[2]=e[2]*f,n}function io(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function O_(n,e,r){var a=e[0],u=e[1],f=e[2],m=r[0],y=r[1],x=r[2];return n[0]=u*x-f*y,n[1]=f*m-a*x,n[2]=a*y-u*m,n}function Kn(n,e,r){var a=e[0],u=e[1],f=e[2],m=r[3]*a+r[7]*u+r[11]*f+r[15];return n[0]=(r[0]*a+r[4]*u+r[8]*f+r[12])/(m=m||1),n[1]=(r[1]*a+r[5]*u+r[9]*f+r[13])/m,n[2]=(r[2]*a+r[6]*u+r[10]*f+r[14])/m,n}function x1(n,e,r){var a=r[0],u=r[1],f=r[2],m=e[0],y=e[1],x=e[2],b=u*x-f*y,C=f*m-a*x,P=a*y-u*m,I=u*P-f*C,L=f*b-a*P,R=a*C-u*b,O=2*r[3];return C*=O,P*=O,L*=2,R*=2,n[0]=m+(b*=O)+(I*=2),n[1]=y+C+L,n[2]=x+P+R,n}var nd,zo=F_,bM=v1,TM=Jh;function w1(n,e,r){return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n}function b1(n,e){var r=e[0],a=e[1],u=e[2],f=e[3],m=r*r+a*a+u*u+f*f;return m>0&&(m=1/Math.sqrt(m)),n[0]=r*m,n[1]=a*m,n[2]=u*m,n[3]=f*m,n}function zl(n,e,r){var a=e[0],u=e[1],f=e[2],m=e[3];return n[0]=r[0]*a+r[4]*u+r[8]*f+r[12]*m,n[1]=r[1]*a+r[5]*u+r[9]*f+r[13]*m,n[2]=r[2]*a+r[6]*u+r[10]*f+r[14]*m,n[3]=r[3]*a+r[7]*u+r[11]*f+r[15]*m,n}function T1(){var n=new Sr(4);return Sr!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function E1(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function S1(n,e,r){r*=.5;var a=e[0],u=e[1],f=e[2],m=e[3],y=Math.sin(r),x=Math.cos(r);return n[0]=a*x+m*y,n[1]=u*x+f*y,n[2]=f*x-u*y,n[3]=m*x-a*y,n}function C1(n,e,r){r*=.5;var a=e[0],u=e[1],f=e[2],m=e[3],y=Math.sin(r),x=Math.cos(r);return n[0]=a*x-f*y,n[1]=u*x+m*y,n[2]=f*x+a*y,n[3]=m*x-u*y,n}B_(),nd=new Sr(4),Sr!=Float32Array&&(nd[0]=0,nd[1]=0,nd[2]=0,nd[3]=0);var EM=b1;B_(),Zc(1,0,0),Zc(0,1,0),T1(),T1(),p1();const SM=xe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:A1}=SM,M1=xe([{name:"a_pos_3",components:3,type:"Int16"}]);var id=xe([{name:"a_pos",type:"Int16",components:2}]);class U_{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,a){const u=io(r,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/u;return a[0]=this.pos[0]+this.dir[0]*f,a[1]=this.pos[1]+this.dir[1]*f,a[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,r,a){if(function(L,R){var O=L[0],Z=L[1],Q=L[2],ue=R[0],te=R[1],le=R[2];return Math.abs(O-ue)<=Lp*Math.max(1,Math.abs(O),Math.abs(ue))&&Math.abs(Z-te)<=Lp*Math.max(1,Math.abs(Z),Math.abs(te))&&Math.abs(Q-le)<=Lp*Math.max(1,Math.abs(Q),Math.abs(le))}(this.pos,e)||r===0)return a[0]=a[1]=a[2]=0,!1;const[u,f,m]=this.dir,y=this.pos[0]-e[0],x=this.pos[1]-e[1],b=this.pos[2]-e[2],C=u*u+f*f+m*m,P=2*(y*u+x*f+b*m),I=P*P-4*C*(y*y+x*x+b*b-r*r);if(I<0){const L=Math.max(-P/2,0),R=y+u*L,O=x+f*L,Z=b+m*L,Q=Math.hypot(R,O,Z);return a[0]=R*r/Q,a[1]=O*r/Q,a[2]=Z*r/Q,!1}{const L=(-P-Math.sqrt(I))/(2*C);if(L<0){const R=Math.hypot(y,x,b);return a[0]=y*r/R,a[1]=x*r/R,a[2]=b*r/R,!1}return a[0]=y+u*L,a[1]=x+f*L,a[2]=b+m*L,!0}}}class V_{constructor(e,r,a,u,f){this.TL=e,this.TR=r,this.BR=a,this.BL=u,this.horizon=f}static fromInvProjectionMatrix(e,r,a){const u=[-1,1,1],f=[1,1,1],m=[1,-1,1],y=[-1,-1,1],x=Kn(u,u,e),b=Kn(f,f,e),C=Kn(m,m,e),P=Kn(y,y,e);return new V_(x,b,C,P,r/a)}}class N_{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,a,u){const f=Math.pow(2,a),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const b=zl([],x,e),C=1/b[3]/r*f;return function(P,I,L){return P[0]=I[0]*L[0],P[1]=I[1]*L[1],P[2]=I[2]*L[2],P[3]=I[3]*L[3],P}(b,b,[C,C,u?1/b[3]:C,C])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const b=er([],O_([],zo([],m[x[0]],m[x[1]]),zo([],m[x[2]],m[x[1]]))),C=-io(b,m[x[1]]);return b.concat(C)});return new N_(m,y)}}class tr{static fromPoints(e){const r=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const u of e)Qh(r,r,u),ed(a,a,u);return new tr(r,a)}static applyTransform(e,r){const a=e.getCorners();for(let u=0;u<a.length;++u)Kn(a[u],a[u],r);return tr.fromPoints(a)}constructor(e,r){this.min=e,this.max=r,this.center=Vr([],zs([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],a=y1(this.min),u=y1(this.max);for(let f=0;f<r.length;f++)a[f]=r[f]?this.min[f]:this.center[f],u[f]=r[f]?this.center[f]:this.max[f];return u[2]=this.max[2],new tr(a,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let a=!0;for(let u=0;u<e.planes.length;u++){const f=e.planes[u];let m=0;for(let y=0;y<r.length;y++)m+=io(f,r[y])+f[3]>=0;if(m===0)return 0;m!==r.length&&(a=!1)}if(a)return 2;for(let u=0;u<3;u++){let f=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let y=0;y<e.points.length;y++){const x=e.points[y][u]-this.min[u];f=Math.min(f,x),m=Math.max(m,x)}if(m<0||f>this.max[u]-this.min[u])return 0}return 1}}const j_=5,P1=6,ns=Ct/Math.PI/2,CM=16383,Ll=64,rd=[Ll,32,16],ro=-ns,oo=ns,AM=[new tr([ro,ro,ro],[oo,oo,oo]),new tr([ro,ro,ro],[0,0,oo]),new tr([0,ro,ro],[oo,0,oo]),new tr([ro,0,ro],[0,oo,oo]),new tr([0,0,ro],[oo,oo,oo])];function Bp(n){return n*ns/ad}function I1(n,e,r,a=!0){const u=Vr([],n._camera.position,n.worldSize),f=[e,r,1,1];zl(f,f,n.pixelMatrixInverse),w1(f,f,1/f[3]);const m=er([],zo([],f,u)),y=n.globeMatrix,x=[y[12],y[13],y[14]],b=zo([],x,u),C=Jh(b),P=er([],b),I=n.worldSize/(2*Math.PI),L=io(P,m),R=Math.asin(I/C);if(R<Math.acos(L)){if(!a)return null;const et=[],ke=[];Vr(et,m,C/L),er(ke,zo(ke,et,b)),er(m,zs(m,b,Vr(m,ke,Math.tan(R)*C)))}const O=[];new U_(u,m).closestPointOnSphere(x,I,O);const Z=er([],Br(y,0)),Q=er([],Br(y,1)),ue=er([],Br(y,2)),te=io(Z,O),le=io(Q,O),pe=io(ue,O),fe=Jt(Math.asin(-le/I));let Pe=Jt(Math.atan2(te,pe));Pe=n.center.lng+function(et,ke){const Ge=(ke-et+180)%360-180;return Ge<-180?Ge+360:Ge}(n.center.lng,Pe);const Se=rs(Pe),Oe=Xe(os(fe),0,1);return new Hc(Se,Oe)}class MM{constructor(e,r,a){this.a=zo([],e,a),this.b=zo([],r,a),this.center=a;const u=er([],this.a),f=er([],this.b);this.angle=Math.acos(io(u,f))}}function G_(n,e){if(n.angle===0)return null;let r;return r=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),r<0||r>1?null:function(a,u,f,m){const y=Math.sin(f);return a*(Math.sin((1-m)*f)/y)+u*(Math.sin(m*f)/y)}(n.a[e],n.b[e],n.angle,Xe(r,0,1))+n.center[e]}function is(n){if(n.z<=1)return AM[n.z+2*n.y+n.x];const e=$_(Fp(n));return tr.fromPoints(e)}function Rl(n,e,r){return Vr(n,n,1-r),td(n,n,e,r)}function k1(n,e){const r=Xc(e.zoom);if(r===0)return is(n);const a=Fp(n),u=$_(a),f=rs(a.getWest())*e.worldSize,m=rs(a.getEast())*e.worldSize,y=os(a.getNorth())*e.worldSize,x=os(a.getSouth())*e.worldSize,b=[f,y,0],C=[m,y,0],P=[f,x,0],I=[m,x,0],L=L_([],e.globeMatrix);return Kn(b,b,L),Kn(C,C,L),Kn(P,P,L),Kn(I,I,L),u[0]=Rl(u[0],P,r),u[1]=Rl(u[1],I,r),u[2]=Rl(u[2],C,r),u[3]=Rl(u[3],b,r),tr.fromPoints(u)}function D1(n,e,r){for(const a of n)Kn(a,a,e),Vr(a,a,r)}function PM(n,e,r){const a=e/n.worldSize,u=n.globeMatrix;if(r.z<=1){const Se=is(r).getCorners();return D1(Se,u,a),tr.fromPoints(Se)}const f=Fp(r),m=$_(f);D1(m,u,a);const y=Number.MAX_VALUE,x=[-y,-y,-y],b=[y,y,y];if(f.contains(n.center)){for(const et of m)Qh(b,b,et),ed(x,x,et);x[2]=0;const Se=n.point,Oe=[Se.x*a,Se.y*a,0];return Qh(b,b,Oe),ed(x,x,Oe),new tr(b,x)}const C=[u[12]*a,u[13]*a,u[14]*a],P=f.getCenter(),I=Xe(n.center.lat,-Ui,Ui),L=Xe(P.lat,-Ui,Ui),R=rs(n.center.lng),O=os(I);let Z=R-rs(P.lng);const Q=O-os(L);Z>.5?Z-=1:Z<-.5&&(Z+=1);let ue=0;Math.abs(Z)>Math.abs(Q)?ue=Z>=0?1:3:(ue=Q>=0?0:2,td(C,C,[u[4]*a,u[5]*a,u[6]*a],-Math.sin(gt(Q>=0?f.getSouth():f.getNorth()))*ns));const te=m[ue],le=m[(ue+1)%4],pe=new MM(te,le,C),fe=[G_(pe,0)||te[0],G_(pe,1)||te[1],G_(pe,2)||te[2]],Pe=Xc(n.zoom);if(Pe>0){const Se=function({x:et,y:ke,z:Ge},$e,We,rt,Re){const ut=1/(1<<Ge);let yt=et*ut,ht=yt+ut,Bt=ke*ut,st=Bt+ut,Et=0;const Ft=(yt+ht)/2-rt;return Ft>.5?Et=-1:Ft<-.5&&(Et=1),yt=((yt+Et)*$e-(rt*=$e))*We+rt,ht=((ht+Et)*$e-rt)*We+rt,Bt=(Bt*$e-(Re*=$e))*We+Re,st=(st*$e-Re)*We+Re,[[yt,st,0],[ht,st,0],[ht,Bt,0],[yt,Bt,0]]}(r,e,n._pixelsPerMercatorPixel,R,O);for(let et=0;et<m.length;et++)Rl(m[et],Se[et],Pe);const Oe=zs([],Se[ue],Se[(ue+1)%4]);Vr(Oe,Oe,.5),Rl(fe,Oe,Pe)}for(const Se of m)Qh(b,b,Se),ed(x,x,Se);return b[2]=Math.min(te[2],le[2]),Qh(b,b,fe),ed(x,x,fe),new tr(b,x)}function Fp({x:n,y:e,z:r}){const a=1/(1<<r),u=new wn(Nr(n*a),Oi((e+1)*a)),f=new wn(Nr((n+1)*a),Oi(e*a));return new xa(u,f)}function $_(n){const e=gt(n.getNorth()),r=gt(n.getSouth()),a=Math.cos(e),u=Math.cos(r),f=Math.sin(e),m=Math.sin(r),y=n.getWest(),x=n.getEast();return[qc(u,m,y),qc(u,m,x),qc(a,f,x),qc(a,f,y)]}function qc(n,e,r,a=ns){return r=gt(r),[n*Math.sin(r)*a,-e*a,n*Math.cos(r)*a]}function Wc(n,e,r){return qc(Math.cos(gt(n)),Math.sin(gt(n)),e,r)}function od(n,e,r,a){const u=1<<r.z,f=(n/Ct+r.x)/u;return Wc(Oi((e/Ct+r.y)/u),Nr(f),a)}function Op({min:n,max:e}){return CM/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const z1=new Float64Array(16);function sd(n){const e=Op(n),r=g1(z1,[e,e,e]);return Yh(r,r,((a=[])[0]=-(u=n.min)[0],a[1]=-u[1],a[2]=-u[2],a));var a,u}function Z_(n){const e=(a=n.min,(r=z1)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=a[0],r[13]=a[1],r[14]=a[2],r[15]=1,r);var r,a;const u=1/Op(n);return Dl(e,e,[u,u,u])}function L1(n,e,r,a,u){const f=function(x){const b=Ct/(2*Math.PI);return x/(2*Math.PI)/b}(r),m=[n,e,-r/(2*Math.PI)],y=Do(new Float64Array(16));return Yh(y,y,m),Dl(y,y,[f,f,f]),R_(y,y,gt(-u)),Rp(y,y,gt(-a)),y}function Xc(n){return Mt(j_,P1,n)}function R1(n,e){const r=Wc(e.lat,e.lng),a=function(R){const O=Wc(R._center.lat,R._center.lng);let Z=O_([],Zc(0,1,0),O);const Q=_1([],-R.angle,O);Z=Kn(Z,Z,Q),_1(Q,-R._pitch,Z);const ue=er([],O);return Vr(ue,ue,Bp(R.cameraToCenterDistance/R.pixelsPerMeter)),Kn(ue,ue,Q),zs([],O,ue)}(n);return m=(u=F_([],a,r))[0],y=u[1],x=u[2],b=(f=r)[0],C=f[1],P=f[2],L=(I=Math.sqrt(m*m+y*y+x*x)*Math.sqrt(b*b+C*C+P*P))&&io(u,f)/I,Math.acos(Math.min(Math.max(L,-1),1));var u,f,m,y,x,b,C,P,I,L}function q_(n,e){return R1(n,e)>Math.PI/2*1.01}const B1=gt(85),IM=Math.cos(B1),kM=Math.sin(B1),ad=63710088e-1,F1=2*Math.PI*ad;class wa{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new wa(Tt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,u=e.lat*r,f=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((e.lng-this.lng)*r);return ad*Math.acos(Math.min(f,1))}toBounds(e=0){const r=360*e/40075017,a=r/Math.cos(Math.PI/180*this.lat);return new xa(new wa(this.lng-a,this.lat-r),new wa(this.lng+a,this.lat+r))}toEcef(e){const r=Bp(e);return Wc(this.lat,this.lng,ns+r)}static convert(e){if(e instanceof wa)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new wa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new wa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var wn=wa;function W_(n){return F1*Math.cos(n*Math.PI/180)}function rs(n){return(180+n)/360}function os(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Lo(n,e){return n/W_(e)}function Nr(n){return 360*n-180}function Oi(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function O1(n,e){return n*W_(Oi(e))}const Ui=85.051129;function U1(n){return 1/Math.cos(n*Math.PI/180)}class Hc{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=wn.convert(e);return new Hc(rs(a.lng),os(a.lat),Lo(r,a.lat))}toLngLat(){return new wn(Nr(this.x),Oi(this.y))}toAltitude(){return O1(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/F1*U1(Oi(this.y))}}function X_(n,e,r,a,u,f,m,y,x){const b=(e+a)/2,C=(r+u)/2,P=new ze(b,C);y(P),function(I,L,R,O,Z,Q){const ue=R-Z,te=O-Q;return Math.abs((O-L)*ue-(R-I)*te)/Math.hypot(ue,te)}(P.x,P.y,f.x,f.y,m.x,m.y)>=x?(X_(n,e,r,b,C,f,P,y,x),X_(n,b,C,a,u,P,m,y,x)):n.push(m)}function V1(n,e,r){let a=n[0],u=a.x,f=a.y;e(a);const m=[a];for(let y=1;y<n.length;y++){const x=n[y],{x:b,y:C}=x;e(x),X_(m,u,f,b,C,a,x,e,r),u=b,f=C,a=x}return m}function H_(n,e,r,a){if(a(e,r)){const u=e.add(r)._mult(.5);H_(n,e,u,a),H_(n,u,r,a)}else n.push(r)}function DM(n,e){let r=n[0];const a=[r];for(let u=1;u<n.length;u++){const f=n[u];H_(a,r,f,e),r=f}return a}const K_=Math.pow(2,14)-1,N1=-K_-1;function zM(n,e){const r=Math.round(n.x*e),a=Math.round(n.y*e);return n.x=Xe(r,N1,K_),n.y=Xe(a,N1,K_),(r<n.x||r>n.x+1||a<n.y||a>n.y+1)&&pn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function Ls(n,e,r){const a=n.loadGeometry(),u=n.extent,f=Ct/u;if(e&&r&&r.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:y,x,y:b,projection:C}=r,P=I=>{const L=Nr((e.x+I.x/u)/m),R=Oi((e.y+I.y/u)/m),O=C.project(L,R);I.x=(O.x*y-x)*u,I.y=(O.y*y-b)*u};for(let I=0;I<a.length;I++)if(n.type!==1)a[I]=V1(a[I],P,1);else{const L=[];for(const R of a[I])R.x<0||R.x>=u||R.y<0||R.y>=u||(P(R),L.push(R));a[I]=L}}for(const m of a)for(const y of m)zM(y,f);return a}function Bl(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Ls(n):[]}}function Up(n,e,r,a,u){n.emplaceBack(2*e+(a+1)/2,2*r+(u+1)/2)}function Vp(n,e,r){n.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Y_{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Qe,this.indexArray=new xt,this.segments=new ni,this.programConfigurations=new Il(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a,u){const f=this.layers[0],m=[];let y=null;f.type==="circle"&&(y=f.layout.get("circle-sort-key"));for(const{feature:b,id:C,index:P,sourceLayerIndex:I}of e){const L=this.layers[0]._featureFilter.needGeometry,R=Bl(b,L);if(!this.layers[0]._featureFilter.filter(new M(this.zoom),R,a))continue;const O=y?y.evaluate(R,{},a):void 0,Z={id:C,properties:b.properties,type:b.type,sourceLayerIndex:I,index:P,geometry:L?R.geometry:Ls(b,a,u),patterns:{},sortKey:O};m.push(Z)}y&&m.sort((b,C)=>b.sortKey-C.sortKey);let x=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new tt,x=u.projection);for(const b of m){const{geometry:C,index:P,sourceLayerIndex:I}=b,L=e[P].feature;this.addFeature(b,C,P,r.availableImages,a,x),r.featureIndex.insert(L,C,P,I,this.index)}}update(e,r,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vM.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,xM.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,a,u,f,m){for(const y of r)for(const x of y){const b=x.x,C=x.y;if(b<0||b>=Ct||C<0||C>=Ct)continue;if(m){const L=m.projectTilePoint(b,C,f),R=m.upVector(f,b,C),O=this.globeExtVertexArray;Vp(O,L,R),Vp(O,L,R),Vp(O,L,R),Vp(O,L,R)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),I=P.vertexLength;Up(this.layoutVertexArray,b,C,-1,-1),Up(this.layoutVertexArray,b,C,1,-1),Up(this.layoutVertexArray,b,C,1,1),Up(this.layoutVertexArray,b,C,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+2,I+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},u,f)}}function j1(n,e){for(let r=0;r<n.length;r++)if(Fl(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(Fl(n,e[r]))return!0;return!!J_(n,e)}function LM(n,e,r){return!!Fl(n,e)||!!Q_(e,n,r)}function G1(n,e){if(n.length===1)return Z1(e,n[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let u=0;u<a.length;u++)if(Fl(n,a[u]))return!0}for(let r=0;r<n.length;r++)if(Z1(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(J_(n,e[r]))return!0;return!1}function RM(n,e,r){if(n.length>1){if(J_(n,e))return!0;for(let a=0;a<e.length;a++)if(Q_(e[a],n,r))return!0}for(let a=0;a<n.length;a++)if(Q_(n[a],e,r))return!0;return!1}function J_(n,e){if(n.length===0||e.length===0)return!1;for(let r=0;r<n.length-1;r++){const a=n[r],u=n[r+1];for(let f=0;f<e.length-1;f++)if(BM(a,u,e[f],e[f+1]))return!0}return!1}function BM(n,e,r,a){return Gi(n,r,a)!==Gi(e,r,a)&&Gi(n,e,r)!==Gi(n,e,a)}function Q_(n,e,r){const a=r*r;if(e.length===1)return n.distSqr(e[0])<a;for(let u=1;u<e.length;u++)if($1(n,e[u-1],e[u])<a)return!0;return!1}function $1(n,e,r){const a=e.distSqr(r);if(a===0)return n.distSqr(e);const u=((n.x-e.x)*(r.x-e.x)+(n.y-e.y)*(r.y-e.y))/a;return n.distSqr(u<0?e:u>1?r:r.sub(e)._mult(u)._add(e))}function Z1(n,e){let r,a,u,f=!1;for(let m=0;m<n.length;m++){r=n[m];for(let y=0,x=r.length-1;y<r.length;x=y++)a=r[y],u=r[x],a.y>e.y!=u.y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(f=!f)}return f}function Fl(n,e){let r=!1;for(let a=0,u=n.length-1;a<n.length;u=a++){const f=n[a],m=n[u];f.y>e.y!=m.y>e.y&&e.x<(m.x-f.x)*(e.y-f.y)/(m.y-f.y)+f.x&&(r=!r)}return r}function q1(n,e,r,a,u){for(const m of n)if(e<=m.x&&r<=m.y&&a>=m.x&&u>=m.y)return!0;const f=[new ze(e,r),new ze(e,u),new ze(a,u),new ze(a,r)];if(n.length>2){for(const m of f)if(Fl(n,m))return!0}for(let m=0;m<n.length-1;m++)if(FM(n[m],n[m+1],f))return!0;return!1}function FM(n,e,r){const a=r[0],u=r[2];if(n.x<a.x&&e.x<a.x||n.x>u.x&&e.x>u.x||n.y<a.y&&e.y<a.y||n.y>u.y&&e.y>u.y)return!1;const f=Gi(n,e,r[0]);return f!==Gi(n,e,r[1])||f!==Gi(n,e,r[2])||f!==Gi(n,e,r[3])}function Kc(n,e,r){const a=e.paint.get(n).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(n)}function Np(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function W1(n,e,r,a,u){if(!e[0]&&!e[1])return n;const f=ze.convert(e)._mult(u);r==="viewport"&&f._rotate(-a);const m=[];for(let y=0;y<n.length;y++)m.push(n[y].sub(f));return m}function X1(n,e,r,a){const u=ze.convert(n)._mult(a);return e==="viewport"&&u._rotate(-r),u}mt(Y_,"CircleBucket",{omit:["layers"]});const OM=new ie({"circle-sort-key":new q(Fe.layout_circle["circle-sort-key"])});var UM={paint:new ie({"circle-radius":new q(Fe.paint_circle["circle-radius"]),"circle-color":new q(Fe.paint_circle["circle-color"]),"circle-blur":new q(Fe.paint_circle["circle-blur"]),"circle-opacity":new q(Fe.paint_circle["circle-opacity"]),"circle-translate":new F(Fe.paint_circle["circle-translate"]),"circle-translate-anchor":new F(Fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new F(Fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new F(Fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new q(Fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new q(Fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new q(Fe.paint_circle["circle-stroke-opacity"])}),layout:OM};function H1(n,e,r,a,u,f,m,y,x){if(f&&n.queryGeometry.isAboveHorizon)return!1;f&&(x*=n.pixelToTileUnitsFactor);const b=n.tileID.canonical,C=r.projection.upVectorScale(b,r.center.lat,r.worldSize).metersToTile;for(const P of e)for(const I of P){const L=I.add(y),R=u&&r.elevation?r.elevation.exaggeration()*u.getElevationAt(L.x,L.y,!0):0,O=r.projection.projectTilePoint(L.x,L.y,b);if(R>0){const te=r.projection.upVector(b,L.x,L.y);O.x+=te[0]*C*R,O.y+=te[1]*C*R,O.z+=te[2]*C*R}const Z=f?L:VM(O.x,O.y,O.z,a),Q=f?n.tilespaceRays.map(te=>jM(te,R)):n.queryGeometry.screenGeometry,ue=zl([],[O.x,O.y,O.z,1],a);if(!m&&f?x*=ue[3]/r.cameraToCenterDistance:m&&!f&&(x*=r.cameraToCenterDistance/ue[3]),f){const te=Oi((I.y/Ct+b.y)/(1<<b.z));x/=r.projection.pixelsPerMeter(te,1)/Lo(1,te)}if(LM(Q,Z,x))return!0}return!1}function VM(n,e,r,a){const u=zl([],[n,e,r,1],a);return new ze(u[0]/u[3],u[1]/u[3])}const K1=Zc(0,0,0),NM=Zc(0,0,1);function jM(n,e){const r=B_();return K1[2]=e,n.intersectsPlane(K1,NM,r),new ze(r[0],r[1])}class Y1 extends Y_{}function J1(n,{width:e,height:r},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*r*a)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*r*a);return n.width=e,n.height=r,n.data=u,n}function Q1(n,e,r){const{width:a,height:u}=e;a===n.width&&u===n.height||(ey(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,a),height:Math.min(n.height,u)},r),n.width=a,n.height=u,n.data=e.data)}function ey(n,e,r,a,u,f){if(u.width===0||u.height===0)return e;if(u.width>n.width||u.height>n.height||r.x>n.width-u.width||r.y>n.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const m=n.data,y=e.data;for(let x=0;x<u.height;x++){const b=((r.y+x)*n.width+r.x)*f,C=((a.y+x)*e.width+a.x)*f;for(let P=0;P<u.width*f;P++)y[C+P]=m[b+P]}return e}mt(Y1,"HeatmapBucket",{omit:["layers"]});class Rs{constructor(e,r){J1(this,e,1,r)}resize(e){Q1(this,new Rs(e),1)}clone(){return new Rs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,u,f){ey(e,r,a,u,f,1)}}class Cr{constructor(e,r){J1(this,e,4,r)}resize(e){Q1(this,new Cr(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Cr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,u,f){ey(e,r,a,u,f,4)}}mt(Rs,"AlphaImage"),mt(Cr,"RGBAImage");var GM={paint:new ie({"heatmap-radius":new q(Fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new q(Fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new F(Fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ne(Fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new F(Fe.paint_heatmap["heatmap-opacity"])})};function ty(n){const e={},r=n.resolution||256,a=n.clips?n.clips.length:1,u=n.image||new Cr({width:r,height:a}),f=(m,y,x)=>{e[n.evaluationKey]=x;const b=n.expression.evaluate(e);u.data[m+y+0]=Math.floor(255*b.r/b.a),u.data[m+y+1]=Math.floor(255*b.g/b.a),u.data[m+y+2]=Math.floor(255*b.b/b.a),u.data[m+y+3]=Math.floor(255*b.a)};if(n.clips)for(let m=0,y=0;m<a;++m,y+=4*r)for(let x=0,b=0;x<r;x++,b+=4){const C=x/(r-1),{start:P,end:I}=n.clips[m];f(y,b,P*(1-C)+I*C)}else for(let m=0,y=0;m<r;m++,y+=4)f(0,y,m/(r-1));return u}var $M={paint:new ie({"hillshade-illumination-direction":new F(Fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new F(Fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new F(Fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new F(Fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new F(Fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new F(Fe.paint_hillshade["hillshade-accent-color"])})};const ZM=xe([{name:"a_pos",components:2,type:"Int16"}],4),{members:qM}=ZM;var ny={exports:{}};function jp(n,e,r){r=r||2;var a,u,f,m,y,x,b,C=e&&e.length,P=C?e[0]*r:n.length,I=ew(n,0,P,r,!0),L=[];if(!I||I.next===I.prev)return L;if(C&&(I=function(O,Z,Q,ue){var te,le,pe,fe=[];for(te=0,le=Z.length;te<le;te++)(pe=ew(O,Z[te]*ue,te<le-1?Z[te+1]*ue:O.length,ue,!1))===pe.next&&(pe.steiner=!0),fe.push(eP(pe));for(fe.sort(YM),te=0;te<fe.length;te++)Q=JM(fe[te],Q);return Q}(n,e,I,r)),n.length>80*r){a=f=n[0],u=m=n[1];for(var R=r;R<P;R+=r)(y=n[R])<a&&(a=y),(x=n[R+1])<u&&(u=x),y>f&&(f=y),x>m&&(m=x);b=(b=Math.max(f-a,m-u))!==0?32767/b:0}return ld(I,L,r,a,u,b,0),L}function ew(n,e,r,a,u){var f,m;if(u===oy(n,e,r,a)>0)for(f=e;f<r;f+=a)m=iw(f,n[f],n[f+1],m);else for(f=r-a;f>=e;f-=a)m=iw(f,n[f],n[f+1],m);return m&&Gp(m,m.next)&&(ud(m),m=m.next),m}function Ol(n,e){if(!n)return n;e||(e=n);var r,a=n;do if(r=!1,a.steiner||!Gp(a,a.next)&&ii(a.prev,a,a.next)!==0)a=a.next;else{if(ud(a),(a=e=a.prev)===a.next)break;r=!0}while(r||a!==e);return e}function ld(n,e,r,a,u,f,m){if(n){!m&&f&&function(C,P,I,L){var R=C;do R.z===0&&(R.z=iy(R.x,R.y,P,I,L)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==C);R.prevZ.nextZ=null,R.prevZ=null,function(O){var Z,Q,ue,te,le,pe,fe,Pe,Se=1;do{for(Q=O,O=null,le=null,pe=0;Q;){for(pe++,ue=Q,fe=0,Z=0;Z<Se&&(fe++,ue=ue.nextZ);Z++);for(Pe=Se;fe>0||Pe>0&&ue;)fe!==0&&(Pe===0||!ue||Q.z<=ue.z)?(te=Q,Q=Q.nextZ,fe--):(te=ue,ue=ue.nextZ,Pe--),le?le.nextZ=te:O=te,te.prevZ=le,le=te;Q=ue}le.nextZ=null,Se*=2}while(pe>1)}(R)}(n,a,u,f);for(var y,x,b=n;n.prev!==n.next;)if(y=n.prev,x=n.next,f?XM(n,a,u,f):WM(n))e.push(y.i/r|0),e.push(n.i/r|0),e.push(x.i/r|0),ud(n),n=x.next,b=x.next;else if((n=x)===b){m?m===1?ld(n=HM(Ol(n),e,r),e,r,a,u,f,2):m===2&&KM(n,e,r,a,u,f):ld(Ol(n),e,r,a,u,f,1);break}}}function WM(n){var e=n.prev,r=n,a=n.next;if(ii(e,r,a)>=0)return!1;for(var u=e.x,f=r.x,m=a.x,y=e.y,x=r.y,b=a.y,C=u<f?u<m?u:m:f<m?f:m,P=y<x?y<b?y:b:x<b?x:b,I=u>f?u>m?u:m:f>m?f:m,L=y>x?y>b?y:b:x>b?x:b,R=a.next;R!==e;){if(R.x>=C&&R.x<=I&&R.y>=P&&R.y<=L&&Yc(u,y,f,x,m,b,R.x,R.y)&&ii(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function XM(n,e,r,a){var u=n.prev,f=n,m=n.next;if(ii(u,f,m)>=0)return!1;for(var y=u.x,x=f.x,b=m.x,C=u.y,P=f.y,I=m.y,L=y<x?y<b?y:b:x<b?x:b,R=C<P?C<I?C:I:P<I?P:I,O=y>x?y>b?y:b:x>b?x:b,Z=C>P?C>I?C:I:P>I?P:I,Q=iy(L,R,e,r,a),ue=iy(O,Z,e,r,a),te=n.prevZ,le=n.nextZ;te&&te.z>=Q&&le&&le.z<=ue;){if(te.x>=L&&te.x<=O&&te.y>=R&&te.y<=Z&&te!==u&&te!==m&&Yc(y,C,x,P,b,I,te.x,te.y)&&ii(te.prev,te,te.next)>=0||(te=te.prevZ,le.x>=L&&le.x<=O&&le.y>=R&&le.y<=Z&&le!==u&&le!==m&&Yc(y,C,x,P,b,I,le.x,le.y)&&ii(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;te&&te.z>=Q;){if(te.x>=L&&te.x<=O&&te.y>=R&&te.y<=Z&&te!==u&&te!==m&&Yc(y,C,x,P,b,I,te.x,te.y)&&ii(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;le&&le.z<=ue;){if(le.x>=L&&le.x<=O&&le.y>=R&&le.y<=Z&&le!==u&&le!==m&&Yc(y,C,x,P,b,I,le.x,le.y)&&ii(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function HM(n,e,r){var a=n;do{var u=a.prev,f=a.next.next;!Gp(u,f)&&tw(u,a,a.next,f)&&cd(u,f)&&cd(f,u)&&(e.push(u.i/r|0),e.push(a.i/r|0),e.push(f.i/r|0),ud(a),ud(a.next),a=n=f),a=a.next}while(a!==n);return Ol(a)}function KM(n,e,r,a,u,f){var m=n;do{for(var y=m.next.next;y!==m.prev;){if(m.i!==y.i&&tP(m,y)){var x=nw(m,y);return m=Ol(m,m.next),x=Ol(x,x.next),ld(m,e,r,a,u,f,0),void ld(x,e,r,a,u,f,0)}y=y.next}m=m.next}while(m!==n)}function YM(n,e){return n.x-e.x}function JM(n,e){var r=function(u,f){var m,y=f,x=u.x,b=u.y,C=-1/0;do{if(b<=y.y&&b>=y.next.y&&y.next.y!==y.y){var P=y.x+(b-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(P<=x&&P>C&&(C=P,m=y.x<y.next.x?y:y.next,P===x))return m}y=y.next}while(y!==f);if(!m)return null;var I,L=m,R=m.x,O=m.y,Z=1/0;y=m;do x>=y.x&&y.x>=R&&x!==y.x&&Yc(b<O?x:C,b,R,O,b<O?C:x,b,y.x,y.y)&&(I=Math.abs(b-y.y)/(x-y.x),cd(y,u)&&(I<Z||I===Z&&(y.x>m.x||y.x===m.x&&QM(m,y)))&&(m=y,Z=I)),y=y.next;while(y!==L);return m}(n,e);if(!r)return e;var a=nw(r,n);return Ol(a,a.next),Ol(r,r.next)}function QM(n,e){return ii(n.prev,n,e.prev)<0&&ii(e.next,n,n.next)<0}function iy(n,e,r,a,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*u|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function eP(n){var e=n,r=n;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==n);return r}function Yc(n,e,r,a,u,f,m,y){return(u-m)*(e-y)>=(n-m)*(f-y)&&(n-m)*(a-y)>=(r-m)*(e-y)&&(r-m)*(f-y)>=(u-m)*(a-y)}function tP(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(r,a){var u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==a.i&&u.next.i!==a.i&&tw(u,u.next,r,a))return!0;u=u.next}while(u!==r);return!1}(n,e)&&(cd(n,e)&&cd(e,n)&&function(r,a){var u=r,f=!1,m=(r.x+a.x)/2,y=(r.y+a.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&m<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next;while(u!==r);return f}(n,e)&&(ii(n.prev,n,e.prev)||ii(n,e.prev,e))||Gp(n,e)&&ii(n.prev,n,n.next)>0&&ii(e.prev,e,e.next)>0)}function ii(n,e,r){return(e.y-n.y)*(r.x-e.x)-(e.x-n.x)*(r.y-e.y)}function Gp(n,e){return n.x===e.x&&n.y===e.y}function tw(n,e,r,a){var u=Zp(ii(n,e,r)),f=Zp(ii(n,e,a)),m=Zp(ii(r,a,n)),y=Zp(ii(r,a,e));return u!==f&&m!==y||!(u!==0||!$p(n,r,e))||!(f!==0||!$p(n,a,e))||!(m!==0||!$p(r,n,a))||!(y!==0||!$p(r,e,a))}function $p(n,e,r){return e.x<=Math.max(n.x,r.x)&&e.x>=Math.min(n.x,r.x)&&e.y<=Math.max(n.y,r.y)&&e.y>=Math.min(n.y,r.y)}function Zp(n){return n>0?1:n<0?-1:0}function cd(n,e){return ii(n.prev,n,n.next)<0?ii(n,e,n.next)>=0&&ii(n,n.prev,e)>=0:ii(n,e,n.prev)<0||ii(n,n.next,e)<0}function nw(n,e){var r=new ry(n.i,n.x,n.y),a=new ry(e.i,e.x,e.y),u=n.next,f=e.prev;return n.next=e,e.prev=n,r.next=u,u.prev=r,a.next=r,r.prev=a,f.next=a,a.prev=f,a}function iw(n,e,r,a){var u=new ry(n,e,r);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function ud(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function ry(n,e,r){this.i=n,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function oy(n,e,r,a){for(var u=0,f=e,m=r-a;f<r;f+=a)u+=(n[m]-n[f])*(n[f+1]+n[m+1]),m=f;return u}ny.exports=jp,ny.exports.default=jp,jp.deviation=function(n,e,r,a){var u=e&&e.length,f=Math.abs(oy(n,0,u?e[0]*r:n.length,r));if(u)for(var m=0,y=e.length;m<y;m++)f-=Math.abs(oy(n,e[m]*r,m<y-1?e[m+1]*r:n.length,r));var x=0;for(m=0;m<a.length;m+=3){var b=a[m]*r,C=a[m+1]*r,P=a[m+2]*r;x+=Math.abs((n[b]-n[P])*(n[C+1]-n[b+1])-(n[b]-n[C])*(n[P+1]-n[b+1]))}return f===0&&x===0?0:Math.abs((x-f)/f)},jp.flatten=function(n){for(var e=n[0][0].length,r={vertices:[],holes:[],dimensions:e},a=0,u=0;u<n.length;u++){for(var f=0;f<n[u].length;f++)for(var m=0;m<e;m++)r.vertices.push(n[u][f][m]);u>0&&r.holes.push(a+=n[u-1].length)}return r};var sy=se(ny.exports);function nP(n,e,r,a,u){rw(n,e,r||0,a||n.length-1,u||iP)}function rw(n,e,r,a,u){for(;a>r;){if(a-r>600){var f=a-r+1,m=e-r+1,y=Math.log(f),x=.5*Math.exp(2*y/3),b=.5*Math.sqrt(y*x*(f-x)/f)*(m-f/2<0?-1:1);rw(n,e,Math.max(r,Math.floor(e-m*x/f+b)),Math.min(a,Math.floor(e+(f-m)*x/f+b)),u)}var C=n[e],P=r,I=a;for(hd(n,r,e),u(n[a],C)>0&&hd(n,r,a);P<I;){for(hd(n,P,I),P++,I--;u(n[P],C)<0;)P++;for(;u(n[I],C)>0;)I--}u(n[r],C)===0?hd(n,r,I):hd(n,++I,a),I<=e&&(r=I+1),e<=I&&(a=I-1)}}function hd(n,e,r){var a=n[e];n[e]=n[r],n[r]=a}function iP(n,e){return n<e?-1:n>e?1:0}function ay(n,e){const r=n.length;if(r<=1)return[n];const a=[];let u,f;for(let m=0;m<r;m++){const y=Wo(n[m]);y!==0&&(n[m].area=Math.abs(y),f===void 0&&(f=y<0),f===y<0?(u&&a.push(u),u=[n[m]]):u.push(n[m]))}if(u&&a.push(u),e>1)for(let m=0;m<a.length;m++)a[m].length<=e||(nP(a[m],e,1,a[m].length-1,rP),a[m]=a[m].slice(0,e));return a}function rP(n,e){return e.area-n.area}function ly(n,e,r){const a=r.patternDependencies;let u=!1;for(const f of e){const m=f.paint.get(`${n}-pattern`);m.isConstant()||(u=!0);const y=m.constantOr(null);y&&(u=!0,a[y]=!0)}return u}function cy(n,e,r,a,u){const f=u.patternDependencies;for(const m of e){const y=m.paint.get(`${n}-pattern`).value;if(y.kind!=="constant"){let x=y.evaluate({zoom:a},r,{},u.availableImages);x=x&&x.name?x.name:x,f[x]=!0,r.patterns[m.id]=x}}return r}class qp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Qe,this.indexArray=new xt,this.indexArray2=new bi,this.programConfigurations=new Il(e.layers,e.zoom),this.segments=new ni,this.segments2=new ni,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}populate(e,r,a,u){this.hasPattern=ly("fill",this.layers,r);const f=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:y,id:x,index:b,sourceLayerIndex:C}of e){const P=this.layers[0]._featureFilter.needGeometry,I=Bl(y,P);if(!this.layers[0]._featureFilter.filter(new M(this.zoom),I,a))continue;const L=f?f.evaluate(I,{},a,r.availableImages):void 0,R={id:x,properties:y.properties,type:y.type,sourceLayerIndex:C,index:b,geometry:P?I.geometry:Ls(y,a,u),patterns:{},sortKey:L};m.push(R)}f&&m.sort((y,x)=>y.sortKey-x.sortKey);for(const y of m){const{geometry:x,index:b,sourceLayerIndex:C}=y;if(this.hasPattern){const P=cy("fill",this.layers,y,this.zoom,r);this.patternFeatures.push(P)}else this.addFeature(y,x,b,a,{},r.availableImages);r.featureIndex.insert(e[b].feature,x,b,C,this.index)}}update(e,r,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,u)}addFeatures(e,r,a,u,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,r,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qM),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,u,f,m=[]){for(const y of ay(r,500)){let x=0;for(const R of y)x+=R.length;const b=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),C=b.vertexLength,P=[],I=[];for(const R of y){if(R.length===0)continue;R!==y[0]&&I.push(P.length/2);const O=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),Z=O.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(Z+R.length-1,Z),P.push(R[0].x),P.push(R[0].y);for(let Q=1;Q<R.length;Q++)this.layoutVertexArray.emplaceBack(R[Q].x,R[Q].y),this.indexArray2.emplaceBack(Z+Q-1,Z+Q),P.push(R[Q].x),P.push(R[Q].y);O.vertexLength+=R.length,O.primitiveLength+=R.length}const L=sy(P,I);for(let R=0;R<L.length;R+=3)this.indexArray.emplaceBack(C+L[R],C+L[R+1],C+L[R+2]);b.vertexLength+=x,b.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,m,u)}}mt(qp,"FillBucket",{omit:["layers","patternFeatures"]});const oP=new ie({"fill-sort-key":new q(Fe.layout_fill["fill-sort-key"])});var sP={paint:new ie({"fill-antialias":new F(Fe.paint_fill["fill-antialias"]),"fill-opacity":new q(Fe.paint_fill["fill-opacity"]),"fill-color":new q(Fe.paint_fill["fill-color"]),"fill-outline-color":new q(Fe.paint_fill["fill-outline-color"]),"fill-translate":new F(Fe.paint_fill["fill-translate"]),"fill-translate-anchor":new F(Fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new q(Fe.paint_fill["fill-pattern"])}),layout:oP};const aP=xe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),lP=xe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),cP=xe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:uP}=aP;var Wp={},hP=Ye,ow=Jc;function Jc(n,e,r,a,u){this.properties={},this.extent=r,this.type=0,this._pbf=n,this._geometry=-1,this._keys=a,this._values=u,n.readFields(dP,this,e)}function dP(n,e,r){n==1?e.id=r.readVarint():n==2?function(a,u){for(var f=a.readVarint()+a.pos;a.pos<f;){var m=u._keys[a.readVarint()],y=u._values[a.readVarint()];u.properties[m]=y}}(r,e):n==3?e.type=r.readVarint():n==4&&(e._geometry=r.pos)}function fP(n){for(var e,r,a=0,u=0,f=n.length,m=f-1;u<f;m=u++)a+=((r=n[m]).x-(e=n[u]).x)*(e.y+r.y);return a}Jc.types=["Unknown","Point","LineString","Polygon"],Jc.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,r=n.readVarint()+n.pos,a=1,u=0,f=0,m=0,y=[];n.pos<r;){if(u<=0){var x=n.readVarint();a=7&x,u=x>>3}if(u--,a===1||a===2)f+=n.readSVarint(),m+=n.readSVarint(),a===1&&(e&&y.push(e),e=[]),e.push(new hP(f,m));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&y.push(e),y},Jc.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,r=1,a=0,u=0,f=0,m=1/0,y=-1/0,x=1/0,b=-1/0;n.pos<e;){if(a<=0){var C=n.readVarint();r=7&C,a=C>>3}if(a--,r===1||r===2)(u+=n.readSVarint())<m&&(m=u),u>y&&(y=u),(f+=n.readSVarint())<x&&(x=f),f>b&&(b=f);else if(r!==7)throw new Error("unknown command "+r)}return[m,x,y,b]},Jc.prototype.toGeoJSON=function(n,e,r){var a,u,f=this.extent*Math.pow(2,r),m=this.extent*n,y=this.extent*e,x=this.loadGeometry(),b=Jc.types[this.type];function C(L){for(var R=0;R<L.length;R++){var O=L[R];L[R]=[360*(O.x+m)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(O.y+y)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(a=0;a<x.length;a++)P[a]=x[a][0];C(x=P);break;case 2:for(a=0;a<x.length;a++)C(x[a]);break;case 3:for(x=function(L){var R=L.length;if(R<=1)return[L];for(var O,Z,Q=[],ue=0;ue<R;ue++){var te=fP(L[ue]);te!==0&&(Z===void 0&&(Z=te<0),Z===te<0?(O&&Q.push(O),O=[L[ue]]):O.push(L[ue]))}return O&&Q.push(O),Q}(x),a=0;a<x.length;a++)for(u=0;u<x[a].length;u++)C(x[a][u])}x.length===1?x=x[0]:b="Multi"+b;var I={type:"Feature",geometry:{type:b,coordinates:x},properties:this.properties};return"id"in this&&(I.id=this.id),I};var pP=ow,sw=aw;function aw(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(mP,this,e),this.length=this._features.length}function mP(n,e,r){n===15?e.version=r.readVarint():n===1?e.name=r.readString():n===5?e.extent=r.readVarint():n===2?e._features.push(r.pos):n===3?e._keys.push(r.readString()):n===4&&e._values.push(function(a){for(var u=null,f=a.readVarint()+a.pos;a.pos<f;){var m=a.readVarint()>>3;u=m===1?a.readString():m===2?a.readFloat():m===3?a.readDouble():m===4?a.readVarint64():m===5?a.readVarint():m===6?a.readSVarint():m===7?a.readBoolean():null}return u}(r))}aw.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new pP(this._pbf,e,this.extent,this._keys,this._values)};var gP=sw;function _P(n,e,r){if(n===3){var a=new gP(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}var uy=Wp.VectorTile=function(n,e){this.layers=n.readFields(_P,{},e)},Xp=Wp.VectorTileFeature=ow;function Hp(n,e,r,a){const u=[],f=a===0?(m,y,x,b,C,P)=>{m.push(new ze(P,x+(P-y)/(b-y)*(C-x)))}:(m,y,x,b,C,P)=>{m.push(new ze(y+(P-x)/(C-x)*(b-y),P))};for(const m of n){const y=[];for(const x of m){if(x.length<=2)continue;const b=[];for(let I=0;I<x.length-1;I++){const L=x[I].x,R=x[I].y,O=x[I+1].x,Z=x[I+1].y,Q=a===0?L:R,ue=a===0?O:Z;Q<e?ue>e&&f(b,L,R,O,Z,e):Q>r?ue<r&&f(b,L,R,O,Z,r):b.push(x[I]),ue<e&&Q>=e&&f(b,L,R,O,Z,e),ue>r&&Q<=r&&f(b,L,R,O,Z,r)}let C=x[x.length-1];const P=a===0?C.x:C.y;P>=e&&P<=r&&b.push(C),b.length&&(C=b[b.length-1],b[0].x===C.x&&b[0].y===C.y||b.push(b[0]),y.push(b))}y.length&&u.push(y)}return u}Wp.VectorTileLayer=sw;const yP=Xp.types,vP=Math.pow(2,13);function dd(n,e,r,a,u,f,m,y){n.emplaceBack((e<<1)+m,(r<<1)+f,(Math.floor(a*vP)<<1)+u,Math.round(y))}function fd(n,e,r){n.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class lw{constructor(){this.acc=new ze(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ze(e.x,e.y),this.max=new ze(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);const a=this.min,u=this.max;e.x<a.x?a.x=e.x:e.x>u.x&&(u.x=e.x),e.y<a.y?a.y=e.y:e.y>u.y&&(u.y=e.y),((e.x===0||e.x===Ct)&&e.x===r.x)!=((e.y===0||e.y===Ct)&&e.y===r.y)&&this.processBorderOverlap(e,r),r.x<0!=e.x<0&&this.addBorderIntersection(0,Yt(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>Ct!=e.x>Ct&&this.addBorderIntersection(1,Yt(r.y,e.y,(Ct-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,Yt(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>Ct!=e.y>Ct&&this.addBorderIntersection(3,Yt(r.x,e.x,(Ct-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];r<a[0]&&(a[0]=r),r>a[1]&&(a[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,r.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,r.x),this.addBorderIntersection(a,e.x)}}centroid(){const e=this.polyCount.reduce((r,a)=>r+a.edges,0);return e!==0?this.acc.div(e)._round():new ze(0,0)}span(){return new ze(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class pd{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new je,this.centroidVertexArray=new Po,this.indexArray=new xt,this.programConfigurations=new Il(e.layers,e.zoom),this.segments=new ni,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,a,u){this.features=[],this.hasPattern=ly("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(f){const m=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*m/(m*m+1)/Ct/(1<<f.z)}(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:f,id:m,index:y,sourceLayerIndex:x}of e){const b=this.layers[0]._featureFilter.needGeometry,C=Bl(f,b);if(!this.layers[0]._featureFilter.filter(new M(this.zoom),C,a))continue;const P={id:m,sourceLayerIndex:x,index:y,geometry:b?C.geometry:Ls(f,a,u),properties:f.properties,type:f.type,patterns:{}},I=this.layoutVertexArray.length;this.hasPattern?this.features.push(cy("fill-extrusion",this.layers,P,this.zoom,r)):this.addFeature(P,P.geometry,y,a,{},r.availableImages,u),r.featureIndex.insert(f,P.geometry,y,x,this.index,I)}this.sortBorders()}addFeatures(e,r,a,u,f){for(const m of this.features){const{geometry:y}=m;this.addFeature(m,y,m.index,r,a,u,f)}this.sortBorders()}update(e,r,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,uP),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,cP.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,lP.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,u,f,m,y){const x=[new ze(0,0),new ze(Ct,Ct)],b=y.projection,C=b.name==="globe",P=this.enableTerrain&&!C?new lw:null,I=yP[e.type]==="Polygon";C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new tt);const L=ay(r,500);for(let Q=L.length-1;Q>=0;Q--){const ue=L[Q];(ue.length===0||(R=ue[0]).every(te=>te.x<=0)||R.every(te=>te.x>=Ct)||R.every(te=>te.y<=0)||R.every(te=>te.y>=Ct))&&L.splice(Q,1)}var R;let O;if(C)O=mw(L,x,u);else{O=[];for(const Q of L)O.push({polygon:Q,bounds:x})}const Z=I?this.edgeRadius:0;for(const{polygon:Q,bounds:ue}of O){let te=0,le=0;for(const fe of Q)I&&!fe[0].equals(fe[fe.length-1])&&fe.push(fe[0]),le+=I?fe.length-1:fe.length;const pe=this.segments.prepareSegment((I?5:4)*le,this.layoutVertexArray,this.indexArray);if(I){const fe=[],Pe=[];te=pe.vertexLength;for(const Oe of Q){let et,ke;Oe.length&&Oe!==Q[0]&&Pe.push(fe.length/2),et=Oe[1].sub(Oe[0])._perp()._unit();for(let Ge=1;Ge<Oe.length;Ge++){const $e=Oe[Ge],We=Oe[Ge===Oe.length-1?1:Ge+1];let{x:rt,y:Re}=$e;if(Z){ke=We.sub($e)._perp()._unit();const ut=et.add(ke)._unit(),yt=Z*Math.min(4,1/(et.x*ut.x+et.y*ut.y));rt+=yt*ut.x,Re+=yt*ut.y,et=ke}dd(this.layoutVertexArray,rt,Re,0,0,1,1,0),pe.vertexLength++,fe.push($e.x,$e.y),C&&fd(this.layoutVertexExtArray,b.projectTilePoint(rt,Re,u),b.upVector(u,rt,Re))}}const Se=sy(fe,Pe);for(let Oe=0;Oe<Se.length;Oe+=3)this.indexArray.emplaceBack(te+Se[Oe],te+Se[Oe+2],te+Se[Oe+1]),pe.primitiveLength++}for(const fe of Q){P&&fe.length&&P.startRing(fe[0]);let Pe,Se,Oe,et=fe.length>4&&dw(fe[fe.length-2],fe[0],fe[1]),ke=Z?xP(fe[fe.length-2],fe[0],fe[1],Z):0;Se=fe[1].sub(fe[0])._perp()._unit();let Ge=!0;for(let $e=1,We=0;$e<fe.length;$e++){let rt=fe[$e-1],Re=fe[$e];const ut=fe[$e===fe.length-1?1:$e+1];if(P&&I&&P.currentPolyCount.top++,hw(Re,rt,ue)){Z&&(Se=ut.sub(Re)._perp()._unit(),Ge=!Ge);continue}P&&P.append(Re,rt);const yt=Re.sub(rt)._perp(),ht=yt.x/(Math.abs(yt.x)+Math.abs(yt.y)),Bt=yt.y>0?1:0,st=rt.dist(Re);if(We+st>32768&&(We=0),Z){Oe=ut.sub(Re)._perp()._unit();let Ot=uw(rt,Re,ut,cw(Se,Oe),Z);isNaN(Ot)&&(Ot=0);const Pt=Re.sub(rt)._unit();rt=rt.add(Pt.mult(ke))._round(),Re=Re.add(Pt.mult(-Ot))._round(),ke=Ot,Se=Oe}const Et=pe.vertexLength,Ft=fe.length>4&&dw(rt,Re,ut);let tn=fw(We,et,Ge);if(dd(this.layoutVertexArray,rt.x,rt.y,ht,Bt,0,0,tn),dd(this.layoutVertexArray,rt.x,rt.y,ht,Bt,0,1,tn),We+=st,tn=fw(We,Ft,!Ge),et=Ft,dd(this.layoutVertexArray,Re.x,Re.y,ht,Bt,0,0,tn),dd(this.layoutVertexArray,Re.x,Re.y,ht,Bt,0,1,tn),pe.vertexLength+=4,this.indexArray.emplaceBack(Et+0,Et+1,Et+2),this.indexArray.emplaceBack(Et+1,Et+3,Et+2),pe.primitiveLength+=2,Z){const Ot=te+($e===1?fe.length-2:$e-2),Pt=$e===1?te:Ot+1;if(this.indexArray.emplaceBack(Et+1,Ot,Et+3),this.indexArray.emplaceBack(Ot,Pt,Et+3),pe.primitiveLength+=2,Pe===void 0&&(Pe=Et),!hw(ut,fe[$e],ue)){const Dn=$e===fe.length-1?Pe:pe.vertexLength;this.indexArray.emplaceBack(Et+2,Et+3,Dn),this.indexArray.emplaceBack(Et+3,Dn+1,Dn),this.indexArray.emplaceBack(Et+3,Pt,Dn+1),pe.primitiveLength+=3}Ge=!Ge}if(C){const Ot=this.layoutVertexExtArray,Pt=b.projectTilePoint(rt.x,rt.y,u),Dn=b.projectTilePoint(Re.x,Re.y,u),Nt=b.upVector(u,rt.x,rt.y),jt=b.upVector(u,Re.x,Re.y);fd(Ot,Pt,Nt),fd(Ot,Pt,Nt),fd(Ot,Dn,jt),fd(Ot,Dn,jt)}}I&&(te+=fe.length-1)}}if(P&&P.polyCount.length>0){if(P.borders){P.vertexArrayOffset=this.centroidVertexArray.length;const Q=P.borders,ue=this.featuresOnBorder.push(P)-1;for(let te=0;te<4;te++)Q[te][0]!==Number.MAX_VALUE&&this.borders[te].push(ue)}this.encodeCentroid(P.borders?void 0:P.centroid(),P)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,m,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,a)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}encodeCentroid(e,r,a=!0){let u,f;if(e)if(e.y!==0){const y=r.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(y.x/10)),f=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else u=Math.ceil(7*(e.x+450)),f=0;else u=0,f=+a;let m=a?this.centroidVertexArray.length:r.vertexArrayOffset;for(const y of r.polyCount){a&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let x=0;x<y.top;x++)this.centroidVertexArray.emplace(m++,u,f);for(let x=0;x<2*y.edges;x++)this.centroidVertexArray.emplace(m++,0,f),this.centroidVertexArray.emplace(m++,u,f)}}}function cw(n,e){const r=n.add(e)._unit();return n.x*r.x+n.y*r.y}function xP(n,e,r,a){const u=e.sub(n)._perp()._unit(),f=r.sub(e)._perp()._unit();return uw(n,e,r,cw(u,f),a)}function uw(n,e,r,a,u){const f=Math.sqrt(1-a*a);return Math.min(n.dist(e)/3,e.dist(r)/3,u*f/a)}function hw(n,e,r){return n.x<r[0].x&&e.x<r[0].x||n.x>r[1].x&&e.x>r[1].x||n.y<r[0].y&&e.y<r[0].y||n.y>r[1].y&&e.y>r[1].y}function dw(n,e,r){if(n.x<0||n.x>=Ct||e.x<0||e.x>=Ct||r.x<0||r.x>=Ct)return!1;const a=r.sub(e),u=a.perp(),f=n.sub(e);return(a.x*f.x+a.y*f.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(f.x*f.x+f.y*f.y))>-.866&&u.x*f.x+u.y*f.y<0}function fw(n,e,r){const a=e?2|n:-3&n;return r?1|a:-2&a}function pw(){const n=Math.PI/32,e=Math.tan(n),r=ad;return r*Math.sqrt(1+2*e*e)-r}function mw(n,e,r){const a=1<<r.z,u=Nr(r.x/a),f=Nr((r.x+1)/a),m=Oi(r.y/a),y=Oi((r.y+1)/a);return function(x,b,C,P,I=0,L){const R=[];if(!x.length||!C||!P)return R;const O=(fe,Pe)=>{for(const Se of fe)R.push({polygon:Se,bounds:Pe})},Z=Math.ceil(Math.log2(C)),Q=Math.ceil(Math.log2(P)),ue=Z-Q,te=[];for(let fe=0;fe<Math.abs(ue);fe++)te.push(ue>0?0:1);for(let fe=0;fe<Math.min(Z,Q);fe++)te.push(0),te.push(1);let le=x;if(le=Hp(le,b[0].y-I,b[1].y+I,1),le=Hp(le,b[0].x-I,b[1].x+I,0),!le.length)return R;const pe=[];for(te.length?pe.push({polygons:le,bounds:b,depth:0}):O(le,b);pe.length;){const fe=pe.pop(),Pe=fe.depth,Se=te[Pe],Oe=fe.bounds[0],et=fe.bounds[1],ke=Se===0?Oe.x:Oe.y,Ge=Se===0?et.x:et.y,$e=L?L(Se,ke,Ge):.5*(ke+Ge),We=Hp(fe.polygons,ke-I,$e+I,Se),rt=Hp(fe.polygons,$e-I,Ge+I,Se);if(We.length){const Re=[Oe,new ze(Se===0?$e:et.x,Se===1?$e:et.y)];te.length>Pe+1?pe.push({polygons:We,bounds:Re,depth:Pe+1}):O(We,Re)}if(rt.length){const Re=[new ze(Se===0?$e:Oe.x,Se===1?$e:Oe.y),et];te.length>Pe+1?pe.push({polygons:rt,bounds:Re,depth:Pe+1}):O(rt,Re)}}return R}(n,e,Math.ceil((f-u)/11.25),Math.ceil((m-y)/11.25),1,(x,b,C)=>{if(x===0)return .5*(b+C);{const P=Oi((r.y+b/Ct)/a);return(os(.5*(Oi((r.y+C/Ct)/a)+P))*a-r.y)*Ct}})}mt(pd,"FillExtrusionBucket",{omit:["layers","features"]}),mt(lw,"PartMetadata");const wP=new ie({"fill-extrusion-edge-radius":new F(Fe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var bP={paint:new ie({"fill-extrusion-opacity":new F(Fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new q(Fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new F(Fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new F(Fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new q(Fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new q(Fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new q(Fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new F(Fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new F(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new F(Fe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new F(Fe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:wP};function gw(n,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[n*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class Kp{constructor(e,r,a){this.z=e,this.x=r,this.y=a,this.key=md(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const a=function(f,m,y){var x=gw(256*f,256*(m=Math.pow(2,y)-m-1),y),b=gw(256*(f+1),256*(m+1),y);return x[0]+","+x[1]+","+b[0]+","+b[1]}(this.x,this.y,this.z),u=function(f,m,y){let x,b="";for(let C=f;C>0;C--)x=1<<C-1,b+=(m&x?1:0)+(y&x?2:0);return b}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class _w{constructor(e,r){this.wrap=e,this.canonical=r,this.key=md(e,r.z,r.z,r.x,r.y)}}class nr{constructor(e,r,a,u,f){this.overscaledZ=e,this.wrap=r,this.canonical=new Kp(a,+u,+f),this.key=r===0&&e===a?this.canonical.key:md(r,e,a,u,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new nr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new nr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return md(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return md(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new nr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new nr(r,this.wrap,r,a,u),new nr(r,this.wrap,r,a+1,u),new nr(r,this.wrap,r,a,u+1),new nr(r,this.wrap,r,a+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new nr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new nr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new _w(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function md(n,e,r,a,u){const f=1<<Math.min(r,22);let m=f*(u%f)+a%f;return n&&r<22&&(m+=f*f*((n<0?-2*n-1:2*n)%(1<<2*(22-r)))),16*(32*m+r)+(e-r)}mt(Kp,"CanonicalTileID"),mt(nr,"OverscaledTileID",{omit:["projMatrix"]});class Qc extends ze{constructor(e,r,a){super(e,r),this.z=a}}function gd(n,e){return n.x*e.x+n.y*e.y}function yw(n,e){if(n.length===1){let r=0;const a=e[r++];let u;for(;!u||a.equals(u);)if(u=e[r++],!u)return 1/0;for(;r<e.length;r++){const f=e[r],m=n[0],y=u.sub(a),x=f.sub(a),b=m.sub(a),C=gd(y,y),P=gd(y,x),I=gd(x,x),L=gd(b,y),R=gd(b,x),O=C*I-P*P,Z=(I*L-P*R)/O,Q=(C*R-P*L)/O,ue=a.z*(1-Z-Q)+u.z*Z+f.z*Q;if(isFinite(ue))return ue}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}function vw(n,e,r,a,u,f,m,y){const x=m*u.getElevationAt(n,e,!0,!0),b=f[0]!==0,C=b?f[1]===0?m*(f[0]/7-450):m*function(P,I,L){const R=Math.floor(I[0]/8),O=Math.floor(I[1]/8),Z=10*(I[0]-8*R),Q=10*(I[1]-8*O),ue=P.getElevationAt(R,O,!0,!0),te=P.getMeterToDEM(L),le=Math.floor(.5*(Z*te-1)),pe=Math.floor(.5*(Q*te-1)),fe=P.tileCoordToPixel(R,O),Pe=2*le+1,Se=2*pe+1,Oe=function(rt,Re,ut,yt,ht){return[rt.getElevationAtPixel(Re,ut,!0),rt.getElevationAtPixel(Re+ht,ut,!0),rt.getElevationAtPixel(Re,ut+ht,!0),rt.getElevationAtPixel(Re+yt,ut+ht,!0)]}(P,fe.x-le,fe.y-pe,Pe,Se),et=Math.abs(Oe[0]-Oe[1]),ke=Math.abs(Oe[2]-Oe[3]),Ge=Math.abs(Oe[0]-Oe[2])+Math.abs(Oe[1]-Oe[3]),$e=Math.min(.25,.5*te*(et+ke)/Pe),We=Math.min(.25,.5*te*Ge/Se);return ue+Math.max($e*Z,We*Q)}(u,f,y):x;return{base:x+(r===0)?-1:r,top:b?Math.max(C+a,x+r+2):x+a}}const TP=xe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:EP}=TP,SP=xe([{name:"a_packed",components:4,type:"Float32"}]),{members:CP}=SP,AP=Xp.types,MP=Math.cos(Math.PI/180*37.5);class Yp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Ie,this.layoutVertexArray2=new Ke,this.indexArray=new xt,this.programConfigurations=new Il(e.layers,e.zoom),this.segments=new ni,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a,u){this.hasPattern=ly("line",this.layers,r);const f=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:C,id:P,index:I,sourceLayerIndex:L}of e){const R=this.layers[0]._featureFilter.needGeometry,O=Bl(C,R);if(!this.layers[0]._featureFilter.filter(new M(this.zoom),O,a))continue;const Z=f?f.evaluate(O,{},a):void 0,Q={id:P,properties:C.properties,type:C.type,sourceLayerIndex:L,index:I,geometry:R?O.geometry:Ls(C,a,u),patterns:{},sortKey:Z};m.push(Q)}f&&m.sort((C,P)=>C.sortKey-P.sortKey);const{lineAtlas:y,featureIndex:x}=r,b=this.addConstantDashes(y);for(const C of m){const{geometry:P,index:I,sourceLayerIndex:L}=C;if(b&&this.addFeatureDashes(C,y),this.hasPattern){const R=cy("line",this.layers,C,this.zoom,r);this.patternFeatures.push(R)}else this.addFeature(C,P,I,a,y.positions,r.availableImages);x.insert(e[I].feature,P,I,L,this.index)}}addConstantDashes(e){let r=!1;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,f=a.layout.get("line-cap").value;if(u.kind!=="constant"||f.kind!=="constant")r=!0;else{const m=f.value,y=u.value;if(!y)continue;e.addDash(y,m)}}return r}addFeatureDashes(e,r){const a=this.zoom;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if(f.kind==="constant"&&m.kind==="constant")continue;let y,x;if(f.kind==="constant"){if(y=f.value,!y)continue}else y=f.evaluate({zoom:a},e);x=m.kind==="constant"?m.value:m.evaluate({zoom:a},e),r.addDash(y,x),e.patterns[u.id]=r.getKey(y,x)}}update(e,r,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a,u)}addFeatures(e,r,a,u,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,r,a,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,CP)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,EP),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,u,f,m){const y=this.layers[0].layout,x=y.get("line-join").evaluate(e,{}),b=y.get("line-cap").evaluate(e,{}),C=y.get("line-miter-limit"),P=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const I of r)this.addLine(I,e,x,b,C,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,m,u)}addLine(e,r,a,u,f,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Q=0;Q<e.length-1;Q++)this.totalDistance+=e[Q].dist(e[Q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=AP[r.type]==="Polygon";let x=e.length;for(;x>=2&&e[x-1].equals(e[x-2]);)x--;let b=0;for(;b<x-1&&e[b].equals(e[b+1]);)b++;if(x<(y?3:2))return;a==="bevel"&&(f=1.05);const C=this.overscaling<=16?15*Ct/(512*this.overscaling):0,P=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let I,L,R,O,Z;this.e1=this.e2=-1,y&&(I=e[x-2],Z=e[b].sub(I)._unit()._perp());for(let Q=b;Q<x;Q++){if(R=Q===x-1?y?e[b+1]:void 0:e[Q+1],R&&e[Q].equals(R))continue;Z&&(O=Z),I&&(L=I),I=e[Q],Z=R?R.sub(I)._unit()._perp():O,O=O||Z;let ue=O.add(Z);ue.x===0&&ue.y===0||ue._unit();const te=O.x*Z.x+O.y*Z.y,le=ue.x*Z.x+ue.y*Z.y,pe=le!==0?1/le:1/0,fe=2*Math.sqrt(2-2*le),Pe=le<MP&&L&&R,Se=O.x*Z.y-O.y*Z.x>0;if(Pe&&Q>b){const ke=I.dist(L);if(ke>2*C){const Ge=I.sub(I.sub(L)._mult(C/ke)._round());this.updateDistance(L,Ge),this.addCurrentVertex(Ge,O,0,0,P),L=Ge}}const Oe=L&&R;let et=Oe?a:y?"butt":u;if(Oe&&et==="round"&&(pe<m?et="miter":pe<=2&&(et="fakeround")),et==="miter"&&pe>f&&(et="bevel"),et==="bevel"&&(pe>2&&(et="flipbevel"),pe<f&&(et="miter")),L&&this.updateDistance(L,I),et==="miter")ue._mult(pe),this.addCurrentVertex(I,ue,0,0,P);else if(et==="flipbevel"){if(pe>100)ue=Z.mult(-1);else{const ke=pe*O.add(Z).mag()/O.sub(Z).mag();ue._perp()._mult(ke*(Se?-1:1))}this.addCurrentVertex(I,ue,0,0,P),this.addCurrentVertex(I,ue.mult(-1),0,0,P)}else if(et==="bevel"||et==="fakeround"){const ke=-Math.sqrt(pe*pe-1),Ge=Se?ke:0,$e=Se?0:ke;if(L&&this.addCurrentVertex(I,O,Ge,$e,P),et==="fakeround"){const We=Math.round(180*fe/Math.PI/20);for(let rt=1;rt<We;rt++){let Re=rt/We;if(Re!==.5){const yt=Re-.5;Re+=Re*yt*(Re-1)*((1.0904+te*(te*(3.55645-1.43519*te)-3.2452))*yt*yt+(.848013+te*(.215638*te-1.06021)))}const ut=Z.sub(O)._mult(Re)._add(O)._unit()._mult(Se?-1:1);this.addHalfVertex(I,ut.x,ut.y,!1,Se,0,P)}}R&&this.addCurrentVertex(I,Z,-Ge,-$e,P)}else if(et==="butt")this.addCurrentVertex(I,ue,0,0,P);else if(et==="square"){const ke=L?1:-1;L||this.addCurrentVertex(I,ue,ke,ke,P),this.addCurrentVertex(I,ue,0,0,P),L&&this.addCurrentVertex(I,ue,ke,ke,P)}else et==="round"&&(L&&(this.addCurrentVertex(I,O,0,0,P),this.addCurrentVertex(I,O,1,1,P,!0)),R&&(this.addCurrentVertex(I,Z,-1,-1,P,!0),this.addCurrentVertex(I,Z,0,0,P)));if(Pe&&Q<x-1){const ke=I.dist(R);if(ke>2*C){const Ge=I.add(R.sub(I)._mult(C/ke)._round());this.updateDistance(I,Ge),this.addCurrentVertex(Ge,Z,0,0,P),I=Ge}}}}addCurrentVertex(e,r,a,u,f,m=!1){const y=r.y*u-r.x,x=-r.y-r.x*u;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,m,!1,a,f),this.addHalfVertex(e,y,x,m,!0,-u,f)}addHalfVertex({x:e,y:r},a,u,f,m,y,x){this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(r<<1)+(m?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const b=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,b),x.primitiveLength++),m?this.e2=b:this.e1=b}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}mt(Yp,"LineBucket",{omit:["layers","patternFeatures"]});const PP=new ie({"line-cap":new q(Fe.layout_line["line-cap"]),"line-join":new q(Fe.layout_line["line-join"]),"line-miter-limit":new F(Fe.layout_line["line-miter-limit"]),"line-round-limit":new F(Fe.layout_line["line-round-limit"]),"line-sort-key":new q(Fe.layout_line["line-sort-key"])});var xw={paint:new ie({"line-opacity":new q(Fe.paint_line["line-opacity"]),"line-color":new q(Fe.paint_line["line-color"]),"line-translate":new F(Fe.paint_line["line-translate"]),"line-translate-anchor":new F(Fe.paint_line["line-translate-anchor"]),"line-width":new q(Fe.paint_line["line-width"]),"line-gap-width":new q(Fe.paint_line["line-gap-width"]),"line-offset":new q(Fe.paint_line["line-offset"]),"line-blur":new q(Fe.paint_line["line-blur"]),"line-dasharray":new q(Fe.paint_line["line-dasharray"]),"line-pattern":new q(Fe.paint_line["line-pattern"]),"line-gradient":new ne(Fe.paint_line["line-gradient"]),"line-trim-offset":new F(Fe.paint_line["line-trim-offset"])}),layout:PP};const ww=new class extends q{possiblyEvaluate(n,e){return e=new M(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(n,e)}evaluate(n,e,r,a){return e=fn({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(n,e,r,a)}}(xw.paint.properties["line-width"].specification);function bw(n,e){return e>0?e+2*n:n}ww.useIntegerZoom=!0;const IP=xe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),kP=xe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),DP=xe([{name:"a_projected_pos",components:4,type:"Float32"}],4);xe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const zP=xe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),LP=xe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Tw=xe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),RP=xe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);xe([{name:"triangle",components:3,type:"Uint16"}]),xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),xe([{type:"Float32",name:"offsetX"}]),xe([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ii=24;const Ro=128;function hy(n,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new M(n+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:u}=r;let f=0;for(;f<a.length&&a[f]<=n;)f++;f=Math.max(0,f-1);let m=f;for(;m<a.length&&a[m]<n+1;)m++;m=Math.min(a.length-1,m);const y=a[f],x=a[m];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:x,minSize:r.evaluate(new M(y)),maxSize:r.evaluate(new M(x)),interpolationType:u}}}function Jp(n,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:u}){return n.kind==="source"?a/Ro:n.kind==="composite"?Yt(a/Ro,u/Ro,r):e}function eu(n,e){let r=0,a=0;if(n.kind==="constant")a=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:u,minZoom:f,maxZoom:m}=n,y=u?Xe(eo.interpolationFactor(u,e,f,m),0,1):0;n.kind==="camera"?a=Yt(n.minSize,n.maxSize,y):r=y}return{uSizeT:r,uSize:a}}var BP=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ro,evaluateSizeForFeature:Jp,evaluateSizeForZoom:eu,getSizeData:hy});function FP(n,e,r){return n.sections.forEach(a=>{a.text=function(u,f,m){const y=f.layout.get("text-transform").evaluate(m,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),S.applyArabicShaping&&(u=S.applyArabicShaping(u)),u}(a.text,e,r)}),n}const _d={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function OP(n){return n==="︶"||n==="﹈"||n==="︸"||n==="﹄"||n==="﹂"||n==="︾"||n==="︼"||n==="︺"||n==="︘"||n==="﹀"||n==="︐"||n==="︓"||n==="︔"||n==="｀"||n==="￣"||n==="︑"||n==="︒"}function UP(n){return n==="︵"||n==="﹇"||n==="︷"||n==="﹃"||n==="﹁"||n==="︽"||n==="︻"||n==="︹"||n==="︗"||n==="︿"}var Ew=An,Sw=function(n,e,r,a,u){var f,m,y=8*u-a-1,x=(1<<y)-1,b=x>>1,C=-7,P=r?u-1:0,I=r?-1:1,L=n[e+P];for(P+=I,f=L&(1<<-C)-1,L>>=-C,C+=y;C>0;f=256*f+n[e+P],P+=I,C-=8);for(m=f&(1<<-C)-1,f>>=-C,C+=a;C>0;m=256*m+n[e+P],P+=I,C-=8);if(f===0)f=1-b;else{if(f===x)return m?NaN:1/0*(L?-1:1);m+=Math.pow(2,a),f-=b}return(L?-1:1)*m*Math.pow(2,f-a)},Cw=function(n,e,r,a,u,f){var m,y,x,b=8*f-u-1,C=(1<<b)-1,P=C>>1,I=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=a?0:f-1,R=a?1:-1,O=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,m=C):(m=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-m))<1&&(m--,x*=2),(e+=m+P>=1?I/x:I*Math.pow(2,1-P))*x>=2&&(m++,x/=2),m+P>=C?(y=0,m=C):m+P>=1?(y=(e*x-1)*Math.pow(2,u),m+=P):(y=e*Math.pow(2,P-1)*Math.pow(2,u),m=0));u>=8;n[r+L]=255&y,L+=R,y/=256,u-=8);for(m=m<<u|y,b+=u;b>0;n[r+L]=255&m,L+=R,m/=256,b-=8);n[r+L-R]|=128*O};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function An(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}An.Varint=0,An.Fixed64=1,An.Bytes=2,An.Fixed32=5;var dy=4294967296,Aw=1/dy,Mw=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Bs(n){return n.type===An.Bytes?n.readVarint()+n.pos:n.pos+1}function tu(n,e,r){return r?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function Pw(n,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var u=r.pos-1;u>=n;u--)r.buf[u+a]=r.buf[u]}function VP(n,e){for(var r=0;r<n.length;r++)e.writeVarint(n[r])}function NP(n,e){for(var r=0;r<n.length;r++)e.writeSVarint(n[r])}function jP(n,e){for(var r=0;r<n.length;r++)e.writeFloat(n[r])}function GP(n,e){for(var r=0;r<n.length;r++)e.writeDouble(n[r])}function $P(n,e){for(var r=0;r<n.length;r++)e.writeBoolean(n[r])}function ZP(n,e){for(var r=0;r<n.length;r++)e.writeFixed32(n[r])}function qP(n,e){for(var r=0;r<n.length;r++)e.writeSFixed32(n[r])}function WP(n,e){for(var r=0;r<n.length;r++)e.writeFixed64(n[r])}function XP(n,e){for(var r=0;r<n.length;r++)e.writeSFixed64(n[r])}function Qp(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function nu(n,e,r){n[r]=e,n[r+1]=e>>>8,n[r+2]=e>>>16,n[r+3]=e>>>24}function Iw(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}An.prototype={destroy:function(){this.buf=null},readFields:function(n,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),u=a>>3,f=this.pos;this.type=7&a,n(u,e,this),this.pos===f&&this.skip(a)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=Qp(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Iw(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=Qp(this.buf,this.pos)+Qp(this.buf,this.pos+4)*dy;return this.pos+=8,n},readSFixed64:function(){var n=Qp(this.buf,this.pos)+Iw(this.buf,this.pos+4)*dy;return this.pos+=8,n},readFloat:function(){var n=Sw(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Sw(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(u,f,m){var y,x,b=m.buf;if(y=(112&(x=b[m.pos++]))>>4,x<128||(y|=(127&(x=b[m.pos++]))<<3,x<128)||(y|=(127&(x=b[m.pos++]))<<10,x<128)||(y|=(127&(x=b[m.pos++]))<<17,x<128)||(y|=(127&(x=b[m.pos++]))<<24,x<128)||(y|=(1&(x=b[m.pos++]))<<31,x<128))return tu(u,y,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&Mw?function(r,a,u){return Mw.decode(r.subarray(a,u))}(this.buf,e,n):function(r,a,u){for(var f="",m=a;m<u;){var y,x,b,C=r[m],P=null,I=C>239?4:C>223?3:C>191?2:1;if(m+I>u)break;I===1?C<128&&(P=C):I===2?(192&(y=r[m+1]))==128&&(P=(31&C)<<6|63&y)<=127&&(P=null):I===3?(x=r[m+2],(192&(y=r[m+1]))==128&&(192&x)==128&&((P=(15&C)<<12|(63&y)<<6|63&x)<=2047||P>=55296&&P<=57343)&&(P=null)):I===4&&(x=r[m+2],b=r[m+3],(192&(y=r[m+1]))==128&&(192&x)==128&&(192&b)==128&&((P=(15&C)<<18|(63&y)<<12|(63&x)<<6|63&b)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,I=1):P>65535&&(P-=65536,f+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),f+=String.fromCharCode(P),m+=I}return f}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==An.Bytes)return n.push(this.readVarint(e));var r=Bs(this);for(n=n||[];this.pos<r;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==An.Bytes)return n.push(this.readSVarint());var e=Bs(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==An.Bytes)return n.push(this.readBoolean());var e=Bs(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==An.Bytes)return n.push(this.readFloat());var e=Bs(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==An.Bytes)return n.push(this.readDouble());var e=Bs(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==An.Bytes)return n.push(this.readFixed32());var e=Bs(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==An.Bytes)return n.push(this.readSFixed32());var e=Bs(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==An.Bytes)return n.push(this.readFixed64());var e=Bs(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==An.Bytes)return n.push(this.readSFixed64());var e=Bs(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===An.Varint)for(;this.buf[this.pos++]>127;);else if(e===An.Bytes)this.pos=this.readVarint()+this.pos;else if(e===An.Fixed32)this.pos+=4;else{if(e!==An.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),nu(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),nu(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),nu(this.buf,-1&n,this.pos),nu(this.buf,Math.floor(n*Aw),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),nu(this.buf,-1&n,this.pos),nu(this.buf,Math.floor(n*Aw),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,r){var a,u;if(e>=0?(a=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(f,m,y){y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,y.buf[y.pos]=127&(f>>>=7)}(a,0,r),function(f,m){var y=(7&f)<<4;m.buf[m.pos++]|=y|((f>>>=3)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f)))))}(u,r)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(a,u,f){for(var m,y,x=0;x<u.length;x++){if((m=u.charCodeAt(x))>55295&&m<57344){if(!y){m>56319||x+1===u.length?(a[f++]=239,a[f++]=191,a[f++]=189):y=m;continue}if(m<56320){a[f++]=239,a[f++]=191,a[f++]=189,y=m;continue}m=y-55296<<10|m-56320|65536,y=null}else y&&(a[f++]=239,a[f++]=191,a[f++]=189,y=null);m<128?a[f++]=m:(m<2048?a[f++]=m>>6|192:(m<65536?a[f++]=m>>12|224:(a[f++]=m>>18|240,a[f++]=m>>12&63|128),a[f++]=m>>6&63|128),a[f++]=63&m|128)}return f}(this.buf,n,this.pos);var r=this.pos-e;r>=128&&Pw(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(n){this.realloc(4),Cw(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),Cw(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=n[r]},writeRawMessage:function(n,e){this.pos++;var r=this.pos;n(e,this);var a=this.pos-r;a>=128&&Pw(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(n,e,r){this.writeTag(n,An.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,VP,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,NP,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,$P,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,jP,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,GP,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,ZP,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,qP,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,WP,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,XP,e)},writeBytesField:function(n,e){this.writeTag(n,An.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,An.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,An.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,An.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,An.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,An.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,An.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,An.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,An.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,An.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,!!e)}};var em=se(Ew);const fy=3;function HP(n,e,r){e.glyphs=[],n===1&&r.readMessage(KP,e)}function KP(n,e,r){if(n===3){const{id:a,bitmap:u,width:f,height:m,left:y,top:x,advance:b}=r.readMessage(YP,{});e.glyphs.push({id:a,bitmap:new Rs({width:f+2*fy,height:m+2*fy},u),metrics:{width:f,height:m,left:y,top:x,advance:b}})}else n===4?e.ascender=r.readSVarint():n===5&&(e.descender=r.readSVarint())}function YP(n,e,r){n===1?e.id=r.readVarint():n===2?e.bitmap=r.readBytes():n===3?e.width=r.readVarint():n===4?e.height=r.readVarint():n===5?e.left=r.readSVarint():n===6?e.top=r.readSVarint():n===7&&(e.advance=r.readVarint())}const kw=fy;function py(n){let e=0,r=0;for(const m of n)e+=m.w*m.h,r=Math.max(r,m.w);n.sort((m,y)=>y.h-m.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let u=0,f=0;for(const m of n)for(let y=a.length-1;y>=0;y--){const x=a[y];if(!(m.w>x.w||m.h>x.h)){if(m.x=x.x,m.y=x.y,f=Math.max(f,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===x.w&&m.h===x.h){const b=a.pop();y<a.length&&(a[y]=b)}else m.h===x.h?(x.x+=m.w,x.w-=m.w):m.w===x.w?(x.y+=m.h,x.h-=m.h):(a.push({x:x.x+m.w,y:x.y,w:x.w-m.w,h:m.h}),x.y+=m.h,x.h-=m.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}const fr=1;class my{constructor(e,{pixelRatio:r,version:a,stretchX:u,stretchY:f,content:m}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=u,this.stretchY=f,this.content=m,this.version=a}get tl(){return[this.paddedRect.x+fr,this.paddedRect.y+fr]}get br(){return[this.paddedRect.x+this.paddedRect.w-fr,this.paddedRect.y+this.paddedRect.h-fr]}get displaySize(){return[(this.paddedRect.w-2*fr)/this.pixelRatio,(this.paddedRect.h-2*fr)/this.pixelRatio]}}class Dw{constructor(e,r){const a={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,a,f),this.addImages(r,u,f);const{w:m,h:y}=py(f),x=new Cr({width:m||1,height:y||1});for(const b in e){const C=e[b],P=a[b].paddedRect;Cr.copy(C.data,x,{x:0,y:0},{x:P.x+fr,y:P.y+fr},C.data)}for(const b in r){const C=r[b],P=u[b].paddedRect,I=P.x+fr,L=P.y+fr,R=C.data.width,O=C.data.height;Cr.copy(C.data,x,{x:0,y:0},{x:I,y:L},C.data),Cr.copy(C.data,x,{x:0,y:O-1},{x:I,y:L-1},{width:R,height:1}),Cr.copy(C.data,x,{x:0,y:0},{x:I,y:L+O},{width:R,height:1}),Cr.copy(C.data,x,{x:R-1,y:0},{x:I-1,y:L},{width:1,height:O}),Cr.copy(C.data,x,{x:0,y:0},{x:I+R,y:L},{width:1,height:O})}this.image=x,this.iconPositions=a,this.patternPositions=u}addImages(e,r,a){for(const u in e){const f=e[u],m={x:0,y:0,w:f.data.width+2*fr,h:f.data.height+2*fr};a.push(m),r[u]=new my(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[u,f]=e.tl;a.update(r.data,void 0,{x:u,y:f})}}mt(my,"ImagePosition"),mt(Dw,"ImageAtlas");const jr={horizontal:1,vertical:2,horizontalOnly:3},zw=-17;class yd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const a=new yd;return a.scale=e||1,a.fontStack=r,a}static forImage(e){const r=new yd;return r.imageName=e,r}}class iu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const a=new iu;for(let u=0;u<e.sections.length;u++){const f=e.sections[u];f.image?a.addImageSection(f):a.addTextSection(f,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,a){let u="";for(let f=0;f<r.length;f++){const m=r.charCodeAt(f+1)||null,y=r.charCodeAt(f-1)||null;u+=!a&&(m&&Pp(m)&&!_d[r[f+1]]||y&&Pp(y)&&!_d[r[f-1]])||!_d[r[f]]?r[f]:_d[r[f]]}return u}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&tm[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&tm[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const a=new iu;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(yd.forText(e.scale,e.fontStack||r));const a=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(a)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void pn("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(yd.forImage(r)),this.sectionIndex.push(this.sections.length-1)):pn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function gy(n,e,r,a,u,f,m,y,x,b,C,P,I,L,R){const O=iu.fromFeature(n,u);P===jr.vertical&&O.verticalizePunctuation(I);let Z=[];const Q=function(fe,Pe,Se,Oe,et,ke){if(!fe)return[];const Ge=[],$e=function(ut,yt,ht,Bt,st,Et){let Ft=0;for(let tn=0;tn<ut.length();tn++){const Ot=ut.getSection(tn);Ft+=Lw(ut.getCharCode(tn),Ot,Bt,st,yt,Et)}return Ft/Math.max(1,Math.ceil(Ft/ht))}(fe,Pe,Se,Oe,et,ke),We=fe.text.indexOf("​")>=0;let rt=0;for(let ut=0;ut<fe.length();ut++){const yt=fe.getSection(ut),ht=fe.getCharCode(ut);if(tm[ht]||(rt+=Lw(ht,yt,Oe,et,Pe,ke)),ut<fe.length()-1){const Bt=!((Re=ht)<11904||!(dt["Bopomofo Extended"](Re)||dt.Bopomofo(Re)||dt["CJK Compatibility Forms"](Re)||dt["CJK Compatibility Ideographs"](Re)||dt["CJK Compatibility"](Re)||dt["CJK Radicals Supplement"](Re)||dt["CJK Strokes"](Re)||dt["CJK Symbols and Punctuation"](Re)||dt["CJK Unified Ideographs Extension A"](Re)||dt["CJK Unified Ideographs"](Re)||dt["Enclosed CJK Letters and Months"](Re)||dt["Halfwidth and Fullwidth Forms"](Re)||dt.Hiragana(Re)||dt["Ideographic Description Characters"](Re)||dt["Kangxi Radicals"](Re)||dt["Katakana Phonetic Extensions"](Re)||dt.Katakana(Re)||dt["Vertical Forms"](Re)||dt["Yi Radicals"](Re)||dt["Yi Syllables"](Re)));(JP[ht]||Bt||yt.imageName)&&Ge.push(Bw(ut+1,rt,$e,Ge,QP(ht,fe.getCharCode(ut+1),Bt&&We),!1))}}var Re;return Fw(Bw(fe.length(),rt,$e,Ge,0,!0))}(O,b,f,e,a,L),{processBidirectionalText:ue,processStyledBidirectionalText:te}=S;if(ue&&O.sections.length===1){const fe=ue(O.toString(),Q);for(const Pe of fe){const Se=new iu;Se.text=Pe,Se.sections=O.sections;for(let Oe=0;Oe<Pe.length;Oe++)Se.sectionIndex.push(0);Z.push(Se)}}else if(te){const fe=te(O.text,O.sectionIndex,Q);for(const Pe of fe){const Se=new iu;Se.text=Pe[0],Se.sectionIndex=Pe[1],Se.sections=O.sections,Z.push(Se)}}else Z=function(fe,Pe){const Se=[],Oe=fe.text;let et=0;for(const ke of Pe)Se.push(fe.substring(et,ke)),et=ke;return et<Oe.length&&Se.push(fe.substring(et,Oe.length)),Se}(O,Q);const le=[],pe={positionedLines:le,text:O.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(fe,Pe,Se,Oe,et,ke,Ge,$e,We,rt,Re,ut){let yt=0,ht=0,Bt=0;const st=$e==="right"?1:$e==="left"?0:.5;let Et=!1;for(const Nt of et){const jt=Nt.getSections();for(const bn of jt){if(bn.imageName)continue;const Mn=Pe[bn.fontStack];if(Mn&&(Et=Mn.ascender!==void 0&&Mn.descender!==void 0,!Et))break}if(!Et)break}let Ft=0;for(const Nt of et){Nt.trim();const jt=Nt.getMaxScale(),bn=(jt-1)*Ii,Mn={positionedGlyphs:[],lineOffset:0};fe.positionedLines[Ft]=Mn;const Pn=Mn.positionedGlyphs;let Tn=0;if(!Nt.length()){ht+=ke,++Ft;continue}let Vn=0,Zn=0;for(let En=0;En<Nt.length();En++){const fi=Nt.getSection(En),oi=Nt.getSectionIndex(En),jn=Nt.getCharCode(En);let on=fi.scale,si=null,In=null,ir=null,ai=Ii,ki=0;const Ti=!(We===jr.horizontal||!Re&&!Zh(jn)||Re&&(tm[jn]||(tn=jn,dt.Arabic(tn)||dt["Arabic Supplement"](tn)||dt["Arabic Extended-A"](tn)||dt["Arabic Presentation Forms-A"](tn)||dt["Arabic Presentation Forms-B"](tn))));if(fi.imageName){const rr=Oe[fi.imageName];if(!rr)continue;ir=fi.imageName,fe.iconsInText=fe.iconsInText||!0,In=rr.paddedRect;const Ei=rr.displaySize;on=on*Ii/ut,si={width:Ei[0],height:Ei[1],left:fr,top:-kw,advance:Ti?Ei[1]:Ei[0],localGlyph:!1},ki=Et?-si.height*on:zw+jt*Ii-Ei[1]*on,ai=si.advance;const Oo=(Ti?Ei[0]:Ei[1])*on-Ii*jt;Oo>0&&Oo>Tn&&(Tn=Oo)}else{const rr=Se[fi.fontStack];if(!rr)continue;rr[jn]&&(In=rr[jn]);const Ei=Pe[fi.fontStack];if(!Ei)continue;const Oo=Ei.glyphs[jn];if(!Oo)continue;if(si=Oo.metrics,ai=jn!==8203?Ii:0,Et){const uu=Ei.ascender!==void 0?Math.abs(Ei.ascender):0,Md=Ei.descender!==void 0?Math.abs(Ei.descender):0,Pd=(uu+Md)*on;Vn<Pd&&(Vn=Pd,Zn=(uu-Md)/2*on),ki=-uu*on}else ki=zw+(jt-on)*Ii}Ti?(fe.verticalizable=!0,Pn.push({glyph:jn,imageName:ir,x:yt,y:ht+ki,vertical:Ti,scale:on,localGlyph:si.localGlyph,fontStack:fi.fontStack,sectionIndex:oi,metrics:si,rect:In}),yt+=ai*on+rt):(Pn.push({glyph:jn,imageName:ir,x:yt,y:ht+ki,vertical:Ti,scale:on,localGlyph:si.localGlyph,fontStack:fi.fontStack,sectionIndex:oi,metrics:si,rect:In}),yt+=si.advance*on+rt)}Pn.length!==0&&(Bt=Math.max(yt-rt,Bt),Et?Ow(Pn,st,Tn,Zn,ke*jt/2):Ow(Pn,st,Tn,0,ke/2)),yt=0;const ri=ke*jt+Tn;Mn.lineOffset=Math.max(Tn,bn),ht+=ri,++Ft}var tn;const Ot=ht,{horizontalAlign:Pt,verticalAlign:Dn}=_y(Ge);(function(Nt,jt,bn,Mn,Pn,Tn){const Vn=(jt-bn)*Pn,Zn=-Tn*Mn;for(const ri of Nt)for(const En of ri.positionedGlyphs)En.x+=Vn,En.y+=Zn})(fe.positionedLines,st,Pt,Dn,Bt,Ot),fe.top+=-Dn*Ot,fe.bottom=fe.top+Ot,fe.left+=-Pt*Bt,fe.right=fe.left+Bt,fe.hasBaseline=Et}(pe,e,r,a,Z,m,y,x,P,b,I,R),!function(fe){for(const Pe of fe)if(Pe.positionedGlyphs.length!==0)return!1;return!0}(le)&&pe}const tm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},JP={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Lw(n,e,r,a,u,f){if(e.imageName){const m=a[e.imageName];return m?m.displaySize[0]*e.scale*Ii/f+u:0}{const m=r[e.fontStack],y=m&&m.glyphs[n];return y?y.metrics.advance*e.scale+u:0}}function Rw(n,e,r,a){const u=Math.pow(n-e,2);return a?n<e?u/2:2*u:u+Math.abs(r)*r}function QP(n,e,r){let a=0;return n===10&&(a-=1e4),r&&(a+=150),n!==40&&n!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function Bw(n,e,r,a,u,f){let m=null,y=Rw(e,r,u,f);for(const x of a){const b=Rw(e-x.x,r,u,f)+x.badness;b<=y&&(m=x,y=b)}return{index:n,x:e,priorBreak:m,badness:y}}function Fw(n){return n?Fw(n.priorBreak).concat(n.index):[]}function _y(n){let e=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Ow(n,e,r,a,u){if(!(e||r||a||u))return;const f=n.length-1,m=n[f],y=(m.x+m.metrics.advance*m.scale)*e;for(let x=0;x<=f;x++)n[x].x-=y,n[x].y+=r+a+u}function eI(n,e,r){const{horizontalAlign:a,verticalAlign:u}=_y(r),f=e[0]-n.displaySize[0]*a,m=e[1]-n.displaySize[1]*u;return{image:n,top:m,bottom:m+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function Uw(n,e,r,a,u,f){const m=n.image;let y;if(m.content){const Z=m.content,Q=m.pixelRatio||1;y=[Z[0]/Q,Z[1]/Q,m.displaySize[0]-Z[2]/Q,m.displaySize[1]-Z[3]/Q]}const x=e.left*f,b=e.right*f;let C,P,I,L;r==="width"||r==="both"?(L=u[0]+x-a[3],P=u[0]+b+a[1]):(L=u[0]+(x+b-m.displaySize[0])/2,P=L+m.displaySize[0]);const R=e.top*f,O=e.bottom*f;return r==="height"||r==="both"?(C=u[1]+R-a[0],I=u[1]+O+a[2]):(C=u[1]+(R+O-m.displaySize[1])/2,I=C+m.displaySize[1]),{image:m,top:C,right:P,bottom:I,left:L,collisionPadding:y}}class Fs extends ze{constructor(e,r,a,u,f){super(e,r),this.angle=u,this.z=a,f!==void 0&&(this.segment=f)}clone(){return new Fs(this.x,this.y,this.z,this.angle,this.segment)}}function Vw(n,e,r,a,u){if(e.segment===void 0)return!0;let f=e,m=e.segment+1,y=0;for(;y>-r/2;){if(m--,m<0)return!1;y-=n[m].dist(f),f=n[m]}y+=n[m].dist(n[m+1]),m++;const x=[];let b=0;for(;y<r/2;){const C=n[m],P=n[m+1];if(!P)return!1;let I=n[m-1].angleTo(C)-C.angleTo(P);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:I}),b+=I;y-x[0].distance>a;)b-=x.shift().angleDelta;if(b>u)return!1;m++,y+=C.dist(P)}return!0}function Nw(n){let e=0;for(let r=0;r<n.length-1;r++)e+=n[r].dist(n[r+1]);return e}function jw(n,e,r){return n?.6*e*r:0}function Gw(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function tI(n,e,r,a,u,f){const m=jw(r,u,f),y=Gw(r,a)*f;let x=0;const b=Nw(n)/2;for(let C=0;C<n.length-1;C++){const P=n[C],I=n[C+1],L=P.dist(I);if(x+L>b){const R=(b-x)/L,O=Yt(P.x,I.x,R),Z=Yt(P.y,I.y,R),Q=new Fs(O,Z,0,I.angleTo(P),C);return!m||Vw(n,Q,y,m,e)?Q:void 0}x+=L}}function nI(n,e,r,a,u,f,m,y,x){const b=jw(a,f,m),C=Gw(a,u),P=C*m,I=n[0].x===0||n[0].x===x||n[0].y===0||n[0].y===x;return e-P<e/4&&(e=P+e/4),$w(n,I?e/2*y%e:(C/2+2*f)*m*y%e,e,b,r,P,I,!1,x)}function $w(n,e,r,a,u,f,m,y,x){const b=f/2,C=Nw(n);let P=0,I=e-r,L=[];for(let R=0;R<n.length-1;R++){const O=n[R],Z=n[R+1],Q=O.dist(Z),ue=Z.angleTo(O);for(;I+r<P+Q;){I+=r;const te=(I-P)/Q,le=Yt(O.x,Z.x,te),pe=Yt(O.y,Z.y,te);if(le>=0&&le<x&&pe>=0&&pe<x&&I-b>=0&&I+b<=C){const fe=new Fs(le,pe,0,ue,R);fe._round(),a&&!Vw(n,fe,f,a,u)||L.push(fe)}}P+=Q}return y||L.length||m||(L=$w(n,P/2,r,a,u,f,m,!0,x)),L}function Zw(n,e,r,a,u){const f=[];for(let m=0;m<n.length;m++){const y=n[m];let x;for(let b=0;b<y.length-1;b++){let C=y[b],P=y[b+1];C.x<e&&P.x<e||(C.x<e?C=new ze(e,C.y+(e-C.x)/(P.x-C.x)*(P.y-C.y))._round():P.x<e&&(P=new ze(e,C.y+(e-C.x)/(P.x-C.x)*(P.y-C.y))._round()),C.y<r&&P.y<r||(C.y<r?C=new ze(C.x+(r-C.y)/(P.y-C.y)*(P.x-C.x),r)._round():P.y<r&&(P=new ze(C.x+(r-C.y)/(P.y-C.y)*(P.x-C.x),r)._round()),C.x>=a&&P.x>=a||(C.x>=a?C=new ze(a,C.y+(a-C.x)/(P.x-C.x)*(P.y-C.y))._round():P.x>=a&&(P=new ze(a,C.y+(a-C.x)/(P.x-C.x)*(P.y-C.y))._round()),C.y>=u&&P.y>=u||(C.y>=u?C=new ze(C.x+(u-C.y)/(P.y-C.y)*(P.x-C.x),u)._round():P.y>=u&&(P=new ze(C.x+(u-C.y)/(P.y-C.y)*(P.x-C.x),u)._round()),x&&C.equals(x[x.length-1])||(x=[C],f.push(x)),x.push(P)))))}}return f}mt(Fs,"Anchor");const vd=1e20;function qw(n,e,r,a,u,f,m,y,x){for(let b=e;b<e+a;b++)Ww(n,r*f+b,f,u,m,y,x);for(let b=r;b<r+u;b++)Ww(n,b*f+e,1,a,m,y,x)}function Ww(n,e,r,a,u,f,m){f[0]=0,m[0]=-vd,m[1]=vd,u[0]=n[e];for(let y=1,x=0,b=0;y<a;y++){u[y]=n[e+y*r];const C=y*y;do{const P=f[x];b=(u[y]-u[P]+C-P*P)/(y-P)/2}while(b<=m[x]&&--x>-1);x++,f[x]=y,m[x]=b,m[x+1]=vd}for(let y=0,x=0;y<a;y++){for(;m[x+1]<y;)x++;const b=f[x],C=y-b;n[e+y*r]=u[b]+C*C}}const Bo=2,yy={none:0,ideographs:1,all:2};class ru{constructor(e,r,a){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=a,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const a=[];for(const u in e)for(const f of e[u])a.push({stack:u,id:f});wt(a,({stack:u,id:f},m)=>{let y=this.entries[u];y||(y=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=y.glyphs[f];if(x!==void 0)return void m(null,{stack:u,id:f,glyph:x});if(x=this._tinySDF(y,u,f),x)return y.glyphs[f]=x,void m(null,{stack:u,id:f,glyph:x});const b=Math.floor(f/256);if(256*b>65535)return void m(new Error("glyphs > 65535 not supported"));if(y.ranges[b])return void m(null,{stack:u,id:f,glyph:x});let C=y.requests[b];C||(C=y.requests[b]=[],ru.loadGlyphRange(u,b,this.url,this.requestManager,(P,I)=>{if(I){y.ascender=I.ascender,y.descender=I.descender;for(const L in I.glyphs)this._doesCharSupportLocalGlyph(+L)||(y.glyphs[+L]=I.glyphs[+L]);y.ranges[b]=!0}for(const L of C)L(P,I);delete y.requests[b]})),C.push((P,I)=>{P?m(P):I&&m(null,{stack:u,id:f,glyph:I.glyphs[f]||null})})},(u,f)=>{if(u)r(u);else if(f){const m={};for(const{stack:y,id:x,glyph:b}of f)m[y]===void 0&&(m[y]={}),m[y].glyphs===void 0&&(m[y].glyphs={}),m[y].glyphs[x]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics},m[y].ascender=this.entries[y].ascender,m[y].descender=this.entries[y].descender;r(null,m)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==yy.none&&(this.localGlyphMode===yy.all?!!this.localFontFamily:!!this.localFontFamily&&(dt["CJK Unified Ideographs"](e)||dt["Hangul Syllables"](e)||dt.Hiragana(e)||dt.Katakana(e)||dt["CJK Symbols and Punctuation"](e)))}_tinySDF(e,r,a){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let f=e.tinySDF;if(!f){let O="400";/bold/i.test(r)?O="900":/medium/i.test(r)?O="500":/light/i.test(r)&&(O="200"),f=e.tinySDF=new ru.TinySDF({fontFamily:u,fontWeight:O,fontSize:24*Bo,buffer:3*Bo,radius:8*Bo}),f.fontWeight=O}if(this.localGlyphs[f.fontWeight][a])return this.localGlyphs[f.fontWeight][a];const m=String.fromCharCode(a),{data:y,width:x,height:b,glyphWidth:C,glyphHeight:P,glyphLeft:I,glyphTop:L,glyphAdvance:R}=f.draw(m);return this.localGlyphs[f.fontWeight][a]={id:a,bitmap:new Rs({width:x,height:b},y),metrics:{width:C/Bo,height:P/Bo,left:I/Bo,top:L/Bo-27,advance:R/Bo,localGlyph:!0}}}}ru.loadGlyphRange=function(n,e,r,a,u){const f=256*e,m=f+255,y=a.transformRequest(a.normalizeGlyphsURL(r).replace("{fontstack}",n).replace("{range}",`${f}-${m}`),yo.Glyphs);vt(y,(x,b)=>{if(x)u(x);else if(b){const C={},P=function(I){return new em(I).readFields(HP,{})}(b);for(const I of P.glyphs)C[I.id]=I;u(null,{glyphs:C,ascender:P.ascender,descender:P.descender})}})},ru.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:r=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=r;const y=this.size=n+4*e,x=this._createCanvas(y),b=this.ctx=x.getContext("2d",{willReadFrequently:!0});b.font=`${m} ${f} ${n}px ${u}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(n),m=Math.ceil(r),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-u))),x=Math.min(this.size-this.buffer,m+Math.ceil(a)),b=y+2*this.buffer,C=x+2*this.buffer,P=Math.max(b*C,0),I=new Uint8ClampedArray(P),L={data:I,width:b,height:C,glyphWidth:y,glyphHeight:x,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(y===0||x===0)return L;const{ctx:R,buffer:O,gridInner:Z,gridOuter:Q}=this;R.clearRect(O,O,y,x),R.fillText(n,O,O+m);const ue=R.getImageData(O,O,y,x);Q.fill(vd,0,P),Z.fill(0,0,P);for(let te=0;te<x;te++)for(let le=0;le<y;le++){const pe=ue.data[4*(te*y+le)+3]/255;if(pe===0)continue;const fe=(te+O)*b+le+O;if(pe===1)Q[fe]=0,Z[fe]=vd;else{const Pe=.5-pe;Q[fe]=Pe>0?Pe*Pe:0,Z[fe]=Pe<0?Pe*Pe:0}}qw(Q,0,0,b,C,b,this.f,this.v,this.z),qw(Z,O,O,y,x,b,this.f,this.v,this.z);for(let te=0;te<P;te++){const le=Math.sqrt(Q[te])-Math.sqrt(Z[te]);I[te]=Math.round(255-255*(le/this.radius+this.cutoff))}return L}};const ou=fr;function Xw(n,e,r,a){const u=[],f=n.image,m=f.pixelRatio,y=f.paddedRect.w-2*ou,x=f.paddedRect.h-2*ou,b=n.right-n.left,C=n.bottom-n.top,P=f.stretchX||[[0,y]],I=f.stretchY||[[0,x]],L=(ke,Ge)=>ke+Ge[1]-Ge[0],R=P.reduce(L,0),O=I.reduce(L,0),Z=y-R,Q=x-O;let ue=0,te=R,le=0,pe=O,fe=0,Pe=Z,Se=0,Oe=Q;if(f.content&&a){const ke=f.content;ue=nm(P,0,ke[0]),le=nm(I,0,ke[1]),te=nm(P,ke[0],ke[2]),pe=nm(I,ke[1],ke[3]),fe=ke[0]-ue,Se=ke[1]-le,Pe=ke[2]-ke[0]-te,Oe=ke[3]-ke[1]-pe}const et=(ke,Ge,$e,We)=>{const rt=im(ke.stretch-ue,te,b,n.left),Re=rm(ke.fixed-fe,Pe,ke.stretch,R),ut=im(Ge.stretch-le,pe,C,n.top),yt=rm(Ge.fixed-Se,Oe,Ge.stretch,O),ht=im($e.stretch-ue,te,b,n.left),Bt=rm($e.fixed-fe,Pe,$e.stretch,R),st=im(We.stretch-le,pe,C,n.top),Et=rm(We.fixed-Se,Oe,We.stretch,O),Ft=new ze(rt,ut),tn=new ze(ht,ut),Ot=new ze(ht,st),Pt=new ze(rt,st),Dn=new ze(Re/m,yt/m),Nt=new ze(Bt/m,Et/m),jt=e*Math.PI/180;if(jt){const Pn=Math.sin(jt),Tn=Math.cos(jt),Vn=[Tn,-Pn,Pn,Tn];Ft._matMult(Vn),tn._matMult(Vn),Pt._matMult(Vn),Ot._matMult(Vn)}const bn=ke.stretch+ke.fixed,Mn=Ge.stretch+Ge.fixed;return{tl:Ft,tr:tn,bl:Pt,br:Ot,tex:{x:f.paddedRect.x+ou+bn,y:f.paddedRect.y+ou+Mn,w:$e.stretch+$e.fixed-bn,h:We.stretch+We.fixed-Mn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Dn,pixelOffsetBR:Nt,minFontScaleX:Pe/m/b,minFontScaleY:Oe/m/C,isSDF:r}};if(a&&(f.stretchX||f.stretchY)){const ke=Hw(P,Z,R),Ge=Hw(I,Q,O);for(let $e=0;$e<ke.length-1;$e++){const We=ke[$e],rt=ke[$e+1];for(let Re=0;Re<Ge.length-1;Re++)u.push(et(We,Ge[Re],rt,Ge[Re+1]))}}else u.push(et({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return u}function nm(n,e,r){let a=0;for(const u of n)a+=Math.max(e,Math.min(r,u[1]))-Math.max(e,Math.min(r,u[0]));return a}function Hw(n,e,r){const a=[{fixed:-ou,stretch:0}];for(const[u,f]of n){const m=a[a.length-1];a.push({fixed:u-m.stretch,stretch:m.stretch}),a.push({fixed:u-m.stretch,stretch:m.stretch+(f-u)})}return a.push({fixed:e+ou,stretch:r}),a}function im(n,e,r,a){return n/e*r+a}function rm(n,e,r,a){return n-e*r/a}function iI(n,e,r,a){const u=e+n.positionedLines[a].lineOffset;return a===0?r+u/2:r+(u+(e+n.positionedLines[a-1].lineOffset))/2}class rI{constructor(e=[],r=oI){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,u=r[e];for(;e>0;){const f=e-1>>1,m=r[f];if(a(u,m)>=0)break;r[e]=m,e=f}r[e]=u}_down(e){const{data:r,compare:a}=this,u=this.length>>1,f=r[e];for(;e<u;){let m=1+(e<<1),y=r[m];const x=m+1;if(x<this.length&&a(r[x],y)<0&&(m=x,y=r[x]),a(y,f)>=0)break;r[e]=y,e=m}r[e]=f}}function oI(n,e){return n<e?-1:n>e?1:0}function sI(n,e=1,r=!1){let a=1/0,u=1/0,f=-1/0,m=-1/0;const y=n[0];for(let L=0;L<y.length;L++){const R=y[L];(!L||R.x<a)&&(a=R.x),(!L||R.y<u)&&(u=R.y),(!L||R.x>f)&&(f=R.x),(!L||R.y>m)&&(m=R.y)}const x=Math.min(f-a,m-u);let b=x/2;const C=new rI([],aI);if(x===0)return new ze(a,u);for(let L=a;L<f;L+=x)for(let R=u;R<m;R+=x)C.push(new su(L+b,R+b,b,n));let P=function(L){let R=0,O=0,Z=0;const Q=L[0];for(let ue=0,te=Q.length,le=te-1;ue<te;le=ue++){const pe=Q[ue],fe=Q[le],Pe=pe.x*fe.y-fe.x*pe.y;O+=(pe.x+fe.x)*Pe,Z+=(pe.y+fe.y)*Pe,R+=3*Pe}return new su(O/R,Z/R,0,L)}(n),I=C.length;for(;C.length;){const L=C.pop();(L.d>P.d||!P.d)&&(P=L,r&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,I)),L.max-P.d<=e||(b=L.h/2,C.push(new su(L.p.x-b,L.p.y-b,b,n)),C.push(new su(L.p.x+b,L.p.y-b,b,n)),C.push(new su(L.p.x-b,L.p.y+b,b,n)),C.push(new su(L.p.x+b,L.p.y+b,b,n)),I+=4)}return r&&(console.log(`num probes: ${I}`),console.log(`best distance: ${P.d}`)),P.p}function aI(n,e){return e.max-n.max}class su{constructor(e,r,a,u){this.p=new ze(e,r),this.h=a,this.d=function(f,m){let y=!1,x=1/0;for(let b=0;b<m.length;b++){const C=m[b];for(let P=0,I=C.length,L=I-1;P<I;L=P++){const R=C[P],O=C[L];R.y>f.y!=O.y>f.y&&f.x<(O.x-R.x)*(f.y-R.y)/(O.y-R.y)+R.x&&(y=!y),x=Math.min(x,$1(f,R,O))}}return(y?1:-1)*Math.sqrt(x)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const au=7,vy=Number.POSITIVE_INFINITY,lI=Math.sqrt(2);function Kw(n,[e,r]){let a=0,u=0;if(r===vy){e<0&&(e=0);const f=e/lI;switch(n){case"top-right":case"top-left":u=f-au;break;case"bottom-right":case"bottom-left":u=-f+au;break;case"bottom":u=-e+au;break;case"top":u=e-au}switch(n){case"top-right":case"bottom-right":a=-f;break;case"top-left":case"bottom-left":a=f;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),n){case"top-right":case"top-left":case"top":u=r-au;break;case"bottom-right":case"bottom-left":case"bottom":u=-r+au}switch(n){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,u]}function cI(n,e,r,a,u,f,m,y,x,b){n.createArrays(),n.tilePixelRatio=Ct/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const C=n.layers[0].layout,P=n.layers[0]._unevaluatedLayout._values,I={};if(n.textSizeData.kind==="composite"){const{minZoom:O,maxZoom:Z}=n.textSizeData;I.compositeTextSizes=[P["text-size"].possiblyEvaluate(new M(O),y),P["text-size"].possiblyEvaluate(new M(Z),y)]}if(n.iconSizeData.kind==="composite"){const{minZoom:O,maxZoom:Z}=n.iconSizeData;I.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new M(O),y),P["icon-size"].possiblyEvaluate(new M(Z),y)]}I.layoutTextSize=P["text-size"].possiblyEvaluate(new M(x+1),y),I.layoutIconSize=P["icon-size"].possiblyEvaluate(new M(x+1),y),I.textMaxSize=P["text-size"].possiblyEvaluate(new M(18),y);const L=C.get("text-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",R=C.get("text-size");for(const O of n.features){const Z=C.get("text-font").evaluate(O,{},y).join(","),Q=R.evaluate(O,{},y),ue=I.layoutTextSize.evaluate(O,{},y),te=(I.layoutIconSize.evaluate(O,{},y),{horizontal:{},vertical:void 0}),le=O.text;let pe,fe=[0,0];if(le){const Oe=le.toString(),et=C.get("text-letter-spacing").evaluate(O,{},y)*Ii,ke=C.get("text-line-height").evaluate(O,{},y)*Ii,Ge=M_(Oe)?et:0,$e=C.get("text-anchor").evaluate(O,{},y),We=C.get("text-variable-anchor");if(!We){const ht=C.get("text-radial-offset").evaluate(O,{},y);fe=ht?Kw($e,[ht*Ii,vy]):C.get("text-offset").evaluate(O,{},y).map(Bt=>Bt*Ii)}let rt=L?"center":C.get("text-justify").evaluate(O,{},y);const Re=C.get("symbol-placement")==="point",ut=Re?C.get("text-max-width").evaluate(O,{},y)*Ii:1/0,yt=ht=>{n.allowVerticalPlacement&&$h(Oe)&&(te.vertical=gy(le,e,r,u,Z,ut,ke,$e,ht,Ge,fe,jr.vertical,!0,ue,Q))};if(!L&&We){const ht=rt==="auto"?We.map(st=>xy(st)):[rt];let Bt=!1;for(let st=0;st<ht.length;st++){const Et=ht[st];if(!te.horizontal[Et])if(Bt)te.horizontal[Et]=te.horizontal[0];else{const Ft=gy(le,e,r,u,Z,ut,ke,"center",Et,Ge,fe,jr.horizontal,!1,ue,Q);Ft&&(te.horizontal[Et]=Ft,Bt=Ft.positionedLines.length===1)}}yt("left")}else{if(rt==="auto"&&(rt=xy($e)),Re||C.get("text-writing-mode").indexOf("horizontal")>=0||!$h(Oe)){const ht=gy(le,e,r,u,Z,ut,ke,$e,rt,Ge,fe,jr.horizontal,!1,ue,Q);ht&&(te.horizontal[rt]=ht)}yt(Re?"left":rt)}}let Pe=!1;if(O.icon&&O.icon.name){const Oe=a[O.icon.name];Oe&&(pe=eI(u[O.icon.name],C.get("icon-offset").evaluate(O,{},y),C.get("icon-anchor").evaluate(O,{},y)),Pe=Oe.sdf,n.sdfIcons===void 0?n.sdfIcons=Oe.sdf:n.sdfIcons!==Oe.sdf&&pn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Oe.pixelRatio!==n.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0))}const Se=Jw(te.horizontal)||te.vertical;n.iconsInText||(n.iconsInText=!!Se&&Se.iconsInText),(Se||pe)&&uI(n,O,te,pe,a,I,ue,0,fe,Pe,m,y,b)}f&&n.generateCollisionDebugBuffers(x,n.collisionBoxArray)}function xy(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function uI(n,e,r,a,u,f,m,y,x,b,C,P,I){let L=f.textMaxSize.evaluate(e,{},P);L===void 0&&(L=m);const R=n.layers[0].layout,O=R.get("icon-offset").evaluate(e,{},P),Z=Jw(r.horizontal)||r.vertical,Q=I.name==="globe",ue=Ii,te=m/ue,le=n.tilePixelRatio*L/ue,pe=($e=n.overscaling,n.zoom>18&&$e>2&&($e>>=1),Math.max(Ct/(512*$e),1)*R.get("symbol-spacing")),fe=R.get("text-padding")*n.tilePixelRatio,Pe=R.get("icon-padding")*n.tilePixelRatio,Se=gt(R.get("text-max-angle")),Oe=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",et=R.get("icon-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",ke=R.get("symbol-placement"),Ge=pe/2;var $e;const We=R.get("icon-text-fit");let rt;a&&We!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(rt=Uw(a,r.vertical,We,R.get("icon-text-fit-padding"),O,te)),Z&&(a=Uw(a,Z,We,R.get("icon-text-fit-padding"),O,te)));const Re=(ut,yt,ht)=>{if(yt.x<0||yt.x>=Ct||yt.y<0||yt.y>=Ct)return;let Bt=null;if(Q){const{x:st,y:Et,z:Ft}=I.projectTilePoint(yt.x,yt.y,ht);Bt={anchor:new Fs(st,Et,Ft,0,void 0),up:I.upVector(ht,yt.x,yt.y)}}(function(st,Et,Ft,tn,Ot,Pt,Dn,Nt,jt,bn,Mn,Pn,Tn,Vn,Zn,ri,En,fi,oi,jn,on,si,In,ir,ai){const ki=st.addToLineVertexArray(Et,tn);let Ti,rr,Ei,Oo,uu,Md,Pd,kb=0,Db=0,zb=0,Lb=0,Ry=-1,By=-1;const cs={};let Rb=k_("");const Nl=Ft?Ft.anchor:Et;let Fy=0,Oy=0;if(jt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Fy,Oy]=jt.layout.get("text-offset").evaluate(on,{},ai).map(Ar=>Ar*Ii):(Fy=jt.layout.get("text-radial-offset").evaluate(on,{},ai)*Ii,Oy=vy),st.allowVerticalPlacement&&Ot.vertical){const Ar=Ot.vertical;if(Zn)Md=wy(Ar),Nt&&(Pd=wy(Nt));else{const Mr=jt.layout.get("text-rotate").evaluate(on,{},ai)+90;Ei=om(bn,Nl,Et,Mn,Pn,Tn,Ar,Vn,Mr,ri),Nt&&(Oo=om(bn,Nl,Et,Mn,Pn,Tn,Nt,fi,Mr))}}if(Pt){const Ar=jt.layout.get("icon-rotate").evaluate(on,{},ai),Mr=jt.layout.get("icon-text-fit")!=="none",Id=Xw(Pt,Ar,In,Mr),Vy=Nt?Xw(Nt,Ar,In,Mr):void 0;rr=om(bn,Nl,Et,Mn,Pn,Tn,Pt,fi,Ar),kb=4*Id.length;const Bb=st.iconSizeData;let jl=null;Bb.kind==="source"?(jl=[Ro*jt.layout.get("icon-size").evaluate(on,{},ai)],jl[0]>ba&&pn(`${st.layerIds[0]}: Value for "icon-size" is >= ${xd}. Reduce your "icon-size".`)):Bb.kind==="composite"&&(jl=[Ro*si.compositeIconSizes[0].evaluate(on,{},ai),Ro*si.compositeIconSizes[1].evaluate(on,{},ai)],(jl[0]>ba||jl[1]>ba)&&pn(`${st.layerIds[0]}: Value for "icon-size" is >= ${xd}. Reduce your "icon-size".`)),st.addSymbols(st.icon,Id,jl,jn,oi,on,!1,Ft,Et,ki.lineStartIndex,ki.lineLength,-1,ir,ai),Ry=st.icon.placedSymbolArray.length-1,Vy&&(Db=4*Vy.length,st.addSymbols(st.icon,Vy,jl,jn,oi,on,jr.vertical,Ft,Et,ki.lineStartIndex,ki.lineLength,-1,ir,ai),By=st.icon.placedSymbolArray.length-1)}for(const Ar in Ot.horizontal){const Mr=Ot.horizontal[Ar];Ti||(Rb=k_(Mr.text),Zn?uu=wy(Mr):Ti=om(bn,Nl,Et,Mn,Pn,Tn,Mr,Vn,jt.layout.get("text-rotate").evaluate(on,{},ai),ri));const Id=Mr.positionedLines.length===1;if(zb+=Yw(st,Ft,Et,Mr,Dn,jt,Zn,on,ri,ki,Ot.vertical?jr.horizontal:jr.horizontalOnly,Id?Object.keys(Ot.horizontal):[Ar],cs,Ry,si,ir,ai),Id)break}Ot.vertical&&(Lb+=Yw(st,Ft,Et,Ot.vertical,Dn,jt,Zn,on,ri,ki,jr.vertical,["vertical"],cs,By,si,ir,ai));let Ma=-1;const Uy=(Ar,Mr)=>Ar?Math.max(Ar,Mr):Mr;Ma=Uy(uu,Ma),Ma=Uy(Md,Ma),Ma=Uy(Pd,Ma);const OI=Ma>-1?1:0;st.glyphOffsetArray.length>=Ea.MAX_GLYPHS&&pn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),on.sortKey!==void 0&&st.addToSortKeyRanges(st.symbolInstances.length,on.sortKey),st.symbolInstances.emplaceBack(Nl.x,Nl.y,Nl.z,Et.x,Et.y,cs.right>=0?cs.right:-1,cs.center>=0?cs.center:-1,cs.left>=0?cs.left:-1,cs.vertical>=0?cs.vertical:-1,Ry,By,Rb,Ti!==void 0?Ti:st.collisionBoxArray.length,Ti!==void 0?Ti+1:st.collisionBoxArray.length,Ei!==void 0?Ei:st.collisionBoxArray.length,Ei!==void 0?Ei+1:st.collisionBoxArray.length,rr!==void 0?rr:st.collisionBoxArray.length,rr!==void 0?rr+1:st.collisionBoxArray.length,Oo||st.collisionBoxArray.length,Oo?Oo+1:st.collisionBoxArray.length,Mn,zb,Lb,kb,Db,OI,0,Fy,Oy,Ma)})(n,yt,Bt,ut,r,a,u,rt,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,fe,Oe,x,0,Pe,et,O,e,f,b,C,P)};if(ke==="line")for(const ut of Zw(e.geometry,0,0,Ct,Ct)){const yt=nI(ut,pe,Se,r.vertical||Z,a,ue,le,n.overscaling,Ct);for(const ht of yt)Z&&hI(n,Z.text,Ge,ht)||Re(ut,ht,P)}else if(ke==="line-center"){for(const ut of e.geometry)if(ut.length>1){const yt=tI(ut,Se,r.vertical||Z,a,ue,le);yt&&Re(ut,yt,P)}}else if(e.type==="Polygon")for(const ut of ay(e.geometry,0)){const yt=sI(ut,16);Re(ut[0],new Fs(yt.x,yt.y,0,0,void 0),P)}else if(e.type==="LineString")for(const ut of e.geometry)Re(ut,new Fs(ut[0].x,ut[0].y,0,0,void 0),P);else if(e.type==="Point")for(const ut of e.geometry)for(const yt of ut)Re([yt],new Fs(yt.x,yt.y,0,0,void 0),P)}const xd=255,ba=xd*Ro;function Yw(n,e,r,a,u,f,m,y,x,b,C,P,I,L,R,O,Z){const Q=function(le,pe,fe,Pe,Se,Oe,et,ke){const Ge=[];if(pe.positionedLines.length===0)return Ge;const $e=Pe.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,We=function(ht){const Bt=ht[0],st=ht[1],Et=Bt*st;return Et>0?[Bt,-st]:Et<0?[-Bt,st]:Bt===0?[st,Bt]:[st,-Bt]}(fe);let rt=Math.abs(pe.top-pe.bottom);for(const ht of pe.positionedLines)rt-=ht.lineOffset;const Re=pe.positionedLines.length,ut=rt/Re;let yt=pe.top-fe[1];for(let ht=0;ht<Re;++ht){const Bt=pe.positionedLines[ht];yt=iI(pe,ut,yt,ht);for(const st of Bt.positionedGlyphs){if(!st.rect)continue;const Et=st.rect||{};let Ft=kw+1,tn=!0,Ot=1,Pt=0;if(st.imageName){const In=et[st.imageName];if(!In)continue;if(In.sdf){pn("SDF images are not supported in formatted text and will be ignored.");continue}tn=!1,Ot=In.pixelRatio,Ft=fr/Ot}const Dn=(Se||ke)&&st.vertical,Nt=st.metrics.advance*st.scale/2,jt=st.metrics,bn=st.rect;if(bn===null)continue;ke&&pe.verticalizable&&(Pt=st.imageName?Nt-st.metrics.width*st.scale/2:0);const Mn=Se?[st.x+Nt,st.y]:[0,0];let Pn=[0,0],Tn=[0,0],Vn=!1;Se||(Dn?(Tn=[st.x+Nt+We[0],st.y+We[1]-Pt],Vn=!0):Pn=[st.x+Nt+fe[0],st.y+fe[1]-Pt]);const Zn=bn.w*st.scale/(Ot*(st.localGlyph?Bo:1)),ri=bn.h*st.scale/(Ot*(st.localGlyph?Bo:1));let En,fi,oi,jn;if(Dn){const In=st.y-yt,ir=new ze(-Nt,Nt-In),ai=-Math.PI/2,ki=new ze(...Tn);En=new ze(-Nt+Pn[0],Pn[1]),En._rotateAround(ai,ir)._add(ki),En.x+=-In+Nt,En.y-=(jt.left-Ft)*st.scale;const Ti=st.imageName?jt.advance*st.scale:Ii*st.scale,rr=String.fromCharCode(st.glyph);OP(rr)?En.x+=(1-Ft)*st.scale:UP(rr)?En.x+=Ti-jt.height*st.scale+(-Ft-1)*st.scale:En.x+=st.imageName||jt.width+2*Ft===bn.w&&jt.height+2*Ft===bn.h?(Ti-ri)/2:(Ti-(jt.height+2*Ft)*st.scale)/2,fi=new ze(En.x,En.y-Zn),oi=new ze(En.x+ri,En.y),jn=new ze(En.x+ri,En.y-Zn)}else{const In=(jt.left-Ft)*st.scale-Nt+Pn[0],ir=(-jt.top-Ft)*st.scale+Pn[1],ai=In+Zn,ki=ir+ri;En=new ze(In,ir),fi=new ze(ai,ir),oi=new ze(In,ki),jn=new ze(ai,ki)}if($e){let In;In=Se?new ze(0,0):Vn?new ze(We[0],We[1]):new ze(fe[0],fe[1]),En._rotateAround($e,In),fi._rotateAround($e,In),oi._rotateAround($e,In),jn._rotateAround($e,In)}const on=new ze(0,0),si=new ze(0,0);Ge.push({tl:En,tr:fi,bl:oi,br:jn,tex:Et,writingMode:pe.writingMode,glyphOffset:Mn,sectionIndex:st.sectionIndex,isSDF:tn,pixelOffsetTL:on,pixelOffsetBR:si,minFontScaleX:0,minFontScaleY:0})}}return Ge}(0,a,x,f,m,y,u,n.allowVerticalPlacement),ue=n.textSizeData;let te=null;ue.kind==="source"?(te=[Ro*f.layout.get("text-size").evaluate(y,{},Z)],te[0]>ba&&pn(`${n.layerIds[0]}: Value for "text-size" is >= ${xd}. Reduce your "text-size".`)):ue.kind==="composite"&&(te=[Ro*R.compositeTextSizes[0].evaluate(y,{},Z),Ro*R.compositeTextSizes[1].evaluate(y,{},Z)],(te[0]>ba||te[1]>ba)&&pn(`${n.layerIds[0]}: Value for "text-size" is >= ${xd}. Reduce your "text-size".`)),n.addSymbols(n.text,Q,te,x,m,y,C,e,r,b.lineStartIndex,b.lineLength,L,O,Z);for(const le of P)I[le]=n.text.placedSymbolArray.length-1;return 4*Q.length}function Jw(n){for(const e in n)return n[e];return null}function om(n,e,r,a,u,f,m,y,x,b){let C=m.top,P=m.bottom,I=m.left,L=m.right;const R=m.collisionPadding;if(R&&(I-=R[0],C-=R[1],L+=R[2],P+=R[3]),x){const O=new ze(I,C),Z=new ze(L,C),Q=new ze(I,P),ue=new ze(L,P),te=gt(x);let le=new ze(0,0);b&&(le=new ze(b[0],b[1])),O._rotateAround(te,le),Z._rotateAround(te,le),Q._rotateAround(te,le),ue._rotateAround(te,le),I=Math.min(O.x,Z.x,Q.x,ue.x),L=Math.max(O.x,Z.x,Q.x,ue.x),C=Math.min(O.y,Z.y,Q.y,ue.y),P=Math.max(O.y,Z.y,Q.y,ue.y)}return n.emplaceBack(e.x,e.y,e.z,r.x,r.y,I,C,L,P,y,a,u,f),n.length-1}function wy(n){n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function hI(n,e,r,a){const u=n.compareText;if(e in u){const f=u[e];for(let m=f.length-1;m>=0;m--)if(a.dist(f[m])<r)return!0}else u[e]=[];return u[e].push(a),!1}function Qw(n,e){const r=n.fovAboveCenter,a=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,u=(n._camera.position[2]*n.worldSize-a)/Math.cos(n._pitch),f=Math.sin(r)*u/Math.sin(Math.max(Math.PI/2-n._pitch-r,.01)),m=Math.sin(n._pitch)*f+u;return Math.min(1.01*m,u*(1/n._horizonShift))}function Ul(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const r=Math.pow(2,-n.z),a=n.x*r,u=(n.x+1)*r,f=n.y*r,m=(n.y+1)*r,y=Nr(a),x=Nr(u),b=Oi(f),C=Oi(m),P=e.project(y,b),I=e.project(x,b),L=e.project(x,C),R=e.project(y,C);let O=Math.min(P.x,I.x,L.x,R.x),Z=Math.min(P.y,I.y,L.y,R.y),Q=Math.max(P.x,I.x,L.x,R.x),ue=Math.max(P.y,I.y,L.y,R.y);const te=r/16;function le(fe,Pe,Se,Oe,et,ke){const Ge=(Se+et)/2,$e=(Oe+ke)/2,We=e.project(Nr(Ge),Oi($e)),rt=Math.max(0,O-We.x,Z-We.y,We.x-Q,We.y-ue);O=Math.min(O,We.x),Q=Math.max(Q,We.x),Z=Math.min(Z,We.y),ue=Math.max(ue,We.y),rt>te&&(le(fe,We,Se,Oe,Ge,$e),le(We,Pe,Ge,$e,et,ke))}le(P,I,a,f,u,f),le(I,L,u,f,u,m),le(L,R,u,m,a,m),le(R,P,a,m,a,f),O-=te,Z-=te,Q+=te,ue+=te;const pe=1/Math.max(Q-O,ue-Z);return{scale:pe,x:O*pe,y:Z*pe,x2:Q*pe,y2:ue*pe,projection:e}}const dI=Do(new Float32Array(16));class Ta{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new wn(0,0)}projectTilePoint(e,r,a){return{x:e,y:r,z:0}}locationPoint(e,r,a=!0){return e._coordinatePoint(e.locationCoordinate(r),a)}pixelsPerMeter(e,r){return Lo(1,e)*r}pixelSpaceConversion(e,r,a){return 1}farthestPixelDistance(e){return Qw(e,e.pixelsPerMeter)}pointCoordinate(e,r,a,u){const f=e.horizonLineFromTop(!1),m=new ze(r,Math.max(f,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,u))}pointCoordinate3D(e,r,a){const u=new ze(r,a);if(e.elevation)return e.elevation.pointCoordinate(u);{const f=this.pointCoordinate(e,u.x,u.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,r){if(e.elevation)return!this.pointCoordinate3D(e,r.x,r.y);const a=e.horizonLineFromTop();return r.y<a}createInversionMatrix(e,r){return dI}createTileMatrix(e,r,a){let u,f,m;const y=a.canonical,x=Do(new Float64Array(16));if(this.isReprojectedInTileSpace){const b=Ul(y,this);u=1,f=b.x+a.wrap*b.scale,m=b.y,Dl(x,x,[u/b.scale,u/b.scale,e.pixelsPerMeter/r])}else u=r/e.zoomScale(y.z),f=(y.x+Math.pow(2,y.z)*a.wrap)*u,m=y.y*u;return Yh(x,x,[f,m,0]),Dl(x,x,[u/Ct,u/Ct,1]),x}upVector(e,r,a){return[0,0,1]}upVectorScale(e,r,a){return{metersToTile:1}}}class fI extends Ta{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,a]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(gt(r));this.n=(u+Math.sin(gt(a)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:a,c:u,r0:f}=this,m=gt(e-this.center[0]),y=gt(r),x=Math.sqrt(u-2*a*Math.sin(y))/a;return{x:x*Math.sin(m*a),y:x*Math.cos(m*a)-f,z:0}}unproject(e,r){const{n:a,c:u,r0:f}=this,m=f+r;let y=Math.atan2(e,Math.abs(m))*Math.sign(m);m*a<0&&(y-=Math.PI*Math.sign(e)*Math.sign(m));const x=gt(this.center[0])*a;y=Tt(y,-Math.PI-x,Math.PI-x);const b=Xe(Jt(y/a)+this.center[0],-180,180),C=Math.asin(Xe((u-(e*e+m*m)*a*a)/(2*a),-1,1)),P=Xe(Jt(C),-Ui,Ui);return new wn(b,P)}}const wd=1.340264,bd=-.081106,Td=893e-6,Ed=.003796,sm=Math.sqrt(3)/2;class pI extends Ta{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(sm*Math.sin(r)),u=a*a,f=u*u*u;return{x:.5*(e*Math.cos(a)/(sm*(wd+3*bd*u+f*(7*Td+9*Ed*u)))/Math.PI+.5),y:1-.5*(a*(wd+bd*u+f*(Td+Ed*u))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,u=a*a,f=u*u*u;for(let C,P,I,L=0;L<12&&(P=a*(wd+bd*u+f*(Td+Ed*u))-r,I=wd+3*bd*u+f*(7*Td+9*Ed*u),C=P/I,a=Xe(a-C,-Math.PI/3,Math.PI/3),u=a*a,f=u*u*u,!(Math.abs(C)<1e-12));++L);const m=sm*e*(wd+3*bd*u+f*(7*Td+9*Ed*u))/Math.cos(a),y=Math.asin(Math.sin(a)/sm),x=Xe(180*m/Math.PI,-180,180),b=Xe(180*y/Math.PI,-Ui,Ui);return new wn(x,b)}}class mI extends Ta{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const a=360*(e-.5),u=Xe(360*(.5-r),-Ui,Ui);return new wn(a,u)}}const lu=Math.PI/2;function am(n){return Math.tan((lu+n)/2)}class gI extends Ta{constructor(e){super(e),this.center=e.center||[0,30];const[r,a]=this.parallels=e.parallels||[30,30];let u=gt(r),f=gt(a);this.southernCenter=u+f<0,this.southernCenter&&(u=-u,f=-f);const m=Math.cos(u),y=am(u);this.n=u===f?Math.sin(u):Math.log(m/Math.cos(f))/Math.log(am(f)/y),this.f=m*Math.pow(am(u),this.n)/this.n}project(e,r){r=gt(r),this.southernCenter&&(r=-r),e=gt(e-this.center[0]);const a=1e-6,{n:u,f}=this;f>0?r<-lu+a&&(r=-lu+a):r>lu-a&&(r=lu-a);const m=f/Math.pow(am(r),u);let y=m*Math.sin(u*e),x=f-m*Math.cos(u*e);return y=.5*(y/Math.PI+.5),x=.5*(x/Math.PI+.5),{x:y,y:this.southernCenter?x:1-x,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:a,f:u}=this,f=u-r,m=Math.sign(f),y=Math.sign(a)*Math.sqrt(e*e+f*f);let x=Math.atan2(e,Math.abs(f))*m;f*a<0&&(x-=Math.PI*Math.sign(e)*m);const b=Xe(Jt(x/a)+this.center[0],-180,180),C=Xe(Jt(2*Math.atan(Math.pow(u/y,1/a))-lu),-Ui,Ui);return new wn(b,this.southernCenter?-C:C)}}class eb extends Ta{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:rs(e),y:os(r),z:0}}unproject(e,r){const a=Nr(e),u=Oi(r);return new wn(a,u)}}const tb=gt(Ui);class _I extends Ta{project(e,r){const a=(r=gt(r))*r,u=a*a;return{x:.5*((e=gt(e))*(.8707-.131979*a+u*(u*(.003971*a-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+a*(.015085+u*(.028874*a-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,u=25,f=0,m=a*a;do{m=a*a;const b=m*m;f=(a*(1.007226+m*(.015085+b*(.028874*m-.044475-.005916*b)))-r)/(1.007226+m*(.045255+b*(.259866*m-.311325-.005916*11*b))),a=Xe(a-f,-tb,tb)}while(Math.abs(f)>1e-6&&--u>0);m=a*a;const y=Xe(Jt(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),x=Jt(a);return new wn(y,x)}}const nb=gt(Ui);class yI extends Ta{project(e,r){r=gt(r),e=gt(e);const a=Math.cos(r),u=2/Math.PI,f=Math.acos(a*Math.cos(e/2)),m=Math.sin(f)/f,y=.5*(e*u+2*a*Math.sin(e/2)/m)||0,x=.5*(r+Math.sin(r)/m)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,r){let a=e=(2*e-.5)*Math.PI,u=r=(2*(1-r)-1)*Math.PI,f=25;const m=1e-6;let y=0,x=0;do{const b=Math.cos(u),C=Math.sin(u),P=2*C*b,I=C*C,L=b*b,R=Math.cos(a/2),O=Math.sin(a/2),Z=2*R*O,Q=O*O,ue=1-L*R*R,te=ue?1/ue:0,le=ue?Math.acos(b*R)*Math.sqrt(1/ue):0,pe=.5*(2*le*b*O+2*a/Math.PI)-e,fe=.5*(le*C+u)-r,Pe=.5*te*(L*Q+le*b*R*I)+1/Math.PI,Se=te*(Z*P/4-le*C*O),Oe=.125*te*(P*O-le*C*L*Z),et=.5*te*(I*R+le*Q*b)+.5,ke=Se*Oe-et*Pe;y=(fe*Se-pe*et)/ke,x=(pe*Oe-fe*Pe)/ke,a=Xe(a-y,-Math.PI,Math.PI),u=Xe(u-x,-nb,nb)}while((Math.abs(y)>m||Math.abs(x)>m)&&--f>0);return new wn(Jt(a),Jt(u))}}class ib extends Ta{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(gt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:a,cosPhi:u}=this;return{x:gt(e)*u*a+.5,y:-Math.sin(gt(r))/u*a+.5,z:0}}unproject(e,r){const{scale:a,cosPhi:u}=this,f=-(r-.5)/a,m=Xe(Jt((e-.5)/a)/u,-180,180),y=Math.asin(Xe(f*u,-1,1)),x=Xe(Jt(y),-Ui,Ui);return new wn(m,x)}}class vI extends eb{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,a){const u=od(e,r,a);return Kn(u,u,sd(is(a))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,r){const a=Wc(r.lat,r.lng),u=er([],a),f=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;td(a,a,u,Lo(1,0)*Ct*f);const m=Do(new Float64Array(16));return kl(m,e.pixelMatrix,e.globeMatrix),Kn(a,a,m),new ze(a[0],a[1])}pixelsPerMeter(e,r){return Lo(1,0)*r}pixelSpaceConversion(e,r,a){const u=Lo(1,e)*r,f=Yt(Lo(1,45)*r,u,a);return this.pixelsPerMeter(e,r)/f}createTileMatrix(e,r,a){const u=Z_(is(a.canonical));return kl(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,r){const{center:a}=e,u=sd(is(r));return Rp(u,u,gt(a.lng)),R_(u,u,gt(a.lat)),Dl(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,r,a,u){return I1(e,r,a,!0)||new Hc(0,0)}pointCoordinate3D(e,r,a){const u=this.pointCoordinate(e,r,a,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,r){return!I1(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(u,f){const m=u.cameraToCenterDistance,y=u._centerAltitude*f,x=u._camera,b=u._camera.forward(),C=zs([],Vr([],b,-m),[0,0,y]),P=u.worldSize/(2*Math.PI),I=[0,0,-P],L=u.width/u.height,R=Math.tan(u.fovAboveCenter),O=Vr([],x.up(),R),Z=Vr([],x.right(),R*L),Q=er([],zs([],zs([],b,O),Z)),ue=[];let te;if(new U_(C,Q).closestPointOnSphere(I,P,ue)){const le=zs([],ue,I),pe=zo([],le,C);te=Math.cos(u.fovAboveCenter)*Jh(pe)}else{const le=zo([],C,I),pe=zo([],I,C);er(pe,pe);const fe=Jh(le)-P;te=Math.sqrt(fe*(fe+2*P));const Pe=Math.acos(te/(P+fe))-Math.acos(io(b,pe));te*=Math.cos(Pe)}return 1.01*te}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Xc(e.zoom);if(a>0){const u=Qw(e,Lo(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Yt(r,u+f*(1-Math.cos(m)),Math.pow(a,10))}return r}upVector(e,r,a){return od(r,a,e,1)}upVectorScale(e){return{metersToTile:Bp(Op(is(e)))}}}function rb(n){const e=n.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new eb(n);case"equirectangular":return new mI(n);case"naturalEarth":return new _I(n);case"equalEarth":return new pI(n);case"winkelTripel":return new yI(n);case"albers":return r?new ib(n):new fI(n);case"lambertConformalConic":return r?new ib(n):new gI(n);case"globe":return new vI(n)}throw new Error(`Invalid projection name: ${n.name}`)}const xI=Xp.types,wI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function lm(n,e,r,a,u,f,m,y,x,b,C,P,I){const L=y?Math.min(ba,Math.round(y[0])):0,R=y?Math.min(ba,Math.round(y[1])):0;n.emplaceBack(e,r,Math.round(32*a),Math.round(32*u),f,m,(L<<1)+(x?1:0),R,16*b,16*C,256*P,256*I)}function cm(n,e,r,a,u,f,m){n.emplaceBack(e,r,a,u,f,m)}function um(n,e,r,a,u){n.emplaceBack(e,r,a,u),n.emplaceBack(e,r,a,u),n.emplaceBack(e,r,a,u),n.emplaceBack(e,r,a,u)}function bI(n){for(const e of n.sections)if(I_(e.text))return!0;return!1}class by{constructor(e){this.layoutVertexArray=new Ze,this.indexArray=new xt,this.programConfigurations=e,this.segments=new ni,this.dynamicLayoutVertexArray=new Ke,this.opacityVertexArray=new bt,this.placedSymbolArray=new ti,this.globeExtVertexArray=new it}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,a,u){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,IP.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,DP.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,wI,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,kP.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}mt(by,"SymbolBuffers");class Ty{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new ni,this.collisionVertexArray=new Ht,this.collisionVertexArrayExt=new qt}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,zP.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,LP.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}mt(Ty,"CollisionBuffers");class Ea{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Do([]),this.placementViewportMatrix=Do([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=hy(this.zoom,r["text-size"]),this.iconSizeData=hy(this.zoom,r["icon-size"]);const a=this.layers[0].layout,u=a.get("symbol-sort-key"),f=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(m=>jr[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new by(new Il(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new by(new Il(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Qi,this.lineVertexArray=new jc,this.symbolInstances=new Ln}calculateGlyphDependencies(e,r,a,u,f){for(let m=0;m<e.length;m++)if(r[e.charCodeAt(m)]=!0,u&&f){const y=_d[e.charAt(m)];y&&(r[y.charCodeAt(0)]=!0)}}populate(e,r,a,u){const f=this.layers[0],m=f.layout,y=this.projection.name==="globe",x=m.get("text-font"),b=m.get("text-field"),C=m.get("icon-image"),P=(b.value.kind!=="constant"||b.value.value instanceof Ji&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),I=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,L=m.get("symbol-sort-key");if(this.features=[],!P&&!I)return;const R=r.iconDependencies,O=r.glyphDependencies,Z=r.availableImages,Q=new M(this.zoom);for(const{feature:ue,id:te,index:le,sourceLayerIndex:pe}of e){const fe=f._featureFilter.needGeometry,Pe=Bl(ue,fe);if(!f._featureFilter.filter(Q,Pe,a))continue;if(fe||(Pe.geometry=Ls(ue,a,u)),y&&ue.type!==1&&a.z<=5){const ke=Pe.geometry,Ge=.98078528056,$e=(We,rt)=>io(od(We.x,We.y,a,1),od(rt.x,rt.y,a,1))<Ge;for(let We=0;We<ke.length;We++)ke[We]=DM(ke[We],$e)}let Se,Oe;if(P){const ke=f.getValueAndResolveTokens("text-field",Pe,a,Z),Ge=Ji.factory(ke);bI(Ge)&&(this.hasRTLText=!0),(!this.hasRTLText||v()==="unavailable"||this.hasRTLText&&S.isParsed())&&(Se=FP(Ge,f,Pe))}if(I){const ke=f.getValueAndResolveTokens("icon-image",Pe,a,Z);Oe=ke instanceof wr?ke:wr.fromString(ke)}if(!Se&&!Oe)continue;const et=this.sortFeaturesByKey?L.evaluate(Pe,{},a):void 0;if(this.features.push({id:te,text:Se,icon:Oe,index:le,sourceLayerIndex:pe,geometry:Pe.geometry,properties:ue.properties,type:xI[ue.type],sortKey:et}),Oe&&(R[Oe.name]=!0),Se){const ke=x.evaluate(Pe,{},a).join(","),Ge=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(jr.vertical)>=0;for(const $e of Se.sections)if($e.image)R[$e.image.name]=!0;else{const We=$h(Se.toString()),rt=$e.fontStack||ke,Re=O[rt]=O[rt]||{};this.calculateGlyphDependencies($e.text,Re,Ge,this.allowVerticalPlacement,We)}}}m.get("symbol-placement")==="line"&&(this.features=function(ue){const te={},le={},pe=[];let fe=0;function Pe(ke){pe.push(ue[ke]),fe++}function Se(ke,Ge,$e){const We=le[ke];return delete le[ke],le[Ge]=We,pe[We].geometry[0].pop(),pe[We].geometry[0]=pe[We].geometry[0].concat($e[0]),We}function Oe(ke,Ge,$e){const We=te[Ge];return delete te[Ge],te[ke]=We,pe[We].geometry[0].shift(),pe[We].geometry[0]=$e[0].concat(pe[We].geometry[0]),We}function et(ke,Ge,$e){const We=$e?Ge[0][Ge[0].length-1]:Ge[0][0];return`${ke}:${We.x}:${We.y}`}for(let ke=0;ke<ue.length;ke++){const Ge=ue[ke],$e=Ge.geometry,We=Ge.text?Ge.text.toString():null;if(!We){Pe(ke);continue}const rt=et(We,$e),Re=et(We,$e,!0);if(rt in le&&Re in te&&le[rt]!==te[Re]){const ut=Oe(rt,Re,$e),yt=Se(rt,Re,pe[ut].geometry);delete te[rt],delete le[Re],le[et(We,pe[yt].geometry,!0)]=yt,pe[ut].geometry=null}else rt in le?Se(rt,Re,$e):Re in te?Oe(rt,Re,$e):(Pe(ke),te[rt]=fe-1,le[Re]=fe-1)}return pe.filter(ke=>ke.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ue,te)=>ue.sortKey-te.sortKey)}update(e,r,a,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,a,u),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,a,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=rb(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:f}of r)this.lineVertexArray.emplaceBack(u,f);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,u,f,m,y,x,b,C,P,I,L,R){const O=e.indexArray,Z=e.layoutVertexArray,Q=e.globeExtVertexArray,ue=e.segments.prepareSegment(4*r.length,Z,O,this.canOverlap?m.sortKey:void 0),te=this.glyphOffsetArray.length,le=ue.vertexLength,pe=this.allowVerticalPlacement&&y===jr.vertical?Math.PI/2:0,fe=m.text&&m.text.sections;for(let Se=0;Se<r.length;Se++){const{tl:Oe,tr:et,bl:ke,br:Ge,tex:$e,pixelOffsetTL:We,pixelOffsetBR:rt,minFontScaleX:Re,minFontScaleY:ut,glyphOffset:yt,isSDF:ht,sectionIndex:Bt}=r[Se],st=ue.vertexLength,Et=yt[1];if(lm(Z,b.x,b.y,Oe.x,Et+Oe.y,$e.x,$e.y,a,ht,We.x,We.y,Re,ut),lm(Z,b.x,b.y,et.x,Et+et.y,$e.x+$e.w,$e.y,a,ht,rt.x,We.y,Re,ut),lm(Z,b.x,b.y,ke.x,Et+ke.y,$e.x,$e.y+$e.h,a,ht,We.x,rt.y,Re,ut),lm(Z,b.x,b.y,Ge.x,Et+Ge.y,$e.x+$e.w,$e.y+$e.h,a,ht,rt.x,rt.y,Re,ut),x){const{x:Ft,y:tn,z:Ot}=x.anchor,[Pt,Dn,Nt]=x.up;cm(Q,Ft,tn,Ot,Pt,Dn,Nt),cm(Q,Ft,tn,Ot,Pt,Dn,Nt),cm(Q,Ft,tn,Ot,Pt,Dn,Nt),cm(Q,Ft,tn,Ot,Pt,Dn,Nt),um(e.dynamicLayoutVertexArray,Ft,tn,Ot,pe)}else um(e.dynamicLayoutVertexArray,b.x,b.y,b.z,pe);O.emplaceBack(st,st+1,st+2),O.emplaceBack(st+1,st+2,st+3),ue.vertexLength+=4,ue.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(yt[0]),Se!==r.length-1&&Bt===r[Se+1].sectionIndex||e.programConfigurations.populatePaintArrays(Z.length,m,m.index,{},L,R,fe&&fe[Bt])}const Pe=x?x.anchor:b;e.placedSymbolArray.emplaceBack(Pe.x,Pe.y,Pe.z,b.x,b.y,te,this.glyphOffsetArray.length-te,le,C,P,b.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],y,0,!1,0,I,0)}_commitLayoutVertex(e,r,a,u,f,m,y){e.emplaceBack(r,a,u,f,m,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,r,a,u,f,m,y){const x=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),b=x.vertexLength,C=y.tileAnchorX,P=y.tileAnchorY;for(let L=0;L<4;L++)a.collisionVertexArray.emplaceBack(0,0,0,0);a.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),a.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),a.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(a.layoutVertexArray,u,f,m,C,P,new ze(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,f,m,C,P,new ze(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,f,m,C,P,new ze(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,u,f,m,C,P,new ze(e.x1,e.y2)),x.vertexLength+=4;const I=a.indexArray;I.emplaceBack(b,b+1),I.emplaceBack(b+1,b+2),I.emplaceBack(b+2,b+3),I.emplaceBack(b+3,b),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,a,u,f,m){for(let y=u;y<f;y++){const x=a.get(y),b=this.getSymbolInstanceTextSize(e,m,r,y);this._addCollisionDebugVertices(x,b,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,r,a,u,f,m){for(let y=u;y<f;y++){const x=a.get(y),b=this.getSymbolInstanceIconSize(e,r,m.placedIconSymbolIndex);this._addCollisionDebugVertices(x,b,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ty(_t,Tw.members,bi),this.iconCollisionBox=new Ty(_t,Tw.members,bi);const a=eu(this.iconSizeData,e),u=eu(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(u,e,r,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(u,e,r,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(a,e,r,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(a,e,r,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(e,r,a,u){const f=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:u),m=Jp(this.textSizeData,e,f)/Ii;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,r,a){const u=this.icon.placedSymbolArray.get(a),f=Jp(this.iconSizeData,e,u);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,r,a){e.emplaceBack(r,-a,-a),e.emplaceBack(r,a,-a),e.emplaceBack(r,a,a),e.emplaceBack(r,-a,a)}_updateTextDebugCollisionBoxes(e,r,a,u,f,m){for(let y=u;y<f;y++){const x=a.get(y),b=this.getSymbolInstanceTextSize(e,m,r,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,b,x.padding)}}_updateIconDebugCollisionBoxes(e,r,a,u,f,m){for(let y=u;y<f;y++){const x=a.get(y),b=this.getSymbolInstanceIconSize(e,r,m);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,x.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=eu(this.iconSizeData,e),u=eu(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(u,e,r,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(u,e,r,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(a,e,r,m.iconBoxStartIndex,m.iconBoxEndIndex,m.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(a,e,r,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,a,u,f,m,y,x,b){const C={};if(r<a){const{x1:P,y1:I,x2:L,y2:R,padding:O,projectedAnchorX:Z,projectedAnchorY:Q,projectedAnchorZ:ue,tileAnchorX:te,tileAnchorY:le,featureIndex:pe}=e.get(r);C.textBox={x1:P,y1:I,x2:L,y2:R,padding:O,projectedAnchorX:Z,projectedAnchorY:Q,projectedAnchorZ:ue,tileAnchorX:te,tileAnchorY:le},C.textFeatureIndex=pe}if(u<f){const{x1:P,y1:I,x2:L,y2:R,padding:O,projectedAnchorX:Z,projectedAnchorY:Q,projectedAnchorZ:ue,tileAnchorX:te,tileAnchorY:le,featureIndex:pe}=e.get(u);C.verticalTextBox={x1:P,y1:I,x2:L,y2:R,padding:O,projectedAnchorX:Z,projectedAnchorY:Q,projectedAnchorZ:ue,tileAnchorX:te,tileAnchorY:le},C.verticalTextFeatureIndex=pe}if(m<y){const{x1:P,y1:I,x2:L,y2:R,padding:O,projectedAnchorX:Z,projectedAnchorY:Q,projectedAnchorZ:ue,tileAnchorX:te,tileAnchorY:le,featureIndex:pe}=e.get(m);C.iconBox={x1:P,y1:I,x2:L,y2:R,padding:O,projectedAnchorX:Z,projectedAnchorY:Q,projectedAnchorZ:ue,tileAnchorX:te,tileAnchorY:le},C.iconFeatureIndex=pe}if(x<b){const{x1:P,y1:I,x2:L,y2:R,padding:O,projectedAnchorX:Z,projectedAnchorY:Q,projectedAnchorZ:ue,tileAnchorX:te,tileAnchorY:le,featureIndex:pe}=e.get(x);C.verticalIconBox={x1:P,y1:I,x2:L,y2:R,padding:O,projectedAnchorX:Z,projectedAnchorY:Q,projectedAnchorZ:ue,tileAnchorX:te,tileAnchorY:le},C.verticalIconFeatureIndex=pe}return C}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),u=a.vertexStartIndex+4*a.numGlyphs;for(let f=a.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),u=[],f=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);const x=this.symbolInstances.get(y);u.push(0|Math.round(r*x.tileAnchorX+a*x.tileAnchorY)),f.push(x.featureIndex)}return m.sort((y,x)=>u[y]-u[x]||f[x]-f[y]),m}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:x,verticalPlacedIconSymbolIndex:b}=a;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),f>=0&&f!==u&&this.addIndicesForPlacedSymbol(this.text,f),m>=0&&m!==f&&m!==u&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}mt(Ea,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ea.MAX_GLYPHS=65535,Ea.addDynamicAttributes=um;const TI=new ie({"symbol-placement":new F(Fe.layout_symbol["symbol-placement"]),"symbol-spacing":new F(Fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new F(Fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new q(Fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new F(Fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new F(Fe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new F(Fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new F(Fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new F(Fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new q(Fe.layout_symbol["icon-size"]),"icon-text-fit":new F(Fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new F(Fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new q(Fe.layout_symbol["icon-image"]),"icon-rotate":new q(Fe.layout_symbol["icon-rotate"]),"icon-padding":new F(Fe.layout_symbol["icon-padding"]),"icon-keep-upright":new F(Fe.layout_symbol["icon-keep-upright"]),"icon-offset":new q(Fe.layout_symbol["icon-offset"]),"icon-anchor":new q(Fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new F(Fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new F(Fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new F(Fe.layout_symbol["text-rotation-alignment"]),"text-field":new q(Fe.layout_symbol["text-field"]),"text-font":new q(Fe.layout_symbol["text-font"]),"text-size":new q(Fe.layout_symbol["text-size"]),"text-max-width":new q(Fe.layout_symbol["text-max-width"]),"text-line-height":new q(Fe.layout_symbol["text-line-height"]),"text-letter-spacing":new q(Fe.layout_symbol["text-letter-spacing"]),"text-justify":new q(Fe.layout_symbol["text-justify"]),"text-radial-offset":new q(Fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new F(Fe.layout_symbol["text-variable-anchor"]),"text-anchor":new q(Fe.layout_symbol["text-anchor"]),"text-max-angle":new F(Fe.layout_symbol["text-max-angle"]),"text-writing-mode":new F(Fe.layout_symbol["text-writing-mode"]),"text-rotate":new q(Fe.layout_symbol["text-rotate"]),"text-padding":new F(Fe.layout_symbol["text-padding"]),"text-keep-upright":new F(Fe.layout_symbol["text-keep-upright"]),"text-transform":new q(Fe.layout_symbol["text-transform"]),"text-offset":new q(Fe.layout_symbol["text-offset"]),"text-allow-overlap":new F(Fe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new F(Fe.layout_symbol["text-ignore-placement"]),"text-optional":new F(Fe.layout_symbol["text-optional"])});var Ey={paint:new ie({"icon-opacity":new q(Fe.paint_symbol["icon-opacity"]),"icon-color":new q(Fe.paint_symbol["icon-color"]),"icon-halo-color":new q(Fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new q(Fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new q(Fe.paint_symbol["icon-halo-blur"]),"icon-translate":new F(Fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new F(Fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new q(Fe.paint_symbol["text-opacity"]),"text-color":new q(Fe.paint_symbol["text-color"],{runtimeType:hr,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new q(Fe.paint_symbol["text-halo-color"]),"text-halo-width":new q(Fe.paint_symbol["text-halo-width"]),"text-halo-blur":new q(Fe.paint_symbol["text-halo-blur"]),"text-translate":new F(Fe.paint_symbol["text-translate"]),"text-translate-anchor":new F(Fe.paint_symbol["text-translate-anchor"])}),layout:TI};class ob{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ea,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}mt(ob,"FormatSectionOverride",{omit:["defaultValue"]});class hm extends ko{constructor(e){super(e,Ey)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const u=[];for(const f of a)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,a,u){const f=this.layout.get(e).evaluate(r,{},a,u),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||da(m.value)||!f?f:function(y,x){return x.replace(/{([^{}]+)}/g,(b,C)=>C in y?String(y[C]):"")}(r.properties,f)}createBucket(e){return new Ea(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Ey.paint.overridableProperties){if(!hm.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new ob(r),u=new Lc(a,r.property.specification);let f=null;f=r.value.kind==="constant"||r.value.kind==="source"?new zh("source",u):new wl("composite",u,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new H(r.property,f,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&hm.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),u=Ey.paint.properties[r];let f=!1;const m=y=>{for(const x of y)if(u.overrides&&u.overrides.hasOverride(x))return void(f=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Ji)m(a.value.value.sections);else if(a.value.kind==="source"){const y=b=>{f||(b instanceof bs&&$n(b.value)===rl?m(b.value.sections):b instanceof Qo?m(b.sections):b.eachChild(y))},x=a.value;x._styleExpression&&y(x._styleExpression.expression)}return f}getProgramConfiguration(e){return new va(this,e)}}var EI={paint:new ie({"background-color":new F(Fe.paint_background["background-color"]),"background-pattern":new F(Fe.paint_background["background-pattern"]),"background-opacity":new F(Fe.paint_background["background-opacity"])})},SI={paint:new ie({"raster-opacity":new F(Fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new F(Fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new F(Fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new F(Fe.paint_raster["raster-brightness-max"]),"raster-saturation":new F(Fe.paint_raster["raster-saturation"]),"raster-contrast":new F(Fe.paint_raster["raster-contrast"]),"raster-resampling":new F(Fe.paint_raster["raster-resampling"]),"raster-fade-duration":new F(Fe.paint_raster["raster-fade-duration"])})};class CI extends ko{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var AI={paint:new ie({"sky-type":new F(Fe.paint_sky["sky-type"]),"sky-atmosphere-sun":new F(Fe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new F(Fe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new F(Fe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new F(Fe.paint_sky["sky-gradient-radius"]),"sky-gradient":new ne(Fe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new F(Fe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new F(Fe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new F(Fe.paint_sky["sky-opacity"])})};function Sy(n,e,r){const a=[0,0,1],u=E1([]);return C1(u,u,r?-gt(n)+Math.PI:gt(n)),S1(u,u,-gt(e)),x1(a,a,u),er(a,a)}const MI={circle:class extends ko{constructor(n){super(n,UM)}createBucket(n){return new Y_(n)}queryRadius(n){const e=n;return Kc("circle-radius",this,e)+Kc("circle-stroke-width",this,e)+Np(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,r,a,u,f,m,y){const x=X1(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return H1(n,a,f,m,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,b)}getProgramIds(){return["circle"]}getProgramConfiguration(n){return new va(this,n)}},heatmap:class extends ko{createBucket(n){return new Y1(n)}constructor(n){super(n,GM),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ty({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return Kc("heatmap-radius",this,n)}queryIntersectsFeature(n,e,r,a,u,f,m,y){const x=this.paint.get("heatmap-radius").evaluate(e,r);return H1(n,a,f,m,y,!0,!0,new ze(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(n){return new va(this,n)}},hillshade:class extends ko{constructor(n){super(n,$M)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ko{constructor(n){super(n,sP)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(n){return new va(this,n)}recalculate(n,e){super.recalculate(n,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new qp(n)}queryRadius(){return Np(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,r,a,u,f){return!n.queryGeometry.isAboveHorizon&&G1(W1(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends ko{constructor(n){super(n,bP)}createBucket(n){return new pd(n)}queryRadius(){return Np(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(n){return new va(this,n)}queryIntersectsFeature(n,e,r,a,u,f,m,y,x){const b=X1(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),C=this.paint.get("fill-extrusion-height").evaluate(e,r),P=this.paint.get("fill-extrusion-base").evaluate(e,r),I=[0,0],L=y&&f.elevation,R=f.elevation?f.elevation.exaggeration():1,O=n.tile.getBucket(this);if(L&&O instanceof pd){const le=O.centroidVertexArray,pe=x+1;pe<le.length&&(I[0]=le.geta_centroid_pos0(pe),I[1]=le.geta_centroid_pos1(pe))}if(I[0]===0&&I[1]===1)return!1;f.projection.name==="globe"&&(a=mw([a],[new ze(0,0),new ze(Ct,Ct)],n.tileID.canonical).map(le=>le.polygon).flat());const Z=L?y:null,[Q,ue]=function(le,pe,fe,Pe,Se,Oe,et,ke,Ge,$e,We){return le.projection.name==="globe"?function(rt,Re,ut,yt,ht,Bt,st,Et,Ft,tn,Ot){const Pt=[],Dn=[],Nt=rt.projection.upVectorScale(Ot,rt.center.lat,rt.worldSize).metersToTile,jt=[0,0,0,1],bn=[0,0,0,1],Mn=(Tn,Vn,Zn,ri)=>{Tn[0]=Vn,Tn[1]=Zn,Tn[2]=ri,Tn[3]=1},Pn=pw();ut>0&&(ut+=Pn),yt+=Pn;for(const Tn of Re){const Vn=[],Zn=[];for(const ri of Tn){const En=ri.x+ht.x,fi=ri.y+ht.y,oi=rt.projection.projectTilePoint(En,fi,Ot),jn=rt.projection.upVector(Ot,ri.x,ri.y);let on=ut,si=yt;if(st){const In=vw(En,fi,ut,yt,st,Et,Ft,tn);on+=In.base,si+=In.top}ut!==0?Mn(jt,oi.x+jn[0]*Nt*on,oi.y+jn[1]*Nt*on,oi.z+jn[2]*Nt*on):Mn(jt,oi.x,oi.y,oi.z),Mn(bn,oi.x+jn[0]*Nt*si,oi.y+jn[1]*Nt*si,oi.z+jn[2]*Nt*si),Kn(jt,jt,Bt),Kn(bn,bn,Bt),Vn.push(new Qc(jt[0],jt[1],jt[2])),Zn.push(new Qc(bn[0],bn[1],bn[2]))}Pt.push(Vn),Dn.push(Zn)}return[Pt,Dn]}(le,pe,fe,Pe,Se,Oe,et,ke,Ge,$e,We):et?function(rt,Re,ut,yt,ht,Bt,st,Et,Ft){const tn=[],Ot=[],Pt=[0,0,0,1];for(const Dn of rt){const Nt=[],jt=[];for(const bn of Dn){const Mn=bn.x+yt.x,Pn=bn.y+yt.y,Tn=vw(Mn,Pn,Re,ut,Bt,st,Et,Ft);Pt[0]=Mn,Pt[1]=Pn,Pt[2]=Tn.base,Pt[3]=1,zl(Pt,Pt,ht),Pt[3]=Math.max(Pt[3],1e-5);const Vn=new Qc(Pt[0]/Pt[3],Pt[1]/Pt[3],Pt[2]/Pt[3]);Pt[0]=Mn,Pt[1]=Pn,Pt[2]=Tn.top,Pt[3]=1,zl(Pt,Pt,ht),Pt[3]=Math.max(Pt[3],1e-5);const Zn=new Qc(Pt[0]/Pt[3],Pt[1]/Pt[3],Pt[2]/Pt[3]);Nt.push(Vn),jt.push(Zn)}tn.push(Nt),Ot.push(jt)}return[tn,Ot]}(pe,fe,Pe,Se,Oe,et,ke,Ge,$e):function(rt,Re,ut,yt,ht){const Bt=[],st=[],Et=ht[8]*Re,Ft=ht[9]*Re,tn=ht[10]*Re,Ot=ht[11]*Re,Pt=ht[8]*ut,Dn=ht[9]*ut,Nt=ht[10]*ut,jt=ht[11]*ut;for(const bn of rt){const Mn=[],Pn=[];for(const Tn of bn){const Vn=Tn.x+yt.x,Zn=Tn.y+yt.y,ri=ht[0]*Vn+ht[4]*Zn+ht[12],En=ht[1]*Vn+ht[5]*Zn+ht[13],fi=ht[2]*Vn+ht[6]*Zn+ht[14],oi=ht[3]*Vn+ht[7]*Zn+ht[15],jn=ri+Et,on=En+Ft,si=fi+tn,In=Math.max(oi+Ot,1e-5),ir=ri+Pt,ai=En+Dn,ki=fi+Nt,Ti=Math.max(oi+jt,1e-5);Mn.push(new Qc(jn/In,on/In,si/In)),Pn.push(new Qc(ir/Ti,ai/Ti,ki/Ti))}Bt.push(Mn),st.push(Pn)}return[Bt,st]}(pe,fe,Pe,Se,Oe)}(f,a,P,C,b,m,Z,I,R,f.center.lat,n.tileID.canonical),te=n.queryGeometry;return function(le,pe,fe){let Pe=1/0;G1(fe,pe)&&(Pe=yw(fe,pe[0]));for(let Se=0;Se<pe.length;Se++){const Oe=pe[Se],et=le[Se];for(let ke=0;ke<Oe.length-1;ke++){const Ge=Oe[ke],$e=[Ge,Oe[ke+1],et[ke+1],et[ke],Ge];j1(fe,$e)&&(Pe=Math.min(Pe,yw(fe,$e)))}}return Pe!==1/0&&Pe}(Q,ue,te.isPointQuery()?te.screenBounds:te.screenGeometry)}},line:class extends ko{constructor(n){super(n,xw),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof xh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=ww.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Yp(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(n){return new va(this,n)}queryRadius(n){const e=n,r=bw(Kc("line-width",this,e),Kc("line-gap-width",this,e)),a=Kc("line-offset",this,e);return r/2+Math.abs(a)+Np(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,r,a,u,f){if(n.queryGeometry.isAboveHorizon)return!1;const m=W1(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,n.pixelToTileUnitsFactor),y=n.pixelToTileUnitsFactor/2*bw(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),x=this.paint.get("line-offset").evaluate(e,r);return x&&(a=function(b,C){const P=[],I=new ze(0,0);for(let L=0;L<b.length;L++){const R=b[L],O=[];for(let Z=0;Z<R.length;Z++){const Q=R[Z],ue=R[Z+1],te=Z===0?I:Q.sub(R[Z-1])._unit()._perp(),le=Z===R.length-1?I:ue.sub(Q)._unit()._perp(),pe=te._add(le)._unit();pe._mult(1/(pe.x*le.x+pe.y*le.y)),O.push(pe._mult(C)._add(Q))}P.push(O)}return P}(a,x*n.pixelToTileUnitsFactor)),function(b,C,P){for(let I=0;I<C.length;I++){const L=C[I];if(b.length>=3){for(let R=0;R<L.length;R++)if(Fl(b,L[R]))return!0}if(RM(b,L,P))return!0}return!1}(m,a,y)}isTileClipped(){return!0}},symbol:hm,background:class extends ko{constructor(n){super(n,EI)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ko{constructor(n){super(n,SI)}getProgramIds(){return["raster"]}},sky:class extends ko{constructor(n){super(n,AI),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ty({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),u=!a,f=n.style.light,m=f.properties.get("position");return u&&f.properties.get("anchor")==="viewport"&&pn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Sy(m.azimuthal,90-m.polar,e):Sy(a[0],90-a[1],e)}const r=this.paint.get("sky-gradient-center");return Sy(r[0],90-r[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}}};class Sd{constructor(e,r,a,u){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(r,u)}update(e,r,a){const{width:u,height:f}=e,{context:m}=this,{gl:y}=m,{HTMLImageElement:x,HTMLCanvasElement:b,HTMLVideoElement:C,ImageData:P,ImageBitmap:I}=A;if(y.bindTexture(y.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!r||r.premultiply!==!1)),a||this.size&&this.size[0]===u&&this.size[1]===f){const{x:L,y:R}=a||{x:0,y:0};e instanceof x||e instanceof b||e instanceof C||e instanceof P||I&&e instanceof I?y.texSubImage2D(y.TEXTURE_2D,0,L,R,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,L,R,u,f,y.RGBA,y.UNSIGNED_BYTE,e.data)}else this.size=[u,f],e instanceof x||e instanceof b||e instanceof C||e instanceof P||I&&e instanceof I?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,u,f,0,this.format,y.UNSIGNED_BYTE,e.data);this.useMipmap=!!(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,r){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class PI{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class II{constructor(){this.tasks={},this.taskQueue=[],cr(["process"],this),this.invoker=new PI(this.process),this.nextId=0}add(e,r){const a=this.nextId++,u=function({type:f,isSymbolTile:m,zoom:y}){return y=y||0,f==="message"?0:f!=="maybePrepare"||m?f!=="parseTile"||m?f==="parseTile"&&m?300-y:f==="maybePrepare"&&m?400-y:500:200-y:100-y}(r);if(u===0){Hi();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[a]={fn:e,metadata:r,priority:u,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){Hi();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let u=0;u<this.taskQueue.length;u++){const f=this.tasks[this.taskQueue[u]];f.priority<r&&(r=f.priority,e=u)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class sb{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const kI=["tile","layer","source","sourceLayer","state"];class ab{constructor(e,r,a,u,f){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=a,this._y=u,this.properties=e.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const r of kI)this[r]!==void 0&&(e[r]=this[r]);return e}}const so=32,ss=33,Sa=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,r=0,a=0,u=0,f=0,m=0,y=0;for(1&e?u=f=m=so:r=a=y=so;(e>>=1)>1;){const b=r+u>>1,C=a+f>>1;1&e?(u=r,f=a,r=m,a=y):(r=u,a=f,u=m,f=y),m=b,y=C}const x=4*n;Sa[x+0]=r,Sa[x+1]=a,Sa[x+2]=u,Sa[x+3]=f}const as=new Uint16Array(2178),Ca=new Uint8Array(1089),dm=new Uint16Array(1089);function lb(n){return n===0?-.03125:n===32?.03125:0}var cb=xe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const ub={type:2,extent:Ct,loadGeometry:()=>[[new ze(0,0),new ze(Ct+1,0),new ze(Ct+1,Ct+1),new ze(0,Ct+1),new ze(0,0)]]};class Cy{constructor(e,r,a,u,f){this.tileID=e,this.uid=mi(),this.uses=0,this.tileSize=r,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<vo.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Ul(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,f){const m={};if(!f)return m;for(const y of u){const x=y.layerIds.map(b=>f.getLayer(b)).filter(Boolean);if(x.length!==0){y.layers=x,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(b=>x.filter(C=>C.id===b)[0]));for(const b of x)m[b.id]=y}}return m}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const f=this.buckets[u];if(f instanceof Ea){if(this.hasSymbolBuckets=!0,!a)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const f=this.buckets[u];if(f instanceof Ea&&f.hasRTLText){this.hasRTLText=!0,S.isLoading()||S.isLoaded()||v()!=="deferred"||T();break}}this.queryPadding=0;for(const u in this.buckets){const f=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(u).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new xn}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const u=this.buckets[a];u.uploadPending()&&u.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Sd(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Sd(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Sd(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,a,u,f,m,y,x){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:y,transform:m,params:f,tileTransform:this.tileTransform},e,r,a):{}}querySourceFeatures(e,r){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const u=a.loadVTLayers(),f=r?r.sourceLayer:"",m=u._geojsonTileLayer||u[f];if(!m)return;const y=Oc(r&&r.filter),{z:x,x:b,y:C}=this.tileID.canonical,P={z:x,x:b,y:C};for(let I=0;I<m.length;I++){const L=m.feature(I);if(y.needGeometry){const Z=Bl(L,!0);if(!y.filter(new M(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!y.filter(new M(this.tileID.overscaledZ),L))continue;const R=a.getId(L,f),O=new ab(L,x,b,C,R);O.tile=P,e.push(O)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const a=Mi(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let u=!1;if(this.expirationTime>a)u=!1;else if(r)if(this.expirationTime<r)u=!0;else{const f=this.expirationTime-r;f?this.expirationTime=a+Math.max(f,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!r)return;const a=this.latestFeatureIndex.loadVTLayers(),u=r.style.listImages();for(const f in this.buckets){if(!r.style.hasLayer(f))continue;const m=this.buckets[f],y=m.layers[0].sourceLayer||"_geojsonTileLayer",x=a[y],b=e[y];if(!x||!b||Object.keys(b).length===0)continue;if(m.update(b,x,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),m instanceof Yp||m instanceof qp){const P=r.style._getSourceCache(m.layers[0].source);r._terrain&&r._terrain.enabled&&P&&m.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(P.id,this.tileID)}const C=r&&r.style&&r.style.getLayer(f);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<vo.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=vo.now()+e}setTexture(e,r){const a=r.context,u=a.gl;this.texture=this.texture||r.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Sd(a,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE))}setDependencies(e,r){const a={};for(const u of r)a[u]=!0;this.dependencies[e]=a}hasDependency(e,r){for(const a of e){const u=this.dependencies[a];if(u){for(const f of r)if(u[f])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const a=Ls(ub,this.tileID.canonical,this.tileTransform)[0],u=new Qe,f=new Er;for(let m=0;m<a.length;m++){const{x:y,y:x}=a[m];u.emplaceBack(y,x),f.emplaceBack(m)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(u,id.members),this._tileDebugSegments=ni.simpleSegment(0,0,u.length,f.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const a=Ls(ub,this.tileID.canonical,this.tileTransform)[0];let u,f;if(this.isRaster){const m=function(y,x){const b=Ul(y,x),C=Math.pow(2,y.z);for(let Z=0;Z<ss;Z++)for(let Q=0;Q<ss;Q++){const ue=Nr((y.x+(Q+lb(Q))/so)/C),te=Oi((y.y+(Z+lb(Z))/so)/C),le=x.project(ue,te),pe=Z*ss+Q;as[2*pe+0]=Math.round((le.x*b.scale-b.x)*Ct),as[2*pe+1]=Math.round((le.y*b.scale-b.y)*Ct)}Ca.fill(0),dm.fill(0);for(let Z=2045;Z>=0;Z--){const Q=4*Z,ue=Sa[Q+0],te=Sa[Q+1],le=Sa[Q+2],pe=Sa[Q+3],fe=ue+le>>1,Pe=te+pe>>1,Se=fe+Pe-te,Oe=Pe+ue-fe,et=te*ss+ue,ke=pe*ss+le,Ge=Pe*ss+fe,$e=Math.hypot((as[2*et+0]+as[2*ke+0])/2-as[2*Ge+0],(as[2*et+1]+as[2*ke+1])/2-as[2*Ge+1])>=16;Ca[Ge]=Ca[Ge]||($e?1:0),Z<1022&&(Ca[Ge]=Ca[Ge]||Ca[(te+Oe>>1)*ss+(ue+Se>>1)]||Ca[(pe+Oe>>1)*ss+(le+Se>>1)])}const P=new je,I=new xt;let L=0;function R(Z,Q){const ue=Q*ss+Z;return dm[ue]===0&&(P.emplaceBack(as[2*ue+0],as[2*ue+1],Z*Ct/so,Q*Ct/so),dm[ue]=++L),dm[ue]-1}function O(Z,Q,ue,te,le,pe){const fe=Z+ue>>1,Pe=Q+te>>1;if(Math.abs(Z-le)+Math.abs(Q-pe)>1&&Ca[Pe*ss+fe])O(le,pe,Z,Q,fe,Pe),O(ue,te,le,pe,fe,Pe);else{const Se=R(Z,Q),Oe=R(ue,te),et=R(le,pe);I.emplaceBack(Se,Oe,et)}}return O(0,0,so,so,so,0),O(so,so,0,0,0,so),{vertices:P,indices:I}}(this.tileID.canonical,r);u=m.vertices,f=m.indices}else{u=new je,f=new xt;for(const{x:y,y:x}of a)u.emplaceBack(y,x,0,0);const m=sy(u.int16,void 0,4);for(let y=0;y<m.length;y+=3)f.emplaceBack(m[y],m[y+1],m[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,cb.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=ni.simpleSegment(0,0,u.length,f.length)}_makeGlobeTileDebugBuffers(e,r){const a=r.projection;if(!a||a.name!=="globe"||r.freezeTileCoverage)return;const u=this.tileID.canonical,f=sd(k1(u,r)),m=Xc(r.zoom);let y;m>0&&(y=L_(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,u,r,f,y,m),this._makeGlobeTileDebugTextBuffer(e,u,r,f,y,m)}_globePoint(e,r,a,u,f,m,y){let x=od(e,r,a);if(m){const b=1<<a.z,C=rs(u.center.lng),P=os(u.center.lat),I=(a.x+.5)/b-C;let L=0;I>.5?L=-1:I<-.5&&(L=1);let R=(e/Ct+a.x)/b+L,O=(r/Ct+a.y)/b;R=(R-C)*u._pixelsPerMercatorPixel+C,O=(O-P)*u._pixelsPerMercatorPixel+P;const Z=[R*u.worldSize,O*u.worldSize,0];Kn(Z,Z,m),x=Rl(x,Z,y)}return Kn(x,x,f)}_makeGlobeTileDebugBorderBuffer(e,r,a,u,f,m){const y=new Qe,x=new Er,b=new Ee,C=(I,L,R,O,Z)=>{const Q=(R-I)/(Z-1),ue=(O-L)/(Z-1),te=y.length;for(let le=0;le<Z;le++){const pe=I+le*Q,fe=L+le*ue;y.emplaceBack(pe,fe);const Pe=this._globePoint(pe,fe,r,a,u,f,m);b.emplaceBack(Pe[0],Pe[1],Pe[2]),x.emplaceBack(te+le)}},P=Ct;C(0,0,P,0,16),C(P,0,P,P,16),C(P,P,0,P,16),C(0,P,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(x),this._tileDebugBuffer=e.createVertexBuffer(y,id.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(b,M1.members),this._tileDebugSegments=ni.simpleSegment(0,0,y.length,x.length)}_makeGlobeTileDebugTextBuffer(e,r,a,u,f,m){const y=Ct/4,x=new Qe,b=new xt,C=new Ee,P=25;b.reserve(32),x.reserve(P),C.reserve(P);const I=(L,R)=>P*L+R;for(let L=0;L<P;L++){const R=L*y;for(let O=0;O<P;O++){const Z=O*y;x.emplaceBack(Z,R);const Q=this._globePoint(Z,R,r,a,u,f,m);C.emplaceBack(Q[0],Q[1],Q[2])}}for(let L=0;L<4;L++)for(let R=0;R<4;R++){const O=I(L,R),Z=I(L,R+1),Q=I(L+1,R),ue=I(L+1,R+1);b.emplaceBack(O,Z,Q),b.emplaceBack(Q,Z,ue)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(b),this._tileDebugTextBuffer=e.createVertexBuffer(x,id.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(C,M1.members),this._tileDebugTextSegments=ni.simpleSegment(0,0,P,32)}}class DI{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,a){const u=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},fn(this.stateChanges[e][u],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const f in this.state[e])f!==u&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const f in this.state[e][u])a[f]||(this.deletedStates[e][u][f]=null)}else for(const f in a)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][f]===null&&delete this.deletedStates[e][u][f]}removeFeatureState(e,r,a){if(this.deletedStates[e]===null)return;const u=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&r!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][a]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(a in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][a]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,r){const a=String(r),u=fn({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const f=this.deletedStates[e][r];if(f===null)return{};for(const m in f)delete u[m]}return u}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const a={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const f={};for(const m in this.stateChanges[u])this.state[u][m]||(this.state[u][m]={}),fn(this.state[u][m],this.stateChanges[u][m]),f[m]=this.state[u][m];a[u]=f}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const f={};if(this.deletedStates[u]===null)for(const m in this.state[u])f[m]={},this.state[u][m]={};else for(const m in this.deletedStates[u]){if(this.deletedStates[u][m]===null)this.state[u][m]={};else if(this.state[u][m])for(const y of Object.keys(this.deletedStates[u][m]))delete this.state[u][m][y];f[m]=this.state[u][m]}a[u]=a[u]||{},fn(a[u],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const u in e)e[u].setFeatureState(a,r)}}class hb{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const a=this.toIdx(e,r);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function db(n,e,r,a){let u=0,f=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(a[m])<1e-15){if(r[m]<n[m]||r[m]>e[m])return null}else{const y=1/a[m];let x=(n[m]-r[m])*y,b=(e[m]-r[m])*y;if(x>b){const C=x;x=b,b=C}if(x>u&&(u=x),b<f&&(f=b),u>f)return null}return u}function fb(n,e,r,a,u,f,m,y,x,b,C){const P=a-n,I=u-e,L=f-r,R=m-n,O=y-e,Z=x-r,Q=C[1]*Z-C[2]*O,ue=C[2]*R-C[0]*Z,te=C[0]*O-C[1]*R,le=P*Q+I*ue+L*te;if(Math.abs(le)<1e-15)return null;const pe=1/le,fe=b[0]-n,Pe=b[1]-e,Se=b[2]-r,Oe=(fe*Q+Pe*ue+Se*te)*pe;if(Oe<0||Oe>1)return null;const et=Pe*L-Se*I,ke=Se*P-fe*L,Ge=fe*I-Pe*P,$e=(C[0]*et+C[1]*ke+C[2]*Ge)*pe;return $e<0||Oe+$e>1?null:(R*et+O*ke+Z*Ge)*pe}function pb(n,e,r){return(n-e)/(r-e)}function mb(n,e,r,a,u,f,m,y,x){const b=1<<r,C=f-a,P=m-u,I=(n+1)/b*C+a,L=(e+0)/b*P+u,R=(e+1)/b*P+u;y[0]=(n+0)/b*C+a,y[1]=L,x[0]=I,x[1]=R}class gb{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(f){const m=Math.ceil(Math.log2(f.dim/8)),y=[];let x=Math.ceil(Math.pow(2,m));const b=1/x,C=(L,R,O,Z,Q)=>{const ue=Z?1:0,te=(L+1)*O-ue,le=R*O,pe=(R+1)*O-ue;Q[0]=L*O,Q[1]=le,Q[2]=te,Q[3]=pe};let P=new hb(x);const I=[];for(let L=0;L<x*x;L++){C(L%x,Math.floor(L/x),b,!1,I);const R=Aa(I[0],I[1],f),O=Aa(I[2],I[1],f),Z=Aa(I[2],I[3],f),Q=Aa(I[0],I[3],f);P.minimums.push(Math.min(R,O,Z,Q)),P.maximums.push(Math.max(R,O,Z,Q)),P.leaves.push(1)}for(y.push(P),x/=2;x>=1;x/=2){const L=y[y.length-1];P=new hb(x);for(let R=0;R<x*x;R++){C(R%x,Math.floor(R/x),2,!0,I);const O=L.getElevation(I[0],I[1]),Z=L.getElevation(I[2],I[1]),Q=L.getElevation(I[2],I[3]),ue=L.getElevation(I[0],I[3]),te=L.isLeaf(I[0],I[1]),le=L.isLeaf(I[2],I[1]),pe=L.isLeaf(I[2],I[3]),fe=L.isLeaf(I[0],I[3]),Pe=Math.min(O.min,Z.min,Q.min,ue.min),Se=Math.max(O.max,Z.max,Q.max,ue.max),Oe=te&&le&&pe&&fe;P.maximums.push(Se),P.minimums.push(Pe),P.leaves.push(Se-Pe<=5&&Oe?1:0)}y.push(P)}return y}(this.dem),a=r.length-1,u=r[a];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(r,0,0,a,0)}raycastRoot(e,r,a,u,f,m,y=1){return db([e,r,-100],[a,u,this.maximums[0]*y],f,m)}raycast(e,r,a,u,f,m,y=1){if(!this.nodeCount)return null;const x=this.raycastRoot(e,r,a,u,f,m,y);if(x==null)return null;const b=[],C=[],P=[],I=[],L=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:R,t:O,nodex:Z,nodey:Q,depth:ue}=L.pop();if(this.leaves[R]){mb(Z,Q,ue,e,r,a,u,P,I);const le=1<<ue,pe=(Z+0)/le,fe=(Z+1)/le,Pe=(Q+0)/le,Se=(Q+1)/le,Oe=Aa(pe,Pe,this.dem)*y,et=Aa(fe,Pe,this.dem)*y,ke=Aa(fe,Se,this.dem)*y,Ge=Aa(pe,Se,this.dem)*y,$e=fb(P[0],P[1],Oe,I[0],P[1],et,I[0],I[1],ke,f,m),We=fb(I[0],I[1],ke,P[0],I[1],Ge,P[0],P[1],Oe,f,m),rt=Math.min($e!==null?$e:Number.MAX_VALUE,We!==null?We:Number.MAX_VALUE);if(rt!==Number.MAX_VALUE)return rt;{const Re=td([],f,m,O);if(_b(Oe,et,Ge,ke,pb(Re[0],P[0],I[0]),pb(Re[1],P[1],I[1]))>=Re[2])return O}continue}let te=0;for(let le=0;le<this._siblingOffset.length;le++){mb((Z<<1)+this._siblingOffset[le][0],(Q<<1)+this._siblingOffset[le][1],ue+1,e,r,a,u,P,I),P[2]=-100,I[2]=this.maximums[this.childOffsets[R]+le]*y;const pe=db(P,I,f,m);if(pe!=null){const fe=pe;b[le]=fe;let Pe=!1;for(let Se=0;Se<te&&!Pe;Se++)fe>=b[C[Se]]&&(C.splice(Se,0,le),Pe=!0);Pe||(C[te]=le),te++}}for(let le=0;le<te;le++){const pe=C[le];L.push({idx:this.childOffsets[R]+pe,t:b[pe],nodex:(Z<<1)+this._siblingOffset[pe][0],nodey:(Q<<1)+this._siblingOffset[pe][1],depth:ue+1})}}return null}_addNode(e,r,a){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,a,u,f){if(e[u].isLeaf(r,a)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const m=u-1,y=e[m];let x=0,b=0;for(let C=0;C<this._siblingOffset.length;C++){const P=2*r+this._siblingOffset[C][0],I=2*a+this._siblingOffset[C][1],L=y.getElevation(P,I),R=y.isLeaf(P,I),O=this._addNode(L.min,L.max,R);R&&(x|=1<<C),b||(b=O)}for(let C=0;C<this._siblingOffset.length;C++)x&1<<C||this._construct(e,2*r+this._siblingOffset[C][0],2*a+this._siblingOffset[C][1],m,b+C)}}function _b(n,e,r,a,u,f){return Yt(Yt(n,r,f),Yt(e,a,f),u)}function Aa(n,e,r){const a=r.dim,u=Xe(n*a-.5,0,a-1),f=Xe(e*a-.5,0,a-1),m=Math.floor(u),y=Math.floor(f),x=Math.min(m+1,a-1),b=Math.min(y+1,a-1);return _b(r.get(m,y),r.get(x,y),r.get(m,b),r.get(x,b),u-m,f-y)}const yb={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function zI(n,e,r){return(256*n*256+256*e+r)/10-1e4}function LI(n,e,r){return 256*n+e+r/256-32768}class fm{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,a,u=!1,f=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return pn(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const m=this.dim=r.height-2,y=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=a||"mapbox",this.borderReady=u,!u){for(let x=0;x<m;x++)y[this._idx(-1,x)]=y[this._idx(0,x)],y[this._idx(m,x)]=y[this._idx(m-1,x)],y[this._idx(x,-1)]=y[this._idx(x,0)],y[this._idx(x,m)]=y[this._idx(x,m-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(m,-1)]=y[this._idx(m-1,0)],y[this._idx(-1,m)]=y[this._idx(0,m-1)],y[this._idx(m,m)]=y[this._idx(m-1,m-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new gb(this)}get(e,r,a=!1){a&&(e=Xe(e,-1,this.dim),r=Xe(r,-1,this.dim));const u=4*this._idx(e,r);return(this.encoding==="terrarium"?LI:zI)(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}static getUnpackVector(e){return yb[e]}get unpackVector(){return yb[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const a=[0,0,0,0],u=fm.getUnpackVector(r);let f=Math.floor((e+u[3])/u[2]);return a[2]=f%256,f=Math.floor(f/256),a[1]=f%256,f=Math.floor(f/256),a[0]=f,a}getPixels(){return new Cr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,f=r*this.dim+this.dim,m=a*this.dim,y=a*this.dim+this.dim;switch(r){case-1:u=f-1;break;case 1:f=u+1}switch(a){case-1:m=y-1;break;case 1:y=m+1}const x=-r*this.dim,b=-a*this.dim;for(let C=m;C<y;C++)for(let P=u;P<f;P++){const I=4*this._idx(P,C),L=4*this._idx(P+x,C+b);this.pixels[I+0]=e.pixels[L+0],this.pixels[I+1]=e.pixels[L+1],this.pixels[I+2]=e.pixels[L+2],this.pixels[I+3]=e.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}mt(fm,"DEMData"),mt(gb,"DemMinMaxQuadTree",{omit:["dem"]});class RI{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,a){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const f={value:r,timeout:void 0};if(a!==void 0&&(f.timeout=setTimeout(()=>{this.remove(e,f)},a)),this.data[u].push(f),this.order.push(u),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const a=e.wrapped().key,u=r===void 0?0:this.data[a].indexOf(r),f=this.data[a][u];return this.data[a].splice(u,1),f.timeout&&clearTimeout(f.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(f.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const a in this.data)for(const u of this.data[a])e(u.value)||r.push(u);for(const a of r)this.remove(a.value.tileID,a)}}class cu{constructor(e,r,a){this.func=e,this.mask=r,this.range=a}}cu.ReadOnly=!1,cu.ReadWrite=!0,cu.disabled=new cu(519,cu.ReadOnly,[0,1]);const Ay=7680;class My{constructor(e,r,a,u,f,m){this.test=e,this.ref=r,this.mask=a,this.fail=u,this.depthFail=f,this.pass=m}}My.disabled=new My({func:519,mask:0},0,0,Ay,Ay,Ay);class ls{constructor(e,r,a){this.blendFunction=e,this.blendColor=r,this.mask=a}}ls.Replace=[1,0],ls.disabled=new ls(ls.Replace,Hn.transparent,[!1,!1,!1,!1]),ls.unblended=new ls(ls.Replace,Hn.transparent,[!0,!0,!0,!0]),ls.alphaBlended=new ls([1,771],Hn.transparent,[!0,!0,!0,!0]);const Py=1029,Iy=2305;class Fo{constructor(e,r,a){this.enable=e,this.mode=r,this.frontFace=a}}Fo.disabled=new Fo(!1,Py,Iy),Fo.backCCW=new Fo(!0,Py,Iy),Fo.backCW=new Fo(!0,Py,2304),Fo.frontCW=new Fo(!0,1028,2304),Fo.frontCCW=new Fo(!0,1028,Iy);class Vl extends il{constructor(e,r,a){super(),this.id=e,this._onlySymbols=a,r.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new RI(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new DI,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const a=this._tiles[r];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return nn(this._tiles).map(e=>e.tileID).sort(vb).map(e=>e.key)}getRenderableIds(e){const r=[];for(const a in this._tiles)this._isIdRenderable(+a,e)&&r.push(this._tiles[a]);return e?r.sort((a,u)=>{const f=a.tileID,m=u.tileID,y=new ze(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),x=new ze(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-m.overscaledZ||x.y-y.y||x.x-y.x}).map(a=>a.tileID.key):r.map(a=>a.tileID).sort(vb).map(a=>a.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=r),this._loadTile(a,this._tileLoaded.bind(this,a,e,r)))}_tileLoaded(e,r,a,u){if(u)if(e.state="errored",u.status!==404)this._source.fire(new xo(u,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=vo.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new xs("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let u=0;u<r.length;u++){const f=r[u];if(e.neighboringTiles&&e.neighboringTiles[f]){const m=this.getTileByID(f);a(e,m),a(m,e)}}function a(u,f){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let m=f.tileID.canonical.x-u.tileID.canonical.x;const y=f.tileID.canonical.y-u.tileID.canonical.y,x=Math.pow(2,u.tileID.canonical.z),b=f.tileID.key;m===0&&y===0||Math.abs(y)>1||(Math.abs(m)>1&&(Math.abs(m+x)===1?m+=x:Math.abs(m-x)===1&&(m-=x)),f.dem&&u.dem&&(u.dem.backfillBorder(f.dem,m,y),u.neighboringTiles&&u.neighboringTiles[b]&&(u.neighboringTiles[b].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,a,u){for(const f in this._tiles){let m=this._tiles[f];if(u[f]||!m.hasData()||m.tileID.overscaledZ<=r||m.tileID.overscaledZ>a)continue;let y=m.tileID;for(;m&&m.tileID.overscaledZ>r+1;){const b=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[b.key],m&&m.hasData()&&(y=b)}let x=y;for(;x.overscaledZ>r;)if(x=x.scaledTo(x.overscaledZ-1),e[x.key]){u[y.key]=y;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=r?a:null}for(let a=e.overscaledZ-1;a>=r;a--){const u=e.scaledTo(a),f=this._getLoadedTile(u);if(f)return f}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const a=Math.ceil(e.width/r)+1,u=Math.ceil(e.height/r)+1,f=Math.floor(a*u*5),m=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,f):f,y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const a={};for(const u in this._tiles){const f=this._tiles[u];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+r),a[f.tileID.key]=f}this._tiles=a;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,r,a){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let u;this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new nr(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(u=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(y=>this._source.hasTile(y)))):u=[];const f=this._updateRetainedTiles(u);if(xb(this._source.type)&&u.length!==0){const y={},x={},b=Object.keys(f);for(const P of b){const I=f[P],L=this._tiles[P];if(!L||L.fadeEndTime&&L.fadeEndTime<=vo.now())continue;const R=this.findLoadedParent(I,Math.max(I.overscaledZ-Vl.maxOverzooming,this._source.minzoom));R&&(this._addTile(R.tileID),y[R.tileID.key]=R.tileID),x[P]=I}const C=u[u.length-1].overscaledZ;for(const P in this._tiles){const I=this._tiles[P];if(f[P]||!I.hasData())continue;let L=I.tileID;for(;L.overscaledZ>C;){L=L.scaledTo(L.overscaledZ-1);const R=this._tiles[L.key];if(R&&R.hasData()&&x[L.key]){f[P]=I.tileID;break}}}for(const P in y)f[P]||(this._coveredTiles[P]=!0,f[P]=y[P])}for(const y in f)this._tiles[y].clearFadeHold();const m=function(y,x){const b=[];for(const C in y)C in x||b.push(C);return b}(this._tiles,f);for(const y of m){const x=this._tiles[y];x.hasSymbolBuckets&&!x.holdingForFade()?x.setHoldDuration(this.map._fadeDuration):x.hasSymbolBuckets&&!x.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const a={},u=e.reduce((b,C)=>Math.min(b,C.overscaledZ),1/0),f=e[0].overscaledZ,m=Math.max(f-Vl.maxOverzooming,this._source.minzoom),y=Math.max(f+Vl.maxUnderzooming,this._source.minzoom),x={};for(const b of e){const C=this._addTile(b);r[b.key]=b,C.hasData()||u<this._source.maxzoom&&(x[b.key]=b)}this._retainLoadedChildren(x,u,y,r);for(const b of e){let C=this._tiles[b.key];if(C.hasData())continue;if(b.canonical.z>=this._source.maxzoom){const I=b.children(this._source.maxzoom)[0],L=this.getTile(I);if(L&&L.hasData()){r[I.key]=I;continue}}else{const I=b.children(this._source.maxzoom);if(r[I[0].key]&&r[I[1].key]&&r[I[2].key]&&r[I[3].key])continue}let P=C.wasRequested();for(let I=b.overscaledZ-1;I>=m;--I){const L=b.scaledTo(I);if(a[L.key]||(a[L.key]=!0,C=this.getTile(L),!C&&P&&(C=this._addTile(L)),C&&(r[L.key]=L,P=C.wasRequested(),C.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let a,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){a=this._loadedParentTiles[u.key];break}r.push(u.key);const f=u.scaledTo(u.overscaledZ-1);if(a=this._getLoadedTile(f),a)break;u=f}for(const f of r)this._loadedParentTiles[f]=a}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const a=!!r;if(!a){const u=this.map?this.map.painter:null;r=new Cy(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,a||this._source.fire(new xs("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=r.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,r,a){const u=[],f=this.transform;if(!f)return u;const m=f.projection.name==="globe",y=rs(f.center.lng);for(const x in this._tiles){const b=this._tiles[x];if(a&&b.clearQueryDebugViz(),b.holdingForFade())continue;let C;if(m){const P=b.tileID.canonical;if(P.z===0){const I=[Math.abs(Xe(y,...Cd(P,-1))-y),Math.abs(Xe(y,...Cd(P,1))-y)];C=[0,2*I.indexOf(Math.min(...I))-1]}else{const I=[Math.abs(Xe(y,...Cd(P,-1))-y),Math.abs(Xe(y,...Cd(P,0))-y),Math.abs(Xe(y,...Cd(P,1))-y)];C=[I.indexOf(Math.min(...I))-1]}}else C=[0];for(const P of C){const I=e.containsTile(b,f,r,P);I&&u.push(I)}}return u}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(a=>this._tiles[a].tileID);for(const a of r)a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(xb(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=vo.now())return!0}return!1}setFeatureState(e,r,a){this._state.updateState(e=e||"_geojsonTileLayer",r,a)}removeFeatureState(e,r,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,a)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,a){const u=this._tiles[e];u&&u.setDependencies(r,a)}reloadTilesForDependencies(e,r){for(const a in this._tiles)this._tiles[a].hasDependency(e,r)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,r))}_preloadTiles(e,r){if(!this._sourceLoaded){const y=()=>{this._sourceLoaded&&(this._source.off("data",y),this._preloadTiles(e,r))};return void this._source.on("data",y)}const a=new Map,u=Array.isArray(e)?e:[e],f=this.map.painter.terrain,m=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const y of u){const x=y.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const b of x)a.set(b.key,b);this.usedForTerrain&&y.updateElevation(!1)}wt(Array.from(a.values()),(y,x)=>{const b=new Cy(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(b,C=>{this._source.type==="raster-dem"&&b.dem&&this._backfillDEM(b),x(C,b)})},r)}}function vb(n,e){const r=Math.abs(2*n.wrap)-+(n.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||a-r||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x}function xb(n){return n==="raster"||n==="image"||n==="video"||n==="custom"}function Cd(n,e){const r=1<<n.z;return[n.x/r+e,(n.x+1)/r+e]}Vl.maxOverzooming=10,Vl.maxUnderzooming=3;class pm{constructor(e,r,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=a}static create(e,r,a){const u=a||e.findDEMTileFor(r);if(!u||!u.dem)return;const f=u.dem,m=u.tileID,y=1<<r.canonical.z-m.canonical.z;return new pm(u,u.tileSize/Ct/y,[(r.canonical.x/y-m.canonical.x)*f.dim,(r.canonical.y/y-m.canonical.y)*f.dim])}tileCoordToPixel(e,r){const a=r*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(a);return new ze(u,f)}getElevationAt(e,r,a,u){const f=e*this._scale+this._offset[0],m=r*this._scale+this._offset[1],y=Math.floor(f),x=Math.floor(m),b=this._dem;return u=!!u,a?Yt(Yt(b.get(y,x,u),b.get(y,x+1,u),m-x),Yt(b.get(y+1,x,u),b.get(y+1,x+1,u),m-x),f-y):b.get(y,x,u)}getElevationAtPixel(e,r,a){return this._dem.get(e,r,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Lo(1,e)*this._dem.stride}}class wb{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new As(Ct,16,0),this.featureIndexArray=new Ml,this.promoteId=r}insert(e,r,a,u,f,m=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,f,m);const x=this.grid;for(let b=0;b<r.length;b++){const C=r[b],P=[1/0,1/0,-1/0,-1/0];for(let I=0;I<C.length;I++){const L=C[I];P[0]=Math.min(P[0],L.x),P[1]=Math.min(P[1],L.y),P[2]=Math.max(P[2],L.x),P[3]=Math.max(P[3],L.y)}P[0]<Ct&&P[1]<Ct&&P[2]>=0&&P[3]>=0&&x.insert(y,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new uy(new em(this.rawTileData)).layers,this.sourceLayerCoder=new sb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,a,u){this.loadVTLayers();const f=e.params||{},m=Oc(f.filter),y=e.tileResult,x=e.transform,b=y.bufferedTilespaceBounds,C=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(R,O,Z,Q)=>q1(y.bufferedTilespaceGeometry,R,O,Z,Q));C.sort(BI);let P=null;x.elevation&&C.length>0&&(P=pm.create(x.elevation,this.tileID));const I={};let L;for(let R=0;R<C.length;R++){const O=C[R];if(O===L)continue;L=O;const Z=this.featureIndexArray.get(O);let Q=null;this.loadMatchingFeature(I,Z,m,f.layers,f.availableImages,r,a,u,(ue,te,le,pe=0)=>(Q||(Q=Ls(ue,this.tileID.canonical,e.tileTransform)),te.queryIntersectsFeature(y,ue,le,Q,this.z,e.transform,e.pixelPosMatrix,P,pe)))}return I}loadMatchingFeature(e,r,a,u,f,m,y,x,b){const{featureIndex:C,bucketIndex:P,sourceLayerIndex:I,layoutVertexArrayOffset:L}=r,R=this.bucketLayerIDs[P];if(u&&!function(ue,te){for(let le=0;le<ue.length;le++)if(te.indexOf(ue[le])>=0)return!0;return!1}(u,R))return;const O=this.sourceLayerCoder.decode(I),Z=this.vtLayers[O].feature(C);if(a.needGeometry){const ue=Bl(Z,!0);if(!a.filter(new M(this.tileID.overscaledZ),ue,this.tileID.canonical))return}else if(!a.filter(new M(this.tileID.overscaledZ),Z))return;const Q=this.getId(Z,O);for(let ue=0;ue<R.length;ue++){const te=R[ue];if(u&&u.indexOf(te)<0)continue;const le=m[te];if(!le)continue;let pe={};Q!==void 0&&x&&(pe=x.getState(le.sourceLayer||"_geojsonTileLayer",Q));const fe=fn({},y[te]);fe.paint=bb(fe.paint,le.paint,Z,pe,f),fe.layout=bb(fe.layout,le.layout,Z,pe,f);const Pe=!b||b(Z,le,pe,L);if(!Pe)continue;const Se=new ab(Z,this.z,this.x,this.y,Q);Se.layer=fe;let Oe=e[te];Oe===void 0&&(Oe=e[te]=[]),Oe.push({featureIndex:C,feature:Se,intersectionZ:Pe})}}lookupSymbolFeatures(e,r,a,u,f,m,y,x){const b={};this.loadVTLayers();const C=Oc(f);for(const P of e)this.loadMatchingFeature(b,{bucketIndex:a,sourceLayerIndex:u,featureIndex:P,layoutVertexArrayOffset:0},C,m,y,x,r);return b}loadFeature(e){const{featureIndex:r,sourceLayerIndex:a}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(a),f=this.vtFeatures[u];if(f[r])return f[r];const m=this.vtLayers[u].feature(r);return f[r]=m,m}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;if(this.promoteId){const u=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];u!=null&&(a=e.properties[u]),typeof a=="boolean"&&(a=Number(a))}return a}}function bb(n,e,r,a,u){return Lt(n,(f,m)=>{const y=e instanceof Y?e.get(m):null;return y&&y.evaluate?y.evaluate(r,a,u):y})}function BI(n,e){return e-n}mt(wb,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Tb{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Rs({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const a=this.getKey(e,r);return this.positions[a]}trim(){const e=this.width,r=this.height=gi(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,a){const u=[];let f=e.length%2==1?-e[e.length-1]*a:0,m=e[0]*a,y=!0;u.push({left:f,right:m,isDash:y,zeroLength:e[0]===0});let x=e[0];for(let b=1;b<e.length;b++){y=!y;const C=e[b];f=x*a,x+=C,m=x*a,u.push({left:f,right:m,isDash:y,zeroLength:C===0})}return u}addRoundDash(e,r,a){const u=r/2;for(let f=-a;f<=a;f++){const m=this.width*(this.nextRow+a+f);let y=0,x=e[y];for(let b=0;b<this.width;b++){b/x.right>1&&(x=e[++y]);const C=Math.abs(b-x.left),P=Math.abs(b-x.right),I=Math.min(C,P);let L;const R=f/a*(u+1);if(x.isDash){const O=u-Math.abs(R);L=Math.sqrt(I*I+O*O)}else L=u-Math.sqrt(I*I+R*R);this.image.data[m+b]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e,r){for(let x=e.length-1;x>=0;--x){const b=e[x],C=e[x+1];b.zeroLength?e.splice(x,1):C&&C.isDash===b.isDash&&(C.left=b.left,e.splice(x,1))}const a=e[0],u=e[e.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const f=this.width*this.nextRow;let m=0,y=e[m];for(let x=0;x<this.width;x++){x/y.right>1&&(y=e[++m]);const b=Math.abs(x-y.left),C=Math.abs(x-y.right),P=Math.min(b,C);this.image.data[f+x]=Math.max(0,Math.min(255,(y.isDash?P:-P)+r+128))}}addDash(e,r){const a=this.getKey(e,r);if(this.positions[a])return this.positions[a];const u=r==="round",f=u?7:0,m=2*f+1;if(this.nextRow+m>this.height)return pn("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let C=0;C<e.length;C++)e[C]<0&&(pn("Negative value is found in line dasharray, replacing values with 0"),e[C]=0),y+=e[C];if(y!==0){const C=this.width/y,P=this.getDashRanges(e,this.width,C);u?this.addRoundDash(P,C,f):this.addRegularDash(P,r==="square"?.5*C:0)}const x=this.nextRow+f;this.nextRow+=m;const b={tl:[x,f],br:[y,0]};return this.positions[a]=b,b}}mt(Tb,"LineAtlas");const Eb=1*Bo;class Sb{constructor(e){const r={},a=[];for(const y in e){const x=e[y],b=r[y]={};for(const C in x.glyphs){const P=x.glyphs[+C];if(!P||P.bitmap.width===0||P.bitmap.height===0)continue;const I=P.metrics.localGlyph?Eb:1,L={x:0,y:0,w:P.bitmap.width+2*I,h:P.bitmap.height+2*I};a.push(L),b[C]=L}}const{w:u,h:f}=py(a),m=new Rs({width:u||1,height:f||1});for(const y in e){const x=e[y];for(const b in x.glyphs){const C=x.glyphs[+b];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;const P=r[y][b],I=C.metrics.localGlyph?Eb:1;Rs.copy(C.bitmap,m,{x:0,y:0},{x:P.x+I,y:P.y+I},C.bitmap)}}this.image=m,this.positions=r}}mt(Sb,"GlyphAtlas");class FI{constructor(e){this.tileID=new nr(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Ul(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,a,u,f){this.status="parsing",this.data=e,this.collisionBoxArray=new xn;const m=new sb(Object.keys(e.layers).sort()),y=new wb(this.tileID,this.promoteId);y.bucketLayerIDs=[];const x={},b=new Tb(256,256),C={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:b,availableImages:a},P=r.familiesBySource[this.source];for(const pe in P){const fe=e.layers[pe];if(!fe)continue;let Pe=!1,Se=!1;for(const ke of P[pe])ke[0].type==="symbol"?Pe=!0:Se=!0;if(this.isSymbolTile===!0&&!Pe||this.isSymbolTile===!1&&!Se)continue;fe.version===1&&pn(`Vector tile source "${this.source}" layer "${pe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Oe=m.encode(pe),et=[];for(let ke=0;ke<fe.length;ke++){const Ge=fe.feature(ke),$e=y.getId(Ge,pe);et.push({feature:Ge,id:$e,index:ke,sourceLayerIndex:Oe})}for(const ke of P[pe]){const Ge=ke[0];this.isSymbolTile!==void 0&&Ge.type==="symbol"!==this.isSymbolTile||Ge.minzoom&&this.zoom<Math.floor(Ge.minzoom)||Ge.maxzoom&&this.zoom>=Ge.maxzoom||Ge.visibility!=="none"&&(ky(ke,this.zoom,a),(x[Ge.id]=Ge.createBucket({index:y.bucketLayerIDs.length,layers:ke,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Oe,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:a})).populate(et,C,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(ke.map($e=>$e.id)))}}let I,L,R,O;b.trim();const Z={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Q=()=>{if(I)return f(I);if(L&&R&&O){const pe=new Sb(L),fe=new Dw(R,O);for(const Pe in x){const Se=x[Pe];Se instanceof Ea?(ky(Se.layers,this.zoom,a),cI(Se,L,pe.positions,R,fe.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection)):Se.hasPattern&&(Se instanceof Yp||Se instanceof qp||Se instanceof pd)&&(ky(Se.layers,this.zoom,a),Se.addFeatures(C,this.tileID.canonical,fe.patternPositions,a,this.tileTransform))}this.status="done",f(null,{buckets:nn(x).filter(Pe=>!Pe.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pe.image,lineAtlas:b,imageAtlas:fe,glyphMap:this.returnDependencies?L:null,iconMap:this.returnDependencies?R:null,glyphPositions:this.returnDependencies?pe.positions:null})}},ue=Lt(C.glyphDependencies,pe=>Object.keys(pe).map(Number));Object.keys(ue).length?u.send("getGlyphs",{uid:this.uid,stacks:ue},(pe,fe)=>{I||(I=pe,L=fe,Q())},void 0,!1,Z):L={};const te=Object.keys(C.iconDependencies);te.length?u.send("getImages",{icons:te,source:this.source,tileID:this.tileID,type:"icons"},(pe,fe)=>{I||(I=pe,R=fe,Q())},void 0,!1,Z):R={};const le=Object.keys(C.patternDependencies);le.length?u.send("getImages",{icons:le,source:this.source,tileID:this.tileID,type:"patterns"},(pe,fe)=>{I||(I=pe,O=fe,Q())},void 0,!1,Z):O={},Q()}}function ky(n,e,r){const a=new M(e);for(const u of n)u.recalculate(a,r)}class Cb{constructor(e){this.entries={},this.scheduler=e}request(e,r,a,u){const f=this.entries[e]=this.entries[e]||{callbacks:[]};if(f.result){const[m,y]=f.result;return this.scheduler?this.scheduler.add(()=>{u(m,y)},r):u(m,y),()=>{}}return f.callbacks.push(u),f.cancel||(f.cancel=a((m,y)=>{f.result=[m,y];for(const x of f.callbacks)this.scheduler?this.scheduler.add(()=>{x(m,y)},r):x(m,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(m=>m!==u),f.callbacks.length||(f.cancel(),delete this.entries[e]))}}}function Ab(n,e,r){const a=JSON.stringify(n.request);return n.data&&(this.deduped.entries[a]={result:[null,n.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},u=>{const f=vt(n.request,(m,y,x,b)=>{m?u(m):y&&u(null,{vectorTile:r?void 0:new uy(new em(y)),rawData:y,cacheControl:x,expires:b})});return()=>{f.cancel(),u()}},e)}const Mb=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Dy{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=a>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const f=Mb[15&a];if(!f)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new Dy(y,m,f,e)}constructor(e,r=64,a=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=Mb.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${a}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+y+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=r,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return zy(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:y}=this,x=[0,f.length-1,0],b=[];for(;x.length;){const C=x.pop()||0,P=x.pop()||0,I=x.pop()||0;if(P-I<=y){for(let Z=I;Z<=P;Z++){const Q=m[2*Z],ue=m[2*Z+1];Q>=e&&Q<=a&&ue>=r&&ue<=u&&b.push(f[Z])}continue}const L=I+P>>1,R=m[2*L],O=m[2*L+1];R>=e&&R<=a&&O>=r&&O<=u&&b.push(f[L]),(C===0?e<=R:r<=O)&&(x.push(I),x.push(L-1),x.push(1-C)),(C===0?a>=R:u>=O)&&(x.push(L+1),x.push(P),x.push(1-C))}return b}within(e,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:m}=this,y=[0,u.length-1,0],x=[],b=a*a;for(;y.length;){const C=y.pop()||0,P=y.pop()||0,I=y.pop()||0;if(P-I<=m){for(let Z=I;Z<=P;Z++)Ib(f[2*Z],f[2*Z+1],e,r)<=b&&x.push(u[Z]);continue}const L=I+P>>1,R=f[2*L],O=f[2*L+1];Ib(R,O,e,r)<=b&&x.push(u[L]),(C===0?e-a<=R:r-a<=O)&&(y.push(I),y.push(L-1),y.push(1-C)),(C===0?e+a>=R:r+a>=O)&&(y.push(L+1),y.push(P),y.push(1-C))}return x}}function zy(n,e,r,a,u,f){if(u-a<=r)return;const m=a+u>>1;Pb(n,e,m,a,u,f),zy(n,e,r,a,m-1,1-f),zy(n,e,r,m+1,u,1-f)}function Pb(n,e,r,a,u,f){for(;u>a;){if(u-a>600){const b=u-a+1,C=r-a+1,P=Math.log(b),I=.5*Math.exp(2*P/3),L=.5*Math.sqrt(P*I*(b-I)/b)*(C-b/2<0?-1:1);Pb(n,e,r,Math.max(a,Math.floor(r-C*I/b+L)),Math.min(u,Math.floor(r+(b-C)*I/b+L)),f)}const m=e[2*r+f];let y=a,x=u;for(Ad(n,e,a,r),e[2*u+f]>m&&Ad(n,e,a,u);y<x;){for(Ad(n,e,y,x),y++,x--;e[2*y+f]<m;)y++;for(;e[2*x+f]>m;)x--}e[2*a+f]===m?Ad(n,e,a,x):(x++,Ad(n,e,x,u)),x<=r&&(a=x+1),r<=x&&(u=x-1)}}function Ad(n,e,r,a){Ly(n,r,a),Ly(e,2*r,2*a),Ly(e,2*r+1,2*a+1)}function Ly(n,e,r){const a=n[e];n[e]=n[r],n[r]=a}function Ib(n,e,r,a){const u=n-r,f=e-a;return u*u+f*f}s.ARRAY_TYPE=Sr,s.AUTH_ERR_MSG=ce,s.Aabb=tr,s.Actor=class{constructor(n,e,r){this.target=n,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},cr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Hi()?n:A,this.scheduler=new II}send(n,e,r,a,u=!1,f){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=f,this.callbacks[m]=r);const y=go(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:n,hasCallback:!!r,targetMapId:a,mustQueue:u,sourceMapId:this.mapId,data:ga(e,y)},y),{cancel:()=>{r&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(n){const e=n.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const a=this.cancelCallbacks[r];delete this.cancelCallbacks[r],a&&a.cancel()}else if(e.mustQueue||Hi()){const a=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),a&&a.metadata||{type:"message"})}else this.processTask(r,e)}processTask(n,e){if(e.type==="<response>"){const r=this.callbacks[n];delete this.callbacks[n],r&&(e.error?r(Ms(e.error)):r(null,Ms(e.data)))}else{const r=go(this.globalScope)?void 0:[],a=e.hasCallback?(f,m)=>{delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:f?ga(f):null,data:ga(m,r)},r)}:f=>{},u=Ms(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,a);else if(this.parent.getWorkerSource){const f=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,f[0],u.source)[f[1]](u,a)}else a(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=Kp,s.Color=Hn,s.ColorMode=ls,s.CullFaceMode=Fo,s.DEMData=fm,s.DataConstantProperty=F,s.DedupedRequest=Cb,s.DepthMode=cu,s.EXTENT=Ct,s.Elevation=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const r=e.getSource().maxzoom,a=1<<r,u=Math.floor(n.x),f=Math.floor((n.x-u)*a),m=Math.floor(n.y*a),y=this.findDEMTileFor(new nr(r,u,r,f,m));return!(!y||!y.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||n.y<0||n.y>1)return e;const u=a.getSource().maxzoom,f=1<<u,m=Math.floor(n.x),y=n.x-m,x=new nr(u,m,u,Math.floor(y*f),Math.floor(n.y*f)),b=this.findDEMTileFor(x);if(!b||!b.dem)return e;const C=b.dem,P=1<<b.tileID.canonical.z,I=(y*P-b.tileID.canonical.x)*C.dim,L=(n.y*P-b.tileID.canonical.y)*C.dim,R=Math.floor(I),O=Math.floor(L);return(r?this.exaggeration():1)*Yt(Yt(C.get(R,O),C.get(R,O+1),L-O),Yt(C.get(R+1,O),C.get(R+1,O+1),L-O),I-R)}getAtTileOffset(n,e,r){const a=1<<n.canonical.z;return this.getAtPointOrZero(new Hc(n.wrap+(n.canonical.x+e/Ct)/a,(n.canonical.y+r/Ct)/a))}getAtTileOffsetFunc(n,e,r,a){return u=>{const f=this.getAtTileOffset(n,u.x,u.y),m=a.upVector(n.canonical,u.x,u.y);return Vr(m,m,f*a.upVectorScale(n.canonical,e,r).metersToTile),m}}getForTilePoints(n,e,r,a){if(this.isUsingMockSource())return!1;const u=pm.create(this,n,a);return!!u&&(e.forEach(f=>{f[2]=this.exaggeration()*u.getElevationAt(f[0],f[1],r)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const r=e.dem.tree,a=e.tileID,u=1<<n.canonical.z-a.canonical.z;let f=n.canonical.x/u-a.canonical.x,m=n.canonical.y/u-a.canonical.y,y=0;for(let x=0;x<n.canonical.z-a.canonical.z&&!r.leaves[y];x++){f*=2,m*=2;const b=2*Math.floor(m)+Math.floor(f);y=r.childOffsets[y]+b,f%=1,m%=1}return{min:this.exaggeration()*r.minimums[y],max:this.exaggeration()*r.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=xo,s.EvaluationParameters=M,s.Event=xs,s.Evented=il,s.FillExtrusionBucket=pd,s.Frustum=N_,s.FrustumCorners=V_,s.GLOBE_RADIUS=ns,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=P1,s.GLOBE_ZOOM_THRESHOLD_MIN=j_,s.GlobeSharedBuffers=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const n of this._wireframeSegments)n.destroy()}}_fillGridMeshWithLods(n,e){const r=new Qe,a=new xt,u=[],f=n+1+2,m=e[0]+1,y=e[0]+1+(1+e.length),x=(b,C,P)=>{let I=b===f-1?b-2:b===0?b:b-1;return I+=P?24575:0,[I,C]};for(let b=0;b<f;++b)r.emplaceBack(...x(b,0,!0));for(let b=0;b<m;++b)for(let C=0;C<f;++C)r.emplaceBack(...x(C,b,(C===0||C===f-1)&&!0));for(let b=0;b<e.length;++b){const C=e[b];for(let P=0;P<f;++P)r.emplaceBack(...x(P,C,!0))}for(let b=0;b<e.length;++b){const C=a.length,P=e[b]+1+2,I=new xt;for(let O=0;O<P-1;O++){const Z=O===P-2,Q=Z?f*(y-e.length+b-O):f;for(let ue=0;ue<f-1;ue++){const te=O*f+ue;O===0||Z||ue===0||ue===f-2?(I.emplaceBack(te+1,te,te+Q),I.emplaceBack(te+Q,te+Q+1,te+1)):(a.emplaceBack(te+1,te,te+Q),a.emplaceBack(te+Q,te+Q+1,te+1))}}const L=ni.simpleSegment(0,C,r.length,a.length-C);for(let O=0;O<I.uint16.length;O+=3)a.emplaceBack(I.uint16[O],I.uint16[O+1],I.uint16[O+2]);const R=ni.simpleSegment(0,C,r.length,a.length-C);u.push({withoutSkirts:L,withSkirts:R})}return{vertices:r,indices:a,segments:u}}_createGrid(n){const e=this._fillGridMeshWithLods(Ll,rd);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,id.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new xt;for(let u=0;u<=Ll;u++)e.emplaceBack(0,u+1,u+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const r=new vn,a=new vn;this._poleSegments=[];for(let u=0,f=0;u<j_;u++){const m=360/(1<<u);r.emplaceBack(0,-ns,0,.5,0),a.emplaceBack(0,-ns,0,.5,1);for(let y=0;y<=Ll;y++){const x=y/Ll,b=Yt(0,m,x),[C,P,I]=qc(IM,kM,b,ns);r.emplaceBack(C,P,I,x,0),a.emplaceBack(C,P,I,x,1)}this._poleSegments.push(ni.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(r,A1,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(a,A1,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}getWirefameBuffers(n,e){if(!this._wireframeSegments){const r=new bi,a=Ll,u=a+1+2,f=1;this._wireframeSegments=[];for(let m=0,y=0;m<rd.length;m++){const x=rd[m];for(let C=f;C<x+f;C++)for(let P=f;P<a+f;P++){const I=C*u+P;r.emplaceBack(I,I+1),r.emplaceBack(I,I+u),r.emplaceBack(I,I+u+1)}const b=x*a*3;this._wireframeSegments.push(ni.simpleSegment(0,y,(x+1)*u,b)),y+=b}this._wireframeIndexBuffer=n.createIndexBuffer(r)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},s.GlyphManager=ru,s.ImagePosition=my,s.KDBush=Dy,s.LivePerformanceUtils=l_,s.LngLat=wn,s.LngLatBounds=xa,s.LocalGlyphMode=yy,s.MAX_MERCATOR_LATITUDE=Ui,s.MercatorCoordinate=Hc,s.ONE_EM=Ii,s.OverscaledTileID=nr,s.PerformanceMarkers=Jo,s.Point=ze,s.Properties=ie,s.RGBAImage=Cr,s.Ray=U_,s.RequestManager=class{constructor(n,e,r){this._transformRequestFn=n,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const n=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",J,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,e){return this._transformRequestFn&&this._transformRequestFn(n,e)||{url:n}}normalizeStyleURL(n,e){if(!de(n))return n;const r=lt(n);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(n,e){if(!de(n))return n;const r=lt(n);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(n,e,r,a){if(!de(n))return n;const u=lt(n);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),r&&u.params.push(`language=${r}`),a&&u.params.push(`worldview=${a}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(n,e,r,a){const u=lt(n);return de(n)?(u.path=`/styles/v1${u.path}/sprite${e}${r}`,this._makeAPIURL(u,this._customAccessToken||a)):(u.path+=`${e}${r}`,Je(u))}normalizeTileURL(n,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!de(n))return n;const a=lt(n);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&a.authority!=="raster"&&r===512?"@2x":""}${G.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${j.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${j.TILE_URL_VERSION}${a.path}`);const u=this._customAccessToken||function(f){for(const m of f){const y=m.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(a.params)||j.ACCESS_TOKEN;return j.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,u)}canonicalizeTileURL(n,e){const r=lt(n);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return n;let a="mapbox://";r.path.match(/^\/raster\/v1\//)?a+=`raster/${r.path.replace(`/${j.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${r.path.replace(`/${j.TILE_URL_VERSION}/`,"")}`;let u=r.params;return e&&(u=u.filter(f=>!f.match(/^access_token=/))),u.length&&(a+=`?${u.join("&")}`),a}canonicalizeTileset(n,e){const r=!!e&&de(e),a=[];for(const u of n.tiles||[])Te(u)?a.push(this.canonicalizeTileURL(u,r)):a.push(u);return a}_makeAPIURL(n,e){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=lt(j.API_URL);if(n.protocol=a.protocol,n.authority=a.authority,n.protocol==="http"){const u=n.params.indexOf("secure");u>=0&&n.params.splice(u,1)}if(a.path!=="/"&&(n.path=`${a.path}${n.path}`),!j.REQUIRE_ACCESS_TOKEN)return Je(n);if(e=e||j.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return n.params=n.params.filter(u=>u.indexOf("access_token")===-1),n.params.push(`access_token=${e||""}`),Je(n)}},s.ResourceType=yo,s.SegmentVector=ni,s.SourceCache=Vl,s.StencilMode=My,s.StructArrayLayout1ui2=Er,s.StructArrayLayout2f1f2i16=At,s.StructArrayLayout2i4=Qe,s.StructArrayLayout2ui4=bi,s.StructArrayLayout3f12=qt,s.StructArrayLayout3ui6=xt,s.StructArrayLayout4i8=je,s.StructArrayLayout5f20=vn,s.Texture=Sd,s.Tile=Cy,s.Transitionable=B,s.Uniform1f=zp,s.Uniform1i=class extends ks{constructor(n){super(n),this.current=0}set(n,e,r){this.fetchUniformLocation(n,e)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},s.Uniform2f=class extends ks{constructor(n){super(n),this.current=[0,0]}set(n,e,r){this.fetchUniformLocation(n,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}},s.Uniform3f=class extends ks{constructor(n){super(n),this.current=[0,0,0]}set(n,e,r){this.fetchUniformLocation(n,e)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}},s.Uniform4f=u1,s.UniformColor=h1,s.UniformMatrix2f=class extends ks{constructor(n){super(n),this.current=pM}set(n,e,r){if(this.fetchUniformLocation(n,e)){for(let a=0;a<4;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}},s.UniformMatrix3f=class extends ks{constructor(n){super(n),this.current=fM}set(n,e,r){if(this.fetchUniformLocation(n,e)){for(let a=0;a<9;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},s.UniformMatrix4f=class extends ks{constructor(n){super(n),this.current=dM}set(n,e,r){if(this.fetchUniformLocation(n,e)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let a=1;a<16;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}},s.UnwrappedTileID=_w,s.ValidationError=pt,s.VectorTileFeature=Xp,s.VectorTileWorkerSource=class extends il{constructor(n,e,r,a,u){super(),this.actor=n,this.layerIndex=e,this.availableImages=r,this.loadVectorData=u||Ab,this.loading={},this.loaded={},this.deduped=new Cb(n.scheduler),this.isSpriteLoaded=a,this.scheduler=n.scheduler}loadTile(n,e){const r=n.uid,a=n&&n.request,u=a&&a.collectResourceTiming,f=this.loading[r]=new FI(n);f.abort=this.loadVectorData(n,(m,y)=>{const x=!this.loading[r];if(delete this.loading[r],x||m||!y)return f.status="done",x||(this.loaded[r]=f),e(m);const b=y.rawData,C={};y.expires&&(C.expires=y.expires),y.cacheControl&&(C.cacheControl=y.cacheControl),f.vectorTile=y.vectorTile||new uy(new em(b));const P=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(I,L)=>{if(I||!L)return e(I);const R={};if(u){const O=eh(a);O.length>0&&(R.resourceTiming=JSON.parse(JSON.stringify(O)))}e(null,fn({rawTileData:b.slice(0)},L,C,R))})};this.isSpriteLoaded?P():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(P,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom}):P()}),this.loaded=this.loaded||{},this.loaded[r]=f})}reloadTile(n,e){const r=this.loaded,a=n.uid,u=this;if(r&&r[a]){const f=r[a];f.showCollisionBoxes=n.showCollisionBoxes,f.enableTerrain=!!n.enableTerrain,f.projection=n.projection,f.tileTransform=Ul(n.tileID.canonical,n.projection);const m=(y,x)=>{const b=f.reloadCallback;b&&(delete f.reloadCallback,f.parse(f.vectorTile,u.layerIndex,this.availableImages,u.actor,b)),e(y,x)};f.status==="parsing"?f.reloadCallback=m:f.status==="done"&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,m):m())}}abortTile(n,e){const r=n.uid,a=this.loading[r];a&&(a.abort&&a.abort(),delete this.loading[r]),e()}removeTile(n,e){const r=this.loaded,a=n.uid;r&&r[a]&&delete r[a],e()}},s.WritingMode=jr,s.ZoomDependentExpression=wl,s.add=zs,s.addDynamicAttributes=um,s.adjoint=function(n,e){var r=e[0],a=e[1],u=e[2],f=e[3],m=e[4],y=e[5],x=e[6],b=e[7],C=e[8];return n[0]=m*C-y*b,n[1]=u*b-a*C,n[2]=a*y-u*m,n[3]=y*x-f*C,n[4]=r*C-u*x,n[5]=u*f-r*y,n[6]=f*b-m*x,n[7]=a*x-r*b,n[8]=r*m-a*f,n},s.asyncAll=wt,s.bezier=Bn,s.bindAll=cr,s.boundsAttributes=cb,s.bufferConvexPolygon=function(n,e){const r=[];for(let a=0;a<n.length;a++){const u=Tt(a-1,-1,n.length-1),f=Tt(a+1,-1,n.length-1),m=n[a],y=n[f],x=n[u].sub(m).unit(),b=y.sub(m).unit(),C=b.angleWithSep(x.x,x.y),P=x.add(b).unit().mult(-1*e/Math.sin(C/2));r.push(m.add(P))}return r},s.cacheEntryPossiblyAdded=function(n){Yo++,Yo>_o&&(n.getActor().send("enforceCacheSizeLimit",ys),Yo=0)},s.calculateGlobeLabelMatrix=function(n,e){const{x:r,y:a}=n.point,u=L1(r,a,n.worldSize/n._pixelsPerMercatorPixel,0,0);return kl(u,u,Z_(is(e)))},s.calculateGlobeMatrix=function(n){const{x:e,y:r}=n.point,{lng:a,lat:u}=n._center;return L1(e,r,n.worldSize,a,u)},s.calculateGlobeMercatorMatrix=function(n){const e=n.pixelsPerMeter,r=e/Lo(1,n.center.lat),a=Do(new Float64Array(16));return Yh(a,a,[n.point.x,n.point.y,0]),Dl(a,a,[r,r,e]),Float32Array.from(a)},s.circumferenceAtLatitude=W_,s.clamp=Xe,s.clearTileCache=function(n){if(!vs())return;const e=A.caches.delete(Ho);n&&e.catch(n).then(()=>n())},s.clipLine=Zw,s.clone=function(n){var e=new Sr(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},s.clone$1=yi,s.collisionCircleLayout=RP,s.config=j,s.conjugate=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},s.create=function(){var n=new Sr(16);return Sr!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},s.create$1=p1,s.createExpression=fa,s.createLayout=xe,s.createStyleLayer=function(n){return n.type==="custom"?new CI(n):new MI[n.type](n)},s.cross=O_,s.degToRad=gt,s.distance=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},s.div=function(n,e,r){return n[0]=e[0]/r[0],n[1]=e[1]/r[1],n[2]=e[2]/r[2],n},s.dot=io,s.earthRadius=ad,s.ease=Xn,s.easeCubicInOut=un,s.ecefToLatLng=function([n,e,r]){const a=Math.hypot(n,e,r),u=Math.atan2(n,r),f=.5*Math.PI-Math.acos(-e/a);return new wn(Jt(u),Jt(f))},s.emitValidationErrors=Ap,s.endsWith=ur,s.enforceCacheSizeLimit=function(n){Kr(),$i&&$i.then(e=>{e.keys().then(r=>{for(let a=0;a<r.length-n;a++)e.delete(r[a])})})},s.evaluateSizeForFeature=Jp,s.evaluateSizeForZoom=eu,s.evaluateVariableOffset=Kw,s.evented=_,s.exactEquals=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},s.exactEquals$1=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]},s.exported=vo,s.exported$1=G,s.extend=fn,s.extend$1=wo,s.fillExtrusionHeightLift=pw,s.filterObject=Rr,s.fromMat4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},s.fromQuat=function(n,e){var r=e[0],a=e[1],u=e[2],f=e[3],m=r+r,y=a+a,x=u+u,b=r*m,C=a*m,P=a*y,I=u*m,L=u*y,R=u*x,O=f*m,Z=f*y,Q=f*x;return n[0]=1-P-R,n[1]=C+Q,n[2]=I-Z,n[3]=0,n[4]=C-Q,n[5]=1-b-R,n[6]=L+O,n[7]=0,n[8]=I+Z,n[9]=L-O,n[10]=1-b-P,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},s.fromRotation=function(n,e){var r=Math.sin(e),a=Math.cos(e);return n[0]=a,n[1]=r,n[2]=0,n[3]=-r,n[4]=a,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},s.fromScaling=g1,s.furthestTileCorner=function(n){const e=Math.round((n+45+360)%360/90)%4;return Sn[e]},s.getAABBPointSquareDist=function(n,e,r){let a=0;for(let u=0;u<2;++u){const f=r?r[u]:0;n[u]>f&&(a+=(n[u]-f)*(n[u]-f)),e[u]<f&&(a+=(f-e[u])*(f-e[u]))}return a},s.getAnchorAlignment=_y,s.getAnchorJustification=xy,s.getBounds=function(n){let e=1/0,r=1/0,a=-1/0,u=-1/0;for(const f of n)e=Math.min(e,f.x),r=Math.min(r,f.y),a=Math.max(a,f.x),u=Math.max(u,f.y);return{min:new ze(e,r),max:new ze(a,u)}},s.getColumn=Br,s.getDefaultExportFromCjs=se,s.getGridMatrix=function(n,e,r,a){const u=e.getNorth(),f=e.getSouth(),m=e.getWest(),y=e.getEast(),x=1<<n.z,b=y-m,C=u-f,P=b/Ll,I=-C/rd[r],L=[0,P,0,I,0,0,u,m,0];if(n.z>0){const R=180/a;m1(L,L,[R/b+1,0,0,0,R/C+1,0,-.5*R/P,.5*R/I,1])}return L[2]=x,L[5]=n.x,L[8]=n.y,L},s.getImage=X,s.getJSON=function(n,e){return ot(fn(n,{type:"json"}),e)},s.getLatitudinalLod=function(n){const e=Ui-5;n=Xe(n,-e,e)/e*90;const r=Math.pow(Math.abs(Math.sin(gt(n))),3);return Math.round(r*(rd.length-1))},s.getMapSessionAPI=Nn,s.getPerformanceMeasurement=eh,s.getProjection=rb,s.getRTLTextPluginStatus=v,s.getReferrer=Ve,s.getTilePoint=function(n,{x:e,y:r},a=0){return new ze(((e-a)*n.scale-n.x)*Ct,(r*n.scale-n.y)*Ct)},s.getTileVec3=function(n,e,r=0){return Zc(((e.x-r)*n.scale-n.x)*Ct,(e.y*n.scale-n.y)*Ct,O1(e.z,e.y))},s.getVideo=function(n,e){const r=A.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let a=0;a<n.length;a++){const u=A.document.createElement("source");Ut(n[a])||(r.crossOrigin="Anonymous"),u.src=n[a],r.appendChild(u)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(n){const e=[0,0,0],r=Do(new Float64Array(16));return kl(r,n.pixelMatrix,n.globeMatrix),Kn(e,e,r),new ze(e[0],e[1])},s.globeDenormalizeECEF=Z_,s.globeECEFOrigin=function(n,e){const r=[0,0,0];return Kn(r,r,sd(is(e.canonical))),Kn(r,r,n),r},s.globeMetersToEcef=Bp,s.globeNormalizeECEF=sd,s.globePixelsToTileUnits=function(n,e){return Ct/(512*Math.pow(2,n))*Op(is(e))},s.globePoleMatrixForTile=function(n,e,r){const a=Do(new Float64Array(16)),u=(e/(1<<n)-.5)*Math.PI*2;return Rp(a,r.globeMatrix,u),Float32Array.from(a)},s.globeTileBounds=is,s.globeTiltAtLngLat=R1,s.globeToMercatorTransition=Xc,s.globeUseCustomAntiAliasing=function(n,e,r){const a=Xc(r.zoom),u=n.style.map._antialias,f=!!e.extStandardDerivatives,m=e.extStandardDerivativesForceOff||n.terrain&&n.terrain.exaggeration()>0;return a===0&&!u&&!m&&f},s.identity=Do,s.identity$1=E1,s.invert=L_,s.isFullscreen=function(){return!!A.document.fullscreenElement||!!A.document.webkitFullscreenElement},s.isLngLatBehindGlobe=q_,s.isMapAuthenticated=function(n){return vi.has(n)},s.isMapboxURL=de,s.isSafariWithAntialiasingBug=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!go(n)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=Oi,s.latLngToECEF=Wc,s.len=TM,s.length=Jh,s.length$1=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},s.lngFromMercatorX=Nr,s.loadVectorTile=Ab,s.makeRequest=ot,s.mapValue=function(n,e,r,a,u){return Xe((n-e)/(r-e)*(u-a)+a,a,u)},s.mercatorScale=U1,s.mercatorXfromLng=rs,s.mercatorYfromLat=os,s.mercatorZfromAltitude=Lo,s.mul=wM,s.mul$1=bM,s.multiply=kl,s.multiply$1=m1,s.multiply$2=v1,s.nextPowerOfTwo=gi,s.normalize=er,s.normalize$1=EM,s.normalize$2=b1,s.number=Yt,s.ortho=function(n,e,r,a,u,f,m){var y=1/(e-r),x=1/(a-u),b=1/(f-m);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*b,n[11]=0,n[12]=(e+r)*y,n[13]=(u+a)*x,n[14]=(m+f)*b,n[15]=1,n},s.pbf=Ew,s.perspective=function(n,e,r,a,u){var f,m=1/Math.tan(e/2);return n[0]=m/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=m,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,u!=null&&u!==1/0?(n[10]=(u+a)*(f=1/(a-u)),n[14]=2*u*a*f):(n[10]=-1,n[14]=-2*a),n},s.pick=function(n,e){const r={};for(let a=0;a<e.length;a++){const u=e[a];u in n&&(r[u]=n[u])}return r},s.plugin=S,s.pointGeometry=Ye,s.polesInViewport=function(n){const e=Do(new Float64Array(16));kl(e,n.pixelMatrix,n.globeMatrix);const r=[0,ro,0],a=[0,oo,0];return Kn(r,r,e),Kn(a,a,e),[r[0]>0&&r[0]<=n.width&&r[1]>0&&r[1]<=n.height&&!q_(n,new wn(n.center.lat,90)),a[0]>0&&a[0]<=n.width&&a[1]>0&&a[1]<=n.height&&!q_(n,new wn(n.center.lat,-90))]},s.polygonContainsPoint=Fl,s.polygonIntersectsBox=q1,s.polygonIntersectsPolygon=j1,s.polygonizeBounds=function(n,e,r=0,a=!0){const u=new ze(r,r),f=n.sub(u),m=e.add(u),y=[f,new ze(m.x,f.y),m,new ze(f.x,m.y)];return a&&y.push(f.clone()),y},s.posAttributes=id,s.postMapLoadEvent=$t,s.postPerformanceEvent=zn,s.postTurnstileEvent=Zt,s.potpack=py,s.prevPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},s.radToDeg=Jt,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(n){return n({pluginStatus:h,pluginURL:o}),_.on("pluginStateChange",n),n},s.removeAuthState=function(n){vi.delete(n)},s.renderColorRamp=ty,s.resample=V1,s.rotateX=R_,s.rotateX$1=S1,s.rotateY=Rp,s.rotateY$1=C1,s.rotateZ=function(n,e,r){var a=Math.sin(r),u=Math.cos(r),f=e[0],m=e[1],y=e[2],x=e[3],b=e[4],C=e[5],P=e[6],I=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u+b*a,n[1]=m*u+C*a,n[2]=y*u+P*a,n[3]=x*u+I*a,n[4]=b*u-f*a,n[5]=C*u-m*a,n[6]=P*u-y*a,n[7]=I*u-x*a,n},s.rotateZ$1=function(n,e,r){r*=.5;var a=e[0],u=e[1],f=e[2],m=e[3],y=Math.sin(r),x=Math.cos(r);return n[0]=a*x+u*y,n[1]=u*x-a*y,n[2]=f*x+m*y,n[3]=m*x-f*y,n},s.scale=Dl,s.scale$1=w1,s.scale$2=Vr,s.scaleAndAdd=td,s.set=function(n,e,r,a){return n[0]=e,n[1]=r,n[2]=a,n},s.setCacheLimits=function(n,e){ys=n,_o=e},s.setColumn=function(n,e,r){n[4*e+0]=r[0],n[4*e+1]=r[1],n[4*e+2]=r[2],n[4*e+3]=r[3]},s.setRTLTextPlugin=function(n,e,r=!1){if(h===qh||h===Wh||h===Xh)throw new Error("setRTLTextPlugin cannot be called multiple times.");o=vo.resolveURL(n),h=qh,_a=e,p(),r||T()},s.smoothstep=Mt,s.spec=Fe,s.squaredLength=function(n){var e=n[0],r=n[1],a=n[2];return e*e+r*r+a*a},s.storeAuthState=function(n,e){e?vi.add(n):vi.delete(n)},s.sub=zo,s.subtract=F_,s.symbolSize=BP,s.tileAABB=function(n,e,r,a,u,f,m,y,x){if(x.name==="globe")return PM(n,e,new Kp(r,a,u));const b=Ul({z:r,x:a,y:u},x);return new tr([(f+b.x/b.scale)*e,e*(b.y/b.scale),m],[(f+b.x2/b.scale)*e,e*(b.y2/b.scale),y])},s.tileCornersToBounds=Fp,s.tileTransform=Ul,s.transformMat3=function(n,e,r){var a=e[0],u=e[1],f=e[2];return n[0]=a*r[0]+u*r[3]+f*r[6],n[1]=a*r[1]+u*r[4]+f*r[7],n[2]=a*r[2]+u*r[5]+f*r[8],n},s.transformMat4=Kn,s.transformMat4$1=zl,s.transformQuat=x1,s.transitionTileAABBinECEF=k1,s.translate=Yh,s.transpose=function(n,e){if(n===e){var r=e[1],a=e[2],u=e[5];n[1]=e[3],n[2]=e[6],n[3]=r,n[5]=e[7],n[6]=a,n[7]=u}else n[0]=e[0],n[1]=e[3],n[2]=e[6],n[3]=e[1],n[4]=e[4],n[5]=e[7],n[6]=e[2],n[7]=e[5],n[8]=e[8];return n},s.triggerPluginCompletionEvent=c,s.uniqueId=mi,s.updateGlobeVertexNormal=function(n,e,r,a,u){const f=5*e+2;n.float32[f+0]=r,n.float32[f+1]=a,n.float32[f+2]=u},s.validateCustomStyleLayer=function(n){const e=[],r=n.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},s.validateFilter=n=>Tr(Cl(n)),s.validateFog=n=>Tr(Ep(n)),s.validateLayer=n=>Tr(xp(n)),s.validateLight=n=>Tr(Tp(n)),s.validateSource=n=>Tr(bp(n)),s.validateStyle=Cp,s.validateTerrain=n=>Tr(Nh(n)),s.values=nn,s.vectorTile=Wp,s.version=z,s.warnOnce=pn,s.window=A,s.wrap=Tt}),w(["./shared"],function(s){function A(ee){if(typeof ee=="number"||typeof ee=="boolean"||typeof ee=="string"||ee==null)return JSON.stringify(ee);if(Array.isArray(ee)){let N="[";for(const X of ee)N+=`${A(X)},`;return`${N}]`}let U="{";for(const N of Object.keys(ee).sort())U+=`${N}:${A(ee[N])},`;return`${U}}`}function z(ee){let U="";for(const N of s.refProperties)U+=`/${A(ee[N])}`;return U}class V{constructor(U){this.keyCache={},U&&this.replace(U)}replace(U){this._layerConfigs={},this._layers={},this.update(U,[])}update(U,N){for(const ce of U)this._layerConfigs[ce.id]=ce,(this._layers[ce.id]=s.createStyleLayer(ce)).compileFilter(),this.keyCache[ce.id]&&delete this.keyCache[ce.id];for(const ce of N)delete this.keyCache[ce],delete this._layerConfigs[ce],delete this._layers[ce];this.familiesBySource={};const X=function(ce,de){const Te={};for(let _e=0;_e<ce.length;_e++){const Ce=de&&de[ce[_e].id]||z(ce[_e]);de&&(de[ce[_e].id]=Ce);let nt=Te[Ce];nt||(nt=Te[Ce]=[]),nt.push(ce[_e])}const we=[];for(const _e in Te)we.push(Te[_e]);return we}(s.values(this._layerConfigs),this.keyCache);for(const ce of X){const de=ce.map(lt=>this._layers[lt.id]),Te=de[0];if(Te.visibility==="none")continue;const we=Te.source||"";let _e=this.familiesBySource[we];_e||(_e=this.familiesBySource[we]={});const Ce=Te.sourceLayer||"_geojsonTileLayer";let nt=_e[Ce];nt||(nt=_e[Ce]=[]),nt.push(de)}}}class j{loadTile(U,N){const{uid:X,encoding:ce,rawImageData:de,padding:Te,buildQuadTree:we}=U,_e=s.window.ImageBitmap&&de instanceof s.window.ImageBitmap?this.getImageData(de,Te):de;N(null,new s.DEMData(X,_e,ce,Te<1,we))}getImageData(U,N){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(U.width,U.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=U.width,this.offscreenCanvas.height=U.height,this.offscreenCanvasContext.drawImage(U,0,0,U.width,U.height);const X=this.offscreenCanvasContext.getImageData(-N,-N,U.width+2*N,U.height+2*N);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),X}}function G(ee,U){if(ee.length!==0){re(ee[0],U);for(var N=1;N<ee.length;N++)re(ee[N],!U)}}function re(ee,U){for(var N=0,X=0,ce=0,de=ee.length,Te=de-1;ce<de;Te=ce++){var we=(ee[ce][0]-ee[Te][0])*(ee[Te][1]+ee[ce][1]),_e=N+we;X+=Math.abs(N)>=Math.abs(we)?N-_e+we:we-_e+N,N=_e}N+X>=0!=!!U&&ee.reverse()}var he=s.getDefaultExportFromCjs(function ee(U,N){var X,ce=U&&U.type;if(ce==="FeatureCollection")for(X=0;X<U.features.length;X++)ee(U.features[X],N);else if(ce==="GeometryCollection")for(X=0;X<U.geometries.length;X++)ee(U.geometries[X],N);else if(ce==="Feature")ee(U.geometry,N);else if(ce==="Polygon")G(U.coordinates,N);else if(ce==="MultiPolygon")for(X=0;X<U.coordinates.length;X++)G(U.coordinates[X],N);return U});const ve=s.VectorTileFeature.prototype.toGeoJSON;var Ue={exports:{}},ae=s.pointGeometry,J=s.vectorTile.VectorTileFeature,se=oe;function oe(ee,U){this.options=U||{},this.features=ee,this.length=ee.length}function Be(ee,U){this.id=typeof ee.id=="number"?ee.id:void 0,this.type=ee.type,this.rawGeometry=ee.type===1?[ee.geometry]:ee.geometry,this.properties=ee.tags,this.extent=U||4096}oe.prototype.feature=function(ee){return new Be(this.features[ee],this.options.extent)},Be.prototype.loadGeometry=function(){var ee=this.rawGeometry;this.geometry=[];for(var U=0;U<ee.length;U++){for(var N=ee[U],X=[],ce=0;ce<N.length;ce++)X.push(new ae(N[ce][0],N[ce][1]));this.geometry.push(X)}return this.geometry},Be.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ee=this.geometry,U=1/0,N=-1/0,X=1/0,ce=-1/0,de=0;de<ee.length;de++)for(var Te=ee[de],we=0;we<Te.length;we++){var _e=Te[we];U=Math.min(U,_e.x),N=Math.max(N,_e.x),X=Math.min(X,_e.y),ce=Math.max(ce,_e.y)}return[U,X,N,ce]},Be.prototype.toGeoJSON=J.prototype.toGeoJSON;var at=s.pbf,Ye=se;function He(ee){var U=new at;return function(N,X){for(var ce in N.layers)X.writeMessage(3,ze,N.layers[ce])}(ee,U),U.finish()}function ze(ee,U){var N;U.writeVarintField(15,ee.version||1),U.writeStringField(1,ee.name||""),U.writeVarintField(5,ee.extent||4096);var X={keys:[],values:[],keycache:{},valuecache:{}};for(N=0;N<ee.length;N++)X.feature=ee.feature(N),U.writeMessage(2,kt,X);var ce=X.keys;for(N=0;N<ce.length;N++)U.writeStringField(3,ce[N]);var de=X.values;for(N=0;N<de.length;N++)U.writeMessage(4,un,de[N])}function kt(ee,U){var N=ee.feature;N.id!==void 0&&U.writeVarintField(1,N.id),U.writeMessage(2,dn,ee),U.writeVarintField(3,N.type),U.writeMessage(4,Sn,N)}function dn(ee,U){var N=ee.feature,X=ee.keys,ce=ee.values,de=ee.keycache,Te=ee.valuecache;for(var we in N.properties){var _e=N.properties[we],Ce=de[we];if(_e!==null){Ce===void 0&&(X.push(we),de[we]=Ce=X.length-1),U.writeVarint(Ce);var nt=typeof _e;nt!=="string"&&nt!=="boolean"&&nt!=="number"&&(_e=JSON.stringify(_e));var lt=nt+":"+_e,Je=Te[lt];Je===void 0&&(ce.push(_e),Te[lt]=Je=ce.length-1),U.writeVarint(Je)}}}function gt(ee,U){return(U<<3)+(7&ee)}function Jt(ee){return ee<<1^ee>>31}function Sn(ee,U){for(var N=ee.loadGeometry(),X=ee.type,ce=0,de=0,Te=N.length,we=0;we<Te;we++){var _e=N[we],Ce=1;X===1&&(Ce=_e.length),U.writeVarint(gt(1,Ce));for(var nt=X===3?_e.length-1:_e.length,lt=0;lt<nt;lt++){lt===1&&X!==1&&U.writeVarint(gt(2,nt-1));var Je=_e[lt].x-ce,It=_e[lt].y-de;U.writeVarint(Jt(Je)),U.writeVarint(Jt(It)),ce+=Je,de+=It}X===3&&U.writeVarint(gt(7,1))}}function un(ee,U){var N=typeof ee;N==="string"?U.writeStringField(1,ee):N==="boolean"?U.writeBooleanField(7,ee):N==="number"&&(ee%1!=0?U.writeDoubleField(3,ee):ee<0?U.writeSVarintField(6,ee):U.writeVarintField(5,ee))}Ue.exports=He,Ue.exports.fromVectorTileJs=He,Ue.exports.fromGeojsonVt=function(ee,U){U=U||{};var N={};for(var X in ee)N[X]=new Ye(ee[X].features,U),N[X].name=X,N[X].version=U.version,N[X].extent=U.extent;return He({layers:N})},Ue.exports.GeoJSONWrapper=Ye;var Bn=s.getDefaultExportFromCjs(Ue.exports);const Xn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ee=>ee},Xe=Math.fround||(Mt=new Float32Array(1),ee=>(Mt[0]=+ee,Mt[0]));var Mt;const Tt=3,wt=5,nn=6;class fn{constructor(U){this.options=Object.assign(Object.create(Xn),U),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(U){const{log:N,minZoom:X,maxZoom:ce}=this.options;N&&console.time("total time");const de=`prepare ${U.length} points`;N&&console.time(de),this.points=U;const Te=[];for(let _e=0;_e<U.length;_e++){const Ce=U[_e];if(!Ce.geometry)continue;const[nt,lt]=Ce.geometry.coordinates,Je=Xe(Un(nt)),It=Xe(gi(lt));Te.push(Je,It,1/0,_e,-1,1),this.options.reduce&&Te.push(0)}let we=this.trees[ce+1]=this._createTree(Te);N&&console.timeEnd(de);for(let _e=ce;_e>=X;_e--){const Ce=+Date.now();we=this.trees[_e]=this._createTree(this._cluster(we,_e)),N&&console.log("z%d: %d clusters in %dms",_e,we.numItems,+Date.now()-Ce)}return N&&console.timeEnd("total time"),this}getClusters(U,N){let X=((U[0]+180)%360+360)%360-180;const ce=Math.max(-90,Math.min(90,U[1]));let de=U[2]===180?180:((U[2]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)X=-180,de=180;else if(X>de){const lt=this.getClusters([X,ce,180,Te],N),Je=this.getClusters([-180,ce,de,Te],N);return lt.concat(Je)}const we=this.trees[this._limitZoom(N)],_e=we.range(Un(X),gi(Te),Un(de),gi(ce)),Ce=we.data,nt=[];for(const lt of _e){const Je=this.stride*lt;nt.push(Ce[Je+wt]>1?Qt(Ce,Je,this.clusterProps):this.points[Ce[Je+Tt]])}return nt}getChildren(U){const N=this._getOriginId(U),X=this._getOriginZoom(U),ce="No cluster with the specified id.",de=this.trees[X];if(!de)throw new Error(ce);const Te=de.data;if(N*this.stride>=Te.length)throw new Error(ce);const we=this.options.radius/(this.options.extent*Math.pow(2,X-1)),_e=de.within(Te[N*this.stride],Te[N*this.stride+1],we),Ce=[];for(const nt of _e){const lt=nt*this.stride;Te[lt+4]===U&&Ce.push(Te[lt+wt]>1?Qt(Te,lt,this.clusterProps):this.points[Te[lt+Tt]])}if(Ce.length===0)throw new Error(ce);return Ce}getLeaves(U,N,X){const ce=[];return this._appendLeaves(ce,U,N=N||10,X=X||0,0),ce}getTile(U,N,X){const ce=this.trees[this._limitZoom(U)],de=Math.pow(2,U),{extent:Te,radius:we}=this.options,_e=we/Te,Ce=(X-_e)/de,nt=(X+1+_e)/de,lt={features:[]};return this._addTileFeatures(ce.range((N-_e)/de,Ce,(N+1+_e)/de,nt),ce.data,N,X,de,lt),N===0&&this._addTileFeatures(ce.range(1-_e/de,Ce,1,nt),ce.data,de,X,de,lt),N===de-1&&this._addTileFeatures(ce.range(0,Ce,_e/de,nt),ce.data,-1,X,de,lt),lt.features.length?lt:null}getClusterExpansionZoom(U){let N=this._getOriginZoom(U)-1;for(;N<=this.options.maxZoom;){const X=this.getChildren(U);if(N++,X.length!==1)break;U=X[0].properties.cluster_id}return N}_appendLeaves(U,N,X,ce,de){const Te=this.getChildren(N);for(const we of Te){const _e=we.properties;if(_e&&_e.cluster?de+_e.point_count<=ce?de+=_e.point_count:de=this._appendLeaves(U,_e.cluster_id,X,ce,de):de<ce?de++:U.push(we),U.length===X)break}return de}_createTree(U){const N=new s.KDBush(U.length/this.stride|0,this.options.nodeSize,Float32Array);for(let X=0;X<U.length;X+=this.stride)N.add(U[X],U[X+1]);return N.finish(),N.data=U,N}_addTileFeatures(U,N,X,ce,de,Te){for(const we of U){const _e=we*this.stride,Ce=N[_e+wt]>1;let nt,lt,Je;if(Ce)nt=mi(N,_e,this.clusterProps),lt=N[_e],Je=N[_e+1];else{const Dt=this.points[N[_e+Tt]];nt=Dt.properties;const[Vt,Zt]=Dt.geometry.coordinates;lt=Un(Vt),Je=gi(Zt)}const It={type:1,geometry:[[Math.round(this.options.extent*(lt*de-X)),Math.round(this.options.extent*(Je*de-ce))]],tags:nt};let Rt;Rt=Ce||this.options.generateId?N[_e+Tt]:this.points[N[_e+Tt]].id,Rt!==void 0&&(It.id=Rt),Te.features.push(It)}}_limitZoom(U){return Math.max(this.options.minZoom,Math.min(Math.floor(+U),this.options.maxZoom+1))}_cluster(U,N){const{radius:X,extent:ce,reduce:de,minPoints:Te}=this.options,we=X/(ce*Math.pow(2,N)),_e=U.data,Ce=[],nt=this.stride;for(let lt=0;lt<_e.length;lt+=nt){if(_e[lt+2]<=N)continue;_e[lt+2]=N;const Je=_e[lt],It=_e[lt+1],Rt=U.within(_e[lt],_e[lt+1],we),Dt=_e[lt+wt];let Vt=Dt;for(const Zt of Rt){const gn=Zt*nt;_e[gn+2]>N&&(Vt+=_e[gn+wt])}if(Vt>Dt&&Vt>=Te){let Zt,gn=Je*Dt,$t=It*Dt,Cn=-1;const zn=((lt/nt|0)<<5)+(N+1)+this.points.length;for(const kn of Rt){const Nn=kn*nt;if(_e[Nn+2]<=N)continue;_e[Nn+2]=N;const vi=_e[Nn+wt];gn+=_e[Nn]*vi,$t+=_e[Nn+1]*vi,_e[Nn+4]=zn,de&&(Zt||(Zt=this._map(_e,lt,!0),Cn=this.clusterProps.length,this.clusterProps.push(Zt)),de(Zt,this._map(_e,Nn)))}_e[lt+4]=zn,Ce.push(gn/Vt,$t/Vt,1/0,zn,-1,Vt),de&&Ce.push(Cn)}else{for(let Zt=0;Zt<nt;Zt++)Ce.push(_e[lt+Zt]);if(Vt>1)for(const Zt of Rt){const gn=Zt*nt;if(!(_e[gn+2]<=N)){_e[gn+2]=N;for(let $t=0;$t<nt;$t++)Ce.push(_e[gn+$t])}}}}return Ce}_getOriginId(U){return U-this.points.length>>5}_getOriginZoom(U){return(U-this.points.length)%32}_map(U,N,X){if(U[N+wt]>1){const Te=this.clusterProps[U[N+nn]];return X?Object.assign({},Te):Te}const ce=this.points[U[N+Tt]].properties,de=this.options.map(ce);return X&&de===ce?Object.assign({},de):de}}function Qt(ee,U,N){return{type:"Feature",id:ee[U+Tt],properties:mi(ee,U,N),geometry:{type:"Point",coordinates:[(X=ee[U],360*(X-.5)),ji(ee[U+1])]}};var X}function mi(ee,U,N){const X=ee[U+wt],ce=X>=1e4?`${Math.round(X/1e3)}k`:X>=1e3?Math.round(X/100)/10+"k":X,de=ee[U+nn],Te=de===-1?{}:Object.assign({},N[de]);return Object.assign(Te,{cluster:!0,cluster_id:ee[U+Tt],point_count:X,point_count_abbreviated:ce})}function Un(ee){return ee/360+.5}function gi(ee){const U=Math.sin(ee*Math.PI/180),N=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return N<0?0:N>1?1:N}function ji(ee){const U=(180-360*ee)*Math.PI/180;return 360*Math.atan(Math.exp(U))/Math.PI-90}function cr(ee,U,N,X){for(var ce,de=X,Te=N-U>>1,we=N-U,_e=ee[U],Ce=ee[U+1],nt=ee[N],lt=ee[N+1],Je=U+3;Je<N;Je+=3){var It=ur(ee[Je],ee[Je+1],_e,Ce,nt,lt);if(It>de)ce=Je,de=It;else if(It===de){var Rt=Math.abs(Je-Te);Rt<we&&(ce=Je,we=Rt)}}de>X&&(ce-U>3&&cr(ee,U,ce,X),ee[ce+2]=de,N-ce>3&&cr(ee,ce,N,X))}function ur(ee,U,N,X,ce,de){var Te=ce-N,we=de-X;if(Te!==0||we!==0){var _e=((ee-N)*Te+(U-X)*we)/(Te*Te+we*we);_e>1?(N=ce,X=de):_e>0&&(N+=Te*_e,X+=we*_e)}return(Te=ee-N)*Te+(we=U-X)*we}function Lt(ee,U,N,X){var ce={id:ee===void 0?null:ee,type:U,geometry:N,tags:X,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(de){var Te=de.geometry,we=de.type;if(we==="Point"||we==="MultiPoint"||we==="LineString")Rr(de,Te);else if(we==="Polygon"||we==="MultiLineString")for(var _e=0;_e<Te.length;_e++)Rr(de,Te[_e]);else if(we==="MultiPolygon")for(_e=0;_e<Te.length;_e++)for(var Ce=0;Ce<Te[_e].length;Ce++)Rr(de,Te[_e][Ce])}(ce),ce}function Rr(ee,U){for(var N=0;N<U.length;N+=3)ee.minX=Math.min(ee.minX,U[N]),ee.minY=Math.min(ee.minY,U[N+1]),ee.maxX=Math.max(ee.maxX,U[N]),ee.maxY=Math.max(ee.maxY,U[N+1])}function yi(ee,U,N,X){if(U.geometry){var ce=U.geometry.coordinates,de=U.geometry.type,Te=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2),we=[],_e=U.id;if(N.promoteId?_e=U.properties[N.promoteId]:N.generateId&&(_e=X||0),de==="Point")_s(ce,we);else if(de==="MultiPoint")for(var Ce=0;Ce<ce.length;Ce++)_s(ce[Ce],we);else if(de==="LineString")pn(ce,we,Te,!1);else if(de==="MultiLineString"){if(N.lineMetrics){for(Ce=0;Ce<ce.length;Ce++)pn(ce[Ce],we=[],Te,!1),ee.push(Lt(_e,"LineString",we,U.properties));return}Gi(ce,we,Te,!1)}else if(de==="Polygon")Gi(ce,we,Te,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(Ce=0;Ce<U.geometry.geometries.length;Ce++)yi(ee,{id:_e,geometry:U.geometry.geometries[Ce],properties:U.properties},N,X);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ce=0;Ce<ce.length;Ce++){var nt=[];Gi(ce[Ce],nt,Te,!0),we.push(nt)}}ee.push(Lt(_e,de,we,U.properties))}}function _s(ee,U){U.push(Wo(ee[0])),U.push(Hi(ee[1])),U.push(0)}function pn(ee,U,N,X){for(var ce,de,Te=0,we=0;we<ee.length;we++){var _e=Wo(ee[we][0]),Ce=Hi(ee[we][1]);U.push(_e),U.push(Ce),U.push(0),we>0&&(Te+=X?(ce*Ce-_e*de)/2:Math.sqrt(Math.pow(_e-ce,2)+Math.pow(Ce-de,2))),ce=_e,de=Ce}var nt=U.length-3;U[2]=1,cr(U,0,nt,N),U[nt+2]=1,U.size=Math.abs(Te),U.start=0,U.end=U.size}function Gi(ee,U,N,X){for(var ce=0;ce<ee.length;ce++){var de=[];pn(ee[ce],de,N,X),U.push(de)}}function Wo(ee){return ee/360+.5}function Hi(ee){var U=Math.sin(ee*Math.PI/180),N=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return N<0?0:N>1?1:N}function Mi(ee,U,N,X,ce,de,Te,we){if(X/=U,de>=(N/=U)&&Te<X)return ee;if(Te<N||de>=X)return null;for(var _e=[],Ce=0;Ce<ee.length;Ce++){var nt=ee[Ce],lt=nt.geometry,Je=nt.type,It=ce===0?nt.minX:nt.minY,Rt=ce===0?nt.maxX:nt.maxY;if(It>=N&&Rt<X)_e.push(nt);else if(!(Rt<N||It>=X)){var Dt=[];if(Je==="Point"||Je==="MultiPoint")Ki(lt,Dt,N,X,ce);else if(Je==="LineString")go(lt,Dt,N,X,ce,!1,we.lineMetrics);else if(Je==="MultiLineString")Br(lt,Dt,N,X,ce,!1);else if(Je==="Polygon")Br(lt,Dt,N,X,ce,!0);else if(Je==="MultiPolygon")for(var Vt=0;Vt<lt.length;Vt++){var Zt=[];Br(lt[Vt],Zt,N,X,ce,!0),Zt.length&&Dt.push(Zt)}if(Dt.length){if(we.lineMetrics&&Je==="LineString"){for(Vt=0;Vt<Dt.length;Vt++)_e.push(Lt(nt.id,Je,Dt[Vt],nt.tags));continue}Je!=="LineString"&&Je!=="MultiLineString"||(Dt.length===1?(Je="LineString",Dt=Dt[0]):Je="MultiLineString"),Je!=="Point"&&Je!=="MultiPoint"||(Je=Dt.length===3?"Point":"MultiPoint"),_e.push(Lt(nt.id,Je,Dt,nt.tags))}}}return _e.length?_e:null}function Ki(ee,U,N,X,ce){for(var de=0;de<ee.length;de+=3){var Te=ee[de+ce];Te>=N&&Te<=X&&(U.push(ee[de]),U.push(ee[de+1]),U.push(ee[de+2]))}}function go(ee,U,N,X,ce,de,Te){for(var we,_e,Ce=Xo(ee),nt=ce===0?ys:_o,lt=ee.start,Je=0;Je<ee.length-3;Je+=3){var It=ee[Je],Rt=ee[Je+1],Dt=ee[Je+2],Vt=ee[Je+3],Zt=ee[Je+4],gn=ce===0?It:Rt,$t=ce===0?Vt:Zt,Cn=!1;Te&&(we=Math.sqrt(Math.pow(It-Vt,2)+Math.pow(Rt-Zt,2))),gn<N?$t>N&&(_e=nt(Ce,It,Rt,Vt,Zt,N),Te&&(Ce.start=lt+we*_e)):gn>X?$t<X&&(_e=nt(Ce,It,Rt,Vt,Zt,X),Te&&(Ce.start=lt+we*_e)):Ho(Ce,It,Rt,Dt),$t<N&&gn>=N&&(_e=nt(Ce,It,Rt,Vt,Zt,N),Cn=!0),$t>X&&gn<=X&&(_e=nt(Ce,It,Rt,Vt,Zt,X),Cn=!0),!de&&Cn&&(Te&&(Ce.end=lt+we*_e),U.push(Ce),Ce=Xo(ee)),Te&&(lt+=we)}var zn=ee.length-3;It=ee[zn],Rt=ee[zn+1],Dt=ee[zn+2],(gn=ce===0?It:Rt)>=N&&gn<=X&&Ho(Ce,It,Rt,Dt),zn=Ce.length-3,de&&zn>=3&&(Ce[zn]!==Ce[0]||Ce[zn+1]!==Ce[1])&&Ho(Ce,Ce[0],Ce[1],Ce[2]),Ce.length&&U.push(Ce)}function Xo(ee){var U=[];return U.size=ee.size,U.start=ee.start,U.end=ee.end,U}function Br(ee,U,N,X,ce,de){for(var Te=0;Te<ee.length;Te++)go(ee[Te],U,N,X,ce,de,!1)}function Ho(ee,U,N,X){ee.push(U),ee.push(N),ee.push(X)}function ys(ee,U,N,X,ce,de){var Te=(de-U)/(X-U);return ee.push(de),ee.push(N+(ce-N)*Te),ee.push(1),Te}function _o(ee,U,N,X,ce,de){var Te=(de-N)/(ce-N);return ee.push(U+(X-U)*Te),ee.push(de),ee.push(1),Te}function $i(ee,U){for(var N=[],X=0;X<ee.length;X++){var ce,de=ee[X],Te=de.type;if(Te==="Point"||Te==="MultiPoint"||Te==="LineString")ce=vr(de.geometry,U);else if(Te==="MultiLineString"||Te==="Polygon"){ce=[];for(var we=0;we<de.geometry.length;we++)ce.push(vr(de.geometry[we],U))}else if(Te==="MultiPolygon")for(ce=[],we=0;we<de.geometry.length;we++){for(var _e=[],Ce=0;Ce<de.geometry[we].length;Ce++)_e.push(vr(de.geometry[we][Ce],U));ce.push(_e)}N.push(Lt(de.id,Te,ce,de.tags))}return N}function vr(ee,U){var N=[];N.size=ee.size,ee.start!==void 0&&(N.start=ee.start,N.end=ee.end);for(var X=0;X<ee.length;X+=3)N.push(ee[X]+U,ee[X+1],ee[X+2]);return N}function vs(ee,U){if(ee.transformed)return ee;var N,X,ce,de=1<<ee.z,Te=ee.x,we=ee.y;for(N=0;N<ee.features.length;N++){var _e=ee.features[N],Ce=_e.geometry,nt=_e.type;if(_e.geometry=[],nt===1)for(X=0;X<Ce.length;X+=2)_e.geometry.push(Kr(Ce[X],Ce[X+1],U,de,Te,we));else for(X=0;X<Ce.length;X++){var lt=[];for(ce=0;ce<Ce[X].length;ce+=2)lt.push(Kr(Ce[X][ce],Ce[X][ce+1],U,de,Te,we));_e.geometry.push(lt)}}return ee.transformed=!0,ee}function Kr(ee,U,N,X,ce,de){return[Math.round(N*(ee*X-ce)),Math.round(N*(U*X-de))]}function Ko(ee,U,N,X,ce){for(var de=U===ce.maxZoom?0:ce.tolerance/((1<<U)*ce.extent),Te={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:N,y:X,z:U,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},we=0;we<ee.length;we++){Te.numFeatures++,Yo(Te,ee[we],de,ce);var _e=ee[we].minX,Ce=ee[we].minY,nt=ee[we].maxX,lt=ee[we].maxY;_e<Te.minX&&(Te.minX=_e),Ce<Te.minY&&(Te.minY=Ce),nt>Te.maxX&&(Te.maxX=nt),lt>Te.maxY&&(Te.maxY=lt)}return Te}function Yo(ee,U,N,X){var ce=U.geometry,de=U.type,Te=[];if(de==="Point"||de==="MultiPoint")for(var we=0;we<ce.length;we+=3)Te.push(ce[we]),Te.push(ce[we+1]),ee.numPoints++,ee.numSimplified++;else if(de==="LineString")yo(Te,ce,ee,N,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(we=0;we<ce.length;we++)yo(Te,ce[we],ee,N,de==="Polygon",we===0);else if(de==="MultiPolygon")for(var _e=0;_e<ce.length;_e++){var Ce=ce[_e];for(we=0;we<Ce.length;we++)yo(Te,Ce[we],ee,N,!0,we===0)}if(Te.length){var nt=U.tags||null;if(de==="LineString"&&X.lineMetrics){for(var lt in nt={},U.tags)nt[lt]=U.tags[lt];nt.mapbox_clip_start=ce.start/ce.size,nt.mapbox_clip_end=ce.end/ce.size}var Je={geometry:Te,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:nt};U.id!==null&&(Je.id=U.id),ee.features.push(Je)}}function yo(ee,U,N,X,ce,de){var Te=X*X;if(X>0&&U.size<(ce?Te:X))N.numPoints+=U.length/3;else{for(var we=[],_e=0;_e<U.length;_e+=3)(X===0||U[_e+2]>Te)&&(N.numSimplified++,we.push(U[_e]),we.push(U[_e+1])),N.numPoints++;ce&&function(Ce,nt){for(var lt=0,Je=0,It=Ce.length,Rt=It-2;Je<It;Rt=Je,Je+=2)lt+=(Ce[Je]-Ce[Rt])*(Ce[Je+1]+Ce[Rt+1]);if(lt>0===nt)for(Je=0,It=Ce.length;Je<It/2;Je+=2){var Dt=Ce[Je],Vt=Ce[Je+1];Ce[Je]=Ce[It-2-Je],Ce[Je+1]=Ce[It-1-Je],Ce[It-2-Je]=Dt,Ce[It-1-Je]=Vt}}(we,de),ee.push(we)}}function Le(ee,U){var N=(U=this.options=function(ce,de){for(var Te in de)ce[Te]=de[Te];return ce}(Object.create(this.options),U)).debug;if(N&&console.time("preprocess data"),U.maxZoom<0||U.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(U.promoteId&&U.generateId)throw new Error("promoteId and generateId cannot be used together.");var X=function(ce,de){var Te=[];if(ce.type==="FeatureCollection")for(var we=0;we<ce.features.length;we++)yi(Te,ce.features[we],de,we);else yi(Te,ce.type==="Feature"?ce:{geometry:ce},de);return Te}(ee,U);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",U.indexMaxZoom,U.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),X=function(ce,de){var Te=de.buffer/de.extent,we=ce,_e=Mi(ce,1,-1-Te,Te,0,-1,2,de),Ce=Mi(ce,1,1-Te,2+Te,0,-1,2,de);return(_e||Ce)&&(we=Mi(ce,1,-Te,1+Te,0,-1,2,de)||[],_e&&(we=$i(_e,1).concat(we)),Ce&&(we=we.concat($i(Ce,-1)))),we}(X,U),X.length&&this.splitTile(X,0,0,0),N&&(X.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ve(ee,U,N){return 32*((1<<ee)*N+U)+ee}function ot(ee,U){const N=ee.tileID.canonical;if(!this._geoJSONIndex)return U(null,null);const X=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!X)return U(null,null);const ce=new class{constructor(Te){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=Te.length,this._features=Te}feature(Te){return new class{constructor(we){this._feature=we,this.extent=s.EXTENT,this.type=we.type,this.properties=we.tags,"id"in we&&!isNaN(we.id)&&(this.id=parseInt(we.id,10))}loadGeometry(){if(this._feature.type===1){const we=[];for(const _e of this._feature.geometry)we.push([new s.Point(_e[0],_e[1])]);return we}{const we=[];for(const _e of this._feature.geometry){const Ce=[];for(const nt of _e)Ce.push(new s.Point(nt[0],nt[1]));we.push(Ce)}return we}}toGeoJSON(we,_e,Ce){return ve.call(this,we,_e,Ce)}}(this._features[Te])}}(X.features);let de=Bn(ce);de.byteOffset===0&&de.byteLength===de.buffer.byteLength||(de=new Uint8Array(de)),U(null,{vectorTile:ce,rawData:de.buffer})}Le.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Le.prototype.splitTile=function(ee,U,N,X,ce,de,Te){for(var we=[ee,U,N,X],_e=this.options,Ce=_e.debug;we.length;){X=we.pop(),N=we.pop(),U=we.pop(),ee=we.pop();var nt=1<<U,lt=Ve(U,N,X),Je=this.tiles[lt];if(!Je&&(Ce>1&&console.time("creation"),Je=this.tiles[lt]=Ko(ee,U,N,X,_e),this.tileCoords.push({z:U,x:N,y:X}),Ce)){Ce>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",U,N,X,Je.numFeatures,Je.numPoints,Je.numSimplified),console.timeEnd("creation"));var It="z"+U;this.stats[It]=(this.stats[It]||0)+1,this.total++}if(Je.source=ee,ce){if(U===_e.maxZoom||U===ce)continue;var Rt=1<<ce-U;if(N!==Math.floor(de/Rt)||X!==Math.floor(Te/Rt))continue}else if(U===_e.indexMaxZoom||Je.numPoints<=_e.indexMaxPoints)continue;if(Je.source=null,ee.length!==0){Ce>1&&console.time("clipping");var Dt,Vt,Zt,gn,$t,Cn,zn=.5*_e.buffer/_e.extent,kn=.5-zn,Nn=.5+zn,vi=1+zn;Dt=Vt=Zt=gn=null,$t=Mi(ee,nt,N-zn,N+Nn,0,Je.minX,Je.maxX,_e),Cn=Mi(ee,nt,N+kn,N+vi,0,Je.minX,Je.maxX,_e),ee=null,$t&&(Dt=Mi($t,nt,X-zn,X+Nn,1,Je.minY,Je.maxY,_e),Vt=Mi($t,nt,X+kn,X+vi,1,Je.minY,Je.maxY,_e),$t=null),Cn&&(Zt=Mi(Cn,nt,X-zn,X+Nn,1,Je.minY,Je.maxY,_e),gn=Mi(Cn,nt,X+kn,X+vi,1,Je.minY,Je.maxY,_e),Cn=null),Ce>1&&console.timeEnd("clipping"),we.push(Dt||[],U+1,2*N,2*X),we.push(Vt||[],U+1,2*N,2*X+1),we.push(Zt||[],U+1,2*N+1,2*X),we.push(gn||[],U+1,2*N+1,2*X+1)}}},Le.prototype.getTile=function(ee,U,N){var X=this.options,ce=X.extent,de=X.debug;if(ee<0||ee>24)return null;var Te=1<<ee,we=Ve(ee,U=(U%Te+Te)%Te,N);if(this.tiles[we])return vs(this.tiles[we],ce);de>1&&console.log("drilling down to z%d-%d-%d",ee,U,N);for(var _e,Ce=ee,nt=U,lt=N;!_e&&Ce>0;)Ce--,nt=Math.floor(nt/2),lt=Math.floor(lt/2),_e=this.tiles[Ve(Ce,nt,lt)];return _e&&_e.source?(de>1&&console.log("found parent tile z%d-%d-%d",Ce,nt,lt),de>1&&console.time("drilling down"),this.splitTile(_e.source,Ce,nt,lt,ee,U,N),de>1&&console.timeEnd("drilling down"),this.tiles[we]?vs(this.tiles[we],ce):null):null};class vt extends s.VectorTileWorkerSource{constructor(U,N,X,ce,de){super(U,N,X,ce,ot),de&&(this.loadGeoJSON=de)}loadData(U,N){const X=U&&U.request,ce=X&&X.collectResourceTiming;this.loadGeoJSON(U,(de,Te)=>{if(de||!Te)return N(de);if(typeof Te!="object")return N(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));{he(Te,!0);try{if(U.filter){const _e=s.createExpression(U.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(_e.result==="error")throw new Error(_e.value.map(nt=>`${nt.key}: ${nt.message}`).join(", "));Te={type:"FeatureCollection",features:Te.features.filter(nt=>_e.value.evaluate({zoom:0},nt))}}this._geoJSONIndex=U.cluster?new fn(function({superclusterOptions:_e,clusterProperties:Ce}){if(!Ce||!_e)return _e;const nt={},lt={},Je={accumulated:null,zoom:0},It={properties:null},Rt=Object.keys(Ce);for(const Dt of Rt){const[Vt,Zt]=Ce[Dt],gn=s.createExpression(Zt),$t=s.createExpression(typeof Vt=="string"?[Vt,["accumulated"],["get",Dt]]:Vt);nt[Dt]=gn.value,lt[Dt]=$t.value}return _e.map=Dt=>{It.properties=Dt;const Vt={};for(const Zt of Rt)Vt[Zt]=nt[Zt].evaluate(Je,It);return Vt},_e.reduce=(Dt,Vt)=>{It.properties=Vt;for(const Zt of Rt)Je.accumulated=Dt[Zt],Dt[Zt]=lt[Zt].evaluate(Je,It)},_e}(U)).load(Te.features):function(_e,Ce){return new Le(_e,Ce)}(Te,U.geojsonVtOptions)}catch(_e){return N(_e)}this.loaded={};const we={};if(ce){const _e=s.getPerformanceMeasurement(X);_e&&(we.resourceTiming={},we.resourceTiming[U.source]=JSON.parse(JSON.stringify(_e)))}N(null,we)}})}reloadTile(U,N){const X=this.loaded;return X&&X[U.uid]?super.reloadTile(U,N):this.loadTile(U,N)}loadGeoJSON(U,N){if(U.request)s.getJSON(U.request,N);else{if(typeof U.data!="string")return N(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));try{return N(null,JSON.parse(U.data))}catch{return N(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(U,N){try{N(null,this._geoJSONIndex.getClusterExpansionZoom(U.clusterId))}catch(X){N(X)}}getClusterChildren(U,N){try{N(null,this._geoJSONIndex.getChildren(U.clusterId))}catch(X){N(X)}}getClusterLeaves(U,N){try{N(null,this._geoJSONIndex.getLeaves(U.clusterId,U.limit,U.offset))}catch(X){N(X)}}}class Ut{constructor(U){this.self=U,this.actor=new s.Actor(U,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:vt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(N,X)=>{if(this.workerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.workerSourceTypes[N]=X},this.self.registerRTLTextPlugin=N=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=N.applyArabicShaping,s.plugin.processBidirectionalText=N.processBidirectionalText,s.plugin.processStyledBidirectionalText=N.processStyledBidirectionalText}}clearCaches(U,N,X){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U],X()}checkIfReady(U,N,X){X()}setReferrer(U,N){this.referrer=N}spriteLoaded(U,N){this.isSpriteLoaded[U]=N;for(const X in this.workerSources[U]){const ce=this.workerSources[U][X];for(const de in ce)ce[de]instanceof s.VectorTileWorkerSource&&(ce[de].isSpriteLoaded=N,ce[de].fire(new s.Event("isSpriteLoaded")))}}setImages(U,N,X){this.availableImages[U]=N;for(const ce in this.workerSources[U]){const de=this.workerSources[U][ce];for(const Te in de)de[Te].availableImages=N}X()}enableTerrain(U,N,X){this.terrain=N,X()}setProjection(U,N){this.projections[U]=s.getProjection(N)}setLayers(U,N,X){this.getLayerIndex(U).replace(N),X()}updateLayers(U,N,X){this.getLayerIndex(U).update(N.layers,N.removedIds),X()}loadTile(U,N,X){const ce=this.enableTerrain?s.extend({enableTerrain:this.terrain},N):N;ce.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,N.type,N.source).loadTile(ce,X)}loadDEMTile(U,N,X){const ce=this.enableTerrain?s.extend({buildQuadTree:this.terrain},N):N;this.getDEMWorkerSource(U,N.source).loadTile(ce,X)}reloadTile(U,N,X){const ce=this.enableTerrain?s.extend({enableTerrain:this.terrain},N):N;ce.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,N.type,N.source).reloadTile(ce,X)}abortTile(U,N,X){this.getWorkerSource(U,N.type,N.source).abortTile(N,X)}removeTile(U,N,X){this.getWorkerSource(U,N.type,N.source).removeTile(N,X)}removeSource(U,N,X){if(!this.workerSources[U]||!this.workerSources[U][N.type]||!this.workerSources[U][N.type][N.source])return;const ce=this.workerSources[U][N.type][N.source];delete this.workerSources[U][N.type][N.source],ce.removeSource!==void 0?ce.removeSource(N,X):X()}loadWorkerSource(U,N,X){try{this.self.importScripts(N.url),X()}catch(ce){X(ce.toString())}}syncRTLPluginState(U,N,X){try{s.plugin.setState(N);const ce=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&ce!=null){this.self.importScripts(ce);const de=s.plugin.isParsed();X(de?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ce}`),de)}}catch(ce){X(ce.toString())}}getAvailableImages(U){let N=this.availableImages[U];return N||(N=[]),N}getLayerIndex(U){let N=this.layerIndexes[U];return N||(N=this.layerIndexes[U]=new V),N}getWorkerSource(U,N,X){if(this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][N]||(this.workerSources[U][N]={}),!this.workerSources[U][N][X]){const ce={send:(de,Te,we,_e,Ce,nt)=>{this.actor.send(de,Te,we,U,Ce,nt)},scheduler:this.actor.scheduler};this.workerSources[U][N][X]=new this.workerSourceTypes[N](ce,this.getLayerIndex(U),this.getAvailableImages(U),this.isSpriteLoaded[U])}return this.workerSources[U][N][X]}getDEMWorkerSource(U,N){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][N]||(this.demWorkerSources[U][N]=new j),this.demWorkerSources[U][N]}enforceCacheSizeLimit(U,N){s.enforceCacheSizeLimit(N)}getWorkerPerformanceMetrics(U,N,X){X(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ut(self)),Ut}),w(["./shared"],function(s){function A(h,o){if(Array.isArray(h)){if(!Array.isArray(o)||h.length!==o.length)return!1;for(let c=0;c<h.length;c++)if(!A(h[c],o[c]))return!1;return!0}if(typeof h=="object"&&h!==null&&o!==null){if(typeof o!="object"||Object.keys(h).length!==Object.keys(o).length)return!1;for(const c in h)if(!A(h[c],o[c]))return!1;return!0}return h===o}var z=V;function V(h){return!function(o){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,v=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(v);try{_=new Worker(T),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(T),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var v=_.getImageData(0,0,1,1);return v&&v.width===p.width}()?(j[c=o&&o.failIfMajorPerformanceCaveat]===void 0&&(j[c]=function(p){var _,v=function(T){var S=document.createElement("canvas"),M=Object.create(V.webGLContextAttributes);return M.failIfMajorPerformanceCaveat=T,S.getContext("webgl",M)||S.getContext("experimental-webgl",M)}(p);if(!v)return!1;try{_=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!_||v.isContextLost())&&(v.shaderSource(_,"void main() {}"),v.compileShader(_),v.getShaderParameter(_,v.COMPILE_STATUS)===!0)}(c)),j[c]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var c}(h)}var j={};function G(h,o,c){const p=s.window.document.createElement(h);return o!==void 0&&(p.className=o),c&&c.appendChild(p),p}function re(h,o,c){const p=s.window.document.createElementNS("http://www.w3.org/2000/svg",h);for(const _ of Object.keys(o))p.setAttributeNS(null,_,o[_]);return c&&c.appendChild(p),p}V.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const he=s.window.document&&s.window.document.documentElement.style,ve=he&&he.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ue;function ae(){he&&ve&&(Ue=he[ve],he[ve]="none")}function J(){he&&ve&&(he[ve]=Ue)}function se(h){h.preventDefault(),h.stopPropagation(),s.window.removeEventListener("click",se,!0)}function oe(){s.window.addEventListener("click",se,!0),s.window.setTimeout(()=>{s.window.removeEventListener("click",se,!0)},0)}function Be(h,o){const c=h.getBoundingClientRect();return He(h,c,o)}function at(h,o){const c=h.getBoundingClientRect(),p=[];for(let _=0;_<o.length;_++)p.push(He(h,c,o[_]));return p}function Ye(h){return s.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function He(h,o,c){const p=h.offsetWidth===o.width?1:h.offsetWidth/o.width;return new s.Point((c.clientX-o.left)*p,(c.clientY-o.top)*p)}function ze(h,o){var c=o[0],p=o[1],_=o[2],v=o[3],T=c*v-_*p;return T?(h[0]=v*(T=1/T),h[1]=-p*T,h[2]=-_*T,h[3]=c*T,h):null}function kt(h){const{userImage:o}=h;return!!(o&&o.render&&o.render())&&(h.data.replace(new Uint8Array(o.data.buffer)),!0)}class dn extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:c,callback:p}of this.requestors)this._notify(c,p);this.requestors=[]}}hasImage(o){return!!this.getImage(o)}getImage(o){return this.images[o]}addImage(o,c){this._validate(o,c)&&(this.images[o]=c)}_validate(o,c){let p=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),p=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),p=!1),this._validateContent(c.content,c)||(this.fire(new s.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),p=!1),p}_validateStretch(o,c){if(!o)return!0;let p=0;for(const _ of o){if(_[0]<p||_[1]<_[0]||c<_[1])return!1;p=_[1]}return!0}_validateContent(o,c){return!(o&&(o.length!==4||o[0]<0||c.data.width<o[0]||o[1]<0||c.data.height<o[1]||o[2]<0||c.data.width<o[2]||o[3]<0||c.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,c){c.version=this.images[o].version+1,this.images[o]=c,this.updatedImages[o]=!0}removeImage(o){const c=this.images[o];delete this.images[o],delete this.patterns[o],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,c){let p=!0;if(!this.isLoaded())for(const _ of o)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(o,c):this.requestors.push({ids:o,callback:c})}_notify(o,c){const p={};for(const _ of o){this.images[_]||this.fire(new s.Event("styleimagemissing",{id:_}));const v=this.images[_];v?p[_]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:s.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,p)}getPixelSize(){const{width:o,height:c}=this.atlasImage;return{width:o,height:c}}getPattern(o){const c=this.patterns[o],p=this.getImage(o);if(!p)return null;if(c&&c.position.version===p.version)return c.position;if(c)c.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},v=new s.ImagePosition(_,p);this.patterns[o]={bin:_,position:v}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const c=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(o,this.atlasImage,c.RGBA),this.atlasTexture&&this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const v in this.patterns)o.push(this.patterns[v].bin);const{w:c,h:p}=s.potpack(o),_=this.atlasImage;_.resize({width:c||1,height:p||1});for(const v in this.patterns){const{bin:T}=this.patterns[v],S=T.x+1,M=T.y+1,D=this.images[v].data,k=D.width,B=D.height;s.RGBAImage.copy(D,_,{x:0,y:0},{x:S,y:M},{width:k,height:B}),s.RGBAImage.copy(D,_,{x:0,y:B-1},{x:S,y:M-1},{width:k,height:1}),s.RGBAImage.copy(D,_,{x:0,y:0},{x:S,y:M+B},{width:k,height:1}),s.RGBAImage.copy(D,_,{x:k-1,y:0},{x:S-1,y:M},{width:1,height:B}),s.RGBAImage.copy(D,_,{x:0,y:0},{x:S+k,y:M},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const c of o){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const p=this.images[c];kt(p)&&this.updateImage(c,p)}}}const gt=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(h,o){return function([c,p,_]){const v=s.degToRad(p+90),T=s.degToRad(_);return{x:c*Math.cos(v)*Math.sin(T),y:c*Math.sin(v)*Math.sin(T),z:c*Math.cos(T),azimuthal:p,polar:_}}(h.expression.evaluate(o))}interpolate(h,o,c){return{x:s.number(h.x,o.x,c),y:s.number(h.y,o.y,c),z:s.number(h.z,o.z,c),azimuthal:s.number(h.azimuthal,o.azimuthal,c),polar:s.number(h.polar,o.polar,c)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)});class Jt extends s.Evented{constructor(o){super(),this._transitionable=new s.Transitionable(gt),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,c={}){if(!this._validate(s.validateLight,o,c))for(const p in o){const _=o[p];s.endsWith(p,"-transition")?this._transitionable.setTransition(p.slice(0,-11),_):this._transitionable.setValue(p,_)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,p){return(!p||p.validate!==!1)&&s.emitValidationErrors(this,o.call(s.validateStyle,s.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const Sn=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)});let un=class extends s.Evented{constructor(h,o){super(),this._transitionable=new s.Transitionable(Sn),this.set(h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o}get(){return this._transitionable.serialize()}set(h){for(const o in h){const c=h[o];s.endsWith(o,"-transition")?this._transitionable.setTransition(o.slice(0,-11),c):this._transitionable.setValue(o,c)}}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}};function Bn(h,o,c,p){const _=s.smoothstep(45,65,c),[v,T]=Xn(h,p),S=s.length(o);let M=1-Math.min(1,Math.exp((S-v)/(T-v)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*_*h.alpha}function Xn(h,o){const c=.5/Math.tan(.5*o);return[h.range[0]+c,h.range[1]+c]}const Xe=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])});class Mt extends s.Evented{constructor(o,c){super(),this._transitionable=new s.Transitionable(Xe),this.set(o),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){const o=this._transform,c=o.projection.name==="globe",p=s.globeToMercatorTransition(o.zoom),_=this.properties.get("range"),v=[.5,3];return{range:c?[s.number(v[0],_[0],p),s.number(v[1],_[1],p)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,c={}){if(!this._validate(s.validateFog,o,c)){for(const p of Object.keys(s.spec.fog))o&&o[p]===void 0&&(o[p]=s.spec.fog[p].default);for(const p in o){const _=o[p];s.endsWith(p,"-transition")?this._transitionable.setTransition(p.slice(0,-11),_):this._transitionable.setValue(p,_)}}}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.smoothstep(45,65,o))*c.a}getOpacityAtLatLng(o,c){return this._transform.projection.supportsFog?function(p,_,v){const T=s.MercatorCoordinate.fromLngLat(_),S=v.elevation?v.elevation.getAtPointOrZero(T):0,M=[T.x,T.y,S];return s.transformMat4(M,M,v.mercatorFogMatrix),Bn(p,M,v.pitch,v._fov)}(this.state,o,c):0}getFovAdjustedRange(o){return this._transform.projection.supportsFog?Xn(this.state,o):[0,1]}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,p){return(!p||p.validate!==!1)&&s.emitValidationErrors(this,o.call(s.validateStyle,s.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class Tt{constructor(o,c){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const v=new Tt.Actor(p[_],c,this.id);v.name=`Worker ${_}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,c,p){s.asyncAll(this.actors,(_,v)=>{_.send(o,c,v)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function wt(h,o,c){return o*(s.EXTENT/(h.tileSize*Math.pow(2,c-h.tileID.overscaledZ)))}Tt.Actor=s.Actor;class nn{constructor(o,c,p,_){this.screenBounds=o,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(o,c){let p,_;if(o instanceof s.Point||typeof o[0]=="number"){const v=s.Point.convert(o);p=[v],_=c.isPointAboveHorizon(v)}else{const v=s.Point.convert(o[0]),T=s.Point.convert(o[1]);p=[v,T],_=s.polygonizeBounds(v,T).every(S=>c.isPointAboveHorizon(S))}return new nn(p,c.getCameraPoint(),_,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return s.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],_=s.polygonizeBounds(c,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<p.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?_[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(_[3]=this.cameraPoint)),s.bufferConvexPolygon(_,o)}bufferedCameraGeometryGlobe(o){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],_=s.polygonizeBounds(c,p,o),v=this.cameraPoint.clone();switch(3*((v.y>c.y)+(v.y>p.y))+((v.x>c.x)+(v.x>p.x))){case 0:_[0]=v,_[4]=v.clone();break;case 1:_.splice(1,0,v);break;case 2:_[1]=v;break;case 3:_.splice(4,0,v);break;case 5:_.splice(2,0,v);break;case 6:_[3]=v;break;case 7:_.splice(3,0,v);break;case 8:_[2]=v}return _}containsTile(o,c,p,_=0){const v=o.queryPadding/c._pixelsPerMercatorPixel+1,T=p?this._bufferedCameraMercator(v,c):this._bufferedScreenMercator(v,c);let S=o.tileID.wrap+(T.unwrapped?_:0);const M=T.polygon.map(Y=>s.getTilePoint(o.tileTransform,Y,S));if(!s.polygonIntersectsBox(M,0,0,s.EXTENT,s.EXTENT))return;S=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const D=this.screenGeometryMercator.polygon.map(Y=>s.getTileVec3(o.tileTransform,Y,S)),k=D.map(Y=>new s.Point(Y[0],Y[1])),B=c.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),$=s.getTileVec3(o.tileTransform,B,S),W=D.map(Y=>{const F=s.sub(Y,Y,$);return s.normalize(F,F),new s.Ray($,F)}),K=wt(o,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:W,bufferedTilespaceGeometry:M,bufferedTilespaceBounds:(H=s.getBounds(M),H.min.x=s.clamp(H.min.x,0,s.EXTENT),H.min.y=s.clamp(H.min.y,0,s.EXTENT),H.max.x=s.clamp(H.max.x,0,s.EXTENT),H.max.y=s.clamp(H.max.y,0,s.EXTENT),H),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:K};var H}_bufferedScreenMercator(o,c){const p=mi(o);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let _;return _=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),c):{polygon:this.bufferedScreenGeometry(o).map(v=>c.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[p]=_,_}}_bufferedCameraMercator(o,c){const p=mi(o);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let _;return _=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),c):{polygon:this.bufferedCameraGeometry(o).map(v=>c.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[p]=_,_}}_projectAndResample(o,c){const p=function(v,T){const S=s.multiply([],T.pixelMatrix,T.globeMatrix),M=[0,-s.GLOBE_RADIUS,0,1],D=[0,s.GLOBE_RADIUS,0,1],k=[0,0,0,1];s.transformMat4$1(M,M,S),s.transformMat4$1(D,D,S),s.transformMat4$1(k,k,S);const B=new s.Point(M[0]/M[3],M[1]/M[3]),$=new s.Point(D[0]/D[3],D[1]/D[3]),W=s.polygonContainsPoint(v,B)&&M[3]<k[3],K=s.polygonContainsPoint(v,$)&&D[3]<k[3];if(!W&&!K)return null;const H=function(ge,be,xe){for(let Me=1;Me<ge.length;Me++){const Qe=Qt(be.pointCoordinate3D(ge[Me-1]).x),Ee=Qt(be.pointCoordinate3D(ge[Me]).x);if(xe<0){if(Qe<Ee)return{idx:Me,t:-Qe/(Ee-1-Qe)}}else if(Ee<Qe)return{idx:Me,t:(1-Qe)/(Ee+1-Qe)}}return null}(v,T,W?-1:1);if(!H)return null;const{idx:Y,t:F}=H;let q=Y>1?fn(v.slice(0,Y),T):[],ne=Y<v.length?fn(v.slice(Y),T):[];q=q.map(ge=>new s.Point(Qt(ge.x),ge.y)),ne=ne.map(ge=>new s.Point(Qt(ge.x),ge.y));const ie=[...q];ie.length===0&&ie.push(ne[ne.length-1]);const me=s.number(ie[ie.length-1].y,(ne.length===0?q[0]:ne[0]).y,F);let ye;return ye=W?[new s.Point(0,me),new s.Point(0,0),new s.Point(1,0),new s.Point(1,me)]:[new s.Point(1,me),new s.Point(1,1),new s.Point(0,1),new s.Point(0,me)],ie.push(...ye),ne.length===0?ie.push(q[0]):ie.push(...ne),{polygon:ie.map(ge=>new s.MercatorCoordinate(ge.x,ge.y)),unwrapped:!1}}(o,c);if(p)return p;const _=function(v,T){let S=!1,M=-1/0,D=0;for(let B=0;B<v.length-1;B++)v[B].x>M&&(M=v[B].x,D=B);for(let B=0;B<v.length-1;B++){const $=(D+B)%(v.length-1),W=v[$],K=v[$+1];Math.abs(W.x-K.x)>.5&&(W.x<K.x?(W.x+=1,$===0&&(v[v.length-1].x+=1)):(K.x+=1,$+1===v.length-1&&(v[0].x+=1)),S=!0)}const k=s.mercatorXfromLng(T.center.lng);return S&&k<Math.abs(k-1)&&v.forEach(B=>{B.x-=1}),{polygon:v,unwrapped:S}}(fn(o,c).map(v=>new s.Point(Qt(v.x),v.y)),c);return{polygon:_.polygon.map(v=>new s.MercatorCoordinate(v.x,v.y)),unwrapped:_.unwrapped}}}function fn(h,o){return s.resample(h,c=>{const p=o.pointCoordinate3D(c);c.x=p.x,c.y=p.y},1/256)}function Qt(h){return h<0?1+h%1:h%1}function mi(h){return 100*h|0}function Un(h,o,c,p,_){const v=function(T,S){if(T)return _(T);if(S){h.url&&S.tiles&&h.tiles&&delete h.tiles;const M=s.pick(s.extend(S,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(M.vectorLayers=S.vector_layers,M.vectorLayerIds=M.vectorLayers.map(D=>D.id)),M.tiles=o.canonicalizeTileset(M,h.url),_(null,M)}};return h.url?s.getJSON(o.transformRequest(o.normalizeSourceURL(h.url,null,c,p),s.ResourceType.Source),v):s.exported.frame(()=>v(null,h))}class gi{constructor(o,c,p){this.bounds=s.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=c||0,this.maxzoom=p||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const c=Math.pow(2,o.z),p=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*c),_=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*c),v=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*c),T=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*c);return o.x>=p&&o.x<v&&o.y>=_&&o.y<T}}class ji{constructor(o,c,p){this.context=o;const _=o.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const cr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ur{constructor(o,c,p,_){this.length=c.length,this.attributes=p,this.itemSize=c.bytesPerElement,this.dynamicDraw=_,this.context=o;const v=o.gl;this.buffer=v.createBuffer(),o.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,c){for(let p=0;p<this.attributes.length;p++){const _=c.attributes[this.attributes[p].name];_!==void 0&&o.enableVertexAttribArray(_)}}setVertexAttribPointers(o,c,p){for(let _=0;_<this.attributes.length;_++){const v=this.attributes[_],T=c.attributes[v.name];T!==void 0&&o.vertexAttribPointer(T,v.components,o[cr[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Lt{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Rr extends Lt{getDefault(){return s.Color.transparent}set(o){const c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class yi extends Lt{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class _s extends Lt{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class pn extends Lt{getDefault(){return[!0,!0,!0,!0]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Gi extends Lt{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Wo extends Lt{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Hi extends Lt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const c=this.current;(o.func!==c.func||o.ref!==c.ref||o.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Mi extends Lt{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Ki extends Lt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=o,this.dirty=!1}}class go extends Lt{getDefault(){return[0,1]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Xo extends Lt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=o,this.dirty=!1}}class Br extends Lt{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Ho extends Lt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.BLEND):c.disable(c.BLEND),this.current=o,this.dirty=!1}}class ys extends Lt{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class _o extends Lt{getDefault(){return s.Color.transparent}set(o){const c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class $i extends Lt{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class vr extends Lt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;o?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=o,this.dirty=!1}}class vs extends Lt{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Kr extends Lt{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let Ko,Yo=class extends Lt{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class yo extends Lt{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Le extends Lt{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Ve extends Lt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class ot extends Lt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class vt extends Lt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Ut extends Lt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class ee extends Lt{getDefault(){return null}set(o){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class U extends Lt{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class N extends Lt{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class X extends Lt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class ce extends Lt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class de extends Lt{constructor(o,c){super(o),this.context=o,this.parent=c}getDefault(){return null}}class Te extends de{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class we extends de{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class _e extends we{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ce{constructor(o,c,p,_){this.context=o,this.width=c,this.height=p;const v=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new Te(o,v),_&&(this.depthAttachment=new we(o,v))}destroy(){const o=this.context.gl,c=this.colorAttachment.get();if(c&&o.deleteTexture(c),this.depthAttachment){const p=this.depthAttachment.get();p&&o.deleteRenderbuffer(p)}o.deleteFramebuffer(this.framebuffer)}}class nt{constructor(o,c=!1){if(this.gl=o,this.isWebGL2=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),c){const p=o;this.extVertexArrayObject={createVertexArrayOES:p.createVertexArray.bind(o),deleteVertexArrayOES:p.deleteVertexArray.bind(o),bindVertexArrayOES:p.bindVertexArray.bind(o)}}this.clearColor=new Rr(this),this.clearDepth=new yi(this),this.clearStencil=new _s(this),this.colorMask=new pn(this),this.depthMask=new Gi(this),this.stencilMask=new Wo(this),this.stencilFunc=new Hi(this),this.stencilOp=new Mi(this),this.stencilTest=new Ki(this),this.depthRange=new go(this),this.depthTest=new Xo(this),this.depthFunc=new Br(this),this.blend=new Ho(this),this.blendFunc=new ys(this),this.blendColor=new _o(this),this.blendEquation=new $i(this),this.cullFace=new vr(this),this.cullFaceSide=new vs(this),this.frontFace=new Kr(this),this.program=new Yo(this),this.activeTexture=new yo(this),this.viewport=new Le(this),this.bindFramebuffer=new Ve(this),this.bindRenderbuffer=new ot(this),this.bindTexture=new vt(this),this.bindVertexBuffer=new Ut(this),this.bindElementBuffer=new ee(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new U(this),this.pixelStoreUnpack=new N(this),this.pixelStoreUnpackPremultiplyAlpha=new X(this),this.pixelStoreUnpackFlipY=new ce(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),c||(this.extTextureHalfFloat=o.getExtension("OES_texture_half_float")),(c||this.extTextureHalfFloat&&o.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=c||o.getExtension("OES_standard_derivatives"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,c){return new ji(this,o,c)}createVertexBuffer(o,c,p){return new ur(this,o,c,p)}createRenderbuffer(o,c,p){const _=this.gl,v=_.createRenderbuffer();return this.bindRenderbuffer.set(v),_.renderbufferStorage(_.RENDERBUFFER,o,c,p),this.bindRenderbuffer.set(null),v}createFramebuffer(o,c,p){return new Ce(this,o,c,p)}clear({color:o,depth:c,stencil:p}){const _=this.gl;let v=0;o&&(v|=_.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(v|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p!==void 0&&(v|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),_.clear(v)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){A(o.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class lt extends s.Evented{constructor(o,c,p,_){if(super(),this.id=o,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(c,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(o){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map._worldview;this._tileJSONRequest=Un(this._options,this.map._requestManager,c,p,(_,v)=>{this._tileJSONRequest=null,this._loaded=!0,_?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),p&&p.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new s.ErrorEvent(_))):v&&(s.extend(this,v),v.bounds&&(this.tileBounds=new gi(v.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(v.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),o&&o(_)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}loadTile(o,c){const p=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(p,s.ResourceType.Tile),data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile};if(_.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=c:o.request=o.actor.send("reloadTile",_,v.bind(this));else if(o.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",_,v.bind(this),void 0,!0);else{const T=s.loadVectorTile.call({deduped:this._deduped},_,(S,M)=>{S||!M?v.call(this,S):(_.data={cacheControl:M.cacheControl,expires:M.expires,rawData:M.rawData.slice(0)},o.actor&&o.actor.send("loadTile",_,v.bind(this),void 0,!0))},!0);o.request={cancel:T}}function v(T,S){return delete o.request,o.aborted?c(null):T&&T.status!==404?c(T):(S&&S.resourceTiming&&(o.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&o.setExpiryData(S),o.loadVectorData(S,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),c(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id})}unloadTile(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Je extends s.Evented{constructor(o,c,p,_){super(),this.id=o,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},c),s.extend(this,s.pick(c,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Un(this._options,this.map._requestManager,null,null,(c,p)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new s.ErrorEvent(c)):p&&(s.extend(this,p),p.bounds&&(this.tileBounds=new gi(p.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(p.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),o&&o(c)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,c){const p=s.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);o.request=s.getImage(this.map._requestManager.transformRequest(_,s.ResourceType.Tile),(v,T,S,M)=>(delete o.request,o.aborted?(o.state="unloaded",c(null)):v?(o.state="errored",c(v)):T?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:S,expires:M}),o.setTexture(T,this.map.painter),o.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void c(null)):c(null)))}static loadTileData(o,c,p){o.setTexture(c,p)}static unloadTileData(o,c){o.texture&&c.saveTileTexture(o.texture)}abortTile(o,c){o.request&&(o.request.cancel(),delete o.request),c()}unloadTile(o,c){o.texture&&this.map.painter.saveTileTexture(o.texture),c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function It(h,o,c,p,_,v,T,S){const M=[h,c,_,o,p,v,1,1,1],D=[T,S,1],k=s.adjoint([],M),[B,$,W]=s.transformMat3(D,D,s.transpose(k,k));return s.multiply$1(M,[B,0,0,0,$,0,0,0,W],M)}class Rt extends s.Evented{constructor(o,c,p,_){super(),this.id=o,this.dispatcher=p,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=c,this._dirty=!1}load(o,c){this._loaded=c||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(p,_)=>{if(this._imageRequest=null,this._loaded=!0,p)this.fire(new s.ErrorEvent(p));else if(_){const{HTMLImageElement:v}=s.window;this.image=_ instanceof v?s.exported.getImageData(_):_,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading()}})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this._imageRequest&&o.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=o.url,this.load(o.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(o){this.coordinates=o,this._boundsArray=void 0;const c=o.map(s.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let _=1/0,v=1/0,T=-1/0,S=-1/0;for(const B of p)_=Math.min(_,B.x),v=Math.min(v,B.y),T=Math.max(T,B.x),S=Math.max(S,B.y);const M=Math.max(T-_,S-v),D=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),k=Math.pow(2,D);return new s.CanonicalTileID(D,Math.floor((_+T)/2*k),Math.floor((v+S)/2*k))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(o){for(const M in this.tiles){const D=this.tiles[M];D.state!=="loaded"&&(D.state="loaded",D.texture=this.texture)}if(this._boundsArray)return;const c=s.tileTransform(this.tileID,this.map.transform.projection),[p,_,v,T]=this.coordinates.map(M=>{const D=c.projection.project(M[0],M[1]);return s.getTilePoint(c,D)._round()});this.perspectiveTransform=function(M,D,k,B,$,W,K,H,Y,F){const q=It(0,0,M,0,0,D,M,D),ne=It(k,B,$,W,K,H,Y,F);return s.multiply$1(ne,s.adjoint(q,q),ne),[ne[6]/ne[8]*M/s.EXTENT,ne[7]/ne[8]*D/s.EXTENT]}(this.width,this.height,p.x,p.y,_.x,_.y,T.x,T.y,v.x,v.y);const S=this._boundsArray=new s.StructArrayLayout4i8;S.emplaceBack(p.x,p.y,0,0),S.emplaceBack(_.x,_.y,s.EXTENT,0),S.emplaceBack(T.x,T.y,0,s.EXTENT),S.emplaceBack(v.x,v.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=o.createVertexBuffer(S,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,c=o.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new s.Texture(o,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(o)}loadTile(o,c){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},c(null)):(o.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Dt={vector:lt,raster:Je,"raster-dem":class extends Je{constructor(h,o,c,p){super(h,o,c,p),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(h,o){const c=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(_,v){_&&(h.state="errored",o(_)),v&&(h.dem=v,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",o(null))}h.request=s.getImage(this.map._requestManager.transformRequest(c,s.ResourceType.Tile),function(_,v,T,S){if(delete h.request,h.aborted)h.state="unloaded",o(null);else if(_)h.state="errored",o(_);else if(v){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:T,expires:S});const M=s.window.ImageBitmap&&v instanceof s.window.ImageBitmap&&(Ko==null&&(Ko=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&typeof s.window.createImageBitmap=="function"),Ko),D=1-(v.width-s.prevPowerOfTwo(v.width))/2;D<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const k=M?v:s.exported.getImageData(v,D),B={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:k,encoding:this.encoding,padding:D};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",B,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(h){const o=h.canonical,c=Math.pow(2,o.z),p=(o.x-1+c)%c,_=o.x===0?h.wrap-1:h.wrap,v=(o.x+1+c)%c,T=o.x+1===c?h.wrap+1:h.wrap,S={};return S[new s.OverscaledTileID(h.overscaledZ,_,o.z,p,o.y).key]={backfilled:!1},S[new s.OverscaledTileID(h.overscaledZ,T,o.z,v,o.y).key]={backfilled:!1},o.y>0&&(S[new s.OverscaledTileID(h.overscaledZ,_,o.z,p,o.y-1).key]={backfilled:!1},S[new s.OverscaledTileID(h.overscaledZ,h.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},S[new s.OverscaledTileID(h.overscaledZ,T,o.z,v,o.y-1).key]={backfilled:!1}),o.y+1<c&&(S[new s.OverscaledTileID(h.overscaledZ,_,o.z,p,o.y+1).key]={backfilled:!1},S[new s.OverscaledTileID(h.overscaledZ,h.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},S[new s.OverscaledTileID(h.overscaledZ,T,o.z,v,o.y+1).key]={backfilled:!1}),S}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded"}},geojson:class extends s.Evented{constructor(h,o,c,p){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(p),this._data=o.data,this._options=s.extend({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const _=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*_,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*_,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:s.EXTENT,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*_,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},o),this}getClusterChildren(h,o){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},o),this}getClusterLeaves(h,o,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:o,offset:c},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const h=s.extend({},this.workerOptions),o=this._data;typeof o=="string"?(h.request=this.map._requestManager.transformRequest(s.exported.resolveURL(o),s.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(c,p)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new s.ErrorEvent(c));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(_.resourceTiming=p.resourceTiming[this.id]),this.fire(new s.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,o){const c=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(c,{type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,_)=>(delete h.request,h.unloadVectorData(),h.aborted?o(null):p?o(p):(h.loadVectorData(_,this.map.painter,c==="reloadTile"),o(null))),void 0,c==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Rt{constructor(h,o,c,p){super(h,o,c,p),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const o of h.urls)this.urls.push(this.map._requestManager.transformRequest(o,s.ResourceType.Source).url);s.getVideo(this.urls,(o,c)=>{this._loaded=!0,o?this.fire(new s.ErrorEvent(o)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const o=this.video.seekable;h<o.start(0)||h>o.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,o=h.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(h,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Rt,canvas:class extends Rt{constructor(h,o,c,p){super(h,o,c,p),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(v=>typeof v!="number"))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(o,this.canvas,o.gl.RGBA,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends s.Evented{constructor(h,o,c,p){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=o,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new gi(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:o,y:c,z:p}=h.canonical;return this._implementation.hasTile({x:o,y:c,z:p})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,o){const{x:c,y:p,z:_}=h.tileID.canonical,v=new s.window.AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:c,y:p,z:_},{signal:v.signal})).then(function(T){return delete h.request,h.aborted?(h.state="unloaded",o(null)):T===void 0?(h.state="errored",o(null)):T===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",o(null)):function(S){return S instanceof s.window.ImageData||S instanceof s.window.HTMLCanvasElement||S instanceof s.window.ImageBitmap||S instanceof s.window.HTMLImageElement}(T)?(this.loadTileData(h,T),h.state="loaded",void o(null)):(h.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(T=>{T.code!==20&&(h.state="errored",o(T))}),h.request.cancel=()=>v.abort()}loadTileData(h,o){Je.loadTileData(h,o,this._map.painter)}unloadTileData(h){Je.unloadTileData(h,this._map.painter)}unloadTile(h,o){if(this.unloadTileData(h),this._implementation.unloadTile){const{x:c,y:p,z:_}=h.tileID.canonical;this._implementation.unloadTile({x:c,y:p,z:_})}o()}abortTile(h,o){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),o()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Vt=function(h,o,c,p){const _=new Dt[o.type](h,o,c,p);if(_.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${_.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],_),_};function Zt(h,o){const c=s.identity([]);return s.scale(c,c,[.5*h.width,.5*-h.height,1]),s.translate(c,c,[1,-1,0]),s.multiply(c,c,h.calculateProjMatrix(o.toUnwrapped())),Float32Array.from(c)}function gn(h,o,c,p,_,v,T,S=!1){const M=h.tilesIn(p,T,S);M.sort(Cn);const D=[];for(const B of M)D.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(o,c,h._state,B,_,v,Zt(h.transform,B.tile.tileID),S)});const k=function(B){const $={},W={};for(const K of B){const H=K.queryResults,Y=K.wrappedTileID,F=W[Y]=W[Y]||{};for(const q in H){const ne=H[q],ie=F[q]=F[q]||{},me=$[q]=$[q]||[];for(const ye of ne)ie[ye.featureIndex]||(ie[ye.featureIndex]=!0,me.push(ye))}}return $}(D);for(const B in k)k[B].forEach($=>{const W=$.feature,K=W.layer;K&&K.type!=="background"&&K.type!=="sky"&&(W.source=K.source,K["source-layer"]&&(W.sourceLayer=K["source-layer"]),W.state=W.id!==void 0?h.getFeatureState(K["source-layer"],W.id):{})});return k}function $t(h,o){const c=h.getRenderableIds().map(v=>h.getTileByID(v)),p=[],_={};for(let v=0;v<c.length;v++){const T=c[v],S=T.tileID.canonical.key;_[S]||(_[S]=!0,T.querySourceFeatures(p,o))}return p}function Cn(h,o){const c=h.tileID,p=o.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}function zn(){return _a.workerClass!=null?new _a.workerClass:new s.window.Worker(_a.workerUrl)}const kn="mapboxgl_preloaded_worker_pool";class Nn{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Nn.workerCount;)this.workers.push(new zn);return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[kn]}numActive(){return Object.keys(this.active).length}}let vi;function Jo(){return vi||(vi=new Nn),vi}function l_(h,o){const c={};for(const p in h)p!=="ref"&&(c[p]=h[p]);return s.refProperties.forEach(p=>{p in o&&(c[p]=o[p])}),c}function $f(h){h=h.slice();const o=Object.create(null);for(let c=0;c<h.length;c++)o[h[c].id]=h[c];for(let c=0;c<h.length;c++)"ref"in h[c]&&(h[c]=l_(h[c],o[h[c].ref]));return h}Nn.workerCount=2;const an={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function eh(h,o,c){c.push({command:an.addSource,args:[h,o[h]]})}function nl(h,o,c){o.push({command:an.removeSource,args:[h]}),c[h]=!0}function th(h,o,c,p){nl(h,c,p),eh(h,o,c)}function pc(h,o,c){let p;for(p in h[c])if(h[c].hasOwnProperty(p)&&p!=="data"&&!A(h[c][p],o[c][p]))return!1;for(p in o[c])if(o[c].hasOwnProperty(p)&&p!=="data"&&!A(h[c][p],o[c][p]))return!1;return!0}function Yr(h,o,c,p,_,v){let T;for(T in o=o||{},h=h||{})h.hasOwnProperty(T)&&(A(h[T],o[T])||c.push({command:v,args:[p,T,o[T],_]}));for(T in o)o.hasOwnProperty(T)&&!h.hasOwnProperty(T)&&(A(h[T],o[T])||c.push({command:v,args:[p,T,o[T],_]}))}function vo(h){return h.id}function nh(h,o){return h[o.id]=o,h}class ih{constructor(o,c){this.reset(o,c)}reset(o,c){this.points=o||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=s.clamp(o,0,1);let c=1,p=this._distances[c];const _=o*this.paddedLength+this.padding;for(;p<_&&c<this._distances.length;)p=this._distances[++c];const v=c-1,T=this._distances[v],S=p-T,M=S>0?(_-T)/S:0;return this.points[v].mult(1-M).add(this.points[c].mult(M))}}class xs{constructor(o,c,p){const _=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(o/p),this.yCellCount=Math.ceil(c/p);for(let T=0;T<this.xCellCount*this.yCellCount;T++)_.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=c,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,c,p,_,v){this._forEachCell(c,p,_,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(v)}insertCircle(o,c,p,_){this._forEachCell(c-_,p-_,c+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(c),this.circles.push(p),this.circles.push(_)}_insertBoxCell(o,c,p,_,v,T){this.boxCells[v].push(T)}_insertCircleCell(o,c,p,_,v,T){this.circleCells[v].push(T)}_query(o,c,p,_,v,T){if(p<0||o>this.width||_<0||c>this.height)return!v&&[];const S=[];if(o<=0&&c<=0&&this.width<=p&&this.height<=_){if(v)return!0;for(let M=0;M<this.boxKeys.length;M++)S.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const D=this.circles[3*M],k=this.circles[3*M+1],B=this.circles[3*M+2];S.push({key:this.circleKeys[M],x1:D-B,y1:k-B,x2:D+B,y2:k+B})}return T?S.filter(T):S}return this._forEachCell(o,c,p,_,this._queryCell,S,{hitTest:v,seenUids:{box:{},circle:{}}},T),v?S.length>0:S}_queryCircle(o,c,p,_,v){const T=o-p,S=o+p,M=c-p,D=c+p;if(S<0||T>this.width||D<0||M>this.height)return!_&&[];const k=[];return this._forEachCell(T,M,S,D,this._queryCellCircle,k,{hitTest:_,circle:{x:o,y:c,radius:p},seenUids:{box:{},circle:{}}},v),_?k.length>0:k}query(o,c,p,_,v){return this._query(o,c,p,_,!1,v)}hitTest(o,c,p,_,v){return this._query(o,c,p,_,!0,v)}hitTestCircle(o,c,p,_){return this._queryCircle(o,c,p,!0,_)}_queryCell(o,c,p,_,v,T,S,M){const D=S.seenUids,k=this.boxCells[v];if(k!==null){const $=this.bboxes;for(const W of k)if(!D.box[W]){D.box[W]=!0;const K=4*W;if(o<=$[K+2]&&c<=$[K+3]&&p>=$[K+0]&&_>=$[K+1]&&(!M||M(this.boxKeys[W]))){if(S.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[W],x1:$[K],y1:$[K+1],x2:$[K+2],y2:$[K+3]})}}}const B=this.circleCells[v];if(B!==null){const $=this.circles;for(const W of B)if(!D.circle[W]){D.circle[W]=!0;const K=3*W;if(this._circleAndRectCollide($[K],$[K+1],$[K+2],o,c,p,_)&&(!M||M(this.circleKeys[W]))){if(S.hitTest)return T.push(!0),!0;{const H=$[K],Y=$[K+1],F=$[K+2];T.push({key:this.circleKeys[W],x1:H-F,y1:Y-F,x2:H+F,y2:Y+F})}}}}}_queryCellCircle(o,c,p,_,v,T,S,M){const D=S.circle,k=S.seenUids,B=this.boxCells[v];if(B!==null){const W=this.bboxes;for(const K of B)if(!k.box[K]){k.box[K]=!0;const H=4*K;if(this._circleAndRectCollide(D.x,D.y,D.radius,W[H+0],W[H+1],W[H+2],W[H+3])&&(!M||M(this.boxKeys[K])))return T.push(!0),!0}}const $=this.circleCells[v];if($!==null){const W=this.circles;for(const K of $)if(!k.circle[K]){k.circle[K]=!0;const H=3*K;if(this._circlesCollide(W[H],W[H+1],W[H+2],D.x,D.y,D.radius)&&(!M||M(this.circleKeys[K])))return T.push(!0),!0}}}_forEachCell(o,c,p,_,v,T,S,M){const D=this._convertToXCellCoord(o),k=this._convertToYCellCoord(c),B=this._convertToXCellCoord(p),$=this._convertToYCellCoord(_);for(let W=D;W<=B;W++)for(let K=k;K<=$;K++)if(v.call(this,o,c,p,_,this.xCellCount*K+W,T,S,M))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,c,p,_,v,T){const S=_-o,M=v-c,D=p+T;return D*D>S*S+M*M}_circleAndRectCollide(o,c,p,_,v,T,S){const M=(T-_)/2,D=Math.abs(o-(_+M));if(D>M+p)return!1;const k=(S-v)/2,B=Math.abs(c-(v+k));if(B>k+p)return!1;if(D<=M||B<=k)return!0;const $=D-M,W=B-k;return $*$+W*W<=p*p}}const xo={unknown:0,flipRequired:1,flipNotRequired:2},il=Math.tan(85*Math.PI/180);function Fe(h,o,c,p,_,v,T){const S=s.create();if(c)if(v.name==="globe"){const M=s.calculateGlobeLabelMatrix(_,o);s.multiply(S,S,M)}else{const M=ze([],T);S[0]=M[0],S[1]=M[1],S[4]=M[2],S[5]=M[3],p||s.rotateZ(S,S,_.angle)}else s.multiply(S,_.labelPlaneMatrix,h);return S}function wo(h,o,c,p,_,v,T){const S=Fe(h,o,c,p,_,v,T);return v.name==="globe"&&c||(S[2]=S[6]=S[10]=S[14]=0),S}function ei(h,o,c,p,_,v,T){if(c){if(v.name==="globe"){const S=Fe(h,o,c,p,_,v,T);return s.invert(S,S),s.multiply(S,h,S),S}{const S=s.clone(h),M=s.identity([]);return M[0]=T[0],M[1]=T[1],M[4]=T[2],M[5]=T[3],s.multiply(S,S,M),p||s.rotateZ(S,S,-_.angle),S}}return _.glCoordMatrix}function xi(h,o,c,p){const _=[h,o,c,1];c?s.transformMat4$1(_,_,p):Xt(_,_,p);const v=_[3];return _[0]/=v,_[1]/=v,_[2]/=v,_}function Zf(h,o){return Math.min(.5+h/o*.5,1.5)}function Jr(h,o){const c=h[0]/h[3],p=h[1]/h[3];return c>=-o[0]&&c<=o[0]&&p>=-o[1]&&p<=o[1]}function rh(h,o,c,p,_,v,T,S,M,D){const k=c.transform,B=p?h.textSizeData:h.iconSizeData,$=s.evaluateSizeForZoom(B,c.transform.zoom),W=k.projection.name==="globe",K=[256/c.width*2+1,256/c.height*2+1],H=p?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;H.clear();let Y=null;W&&(Y=p?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const F=h.lineVertexArray,q=p?h.text.placedSymbolArray:h.icon.placedSymbolArray,ne=c.transform.width/c.transform.height;let ie,me=!1;for(let ye=0;ye<q.length;ye++){const ge=q.get(ye),{numGlyphs:be,writingMode:xe}=ge;if(xe!==s.WritingMode.vertical||me||ie===s.WritingMode.horizontal||(me=!0),ie=xe,(ge.hidden||xe===s.WritingMode.vertical)&&!me){Fr(be,H);continue}me=!1;const Me=new s.Point(ge.tileAnchorX,ge.tileAnchorY);let{x:Qe,y:Ee,z:je}=k.projection.projectTilePoint(Me.x,Me.y,D.canonical);if(M){const[zt,_t,At]=M(Me);Qe+=zt,Ee+=_t,je+=At}const Ie=[Qe,Ee,je,1];if(s.transformMat4$1(Ie,Ie,o),!Jr(Ie,K)){Fr(be,H);continue}const Ke=Zf(c.transform.cameraToCenterDistance,Ie[3]),Ae=s.evaluateSizeForFeature(B,$,ge),Ne=T?Ae/Ke:Ae*Ke,tt=xi(Qe,Ee,je,_);if(tt[3]<=0){Fr(be,H);continue}let Ze={};const it=T?null:M,bt=ft(ge,Ne,!1,S,o,_,v,h.glyphOffsetArray,F,H,Y,tt,Me,Ze,ne,it,k.projection,D,T);me=bt.useVertical,it&&bt.needsFlipping&&(Ze={}),(bt.notEnoughRoom||me||bt.needsFlipping&&ft(ge,Ne,!0,S,o,_,v,h.glyphOffsetArray,F,H,Y,tt,Me,Ze,ne,it,k.projection,D,T).notEnoughRoom)&&Fr(be,H)}p?(h.text.dynamicLayoutVertexBuffer.updateData(H),Y&&h.text.globeExtVertexBuffer.updateData(Y)):(h.icon.dynamicLayoutVertexBuffer.updateData(H),Y&&h.icon.globeExtVertexBuffer.updateData(Y))}function qf(h,o,c,p,_,v,T,S,M,D,k,B,$,W,K,H){const{lineStartIndex:Y,glyphStartIndex:F,segment:q}=S,ne=F+S.numGlyphs,ie=Y+S.lineLength,me=o.getoffsetX(F),ye=o.getoffsetX(ne-1),ge=hr(h*me,c,p,_,v,T,q,Y,ie,M,D,k,B,$,!0,W,K,H);if(!ge)return null;const be=hr(h*ye,c,p,_,v,T,q,Y,ie,M,D,k,B,$,!0,W,K,H);return be?{first:ge,last:be}:null}function ea(h,o,c,p){return h===s.WritingMode.horizontal&&Math.abs(p)>Math.abs(c)?{useVertical:!0}:h===s.WritingMode.vertical?p>0?{needsFlipping:!0}:null:o!==xo.unknown&&function(_,v){return _===0||Math.abs(v/_)>il}(c,p)?o===xo.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function ft(h,o,c,p,_,v,T,S,M,D,k,B,$,W,K,H,Y,F,q){const ne=o/24,ie=h.lineOffsetX*ne,me=h.lineOffsetY*ne,{lineStartIndex:ye,glyphStartIndex:ge,numGlyphs:be,segment:xe,writingMode:Me,flipState:Qe}=h,Ee=ye+h.lineLength,je=Ie=>{if(k){const[tt,Ze,it]=Ie.up,bt=D.length;s.updateGlobeVertexNormal(k,bt+0,tt,Ze,it),s.updateGlobeVertexNormal(k,bt+1,tt,Ze,it),s.updateGlobeVertexNormal(k,bt+2,tt,Ze,it),s.updateGlobeVertexNormal(k,bt+3,tt,Ze,it)}const[Ke,Ae,Ne]=Ie.point;s.addDynamicAttributes(D,Ke,Ae,Ne,Ie.angle)};if(be>1){const Ie=qf(ne,S,ie,me,c,B,$,h,M,v,W,H,!1,Y,F,q);if(!Ie)return{notEnoughRoom:!0};if(p&&!c){let[Ke,Ae,Ne]=Ie.first.point,[tt,Ze,it]=Ie.last.point;[Ke,Ae]=xi(Ke,Ae,Ne,T),[tt,Ze]=xi(tt,Ze,it,T);const bt=ea(Me,Qe,(tt-Ke)*K,Ze-Ae);if(h.flipState=bt&&bt.needsFlipping?xo.flipRequired:xo.flipNotRequired,bt)return bt}je(Ie.first);for(let Ke=ge+1;Ke<ge+be-1;Ke++){const Ae=hr(ne*S.getoffsetX(Ke),ie,me,c,B,$,xe,ye,Ee,M,v,W,H,!1,!1,Y,F,q);if(!Ae)return D.length-=4*(Ke-ge),{notEnoughRoom:!0};je(Ae)}je(Ie.last)}else{if(p&&!c){const Ke=xi($.x,$.y,0,_),Ae=ye+xe+1,Ne=new s.Point(M.getx(Ae),M.gety(Ae)),tt=xi(Ne.x,Ne.y,0,_),Ze=tt[3]>0?tt:Wt($,Ne,Ke,1,_,void 0,Y,F.canonical),it=ea(Me,Qe,(Ze[0]-Ke[0])*K,Ze[1]-Ke[1]);if(h.flipState=it&&it.needsFlipping?xo.flipRequired:xo.flipNotRequired,it)return it}const Ie=hr(ne*S.getoffsetX(ge),ie,me,c,B,$,xe,ye,Ee,M,v,W,H,!1,!1,Y,F,q);if(!Ie)return{notEnoughRoom:!0};je(Ie)}return{}}function Kt(h,o,c,p,_){const{x:v,y:T,z:S}=p.projectTilePoint(h.x,h.y,o);if(!_)return xi(v,T,S,c);const[M,D,k]=_(h);return xi(v+M,T+D,S+k,c)}function Wt(h,o,c,p,_,v,T,S){const M=Kt(h.sub(o)._unit()._add(h),S,_,T,v);return s.sub(M,c,M),s.normalize(M,M),s.scaleAndAdd(M,c,M,p)}function hr(h,o,c,p,_,v,T,S,M,D,k,B,$,W,K,H,Y,F){const q=p?h-o:h+o;let ne=q>0?1:-1,ie=0;p&&(ne*=-1,ie=Math.PI),ne<0&&(ie+=Math.PI);let me=S+T+(ne>0?0:1)|0,ye=_,ge=_,be=0,xe=0;const Me=Math.abs(q),Qe=[],Ee=[];let je=v,Ie=je;const Ke=()=>Wt(Ie,je,ge,Me-be+1,k,$,H,Y.canonical);for(;be+xe<=Me;){if(me+=ne,me<S||me>=M)return null;if(ge=ye,Ie=je,Qe.push(ge),W&&Ee.push(Ie),je=new s.Point(D.getx(me),D.gety(me)),ye=B[me],!ye){const At=Kt(je,Y.canonical,k,H,$);ye=At[3]>0?B[me]=At:Ke()}be+=xe,xe=s.distance(ge,ye)}K&&$&&(B[me]&&(ye=Ke(),xe=s.distance(ge,ye)),B[me]=ye);const Ae=(Me-be)/xe,Ne=je.sub(Ie)._mult(Ae)._add(Ie),tt=s.sub([],ye,ge),Ze=s.scaleAndAdd([],ge,tt,Ae);let it=[0,0,1],bt=tt[0],zt=tt[1];if(F&&(it=H.upVector(Y.canonical,Ne.x,Ne.y),it[0]!==0||it[1]!==0||it[2]!==1)){const At=[it[2],0,-it[0]],Ht=s.cross([],it,At);s.normalize(At,At),s.normalize(Ht,Ht),bt=s.dot(tt,At),zt=s.dot(tt,Ht)}if(c){const At=s.cross([],it,tt);s.normalize(At,At),s.scaleAndAdd(Ze,Ze,At,c*ne)}const _t=ie+Math.atan2(zt,bt);return Qe.push(Ze),W&&Ee.push(Ne),{point:Ze,angle:_t,path:Qe,tilePath:Ee,up:it}}function Fr(h,o){const c=o.length,p=c+4*h;o.resize(p),o.float32.fill(-1/0,4*c,4*p)}function Xt(h,o,c){const p=o[0],_=o[1];return h[0]=c[0]*p+c[4]*_+c[12],h[1]=c[1]*p+c[5]*_+c[13],h[3]=c[3]*p+c[7]*_+c[15],h}const dr=100;class rl{constructor(o,c,p=new xs(o.width+200,o.height+200,25),_=new xs(o.width+200,o.height+200,25)){this.transform=o,this.grid=p,this.ignoredGrid=_,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+dr,this.screenBottomBoundary=o.height+dr,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=c}placeCollisionBox(o,c,p,_,v,T,S,M){let D=p.projectedAnchorX,k=p.projectedAnchorY,B=p.projectedAnchorZ;const $=p.elevation,W=p.tileID,K=o.getProjection();if($&&W){const[ye,ge,be]=K.upVector(W.canonical,p.tileAnchorX,p.tileAnchorY),xe=K.upVectorScale(W.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=ye*$*xe,k+=ge*$*xe,B+=be*$*xe}const H=this.projectAndGetPerspectiveRatio(S,D,k,B,p.tileID,K.name==="globe"||!!$||this.transform.pitch>0,K),Y=T*H.perspectiveRatio,F=(p.x1*c+_.x-p.padding)*Y+H.point.x,q=(p.y1*c+_.y-p.padding)*Y+H.point.y,ne=(p.x2*c+_.x+p.padding)*Y+H.point.x,ie=(p.y2*c+_.y+p.padding)*Y+H.point.y,me=H.perspectiveRatio<=.55||H.occluded;return!this.isInsideGrid(F,q,ne,ie)||!v&&this.grid.hitTest(F,q,ne,ie,M)||me?{box:[],offscreen:!1,occluded:H.occluded}:{box:[F,q,ne,ie],offscreen:this.isOffscreen(F,q,ne,ie),occluded:!1}}placeCollisionCircles(o,c,p,_,v,T,S,M,D,k,B,$,W,K,H){const Y=[],F=this.transform.elevation,q=o.getProjection(),ne=F?F.getAtTileOffsetFunc(H,this.transform.center.lat,this.transform.worldSize,q):null,ie=new s.Point(p.tileAnchorX,p.tileAnchorY);let{x:me,y:ye,z:ge}=q.projectTilePoint(ie.x,ie.y,H.canonical);if(ne){const[Ne,tt,Ze]=ne(ie);me+=Ne,ye+=tt,ge+=Ze}const be=q.name==="globe",xe=this.projectAndGetPerspectiveRatio(S,me,ye,ge,H,be||!!F||this.transform.pitch>0,q),{perspectiveRatio:Me}=xe,Qe=(B?T/Me:T*Me)/s.ONE_EM,Ee=xi(me,ye,ge,M),je=xe.signedDistanceFromCamera>0?qf(Qe,v,p.lineOffsetX*Qe,p.lineOffsetY*Qe,!1,Ee,ie,p,_,M,{},F&&!B?ne:null,B&&!!F,q,H,B):null;let Ie=!1,Ke=!1,Ae=!0;if(je&&!xe.occluded){const Ne=.5*W*Me+K,tt=new s.Point(-100,-100),Ze=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),it=new ih,{first:bt,last:zt}=je,_t=bt.path.length;let At=[];for(let xt=_t-1;xt>=1;xt--)At.push(bt.path[xt]);for(let xt=1;xt<zt.path.length;xt++)At.push(zt.path[xt]);const Ht=2.5*Ne;D&&(At=At.map(([xt,hn,_n],yn)=>(ne&&!be&&(_n=ne(yn<_t-1?bt.tilePath[_t-1-yn]:zt.tilePath[yn-_t+2])[2]),xi(xt,hn,_n,D))),At.some(xt=>xt[3]<=0)&&(At=[]));let qt=[];if(At.length>0){let xt=1/0,hn=-1/0,_n=1/0,yn=-1/0;for(const vn of At)xt=Math.min(xt,vn[0]),_n=Math.min(_n,vn[1]),hn=Math.max(hn,vn[0]),yn=Math.max(yn,vn[1]);hn>=tt.x&&xt<=Ze.x&&yn>=tt.y&&_n<=Ze.y&&(qt=[At.map(vn=>new s.Point(vn[0],vn[1]))],(xt<tt.x||hn>Ze.x||_n<tt.y||yn>Ze.y)&&(qt=s.clipLine(qt,tt.x,tt.y,Ze.x,Ze.y)))}for(const xt of qt){it.reset(xt,.25*Ne);let hn=0;hn=it.length<=.5*Ne?1:Math.ceil(it.paddedLength/Ht)+1;for(let _n=0;_n<hn;_n++){const yn=_n/Math.max(hn-1,1),vn=it.lerp(yn),Fi=vn.x+dr,bi=vn.y+dr;Y.push(Fi,bi,Ne,0);const Er=Fi-Ne,no=bi-Ne,On=Fi+Ne,xn=bi+Ne;if(Ae=Ae&&this.isOffscreen(Er,no,On,xn),Ke=Ke||this.isInsideGrid(Er,no,On,xn),!c&&this.grid.hitTestCircle(Fi,bi,Ne,$)&&(Ie=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Ie,occluded:!1}}}}return{circles:!k&&Ie||!Ke?[]:Y,offscreen:Ae,collisionDetected:Ie,occluded:xe.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let p=1/0,_=1/0,v=-1/0,T=-1/0;for(const k of o){const B=new s.Point(k.x+dr,k.y+dr);p=Math.min(p,B.x),_=Math.min(_,B.y),v=Math.max(v,B.x),T=Math.max(T,B.y),c.push(B)}const S=this.grid.query(p,_,v,T).concat(this.ignoredGrid.query(p,_,v,T)),M={},D={};for(const k of S){const B=k.key;if(M[B.bucketInstanceId]===void 0&&(M[B.bucketInstanceId]={}),M[B.bucketInstanceId][B.featureIndex])continue;const $=[new s.Point(k.x1,k.y1),new s.Point(k.x2,k.y1),new s.Point(k.x2,k.y2),new s.Point(k.x1,k.y2)];s.polygonIntersectsPolygon(c,$)&&(M[B.bucketInstanceId][B.featureIndex]=!0,D[B.bucketInstanceId]===void 0&&(D[B.bucketInstanceId]=[]),D[B.bucketInstanceId].push(B.featureIndex))}return D}insertCollisionBox(o,c,p,_,v){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:v},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,c,p,_,v){const T=c?this.ignoredGrid:this.grid,S={bucketInstanceId:p,featureIndex:_,collisionGroupID:v};for(let M=0;M<o.length;M+=4)T.insertCircle(S,o[M],o[M+1],o[M+2])}projectAndGetPerspectiveRatio(o,c,p,_,v,T,S){const M=[c,p,_,1];let D=!1;_||this.transform.pitch>0?(s.transformMat4$1(M,M,o),this.fogState&&v&&S.name!=="globe"&&(D=function($,W,K,H,Y,F){const q=F.calculateFogTileMatrix(Y),ne=[W,K,H];return s.transformMat4(ne,ne,q),Bn($,ne,F.pitch,F._fov)}(this.fogState,c,p,_,v.toUnwrapped(),this.transform)>.9)):Xt(M,M,o);const k=M[3];return{point:new s.Point((M[0]/k+1)/2*this.transform.width+dr,(-M[1]/k+1)/2*this.transform.height+dr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/k*.5,1.5),signedDistanceFromCamera:k,occluded:T&&M[2]>k||D}}isOffscreen(o,c,p,_){return p<dr||o>=this.screenRightBoundary||_<dr||c>this.screenBottomBoundary}isInsideGrid(o,c,p,_){return p>=0&&o<this.gridRightBoundary&&_>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const o=s.identity([]);return s.translate(o,o,[-100,-100,0]),o}}function ws(h,o,c){const p=o.createTileMatrix(h,h.worldSize,c.toUnwrapped());return s.multiply(new Float32Array(16),h.projMatrix,p)}function xr(h,o,c){if(o.projection.name===c.projection.name)return h.projMatrix;const p=c.clone();return p.setProjection(o.projection),ws(p,o.getProjection(),h)}function Fn(h,o,c){return o.name===c.projection.name?h.projMatrix:ws(c,o,h)}class Wf{constructor(o,c,p,_){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?c:-c))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class bo{constructor(o,c,p,_,v,T=!1){this.text=new Wf(o?o.text:null,c,p,v),this.icon=new Wf(o?o.icon:null,c,_,v),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ol{constructor(o,c,p,_=!1){this.text=o,this.icon=c,this.skipFade=p,this.clipped=_}}class sl{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class oh{constructor(o,c,p,_,v){this.bucketInstanceId=o,this.featureIndex=c,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=v}}class Xf{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const c=++this.maxGroupID;this.collisionGroups[o]={ID:c,predicate:p=>p.collisionGroupID===c}}return this.collisionGroups[o]}}function al(h,o,c,p,_){const{horizontalAlign:v,verticalAlign:T}=s.getAnchorAlignment(h),S=-(v-.5)*o,M=-(T-.5)*c,D=s.evaluateVariableOffset(h,p);return new s.Point(S+D[0]*_,M+D[1]*_)}function ll(h,o,c,p,_){const v=new s.Point(h,o);return c&&v._rotate(p?_:-_),v}class mc{constructor(o,c,p,_,v){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new rl(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Xf(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,c,p,_){const v=p.getBucket(c),T=p.latestFeatureIndex;if(!v||!T||c.id!==v.layerIds[0])return;const S=v.layers[0].layout,M=p.collisionBoxArray,D=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),k=p.tileSize/s.EXTENT,B=p.tileID.toUnwrapped();this.transform.setProjection(v.projection);const $=(W=p.tileID,K=v.getProjection(),H=this.transform,K.name===this.projection?H.calculateProjMatrix(W.toUnwrapped()):ws(H,K,W));var W,K,H;const Y=S.get("text-pitch-alignment")==="map",F=S.get("text-rotation-alignment")==="map";c.compileFilter();const q=c.dynamicFilter(),ne=c.dynamicFilterNeedsFeature(),ie=this.transform.calculatePixelsToTileUnitsMatrix(p),me=wo($,p.tileID.canonical,Y,F,this.transform,v.getProjection(),ie);let ye=null;if(Y){const xe=ei($,p.tileID.canonical,Y,F,this.transform,v.getProjection(),ie);ye=s.multiply([],this.transform.labelPlaneMatrix,xe)}let ge=null;q&&p.latestFeatureIndex&&(ge={unwrappedTileID:B,dynamicFilter:q,dynamicFilterNeedsFeature:ne,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new oh(v.bucketInstanceId,T,v.sourceLayerIndex,v.index,p.tileID);const be={bucket:v,layout:S,posMatrix:$,textLabelPlaneMatrix:me,labelToScreenMatrix:ye,clippingData:ge,scale:D,textPixelRatio:k,holdingForFade:p.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(_)for(const xe of v.sortKeyRanges){const{sortKey:Me,symbolInstanceStart:Qe,symbolInstanceEnd:Ee}=xe;o.push({sortKey:Me,symbolInstanceStart:Qe,symbolInstanceEnd:Ee,parameters:be})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:be})}attemptAnchorPlacement(o,c,p,_,v,T,S,M,D,k,B,$,W,K,H,Y,F,q){const{textOffset0:ne,textOffset1:ie,crossTileID:me}=$,ye=[ne,ie],ge=al(o,p,_,ye,v),be=this.collisionIndex.placeCollisionBox(K,v,c,ll(ge.x,ge.y,T,S,this.transform.angle),B,M,D,k.predicate);if(Y){const xe=K.getSymbolInstanceIconSize(q,this.transform.zoom,$.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(K,xe,Y,ll(ge.x,ge.y,T,S,this.transform.angle),B,M,D,k.predicate).box.length===0)return}if(be.box.length>0){let xe;return this.prevPlacement&&this.prevPlacement.variableOffsets[me]&&this.prevPlacement.placements[me]&&this.prevPlacement.placements[me].text&&(xe=this.prevPlacement.variableOffsets[me].anchor),this.variableOffsets[me]={textOffset:ye,width:p,height:_,anchor:o,textScale:v,prevAnchor:xe},this.markUsedJustification(K,o,$,H),K.allowVerticalPlacement&&(this.markUsedOrientation(K,H,$),this.placedOrientations[me]=H),{shift:ge,placedGlyphBoxes:be}}}placeLayerBucketPart(o,c,p,_){const{bucket:v,layout:T,posMatrix:S,textLabelPlaneMatrix:M,labelToScreenMatrix:D,clippingData:k,textPixelRatio:B,holdingForFade:$,collisionBoxArray:W,partiallyEvaluatedTextSize:K,partiallyEvaluatedIconSize:H,collisionGroup:Y}=o.parameters,F=T.get("text-optional"),q=T.get("icon-optional"),ne=T.get("text-allow-overlap"),ie=T.get("icon-allow-overlap"),me=T.get("text-rotation-alignment")==="map",ye=T.get("text-pitch-alignment")==="map",ge=T.get("icon-text-fit")!=="none",be=T.get("symbol-z-order")==="viewport-y";this.transform.setProjection(v.projection);let xe=ne&&(ie||!v.hasIconData()||q),Me=ie&&(ne||!v.hasTextData()||F);!v.collisionArrays&&W&&v.deserializeCollisionBoxes(W),p&&_&&v.updateCollisionDebugBuffers(this.transform.zoom,W);const Qe=(Ee,je,Ie)=>{const{crossTileID:Ke,numVerticalGlyphVertices:Ae}=Ee;if(k){const On={zoom:this.transform.zoom,pitch:this.transform.pitch};let xn=null;if(k.dynamicFilterNeedsFeature){const rn=this.retainedQueryData[v.bucketInstanceId];xn=k.featureIndex.loadFeature({featureIndex:Ee.featureIndex,bucketIndex:rn.bucketIndex,sourceLayerIndex:rn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,k.dynamicFilter)(On,xn,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new s.Point(Ee.tileAnchorX,Ee.tileAnchorY),this.transform.calculateDistanceTileData(k.unwrappedTileID)))return this.placements[Ke]=new ol(!1,!1,!1,!0),void c.add(Ke)}if(c.has(Ke))return;if($)return void(this.placements[Ke]=new ol(!1,!1,!1));let Ne=!1,tt=!1,Ze=!0,it=!1,bt=!1,zt=null,_t={box:null,offscreen:null,occluded:null},At={box:null,offscreen:null,occluded:null},Ht=null,qt=null,xt=null,hn=0,_n=0,yn=0;Ie.textFeatureIndex?hn=Ie.textFeatureIndex:Ee.useRuntimeCollisionCircles&&(hn=Ee.featureIndex),Ie.verticalTextFeatureIndex&&(_n=Ie.verticalTextFeatureIndex);const vn=On=>{On.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;const xn=this.transform.elevation;(xn||On.elevation)&&(On.elevation=xn?xn.getAtTileOffset(On.tileID,On.tileAnchorX,On.tileAnchorY):0)},Fi=Ie.textBox;if(Fi){vn(Fi);const On=rn=>{let ti=s.WritingMode.horizontal;if(v.allowVerticalPlacement&&!rn&&this.prevPlacement){const Zi=this.prevPlacement.placedOrientations[Ke];Zi&&(this.placedOrientations[Ke]=Zi,ti=Zi,this.markUsedOrientation(v,ti,Ee))}return ti},xn=(rn,ti)=>{if(v.allowVerticalPlacement&&Ae>0&&Ie.verticalTextBox){for(const Zi of v.writingModes)if(Zi===s.WritingMode.vertical?(_t=ti(),At=_t):_t=rn(),_t&&_t.box&&_t.box.length)break}else _t=rn()};if(T.get("text-variable-anchor")){let rn=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ke]){const Ln=this.prevPlacement.variableOffsets[Ke];rn.indexOf(Ln.anchor)>0&&(rn=rn.filter(Qi=>Qi!==Ln.anchor),rn.unshift(Ln.anchor))}const ti=(Ln,Qi,jc)=>{const Ps=v.getSymbolInstanceTextSize(K,Ee,this.transform.zoom,je),Ml=(Ln.x2-Ln.x1)*Ps+2*Ln.padding,Po=(Ln.y2-Ln.y1)*Ps+2*Ln.padding,ts=ge&&!ie?Qi:null;ts&&vn(ts);let Is={box:[],offscreen:!1,occluded:!1};const Gc=ne?2*rn.length:rn.length;for(let Pl=0;Pl<Gc;++Pl){const Hh=this.attemptAnchorPlacement(rn[Pl%rn.length],Ln,Ml,Po,Ps,me,ye,B,S,Y,Pl>=rn.length,Ee,je,v,jc,ts,K,H);if(Hh&&(Is=Hh.placedGlyphBoxes,Is&&Is.box&&Is.box.length)){Ne=!0,zt=Hh.shift;break}}return Is};xn(()=>ti(Fi,Ie.iconBox,s.WritingMode.horizontal),()=>{const Ln=Ie.verticalTextBox;return Ln&&vn(Ln),v.allowVerticalPlacement&&!(_t&&_t.box&&_t.box.length)&&Ae>0&&Ln?ti(Ln,Ie.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),_t&&(Ne=_t.box,Ze=_t.offscreen,it=_t.occluded);const Zi=On(!(!_t||!_t.box));if(!Ne&&this.prevPlacement){const Ln=this.prevPlacement.variableOffsets[Ke];Ln&&(this.variableOffsets[Ke]=Ln,this.markUsedJustification(v,Ln.anchor,Ee,Zi))}}else{const rn=(ti,Zi)=>{const Ln=v.getSymbolInstanceTextSize(K,Ee,this.transform.zoom,je),Qi=this.collisionIndex.placeCollisionBox(v,Ln,ti,new s.Point(0,0),ne,B,S,Y.predicate);return Qi&&Qi.box&&Qi.box.length&&(this.markUsedOrientation(v,Zi,Ee),this.placedOrientations[Ke]=Zi),Qi};xn(()=>rn(Fi,s.WritingMode.horizontal),()=>{const ti=Ie.verticalTextBox;return v.allowVerticalPlacement&&Ae>0&&ti?(vn(ti),rn(ti,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),On(!!(_t&&_t.box&&_t.box.length))}}if(Ht=_t,Ne=Ht&&Ht.box&&Ht.box.length>0,Ze=Ht&&Ht.offscreen,it=Ht&&Ht.occluded,Ee.useRuntimeCollisionCircles){const On=v.text.placedSymbolArray.get(Ee.centerJustifiedTextSymbolIndex>=0?Ee.centerJustifiedTextSymbolIndex:Ee.verticalPlacedTextSymbolIndex),xn=s.evaluateSizeForFeature(v.textSizeData,K,On),rn=T.get("text-padding");qt=this.collisionIndex.placeCollisionCircles(v,ne,On,v.lineVertexArray,v.glyphOffsetArray,xn,S,M,D,p,ye,Y.predicate,Ee.collisionCircleDiameter*xn/s.ONE_EM,rn,this.retainedQueryData[v.bucketInstanceId].tileID),Ne=ne||qt.circles.length>0&&!qt.collisionDetected,Ze=Ze&&qt.offscreen,it=qt.occluded}if(Ie.iconFeatureIndex&&(yn=Ie.iconFeatureIndex),Ie.iconBox){const On=xn=>{vn(xn);const rn=ge&&zt?ll(zt.x,zt.y,me,ye,this.transform.angle):new s.Point(0,0),ti=v.getSymbolInstanceIconSize(H,this.transform.zoom,Ee.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,ti,xn,rn,ie,B,S,Y.predicate)};At&&At.box&&At.box.length&&Ie.verticalIconBox?(xt=On(Ie.verticalIconBox),tt=xt.box.length>0):(xt=On(Ie.iconBox),tt=xt.box.length>0),Ze=Ze&&xt.offscreen,bt=xt.occluded}const bi=F||Ee.numHorizontalGlyphVertices===0&&Ae===0,Er=q||Ee.numIconVertices===0;if(bi||Er?Er?bi||(tt=tt&&Ne):Ne=tt&&Ne:tt=Ne=tt&&Ne,Ne&&Ht&&Ht.box&&this.collisionIndex.insertCollisionBox(Ht.box,T.get("text-ignore-placement"),v.bucketInstanceId,At&&At.box&&_n?_n:hn,Y.ID),tt&&xt&&this.collisionIndex.insertCollisionBox(xt.box,T.get("icon-ignore-placement"),v.bucketInstanceId,yn,Y.ID),qt&&(Ne&&this.collisionIndex.insertCollisionCircles(qt.circles,T.get("text-ignore-placement"),v.bucketInstanceId,hn,Y.ID),p)){const On=v.bucketInstanceId;let xn=this.collisionCircleArrays[On];xn===void 0&&(xn=this.collisionCircleArrays[On]=new sl);for(let rn=0;rn<qt.circles.length;rn+=4)xn.circles.push(qt.circles[rn+0]),xn.circles.push(qt.circles[rn+1]),xn.circles.push(qt.circles[rn+2]),xn.circles.push(qt.collisionDetected?1:0)}const no=v.projection.name!=="globe";xe=xe&&(no||!it),Me=Me&&(no||!bt),this.placements[Ke]=new ol(Ne||xe,tt||Me,Ze||v.justReloaded),c.add(Ke)};if(be){const Ee=v.getSortedSymbolIndexes(this.transform.angle);for(let je=Ee.length-1;je>=0;--je){const Ie=Ee[je];Qe(v.symbolInstances.get(Ie),Ie,v.collisionArrays[Ie])}}else for(let Ee=o.symbolInstanceStart;Ee<o.symbolInstanceEnd;Ee++)Qe(v.symbolInstances.get(Ee),Ee,v.collisionArrays[Ee]);if(p&&v.bucketInstanceId in this.collisionCircleArrays){const Ee=this.collisionCircleArrays[v.bucketInstanceId];s.invert(Ee.invProjMatrix,S),Ee.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(o,c,p,_){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:M,crossTileID:D}=p,k=s.getAnchorJustification(c),B=_===s.WritingMode.vertical?M:k==="left"?v:k==="center"?T:k==="right"?S:-1;v>=0&&(o.text.placedSymbolArray.get(v).crossTileID=B>=0&&v!==B?0:D),T>=0&&(o.text.placedSymbolArray.get(T).crossTileID=B>=0&&T!==B?0:D),S>=0&&(o.text.placedSymbolArray.get(S).crossTileID=B>=0&&S!==B?0:D),M>=0&&(o.text.placedSymbolArray.get(M).crossTileID=B>=0&&M!==B?0:D)}markUsedOrientation(o,c,p){const _=c===s.WritingMode.horizontal||c===s.WritingMode.horizontalOnly?c:0,v=c===s.WritingMode.vertical?c:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:D}=p,k=o.text.placedSymbolArray;T>=0&&(k.get(T).placedOrientation=_),S>=0&&(k.get(S).placedOrientation=_),M>=0&&(k.get(M).placedOrientation=_),D>=0&&(k.get(D).placedOrientation=v)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let p=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const _=c?c.symbolFadeChange(o):1,v=c?c.opacities:{},T=c?c.variableOffsets:{},S=c?c.placedOrientations:{};for(const M in this.placements){const D=this.placements[M],k=v[M];k?(this.opacities[M]=new bo(k,_,D.text,D.icon,null,D.clipped),p=p||D.text!==k.text.placed||D.icon!==k.icon.placed):(this.opacities[M]=new bo(null,_,D.text,D.icon,D.skipFade,D.clipped),p=p||D.text||D.icon)}for(const M in v){const D=v[M];if(!this.opacities[M]){const k=new bo(D,_,!1,!1);k.isHidden()||(this.opacities[M]=k,p=p||D.text.placed||D.icon.placed)}}for(const M in T)this.variableOffsets[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.variableOffsets[M]=T[M]);for(const M in S)this.placedOrientations[M]||!this.opacities[M]||this.opacities[M].isHidden()||(this.placedOrientations[M]=S[M]);p?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:o)}updateLayerOpacities(o,c){const p=new Set;for(const _ of c){const v=_.getBucket(o);v&&_.latestFeatureIndex&&o.id===v.layerIds[0]&&this.updateBucketOpacities(v,p,_.collisionBoxArray)}}updateBucketOpacities(o,c,p){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const _=o.layers[0].layout,v=!!o.layers[0].dynamicFilter(),T=new bo(null,0,!1,!1,!0),S=_.get("text-allow-overlap"),M=_.get("icon-allow-overlap"),D=_.get("text-variable-anchor"),k=_.get("text-rotation-alignment")==="map",B=_.get("text-pitch-alignment")==="map",$=_.get("icon-text-fit")!=="none",W=new bo(null,0,S&&(M||!o.hasIconData()||_.get("icon-optional")),M&&(S||!o.hasTextData()||_.get("text-optional")),!0);!o.collisionArrays&&p&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(p);const K=(Y,F,q)=>{for(let ne=0;ne<F/4;ne++)Y.opacityVertexArray.emplaceBack(q)};let H=0;for(let Y=0;Y<o.symbolInstances.length;Y++){const F=o.symbolInstances.get(Y),{numHorizontalGlyphVertices:q,numVerticalGlyphVertices:ne,crossTileID:ie,numIconVertices:me}=F,ye=c.has(ie);let ge=this.opacities[ie];ye?ge=T:ge||(ge=W,this.opacities[ie]=ge),c.add(ie);const be=q>0||ne>0,xe=me>0,Me=this.placedOrientations[ie],Qe=Me===s.WritingMode.vertical,Ee=Me===s.WritingMode.horizontal||Me===s.WritingMode.horizontalOnly;if(!be&&!xe||ge.isHidden()||H++,be){const je=cl(ge.text);K(o.text,q,Qe?$n:je),K(o.text,ne,Ee?$n:je);const Ie=ge.text.isHidden(),{leftJustifiedTextSymbolIndex:Ke,centerJustifiedTextSymbolIndex:Ae,rightJustifiedTextSymbolIndex:Ne,verticalPlacedTextSymbolIndex:tt}=F,Ze=o.text.placedSymbolArray,it=Ie||Qe?1:0;Ke>=0&&(Ze.get(Ke).hidden=it),Ae>=0&&(Ze.get(Ae).hidden=it),Ne>=0&&(Ze.get(Ne).hidden=it),tt>=0&&(Ze.get(tt).hidden=Ie||Ee?1:0);const bt=this.variableOffsets[ie];bt&&this.markUsedJustification(o,bt.anchor,F,Me);const zt=this.placedOrientations[ie];zt&&(this.markUsedJustification(o,"left",F,zt),this.markUsedOrientation(o,zt,F))}if(xe){const je=cl(ge.icon),{placedIconSymbolIndex:Ie,verticalPlacedIconSymbolIndex:Ke}=F,Ae=o.icon.placedSymbolArray,Ne=ge.icon.isHidden()?1:0;Ie>=0&&(K(o.icon,me,Qe?$n:je),Ae.get(Ie).hidden=Ne),Ke>=0&&(K(o.icon,F.numVerticalIconVertices,Ee?$n:je),Ae.get(Ke).hidden=Ne)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const je=o.collisionArrays[Y];if(je){let Ie=new s.Point(0,0),Ke=!0;if(je.textBox||je.verticalTextBox){if(D){const Ne=this.variableOffsets[ie];Ne?(Ie=al(Ne.anchor,Ne.width,Ne.height,Ne.textOffset,Ne.textScale),k&&Ie._rotate(B?this.transform.angle:-this.transform.angle)):Ke=!1}v&&(Ke=!ge.clipped),je.textBox&&ta(o.textCollisionBox.collisionVertexArray,ge.text.placed,!Ke||Qe,Ie.x,Ie.y),je.verticalTextBox&&ta(o.textCollisionBox.collisionVertexArray,ge.text.placed,!Ke||Ee,Ie.x,Ie.y)}const Ae=Ke&&!!(!Ee&&je.verticalIconBox);je.iconBox&&ta(o.iconCollisionBox.collisionVertexArray,ge.icon.placed,Ae,$?Ie.x:0,$?Ie.y:0),je.verticalIconBox&&ta(o.iconCollisionBox.collisionVertexArray,ge.icon.placed,!Ae,$?Ie.x:0,$?Ie.y:0)}}}if(o.fullyClipped=H===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const Y=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=Y.invProjMatrix,o.placementViewportMatrix=Y.viewportMatrix,o.collisionCircleArray=Y.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,c){const p=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*p>o}setStale(){this.stale=!0}}function ta(h,o,c,p,_){h.emplaceBack(o?1:0,c?1:0,p||0,_||0),h.emplaceBack(o?1:0,c?1:0,p||0,_||0),h.emplaceBack(o?1:0,c?1:0,p||0,_||0),h.emplaceBack(o?1:0,c?1:0,p||0,_||0)}const Yi=Math.pow(2,25),Hn=Math.pow(2,24),sh=Math.pow(2,17),ah=Math.pow(2,16),Ji=Math.pow(2,9),wr=Math.pow(2,8),Hf=Math.pow(2,1);function cl(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const o=h.placed?1:0,c=Math.floor(127*h.opacity);return c*Yi+o*Hn+c*sh+o*ah+c*Ji+o*wr+c*Hf+o}const $n=0;class ul{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,c,p,_,v){const T=this._bucketParts;for(;this._currentTileIndex<o.length;)if(c.getBucketParts(T,_,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((S,M)=>S.sortKey-M.sortKey));this._currentPartIndex<T.length;){const S=T[this._currentPartIndex];if(c.placeLayerBucketPart(S,this._seenCrossTileIDs,p,S.symbolInstanceStart===0),this._currentPartIndex++,v())return!0}return!1}}class lh{constructor(o,c,p,_,v,T,S,M){this.placement=new mc(o,v,T,S,M),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(o,c,p){const _=s.exported.now(),v=()=>{const T=s.exported.now()-_;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=c[o[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=S)&&(!T.maxzoom||T.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new ul(T)),this._inProgressLayer.continuePlacement(p[T.source],this.placement,this._showCollisionBoxes,T,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const bs=512/s.EXTENT/2;class Pi{constructor(o,c,p){this.tileID=o,this.bucketInstanceId=p,this.index=new s.KDBush(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=o.canonical.x*s.EXTENT,v=o.canonical.y*s.EXTENT;for(let T=0;T<c.length;T++){const{key:S,crossTileID:M,tileAnchorX:D,tileAnchorY:k}=c.get(T),B=Math.floor((_+D)*bs),$=Math.floor((v+k)*bs);this.index.add(B,$),this.keys.push(S),this.crossTileIDs.push(M)}this.index.finish()}findMatches(o,c,p){const _=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),v=bs/Math.pow(2,c.canonical.z-this.tileID.canonical.z),T=c.canonical.x*s.EXTENT,S=c.canonical.y*s.EXTENT;for(let M=0;M<o.length;M++){const D=o.get(M);if(D.crossTileID)continue;const{key:k,tileAnchorX:B,tileAnchorY:$}=D,W=Math.floor((T+B)*v),K=Math.floor((S+$)*v),H=this.index.range(W-_,K-_,W+_,K+_);for(const Y of H){const F=this.crossTileIDs[Y];if(this.keys[Y]===k&&!p.has(F)){p.add(F),D.crossTileID=F;break}}}}}class ch{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class uh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const c=Math.round((o-this.lng)/360);if(c!==0)for(const p in this.indexes){const _=this.indexes[p],v={};for(const T in _){const S=_[T];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+c),v[S.tileID.key]=S}this.indexes[p]=v}this.lng=o}addBucket(o,c,p){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let v=0;v<c.symbolInstances.length;v++)c.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);const _=this.usedCrossTileIDs[o.overscaledZ];for(const v in this.indexes){const T=this.indexes[v];if(Number(v)>o.overscaledZ)for(const S in T){const M=T[S];M.tileID.isChildOf(o)&&M.findMatches(c.symbolInstances,o,_)}else{const S=T[o.scaledTo(Number(v)).key];S&&S.findMatches(c.symbolInstances,o,_)}}for(let v=0;v<c.symbolInstances.length;v++){const T=c.symbolInstances.get(v);T.crossTileID||(T.crossTileID=p.generate(),_.add(T.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Pi(o,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(o,c){for(const p of c.crossTileIDs)this.usedCrossTileIDs[o].delete(p)}removeStaleBuckets(o){let c=!1;for(const p in this.indexes){const _=this.indexes[p];for(const v in _)o[_[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[v]),delete _[v],c=!0)}return c}}class To{constructor(){this.layerIndexes={},this.crossTileIDs=new ch,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,c,p,_){let v=this.layerIndexes[o.id];v===void 0&&(v=this.layerIndexes[o.id]=new uh);let T=!1;const S={};_.name!=="globe"&&v.handleWrapJump(p);for(const M of c){const D=M.getBucket(o);D&&o.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(M.tileID,D,this.crossTileIDs)&&(T=!0),S[D.bucketInstanceId]=!0)}return v.removeStaleBuckets(S)&&(T=!0),T}pruneUnusedLayers(o){const c={};o.forEach(p=>{c[p]=!0});for(const p in this.layerIndexes)c[p]||delete this.layerIndexes[p]}}const Qo=(h,o)=>s.emitValidationErrors(h,o&&o.filter(c=>c.identifier!=="source.canvas")),gc=s.pick(an,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),c_=s.pick(an,["setCenter","setZoom","setBearing","setPitch"]),hh={version:8,layers:[],sources:{}},na={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Qr extends s.Evented{constructor(o,c={}){super(),this.map=o,this.dispatcher=new Tt(Jo(),this),this.imageManager=new dn,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(o._requestManager,c.localFontFamily?s.LocalGlyphMode.all:c.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.crossTileSymbolIndex=new To,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const p=this;this._rtlTextPluginCallback=Qr.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(v,T)=>{if(s.triggerPluginCompletionEvent(v),T&&T.every(S=>S))for(const S in p._sourceCaches){const M=p._sourceCaches[S],D=M.getSource().type;D!=="vector"&&D!=="geojson"||M.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const v=this.getSource(_.sourceId);if(v&&v.vectorLayerIds)for(const T in this._layers){const S=this._layers[T];S.source===v.id&&this._validateLayer(S)}})}loadURL(o,c={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const p=typeof c.validate=="boolean"?c.validate:!s.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,c.accessToken);const _=this.map._requestManager.transformRequest(o,s.ResourceType.Style);this._request=s.getJSON(_,(v,T)=>{this._request=null,v?this.fire(new s.ErrorEvent(v)):T&&this._load(T,p)})}loadJSON(o,c={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(o,c.validate!==!1)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(hh,!1)}_updateLayerCount(o,c){const p=c?1:-1;o.is3D()&&(this._num3DLayers+=p),o.type==="circle"&&(this._numCircleLayers+=p),o.type==="symbol"&&(this._numSymbolLayers+=p)}_load(o,c){if(c&&Qo(this,s.validateStyle(o)))return;this._loaded=!0,this.stylesheet=s.clone$1(o),this._updateMapProjection();for(const _ in o.sources)this.addSource(_,o.sources[_],{validate:!1});this._changed=!1,o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(o.glyphs);const p=$f(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(const _ of p){const v=s.createStyleLayer(_);v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Jt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(o){this._spriteRequest=function(c,p,_){let v,T,S;const M=s.exported.devicePixelRatio>1?"@2x":"";let D=s.getJSON(p.transformRequest(p.normalizeSpriteURL(c,M,".json"),s.ResourceType.SpriteJSON),($,W)=>{D=null,S||(S=$,v=W,B())}),k=s.getImage(p.transformRequest(p.normalizeSpriteURL(c,M,".png"),s.ResourceType.SpriteImage),($,W)=>{k=null,S||(S=$,T=W,B())});function B(){if(S)_(S);else if(v&&T){const $=s.exported.getImageData(T),W={};for(const K in v){const{width:H,height:Y,x:F,y:q,sdf:ne,pixelRatio:ie,stretchX:me,stretchY:ye,content:ge}=v[K],be=new s.RGBAImage({width:H,height:Y});s.RGBAImage.copy($,be,{x:F,y:q},{x:0,y:0},{width:H,height:Y}),W[K]={data:be,pixelRatio:ie,sdf:ne,stretchX:me,stretchY:ye,content:ge}}_(null,W)}}return{cancel(){D&&(D.cancel(),D=null),k&&(k.cancel(),k=null)}}}(o,this.map._requestManager,(c,p)=>{if(this._spriteRequest=null,c)this.fire(new s.ErrorEvent(c));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(o){const c=this.getSource(o.source);if(!c)return;const p=o.sourceLayer;p&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(p)===-1)&&this.fire(new s.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${c.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const c=[];for(const p of o){const _=this._layers[p];_.type!=="custom"&&c.push(_.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(o){return!!this.terrain&&(typeof o.isLayerDraped=="function"?o.isLayerDraped():na[o.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(o){if(!this._loaded)return;const c=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(_.length||v.length)&&this._updateWorkerLayers(_,v);for(const T in this._updatedSources){const S=this._updatedSources[T];S==="reload"?this._reloadSource(T):S==="clear"&&this._clearSource(T)}this._updateTilesForChangedImages();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(o);this.light.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._resetUpdates()}const p={};for(const _ in this._sourceCaches){const v=this._sourceCaches[_];p[_]=v.used,v.used=!1}for(const _ of this._order){const v=this._layers[_];if(v.recalculate(o,this._availableImages),!v.isHidden(o.zoom)){const S=this._getLayerSourceCache(v);S&&(S.used=!0)}const T=this.map.painter;if(T){const S=v.getProgramIds();if(!S)continue;const M=v.getProgramConfiguration(o.zoom);for(const D of S)T.useProgram(D,M)}}for(const _ in p){const v=this._sourceCaches[_];p[_]!==v.used&&v.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),Qo(this,s.validateStyle(o)))return!1;(o=s.clone$1(o)).layers=$f(o.layers);const c=function(_,v){if(!_)return[{command:an.setStyle,args:[v]}];let T=[];try{if(!A(_.version,v.version))return[{command:an.setStyle,args:[v]}];A(_.center,v.center)||T.push({command:an.setCenter,args:[v.center]}),A(_.zoom,v.zoom)||T.push({command:an.setZoom,args:[v.zoom]}),A(_.bearing,v.bearing)||T.push({command:an.setBearing,args:[v.bearing]}),A(_.pitch,v.pitch)||T.push({command:an.setPitch,args:[v.pitch]}),A(_.sprite,v.sprite)||T.push({command:an.setSprite,args:[v.sprite]}),A(_.glyphs,v.glyphs)||T.push({command:an.setGlyphs,args:[v.glyphs]}),A(_.transition,v.transition)||T.push({command:an.setTransition,args:[v.transition]}),A(_.light,v.light)||T.push({command:an.setLight,args:[v.light]}),A(_.fog,v.fog)||T.push({command:an.setFog,args:[v.fog]}),A(_.projection,v.projection)||T.push({command:an.setProjection,args:[v.projection]});const S={},M=[];(function(B,$,W,K){let H;for(H in $=$||{},B=B||{})B.hasOwnProperty(H)&&($.hasOwnProperty(H)||nl(H,W,K));for(H in $){if(!$.hasOwnProperty(H))continue;const Y=$[H];B.hasOwnProperty(H)?A(B[H],Y)||(B[H].type==="geojson"&&Y.type==="geojson"&&pc(B,$,H)?W.push({command:an.setGeoJSONSourceData,args:[H,Y.data]}):th(H,$,W,K)):eh(H,$,W)}})(_.sources,v.sources,M,S);const D=[];_.layers&&_.layers.forEach(B=>{B.source&&S[B.source]?T.push({command:an.removeLayer,args:[B.id]}):D.push(B)});let k=_.terrain;k&&S[k.source]&&(T.push({command:an.setTerrain,args:[void 0]}),k=void 0),T=T.concat(M),A(k,v.terrain)||T.push({command:an.setTerrain,args:[v.terrain]}),function(B,$,W){$=$||[];const K=(B=B||[]).map(vo),H=$.map(vo),Y=B.reduce(nh,{}),F=$.reduce(nh,{}),q=K.slice(),ne=Object.create(null);let ie,me,ye,ge,be,xe,Me;for(ie=0,me=0;ie<K.length;ie++)ye=K[ie],F.hasOwnProperty(ye)?me++:(W.push({command:an.removeLayer,args:[ye]}),q.splice(q.indexOf(ye,me),1));for(ie=0,me=0;ie<H.length;ie++)ye=H[H.length-1-ie],q[q.length-1-ie]!==ye&&(Y.hasOwnProperty(ye)?(W.push({command:an.removeLayer,args:[ye]}),q.splice(q.lastIndexOf(ye,q.length-me),1)):me++,xe=q[q.length-ie],W.push({command:an.addLayer,args:[F[ye],xe]}),q.splice(q.length-ie,0,ye),ne[ye]=!0);for(ie=0;ie<H.length;ie++)if(ye=H[ie],ge=Y[ye],be=F[ye],!ne[ye]&&!A(ge,be))if(A(ge.source,be.source)&&A(ge["source-layer"],be["source-layer"])&&A(ge.type,be.type)){for(Me in Yr(ge.layout,be.layout,W,ye,null,an.setLayoutProperty),Yr(ge.paint,be.paint,W,ye,null,an.setPaintProperty),A(ge.filter,be.filter)||W.push({command:an.setFilter,args:[ye,be.filter]}),A(ge.minzoom,be.minzoom)&&A(ge.maxzoom,be.maxzoom)||W.push({command:an.setLayerZoomRange,args:[ye,be.minzoom,be.maxzoom]}),ge)ge.hasOwnProperty(Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?Yr(ge[Me],be[Me],W,ye,Me.slice(6),an.setPaintProperty):A(ge[Me],be[Me])||W.push({command:an.setLayerProperty,args:[ye,Me,be[Me]]}));for(Me in be)be.hasOwnProperty(Me)&&!ge.hasOwnProperty(Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?Yr(ge[Me],be[Me],W,ye,Me.slice(6),an.setPaintProperty):A(ge[Me],be[Me])||W.push({command:an.setLayerProperty,args:[ye,Me,be[Me]]}))}else W.push({command:an.removeLayer,args:[ye]}),xe=q[q.lastIndexOf(ye)+1],W.push({command:an.addLayer,args:[be,xe]})}(D,v.layers,T)}catch(S){console.warn("Unable to compute style diff:",S),T=[{command:an.setStyle,args:[v]}]}return T}(this.serialize(),o).filter(_=>!(_.command in c_));if(c.length===0)return!1;const p=c.filter(_=>!(_.command in gc));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return c.forEach(_=>{_.command!=="setTransition"&&_.command!=="setProjection"&&this[_.command].apply(this,_.args)}),this.stylesheet=o,this._updateMapProjection(),!0}addImage(o,c){return this.getImage(o)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(o,c),this._afterImageUpdated(o),this)}updateImage(o,c){this.imageManager.updateImage(o,c)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o),this._afterImageUpdated(o),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(o,c,p={}){if(this._checkLoaded(),this.getSource(o)!==void 0)throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(s.validateSource,`sources.${o}`,c,null,p))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const _=Vt(o,c,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(o),source:_.serialize(),sourceId:o}));const v=T=>{const S=(T?"symbol:":"other:")+o,M=this._sourceCaches[S]=new s.SourceCache(S,_,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[o]=M,M.style=this,M.onAdd(this.map)};v(!1),c.type!=="vector"&&c.type!=="geojson"||v(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(o){this._checkLoaded();const c=this.getSource(o);if(!c)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===o)return this.fire(new s.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===o)return this.fire(new s.ErrorEvent(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(o);for(const _ of p)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(o,c){this._checkLoaded(),this.getSource(o).setData(c),this._changed=!0}getSource(o){const c=this._getSourceCache(o);return c&&c.getSource()}_getSources(){const o=[];for(const c in this._otherSourceCaches){const p=this._getSourceCache(c);p&&o.push(p.getSource())}return o}addLayer(o,c,p={}){this._checkLoaded();const _=o.id;if(this.getLayer(_))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let v;if(o.type==="custom"){if(Qo(this,s.validateCustomStyleLayer(o)))return;v=s.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(_,o.source),o=s.clone$1(o),o=s.extend(o,{source:_})),this._validate(s.validateLayer,`layers.${_}`,o,{arrayIndex:-1},p))return;v=s.createStyleLayer(o),this._validateLayer(v),v.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}const T=c?this._order.indexOf(c):this._order.length;if(c&&T===-1)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(T,0,_),this._layerOrderChanged=!0,this._layers[_]=v;const S=this._getLayerSourceCache(v);if(this._removedLayers[_]&&v.source&&S&&v.type!=="custom"){const M=this._removedLayers[_];delete this._removedLayers[_],M.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",S.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(o,c){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===c)return;const p=this._order.indexOf(o);this._order.splice(p,1);const _=c?this._order.indexOf(c):this._order.length;c&&_===-1?this.fire(new s.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(_,0,o),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(o){this._checkLoaded();const c=this._layers[o];if(!c)return void this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const p=this._order.indexOf(o);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=c,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}hasLayerType(o){for(const c in this._layers)if(this._layers[c].type===o)return!0;return!1}setLayerZoomRange(o,c,p){this._checkLoaded();const _=this.getLayer(o);_?_.minzoom===c&&_.maxzoom===p||(c!=null&&(_.minzoom=c),p!=null&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(o,c,p={}){this._checkLoaded();const _=this.getLayer(o);if(_){if(!A(_.filter,c))return c==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(s.validateFilter,`layers.${_.id}.filter`,c,{layerType:_.type},p)||(_.filter=s.clone$1(c),this._updateLayer(_)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be filtered.`)))}getFilter(o){const c=this.getLayer(o);return c&&s.clone$1(c.filter)}setLayoutProperty(o,c,p,_={}){this._checkLoaded();const v=this.getLayer(o);v?A(v.getLayoutProperty(c),p)||(v.setLayoutProperty(c,p,_),this._updateLayer(v)):this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(o,c){const p=this.getLayer(o);if(p)return p.getLayoutProperty(c);this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style.`)))}setPaintProperty(o,c,p,_={}){this._checkLoaded();const v=this.getLayer(o);v?A(v.getPaintProperty(c),p)||(v.setPaintProperty(c,p,_)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(o,c){const p=this.getLayer(o);return p&&p.getPaintProperty(c)}setFeatureState(o,c){this._checkLoaded();const p=o.source,_=o.sourceLayer,v=this.getSource(p);if(!v)return void this.fire(new s.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const T=v.type;if(T==="geojson"&&_)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!_)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(p);for(const M of S)M.setFeatureState(_,o.id,c)}removeFeatureState(o,c){this._checkLoaded();const p=o.source,_=this.getSource(p);if(!_)return void this.fire(new s.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const v=_.type,T=v==="vector"?o.sourceLayer:void 0;if(v==="vector"&&!T)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(p);for(const M of S)M.removeFeatureState(T,o.id,c)}getFeatureState(o){this._checkLoaded();const c=o.source,p=o.sourceLayer,_=this.getSource(c);if(_){if(_.type!=="vector"||p)return o.id===void 0&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(p,o.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const o={};for(const c in this._sourceCaches){const p=this._sourceCaches[c].getSource();o[p.id]||(o[p.id]=p.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:o,layers:this._serializeLayers(this._order)},c=>c!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0;const c=this._getLayerSourceCache(o);o.source&&!this._updatedSources[o.source]&&c&&c.getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",c.pause()),this._changed=!0,o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const c=T=>this._layers[T].type==="fill-extrusion",p={},_=[];for(let T=this._order.length-1;T>=0;T--){const S=this._order[T];if(c(S)){p[S]=T;for(const M of o){const D=M[S];if(D)for(const k of D)_.push(k)}}}_.sort((T,S)=>S.intersectionZ-T.intersectionZ);const v=[];for(let T=this._order.length-1;T>=0;T--){const S=this._order[T];if(c(S))for(let M=_.length-1;M>=0;M--){const D=_[M].feature;if(p[D.layer.id]<T)break;v.push(D),_.pop()}else for(const M of o){const D=M[S];if(D)for(const k of D)v.push(k.feature)}}return v}queryRenderedFeatures(o,c,p){c&&c.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",c.filter,null,c);const _={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const M of c.layers){const D=this._layers[M];if(!D)return this.fire(new s.ErrorEvent(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];_[D.source]=!0}}const v=[];c.availableImages=this._availableImages;const T=c&&c.layers?c.layers.some(M=>{const D=this.getLayer(M);return D&&D.is3D()}):this.has3DLayers(),S=nn.createFromScreenPoints(o,p);for(const M in this._sourceCaches){const D=this._sourceCaches[M].getSource().id;c.layers&&!_[D]||v.push(gn(this._sourceCaches[M],this._layers,this._serializedLayers,S,c,p,T,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(M,D,k,B,$,W,K){const H={},Y=W.queryRenderedSymbols(B),F=[];for(const q of Object.keys(Y).map(Number))F.push(K[q]);F.sort(Cn);for(const q of F){const ne=q.featureIndex.lookupSymbolFeatures(Y[q.bucketInstanceId],D,q.bucketIndex,q.sourceLayerIndex,$.filter,$.layers,$.availableImages,M);for(const ie in ne){const me=H[ie]=H[ie]||[],ye=ne[ie];ye.sort((ge,be)=>{const xe=q.featureSortOrder;if(xe){const Me=xe.indexOf(ge.featureIndex);return xe.indexOf(be.featureIndex)-Me}return be.featureIndex-ge.featureIndex});for(const ge of ye)me.push(ge)}}for(const q in H)H[q].forEach(ne=>{const ie=ne.feature,me=k(M[q]);if(!me)return;const ye=me.getFeatureState(ie.layer["source-layer"],ie.id);ie.source=ie.layer.source,ie.layer["source-layer"]&&(ie.sourceLayer=ie.layer["source-layer"]),ie.state=ye});return H}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(o,c){c&&c.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",c.filter,null,c);const p=this._getSourceCaches(o);let _=[];for(const v of p)_=_.concat($t(v,c));return _}addSourceType(o,c,p){return Qr.getSourceType(o)?p(new Error(`A source type called "${o}" already exists.`)):(Qr.setSourceType(o,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:c.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(o,c={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const T in o)if(!A(o[T],p[T])){_=!0;break}if(!_)return;const v=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(o,c),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(o,c=1){if(this._checkLoaded(),!o)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let p=o;if(c===1){if(typeof p.source=="object"){const _="terrain-dem-src";this.addSource(_,p.source),p=s.clone$1(p),p=s.extend(p,{source:_})}if(this._validate(s.validateTerrain,"terrain",p))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,c)}else{const _=this.terrain,v=_.get();for(const T of Object.keys(s.spec.terrain))!p.hasOwnProperty(T)&&s.spec.terrain[T].default&&(p[T]=s.spec.terrain[T].default);for(const T in p)if(!A(p[T],v[T])){_.set(p),this.stylesheet.terrain=p;const S=this._setTransitionParameters({duration:0});_.updateTransitions(S);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const c=this.fog=new Mt(o,this.map.transform);this.stylesheet.fog=o;const p=this._setTransitionParameters({duration:0});c.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,p=c.get();Object.keys(o).length===0&&c.set(o);for(const _ in o)if(!A(o[_],p[_])){c.set(o),this.stylesheet.fog=o;const v=this._setTransitionParameters({duration:0});c.updateTransitions(v);break}}else this._createFog(o);this._markersNeedUpdate=!0}_setTransitionParameters(o){return{now:s.exported.now(),transition:s.extend(o,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const o=this._order.filter(p=>this.isLayerDraped(this._layers[p])),c=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...c)}_createTerrain(o,c){const p=this.terrain=new un(o,c);this.stylesheet.terrain=o,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const _=this._setTransitionParameters({duration:0});p.updateTransitions(_)}_force3DLayerUpdate(){for(const o in this._layers){const c=this._layers[o];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const c=this._layers[o];c.type==="symbol"&&this._updateLayer(c)}}_validate(o,c,p,_,v={}){return(!v||v.validate!==!1)&&Qo(this,o.call(s.validateStyle,s.extend({key:c,style:this.serialize(),value:p,styleSpec:s.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this._sourceCaches)this._sourceCaches[o].clearTiles(),this._sourceCaches[o].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){const c=this._getSourceCaches(o);for(const p of c)p.clearTiles()}_reloadSource(o){const c=this._getSourceCaches(o);for(const p of c)p.resume(),p.reload()}_reloadSources(){for(const o of this._getSources())o.reload&&o.reload()}_updateSources(o){for(const c in this._sourceCaches)this._sourceCaches[c].update(o)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const c=this._sourceCaches[o];c.resume(),c.reload()}}_updatePlacement(o,c,p,_,v=!1){let T=!1,S=!1;const M={};for(const D of this._order){const k=this._layers[D];if(k.type!=="symbol")continue;if(!M[k.source]){const $=this._getLayerSourceCache(k);if(!$)continue;M[k.source]=$.getRenderableIds(!0).map(W=>$.getTileByID(W)).sort((W,K)=>K.tileID.overscaledZ-W.tileID.overscaledZ||(W.tileID.isLessThan(K.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(k,M[k.source],o.center.lng,o.projection);T=T||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),o.zoom))&&(this.pauseablePlacement=new lh(o,this._order,v,c,p,_,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,M),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),S=!0),T&&this.pauseablePlacement.placement.setStale()),S||T)for(const D of this._order){const k=this._layers[D];k.type==="symbol"&&this.placement.updateLayerOpacities(k,M[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,c,p){this.imageManager.getImages(c.icons,p),this._updateTilesForChangedImages();const _=v=>{v&&v.setDependencies(c.tileID.key,c.type,c.icons)};_(this._otherSourceCaches[c.source]),_(this._symbolSourceCaches[c.source])}getGlyphs(o,c,p){this.glyphManager.getGlyphs(c.stacks,p)}getResource(o,c,p){return s.makeRequest(c,p)}_getSourceCache(o){return this._otherSourceCaches[o]}_getLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}_getSourceCaches(o){const c=[];return this._otherSourceCaches[o]&&c.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&c.push(this._symbolSourceCaches[o]),c}_isSourceCacheLoaded(o){const c=this._getSourceCaches(o);return c.length===0?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${o}'`))),!1):c.every(p=>p.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Qr.getSourceType=function(h){return Dt[h]},Qr.setSourceType=function(h,o){Dt[h]=o},Qr.registerForPluginStateChange=s.registerForPluginStateChange;var dh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Ts="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Eo=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,hl=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,So=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let _c={},ia={};const dl=[];ra(dh,dl),ra(Eo,dl),ra(hl,dl),ra(So,dl),_c=ln("",Eo),ia=ln(So,hl);const Kf=ln(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),yc=dh,fh=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var ph={background:ln(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ln(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:ln(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ln("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ln(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ln(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ln("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ln("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ln("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:ln(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:ln(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ln(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ln(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ln(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:ln(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:ln(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ln(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ln(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:ln(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:ln(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:ln(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:ln(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:ln(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:ln(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:ln(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ln(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ts),skyboxGradient:ln(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ts),skyboxCapture:ln(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ln(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ln(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function ra(h,o){const c=h.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of c)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=p.split(" ");for(const v of _)o.includes(v)||o.push(v)}}function ln(h,o){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=o.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),_={},v=[...dl];return ra(h,v),ra(o,v),{fragmentSource:h=h.replace(c,(T,S,M,D,k)=>(_[k]=!0,S==="define"?`
#ifndef HAS_UNIFORM_u_${k}
varying ${M} ${D} ${k};
#else
uniform ${M} ${D} u_${k};
#endif
`:`
#ifdef HAS_UNIFORM_u_${k}
    ${M} ${D} ${k} = u_${k};
#endif
`)),vertexSource:o=o.replace(c,(T,S,M,D,k)=>{const B=D==="float"?"vec2":"vec4",$=k.match(/color/)?"color":B;return _[k]?S==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
attribute ${M} ${B} a_${k};
varying ${M} ${D} ${k};
#else
uniform ${M} ${D} u_${k};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = a_${k};
#else
    ${M} ${D} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = unpack_mix_${$}(a_${k}, u_${k}_t);
#else
    ${M} ${D} ${k} = u_${k};
#endif
`:S==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
attribute ${M} ${B} a_${k};
#else
uniform ${M} ${D} u_${k};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${M} ${D} ${k} = a_${k};
#else
    ${M} ${D} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${M} ${D} ${k} = unpack_mix_${$}(a_${k}, u_${k}_t);
#else
    ${M} ${D} ${k} = u_${k};
#endif
`}),staticAttributes:p,usedDefines:v}}class u_{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,c,p,_,v,T,S){this.context=o;let M=this.boundPaintVertexBuffers.length!==_.length;for(let k=0;!M&&k<_.length;k++)this.boundPaintVertexBuffers[k]!==_[k]&&(M=!0);let D=this.boundDynamicVertexBuffers.length!==S.length;for(let k=0;!D&&k<S.length;k++)this.boundDynamicVertexBuffers[k]!==S[k]&&(D=!0);if(!o.extVertexArrayObject||!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==p||M||D||this.boundIndexBuffer!==v||this.boundVertexOffset!==T)this.freshBind(c,p,_,v,T,S);else{o.bindVertexArrayOES.set(this.vao);for(const k of S)k&&k.bind();v&&v.dynamicDraw&&v.bind()}}freshBind(o,c,p,_,v,T){let S;const M=o.numAttributes,D=this.context,k=D.gl;if(D.extVertexArrayObject)this.vao&&this.destroy(),this.vao=D.extVertexArrayObject.createVertexArrayOES(),D.bindVertexArrayOES.set(this.vao),S=0,this.boundProgram=o,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=T;else{S=D.currentNumAttributes||0;for(let B=M;B<S;B++)k.disableVertexAttribArray(B)}c.enableAttributes(k,o),c.bind(),c.setVertexAttribPointers(k,o,v);for(const B of p)B.enableAttributes(k,o),B.bind(),B.setVertexAttribPointers(k,o,v);for(const B of T)B&&(B.enableAttributes(k,o),B.bind(),B.setVertexAttribPointers(k,o,v));_&&_.bind(),D.currentNumAttributes=M}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function mh(h,o){const c=Math.pow(2,o.canonical.z),p=o.canonical.y;return[new s.MercatorCoordinate(0,p/c).toLngLat().lat,new s.MercatorCoordinate(0,(p+1)/c).toLngLat().lat]}function Yf(h,o,c,p,_,v,T){const S=h.context,M=S.gl,D=c.fbo;if(!D)return;h.prepareDrawTile();const k=h.useProgram("hillshade");S.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,D.colorAttachment.get());const B=((H,Y,F,q)=>{const ne=F.paint.get("hillshade-shadow-color"),ie=F.paint.get("hillshade-highlight-color"),me=F.paint.get("hillshade-accent-color");let ye=F.paint.get("hillshade-illumination-direction")*(Math.PI/180);F.paint.get("hillshade-illumination-anchor")==="viewport"&&(ye-=H.transform.angle);const ge=!H.options.moving;return{u_matrix:q||H.transform.calculateProjMatrix(Y.tileID.toUnwrapped(),ge),u_image:0,u_latrange:mh(0,Y.tileID),u_light:[F.paint.get("hillshade-exaggeration"),ye],u_shadow:ne,u_highlight:ie,u_accent:me}})(h,c,p,h.terrain?o.projMatrix:null);h.prepareDrawProgram(S,k,o.toUnwrapped());const{tileBoundsBuffer:$,tileBoundsIndexBuffer:W,tileBoundsSegments:K}=h.getTileBoundsBuffers(c);k.draw(S,M.TRIANGLES,_,v,T,s.CullFaceMode.disabled,B,p.id,$,W,K)}function gh(h,o,c){if(!o.needsDEMTextureUpload)return;const p=h.context,_=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||h.getTileTexture(c.stride);const v=c.getPixels();o.demTexture?o.demTexture.update(v,{premultiply:!1}):o.demTexture=new s.Texture(p,v,_.RGBA,{premultiply:!1}),o.needsDEMTextureUpload=!1}function Jf(h,o,c,p,_,v){const T=h.context,S=T.gl;if(!o.dem)return;const M=o.dem;if(T.activeTexture.set(S.TEXTURE1),gh(h,o,M),!o.demTexture)return;o.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const D=M.dim;T.activeTexture.set(S.TEXTURE0);let k=o.fbo;if(!k){const K=new s.Texture(T,{width:D,height:D,data:null},S.RGBA);K.bind(S.LINEAR,S.CLAMP_TO_EDGE),k=o.fbo=T.createFramebuffer(D,D,!0),k.colorAttachment.set(K.texture)}T.bindFramebuffer.set(k.framebuffer),T.viewport.set([0,0,D,D]);const{tileBoundsBuffer:B,tileBoundsIndexBuffer:$,tileBoundsSegments:W}=h.getMercatorTileBoundsBuffers();h.useProgram("hillshadePrepare").draw(T,S.TRIANGLES,p,_,v,s.CullFaceMode.disabled,((K,H)=>{const Y=H.stride,F=s.create();return s.ortho(F,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(F,F,[0,-s.EXTENT,0]),{u_matrix:F,u_image:1,u_dimension:[Y,Y],u_zoom:K.overscaledZ,u_unpack:H.unpackVector}})(o.tileID,M),c.id,B,$,W),o.needsHillshadePrepare=!1}const _h=h=>({u_matrix:new s.UniformMatrix4f(h),u_image0:new s.Uniform1i(h),u_skirt_height:new s.Uniform1f(h)}),oa=(h,o)=>({u_matrix:h,u_image0:0,u_skirt_height:o}),vc=(h,o,c,p,_,v,T,S,M,D,k,B,$,W,K)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:c,u_zoom_transition:_,u_merc_center:v,u_image0:0,u_frustum_tl:T,u_frustum_tr:S,u_frustum_br:M,u_frustum_bl:D,u_globe_pos:k,u_globe_radius:B,u_viewport:$,u_grid_matrix:K?Float32Array.from(K):new Float32Array(9),u_skirt_height:W});function sa(h,o){return h!=null&&o!=null&&!(!h.hasData()||!o.hasData())&&h.demTexture!=null&&o.demTexture!=null&&h.tileID.key!==o.tileID.key}const Co=new class{constructor(){this.operations={}}newMorphing(h,o,c,p,_){if(h in this.operations){const v=this.operations[h];v.to.tileID.key!==c.tileID.key&&(v.queued=c)}else this.operations[h]={startTime:p,phase:0,duration:_,from:o,to:c,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const o=this.operations[h];return{from:o.from,to:o.to,phase:o.phase}}update(h){for(const o in this.operations){const c=this.operations[o];for(c.phase=(h-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,h)){delete this.operations[o];break}}}_nextOp(h,o){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=o,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},Es={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function xc(h){return 6*Math.pow(1.5,22-h)}function Qf(h,o){const c=1<<h.z;return!o&&(h.x===0||h.x===c-1)||h.y===0||h.y===c-1}const fl=h=>({u_matrix:h});function yh(h,o,c,p,_){if(_>0){const v=s.exported.now(),T=(v-h.timeAdded)/_,S=o?(v-o.timeAdded)/_:-1,M=c.getSource(),D=p.coveringZoomLevel({tileSize:M.tileSize,roundZoom:M.roundZoom}),k=!o||Math.abs(o.tileID.overscaledZ-D)>Math.abs(h.tileID.overscaledZ-D),B=k&&h.refreshedUponExpiration?1:s.clamp(k?T:1-S,0,1);return h.refreshedUponExpiration&&T>=1&&(h.refreshedUponExpiration=!1),o?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class vh extends s.SourceCache{constructor(o){const c={type:"raster-dem",maxzoom:o.transform.maxZoom},p=new Tt(Jo(),null),_=Vt("mock-dem",c,p,o.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,c){o.state="loaded",c(null)}}class wc extends s.SourceCache{constructor(o){const c=Vt("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new Tt(Jo(),null),o.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,c,p){if(o.freezeTileCoverage)return;this.transform=o;const _=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,T)=>{if(v[T.key]="",!this._tiles[T.key]){const S=new s.Tile(T,this._source.tileSize*T.overscaleFactor(),o.tileZoom);S.state="loaded",this._tiles[T.key]=S}return v},{});for(const v in this._tiles)v in _||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(o){const c=this.proxyCachedFBO[o];if(c!==void 0){const p=Object.values(c);this.renderCachePool.push(...p),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class bc extends s.OverscaledTileID{constructor(o,c,p){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=c,this.projMatrix=p}}class xh extends s.Elevation{constructor(o,c){super(),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,_,v]=function(M){const D=new s.StructArrayLayout2i4,k=new s.StructArrayLayout3ui6,B=131;D.reserve(17161),k.reserve(33800);const $=s.EXTENT/128,W=s.EXTENT+$/2,K=W+$;for(let Y=-$;Y<K;Y+=$)for(let F=-$;F<K;F+=$){const q=F<0||F>W||Y<0||Y>W?24575:0,ne=s.clamp(Math.round(F),0,s.EXTENT),ie=s.clamp(Math.round(Y),0,s.EXTENT);D.emplaceBack(ne+q,ie)}const H=(Y,F)=>{const q=F*B+Y;k.emplaceBack(q+1,q,q+B),k.emplaceBack(q+B,q+B+1,q+1)};for(let Y=1;Y<129;Y++)for(let F=1;F<129;F++)H(F,Y);return[0,129].forEach(Y=>{for(let F=0;F<130;F++)H(F,Y),H(Y,F)}),[D,k,32768]}(),T=o.context;this.gridBuffer=T.createVertexBuffer(p,s.posAttributes.members),this.gridIndexBuffer=T.createIndexBuffer(_),this.gridSegments=s.SegmentVector.simpleSegment(0,0,p.length,_.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,p.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new wc(c.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.EXTENT,0,s.EXTENT,0,1);const S=T.gl;this._overlapStencilMode=new s.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new vh(c.map)}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),o.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=o,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,c,p){if(o&&o.terrain){this._style!==o&&(this.style=o),this.enabled=!0;const _=o.terrain.properties;this.sourceCache=o.terrain.drapeRenderMode===0?this._mockSourceCache:o._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");const v=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const T=this.getScaledDemTileSize();this.sourceCache.update(c,T,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),c.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const o=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||o.efficiency!==100&&s.warnOnce(`Terrain render cache efficiency is not optimal (${o.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${o.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(o){o.coord&&o.dataType==="source"?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._sourceCaches)this._style._sourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=c.getIds().map(M=>{const D=c.getTileByID(M).tileID;return D.projMatrix=p.calculateProjMatrix(D.toUnwrapped()),D});(function(M,D){const k=D.transform.pointCoordinate(D.transform.getCameraPoint()),B=new s.Point(k.x,k.y);M.sort(($,W)=>{if(W.overscaledZ-$.overscaledZ)return W.overscaledZ-$.overscaledZ;const K=new s.Point($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),H=new s.Point(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),Y=B.mult(1<<$.canonical.z);return Y.x-=.5,Y.y-=.5,Y.distSqr(K)-Y.distSqr(H)})})(_,this.painter),this._previousZoom=p.zoom;const v=this.proxyToSource||{};this.proxyToSource={},_.forEach(M=>{this.proxyToSource[M.key]={}}),this.terrainTileForTile={};const T=this._style._sourceCaches;for(const M in T){const D=T[M];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,o[M],v),D.usedForTerrain))continue;const k=o[M];D.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[c.id]=_.map(M=>new bc(M,M.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const S={};this._visibleDemTiles=[];for(const M of this.proxyCoords){const D=this.terrainTileForTile[M.key];if(!D)continue;const k=D.tileID.key;k in S||(this._visibleDemTiles.push(D),S[k]=k)}}_assignTerrainTiles(o){this._initializing||o.forEach(c=>{if(this.terrainTileForTile[c.key])return;const p=this._findTileCoveringTileID(c,this.sourceCache);p&&(this.terrainTileForTile[c.key]=p)})}_prepareDEMTextures(){const o=this.painter.context,c=o.gl;for(const p in this.terrainTileForTile){const _=this.terrainTileForTile[p],v=_.dem;!v||_.demTexture&&!_.needsDEMTextureUpload||(o.activeTexture.set(c.TEXTURE1),gh(this.painter,_,v))}}_prepareDemTileUniforms(o,c,p,_){if(!c||c.demTexture==null)return!1;const v=o.tileID.canonical,T=Math.pow(2,c.tileID.canonical.z-v.z),S=_||"";return p[`u_dem_tl${S}`]=[v.x*T%1,v.y*T%1],p[`u_dem_scale${S}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const o=this.painter.context,c=o.gl;if(!this._emptyDepthBufferTexture){const p=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(o,p,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let o=0;const c=this._visibleDemTiles.reduce((p,_)=>{if(!_.dem)return p;const v=_.dem.tree.minimums[0];return v>0&&o++,p+v},0);return o?c/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,c=o.gl;o.activeTexture.set(c.TEXTURE2);const p=this._getLoadedAreaMinimum(),_=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(p,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(_,{premultiply:!1}):v=this._emptyDEMTexture=new s.Texture(o,_,c.RGBA,{premultiply:!1}),v}setupElevationDraw(o,c,p){const _=this.painter.context,v=_.gl,T=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var S;T.u_dem_size=this.sourceCache.getSource().tileSize,T.u_exaggeration=this.exaggeration();let M=null,D=null,k=1;if(p&&p.morphing&&this._useVertexMorphing){const B=p.morphing.srcDemTile,$=p.morphing.dstDemTile;k=p.morphing.phase,B&&$&&(this._prepareDemTileUniforms(o,B,T,"_prev")&&(D=B),this._prepareDemTileUniforms(o,$,T)&&(M=$))}if(D&&M?(_.activeTexture.set(v.TEXTURE2),M.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),_.activeTexture.set(v.TEXTURE4),D.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),T.u_dem_lerp=k):(M=this.terrainTileForTile[o.tileID.key],_.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(o,M,T)?M.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE)),_.activeTexture.set(v.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&M){const B=(1<<M.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=B}if(p&&p.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),c.setTerrainUniformValues(_,T),this.painter.transform.projection.name==="globe"){const B=this.globeUniformValues(this.painter.transform,o.tileID.canonical,p&&p.useDenormalizedUpVectorScale);c.setGlobeUniformValues(_,B)}}globeUniformValues(o,c,p){const _=o.projection;return{u_tile_tl_up:_.upVector(c,0,0),u_tile_tr_up:_.upVector(c,s.EXTENT,0),u_tile_br_up:_.upVector(c,s.EXTENT,s.EXTENT),u_tile_bl_up:_.upVector(c,0,s.EXTENT),u_tile_up_scale:p?s.globeMetersToEcef(1):_.upVectorScale(c,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){const c=this.painter,p=this.painter.context;o.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,v,T,S,M){if(_.transform.projection.name==="globe")(function(D,k,B,$,W){const K=D.context,H=K.gl;let Y,F;const q=D.options.showTerrainWireframe?2:0,ne=D.transform,ie=s.globeUseCustomAntiAliasing(D,K,ne),me=(Ke,Ae)=>{if(F===Ke)return;const Ne=[Es[Ke],"PROJECTION_GLOBE_VIEW"];ie&&Ne.push("CUSTOM_ANTIALIASING"),Ae&&Ne.push(Es[q]),Y=D.useProgram("globeRaster",null,Ne),F=Ke},ye=D.colorModeForRenderPass(),ge=new s.DepthMode(H.LEQUAL,s.DepthMode.ReadWrite,D.depthRangeFor3D);Co.update(W);const be=s.calculateGlobeMercatorMatrix(ne),xe=[s.mercatorXfromLng(ne.center.lng),s.mercatorYfromLat(ne.center.lat)],Me=q?[!1,!0]:[!1],Qe=D.globeSharedBuffers,Ee=[ne.width*s.exported.devicePixelRatio,ne.height*s.exported.devicePixelRatio],je=Float32Array.from(ne.globeMatrix),Ie={useDenormalizedUpVectorScale:!0};if(Me.forEach(Ke=>{const Ae=D.transform,Ne=xc(Ae.zoom)*k.exaggeration();F=-1;const tt=Ke?H.LINES:H.TRIANGLES;for(const Ze of $){const it=B.getTile(Ze),bt=s.StencilMode.disabled,zt=k.prevTerrainTileForTile[Ze.key],_t=k.terrainTileForTile[Ze.key];sa(zt,_t)&&Co.newMorphing(Ze.key,zt,_t,W,250),K.activeTexture.set(H.TEXTURE0),it.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const At=Co.getMorphValuesForProxy(Ze.key),Ht=At?1:0;At&&s.extend$1(Ie,{morphing:{srcDemTile:At.from,dstDemTile:At.to,phase:s.easeCubicInOut(At.phase)}});const qt=s.tileCornersToBounds(Ze.canonical),xt=s.getLatitudinalLod(qt.getCenter().lat),hn=s.getGridMatrix(Ze.canonical,qt,xt,Ae.worldSize/Ae._pixelsPerMercatorPixel),_n=s.globeNormalizeECEF(s.globeTileBounds(Ze.canonical)),yn=vc(Ae.projMatrix,je,be,_n,s.globeToMercatorTransition(Ae.zoom),xe,Ae.frustumCorners.TL,Ae.frustumCorners.TR,Ae.frustumCorners.BR,Ae.frustumCorners.BL,Ae.globeCenterInViewSpace,Ae.globeRadius,Ee,Ne,hn);if(me(Ht,Ke),k.setupElevationDraw(it,Y,Ie),D.prepareDrawProgram(K,Y,Ze.toUnwrapped()),Qe){const[vn,Fi,bi]=Ke?Qe.getWirefameBuffers(D.context,xt):Qe.getGridBuffers(xt,Ne!==0);Y.draw(K,tt,ge,bt,ye,s.CullFaceMode.backCCW,yn,"globe_raster",vn,Fi,bi)}}}),Qe){const Ke=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ie&&Ke.push("CUSTOM_ANTIALIASING"),Y=D.useProgram("globeRaster",null,Ke);for(const Ae of $){const{x:Ne,y:tt,z:Ze}=Ae.canonical,it=tt===0,bt=tt===(1<<Ze)-1,[zt,_t,At,Ht]=Qe.getPoleBuffers(Ze);if(Ht&&(it||bt)){const qt=B.getTile(Ae);K.activeTexture.set(H.TEXTURE0),qt.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let xt=s.globePoleMatrixForTile(Ze,Ne,ne);const hn=s.globeNormalizeECEF(s.globeTileBounds(Ae.canonical)),_n=(yn,vn)=>yn.draw(K,H.TRIANGLES,ge,s.StencilMode.disabled,ye,s.CullFaceMode.disabled,vc(ne.projMatrix,xt,xt,hn,0,xe,ne.frustumCorners.TL,ne.frustumCorners.TR,ne.frustumCorners.BR,ne.frustumCorners.BL,ne.globeCenterInViewSpace,ne.globeRadius,Ee,0),"globe_pole_raster",vn,At,Ht);k.setupElevationDraw(qt,Y,Ie),D.prepareDrawProgram(K,Y,Ae.toUnwrapped()),it&&_n(Y,zt),bt&&(xt=s.scale(s.create(),xt,[1,-1,1]),_n(Y,_t))}}}})(_,v,T,S,M);else{const D=_.context,k=D.gl;let B,$;const W=_.options.showTerrainWireframe?2:0,K=(ne,ie)=>{if($===ne)return;const me=[Es[ne]];ie&&me.push(Es[W]),B=_.useProgram("terrainRaster",null,me),$=ne},H=_.colorModeForRenderPass(),Y=new s.DepthMode(k.LEQUAL,s.DepthMode.ReadWrite,_.depthRangeFor3D);Co.update(M);const F=_.transform,q=xc(F.zoom)*v.exaggeration();(W?[!1,!0]:[!1]).forEach(ne=>{$=-1;const ie=ne?k.LINES:k.TRIANGLES,[me,ye]=ne?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(const ge of S){const be=T.getTile(ge),xe=s.StencilMode.disabled,Me=v.prevTerrainTileForTile[ge.key],Qe=v.terrainTileForTile[ge.key];sa(Me,Qe)&&Co.newMorphing(ge.key,Me,Qe,M,250),D.activeTexture.set(k.TEXTURE0),be.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST);const Ee=Co.getMorphValuesForProxy(ge.key),je=Ee?1:0;let Ie;Ee&&(Ie={morphing:{srcDemTile:Ee.from,dstDemTile:Ee.to,phase:s.easeCubicInOut(Ee.phase)}});const Ke=oa(ge.projMatrix,Qf(ge.canonical,F.renderWorldCopies)?q/10:q);K(je,ne),v.setupElevationDraw(be,B,Ie),_.prepareDrawProgram(D,B,ge.toUnwrapped()),B.draw(D,ie,Y,xe,H,s.CullFaceMode.backCCW,Ke,"terrain_raster",v.gridBuffer,me,ye)}})}}(c,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const c=this.painter,p=this.painter.context,_=this.proxySourceCache,v=this.proxiedCoords[_.id],T=this._drapedRenderBatches.shift(),S=[],M=c.style.order;let D=0;for(const k of v){const B=_.getTileByID(k.proxyTileKey),$=_.proxyCachedFBO[k.key]?_.proxyCachedFBO[k.key][o]:void 0,W=$!==void 0?_.renderCache[$]:this.pool[D++],K=$!==void 0;if(B.texture=W.tex,K&&!W.dirty){S.push(B.tileID);continue}let H;p.bindFramebuffer.set(W.fb.framebuffer),this.renderedToTile=!1,W.dirty&&(p.clear({color:s.Color.transparent,stencil:0}),W.dirty=!1);for(let Y=T.start;Y<=T.end;++Y){const F=c.style._layers[M[Y]];if(F.isHidden(c.transform.zoom))continue;const q=c.style._getLayerSourceCache(F),ne=q?this.proxyToSource[k.key][q.id]:[k];if(!ne)continue;const ie=ne;p.viewport.set([0,0,W.fb.width,W.fb.height]),H!==(q?q.id:null)&&(this._setupStencil(W,ne,F,q),H=q?q.id:null),c.renderLayer(c,q,F,ie)}this.renderedToTile?(W.dirty=!0,S.push(B.tileID)):K||--D,D===5&&(D=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),T.end+1}postRender(){}renderCacheEfficiency(o){const c=o.order.length;if(c===0)return{efficiency:100};let p,_=0,v=0,T=!1;for(let S=0;S<c;++S){const M=o._layers[o.order[S]];this._style.isLayerDraped(M)?(T&&++_,++v):T||(T=!0,p=M.id)}return v===0?{efficiency:100}:{efficiency:100*(1-_/v),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{o=Math.min(o,c.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,c,p){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const T=v.tileID,S=1<<T.overscaledZ,{x:M,y:D}=T.canonical,k=M/S,B=(M+1)/S,$=D/S,W=(D+1)/S;return{minx:k,miny:$,maxx:B,maxy:W,t:v.dem.tree.raycastRoot(k,$,B,W,o,c,p),tile:v}});_.sort((v,T)=>(v.t!==null?v.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const v of _){if(v.t==null)return null;const T=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,o,c,p);if(T!=null)return T}return null}_createFBO(){const o=this.painter.context,c=o.gl,p=this.drapeBufferSize;o.activeTexture.set(c.TEXTURE0);const _=new s.Texture(o,{width:p[0],height:p[1],data:null},c.RGBA);_.bind(c.LINEAR,c.CLAMP_TO_EDGE);const v=o.createFramebuffer(p[0],p[1],!1);return v.colorAttachment.set(_.texture),v.depthAttachment=new _e(o,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&!o.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:v,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const c=this._style._layers[o],p=c.isHidden(this.painter.transform.zoom);return c.type==="custom"?!p&&c.shouldRedrape():!p&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(const p of this._style._getSources())if(p instanceof lt){o=!0;break}if(!o)return;const c={};for(let p=0;p<this._style.order.length;++p){const _=this._style._layers[this._style.order[p]],v=this._style._getLayerSourceCache(_);if(v&&!c[v.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof s.ZoomDependentExpression){c[v.id]=!0;for(const T of this.proxyCoords){const S=this.proxyToSource[T.key][v.id];if(S)for(const M of S)this._clearRenderCacheForTile(v.id,M)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(const p in this._style._sourceCaches)if(this._style._sourceCaches[p]._source instanceof Je){o=!0;break}if(!o)return;const c={};for(let p=0;p<this._style.order.length;++p){const _=this._style._layers[this._style.order[p]],v=this._style._getLayerSourceCache(_);if(!v||c[v.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const T=_.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const M=this.proxyToSource[S.key][v.id];if(M)for(const D of M){const k=yh(v.getTile(D),v.findLoadedParent(D,0),v,this.painter.transform,T);(k.opacity!==1||k.mix!==0)&&this._clearRenderCacheForTile(v.id,D)}}}}_setupDrapedRenderBatches(){const o=this._style.order,c=o.length;if(c===0)return;const p=[];let _,v=0,T=this._style._layers[o[v]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++v<c;)T=this._style._layers[o[v]];for(;v<c;++v){const S=this._style._layers[o[v]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?_===void 0&&(_=v):_!==void 0&&(p.push({start:_,end:v-1}),_=void 0))}_!==void 0&&p.push({start:_,end:v-1}),this._drapedRenderBatches=p}_setupRenderCache(o){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const T=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let S=0;S<T.length;++S){const M=Object.values(T[S]);c.renderCachePool.push(...M)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,_=this._tilesDirty;for(let T=p.length-1;T>=0;T--){const S=p[T];if(c.getTileByID(S.key),c.proxyCachedFBO[S.key]!==void 0){const M=o[S.key],D=this.proxyToSource[S.key];let k=0;for(const B in D){const $=D[B],W=M[B];if(!W||W.length!==$.length||$.some((K,H)=>K!==W[H]||_[B]&&_[B].hasOwnProperty(K.key))){k=-1;break}++k}for(const B in c.proxyCachedFBO[S.key])c.renderCache[c.proxyCachedFBO[S.key][B]].dirty=k<0||k!==Object.values(M).length}}const v=[...this._drapedRenderBatches];v.sort((T,S)=>S.end-S.start-(T.end-T.start));for(const T of v)for(const S of p){if(c.proxyCachedFBO[S.key])continue;let M=c.renderCachePool.pop();M===void 0&&c.renderCache.length<50&&(M=c.renderCache.length,c.renderCache.push(this._createFBO())),M!==void 0&&(c.proxyCachedFBO[S.key]={},c.proxyCachedFBO[S.key][T.start]=M,c.renderCache[M].dirty=!0)}this._tilesDirty={}}_setupStencil(o,c,p,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,T=v.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let S;if(p.isTileClipped())S=c.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(o,c){const p=this.painter,_=this.painter.context,v=_.gl;p._tileClippingMaskIDs={},_.setColorMode(s.ColorMode.disabled),_.setDepthMode(s.DepthMode.disabled);const T=p.useProgram("clippingMask");for(const S of o){const M=p._tileClippingMaskIDs[S.key]=--c;T.draw(_,v.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:v.ALWAYS,mask:0},M,255,v.KEEP,v.KEEP,v.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,fl(S.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(o){const c=this.painter.transform;if(o.x<0||o.x>c.width||o.y<0||o.y>c.height)return null;const p=[o.x,o.y,1,1];s.transformMat4$1(p,p,c.pixelMatrixInverse),s.scale$1(p,p,1/p[3]),p[0]/=c.worldSize,p[1]/=c.worldSize;const _=c._camera.position,v=s.mercatorZfromAltitude(1,c.center.lat),T=[_[0],_[1],_[2]/v,0],S=s.subtract([],p.slice(0,3),T);s.normalize(S,S);const M=this.raycast(T,S,this._exaggeration);return M!==null&&M?(s.scaleAndAdd(T,T,S,M),T[3]=T[2],T[2]*=v,T):null}drawDepth(){const o=this.painter,c=o.context,p=this.proxySourceCache,_=Math.ceil(o.width),v=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const T=c.gl,S=c.createFramebuffer(_,v,!0);c.activeTexture.set(T.TEXTURE0);const M=new s.Texture(c,{width:_,height:v,data:null},T.RGBA);M.bind(T.NEAREST,T.CLAMP_TO_EDGE),S.colorAttachment.set(M.texture);const D=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,_,v);S.depthAttachment.set(D),this._depthFBO=S,this._depthTexture=M}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,_,v]),function(T,S,M,D){if(T.transform.projection.name==="globe")return;const k=T.context,B=k.gl;k.clear({depth:1});const $=T.useProgram("terrainDepth"),W=new s.DepthMode(B.LESS,s.DepthMode.ReadWrite,T.depthRangeFor3D);for(const K of D){const H=M.getTile(K),Y=oa(K.projMatrix,0);S.setupElevationDraw(H,$),$.draw(k,B.TRIANGLES,W,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,Y,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(o,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,c,p){if(o.getSource()instanceof Rt)return this._setupProxiedCoordsForImageSource(o,c,p);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const _=this.proxiedCoords[o.id]=[],v=this.proxyCoords;for(let S=0;S<v.length;S++){const M=v[S],D=this._findTileCoveringTileID(M,o);if(D){const k=this._createProxiedId(M,D,p[M.key]&&p[M.key][o.id]);_.push(k),this.proxyToSource[M.key][o.id]=[k]}}let T=!1;for(let S=0;S<c.length;S++){const M=o.getTile(c[S]);if(!M||!M.hasData())continue;const D=this._findTileCoveringTileID(M.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==M.tileID.canonical.z){const k=this.proxyToSource[D.tileID.key][o.id],B=this._createProxiedId(D.tileID,M,p[D.tileID.key]&&p[D.tileID.key][o.id]);k?k.splice(k.length-1,0,B):this.proxyToSource[D.tileID.key][o.id]=[B],_.push(B),T=!0}}this._sourceTilesOverlap[o.id]=T}_setupProxiedCoordsForImageSource(o,c,p){if(!o.getSource().loaded())return;const _=this.proxiedCoords[o.id]=[],v=this.proxyCoords,T=o.getSource(),S=new s.Point(T.tileID.x,T.tileID.y)._div(1<<T.tileID.z),M=T.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce((k,B)=>(k.min.x=Math.min(k.min.x,B.x-S.x),k.min.y=Math.min(k.min.y,B.y-S.y),k.max.x=Math.max(k.max.x,B.x-S.x),k.max.y=Math.max(k.max.y,B.y-S.y),k),{min:new s.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(k,B)=>{const $=k.wrap+k.canonical.x/(1<<k.canonical.z),W=k.canonical.y/(1<<k.canonical.z),K=s.EXTENT/(1<<k.canonical.z),H=B.wrap+B.canonical.x/(1<<B.canonical.z),Y=B.canonical.y/(1<<B.canonical.z);return $+K<H+M.min.x||$>H+M.max.x||W+K<Y+M.min.y||W>Y+M.max.y};for(let k=0;k<v.length;k++){const B=v[k];for(let $=0;$<c.length;$++){const W=o.getTile(c[$]);if(!W||!W.hasData()||D(B,W.tileID))continue;const K=this._createProxiedId(B,W,p[B.key]&&p[B.key][o.id]),H=this.proxyToSource[B.key][o.id];H?H.push(K):this.proxyToSource[B.key][o.id]=[K],_.push(K)}}}_createProxiedId(o,c,p){let _=this.orthoMatrix;if(p){const v=p.find(T=>T.key===c.tileID.key);if(v)return v}if(c.tileID.key!==o.key){const v=o.canonical.z-c.tileID.canonical.z;let T,S,M;_=s.create();const D=c.tileID.wrap-o.wrap<<o.overscaledZ;v>0?(T=s.EXTENT>>v,S=T*((c.tileID.canonical.x<<v)-o.canonical.x+D),M=T*((c.tileID.canonical.y<<v)-o.canonical.y)):(T=s.EXTENT<<-v,S=s.EXTENT*(c.tileID.canonical.x-(o.canonical.x+D<<-v)),M=s.EXTENT*(c.tileID.canonical.y-(o.canonical.y<<-v))),s.ortho(_,0,T,0,T,0,1),s.translate(_,_,[S,M,0])}return new bc(c.tileID,o.key,_)}_findTileCoveringTileID(o,c){let p=c.getTile(o);if(p&&p.hasData())return p;const _=this._findCoveringTileCache[c.id],v=_[o.key];if(p=v?c.getTileByID(v):null,p&&p.hasData()||v===null)return p;let T=p?p.tileID:o,S=T.overscaledZ;const M=c.getSource().minzoom,D=[];if(!v){const B=c.getSource().maxzoom;if(o.canonical.z>=B){const $=o.canonical.z-B;c.getSource().reparseOverscaled?(S=Math.max(o.canonical.z+2,c.transform.tileZoom),T=new s.OverscaledTileID(S,o.wrap,B,o.canonical.x>>$,o.canonical.y>>$)):$!==0&&(S=B,T=new s.OverscaledTileID(S,o.wrap,B,o.canonical.x>>$,o.canonical.y>>$))}T.key!==o.key&&(D.push(T.key),p=c.getTile(T))}const k=B=>{D.forEach($=>{_[$]=B}),D.length=0};for(S-=1;S>=M&&(!p||!p.hasData());S--){p&&k(p.tileID.key);const B=T.calculateScaledKey(S);if(p=c.getTileByID(B),p&&p.hasData())break;const $=_[B];if($===null)break;$===void 0?D.push(B):p=c.getTileByID($)}return k(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,c){let p=this._tilesDirty[o];p||(p=this._tilesDirty[o]={}),p[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const o=function(c){let p=0;const _=new s.StructArrayLayout2ui4,v=131;for(let T=1;T<129;T++){for(let S=1;S<129;S++)p=T*v+S,_.emplaceBack(p,p+1),_.emplaceBack(p,p+v),_.emplaceBack(p+1,p+v),T===128&&_.emplaceBack(p+v,p+v+1);_.emplaceBack(p+1,p+1+v)}return _}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(o),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,o.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Yt{static cacheKey(o,c,p,_){let v=`${c}${_?_.cacheKey:""}`;for(const T of p)o.usedDefines.includes(T)&&(v+=`/${T}`);return v}constructor(o,c,p,_,v,T){const S=o.gl;this.program=S.createProgram();const M=function(F){const q=[];for(let ne=0;ne<F.length;ne++){if(F[ne]===null)continue;const ie=F[ne].split(" ");q.push(ie.pop())}return q}(p.staticAttributes),D=_?_.getBinderAttributes():[],k=M.concat(D);let B=_?_.defines():[];B=B.concat(T.map(F=>`#define ${F}`));const $=o.isWebGL2?`#version 300 es
`:"",W=$+B.concat(o.extStandardDerivatives&&$.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(fh):fh,fh,yc,Kf.fragmentSource,ia.fragmentSource,p.fragmentSource).join(`
`),K=$+B.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,yc,Kf.vertexSource,ia.vertexSource,_c.vertexSource,p.vertexSource).join(`
`),H=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(H,W),S.compileShader(H),S.attachShader(this.program,H);const Y=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(Y,K),S.compileShader(Y),S.attachShader(this.program,Y),this.attributes={},this.numAttributes=k.length;for(let F=0;F<this.numAttributes;F++)k[F]&&(S.bindAttribLocation(this.program,F,k[F]),this.attributes[k[F]]=F);S.linkProgram(this.program),S.deleteShader(Y),S.deleteShader(H),this.fixedUniforms=v(o),this.binderUniforms=_?_.getUniforms(o):[],T.includes("TERRAIN")&&(this.terrainUniforms=(F=>({u_dem:new s.Uniform1i(F),u_dem_prev:new s.Uniform1i(F),u_dem_unpack:new s.Uniform4f(F),u_dem_tl:new s.Uniform2f(F),u_dem_scale:new s.Uniform1f(F),u_dem_tl_prev:new s.Uniform2f(F),u_dem_scale_prev:new s.Uniform1f(F),u_dem_size:new s.Uniform1f(F),u_dem_lerp:new s.Uniform1f(F),u_exaggeration:new s.Uniform1f(F),u_depth:new s.Uniform1i(F),u_depth_size_inv:new s.Uniform2f(F),u_meter_to_dem:new s.Uniform1f(F),u_label_plane_matrix_inv:new s.UniformMatrix4f(F)}))(o)),T.includes("GLOBE")&&(this.globeUniforms=(F=>({u_tile_tl_up:new s.Uniform3f(F),u_tile_tr_up:new s.Uniform3f(F),u_tile_br_up:new s.Uniform3f(F),u_tile_bl_up:new s.Uniform3f(F),u_tile_up_scale:new s.Uniform1f(F)}))(o)),T.includes("FOG")&&(this.fogUniforms=(F=>({u_fog_matrix:new s.UniformMatrix4f(F),u_fog_range:new s.Uniform2f(F),u_fog_color:new s.Uniform4f(F),u_fog_horizon_blend:new s.Uniform1f(F),u_fog_temporal_offset:new s.Uniform1f(F),u_frustum_tl:new s.Uniform3f(F),u_frustum_tr:new s.Uniform3f(F),u_frustum_br:new s.Uniform3f(F),u_frustum_bl:new s.Uniform3f(F),u_globe_pos:new s.Uniform3f(F),u_globe_radius:new s.Uniform1f(F),u_globe_transition:new s.Uniform1f(F),u_is_globe:new s.Uniform1i(F),u_viewport:new s.Uniform2f(F)}))(o))}}setTerrainUniformValues(o,c){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const _ in c)p[_]&&p[_].set(this.program,_,c[_])}}setGlobeUniformValues(o,c){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const _ in c)p[_]&&p[_].set(this.program,_,c[_])}}setFogUniformValues(o,c){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const _ in c)p[_].set(this.program,_,c[_])}}draw(o,c,p,_,v,T,S,M,D,k,B,$,W,K,H){const Y=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(p),o.setStencilMode(_),o.setColorMode(v),o.setCullFace(T);for(const q of Object.keys(this.fixedUniforms))this.fixedUniforms[q].set(this.program,q,S[q]);K&&K.setUniforms(this.program,o,this.binderUniforms,$,{zoom:W});const F={[Y.LINES]:2,[Y.TRIANGLES]:3,[Y.LINE_STRIP]:1}[c];for(const q of B.get()){const ne=q.vaos||(q.vaos={});(ne[M]||(ne[M]=new u_)).bind(o,this,D,K?K.getPaintVertexBuffers():[],k,q.vertexOffset,H||[]),Y.drawElements(c,q.primitiveLength*F,Y.UNSIGNED_SHORT,q.primitiveOffset*F*2)}}}function pl(h,o){const c=Math.pow(2,o.tileID.overscaledZ),p=o.tileSize*Math.pow(2,h.transform.tileZoom)/c,_=p*(o.tileID.canonical.x+o.tileID.wrap*c),v=p*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_tile_units_to_pixels:1/wt(o,1,h.transform.tileZoom),u_pixel_coord_upper:[_>>16,v>>16],u_pixel_coord_lower:[65535&_,65535&v]}}const ep=s.create(),wh=(h,o,c,p,_,v,T,S,M,D,k)=>{const B=o.style.light,$=B.properties.get("position"),W=[$.x,$.y,$.z],K=s.create$1();B.properties.get("anchor")==="viewport"&&(s.fromRotation(K,-o.transform.angle),s.transformMat3(W,W,K));const H=B.properties.get("color"),Y=o.transform,F={u_matrix:h,u_lightpos:W,u_lightintensity:B.properties.get("intensity"),u_lightcolor:[H.r,H.g,H.b],u_vertical_gradient:+c,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ep,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:v};return Y.projection.name==="globe"&&(F.u_tile_id=[T.canonical.x,T.canonical.y,1<<T.canonical.z],F.u_zoom_transition=M,F.u_inv_rot_matrix=k,F.u_merc_center=D,F.u_up_dir=Y.projection.upVector(new s.CanonicalTileID(0,0,0),D[0]*s.EXTENT,D[1]*s.EXTENT),F.u_height_lift=S),F},tp=(h,o,c,p,_,v,T,S,M,D,k,B)=>{const $=wh(h,o,c,p,_,v,T,M,D,k,B),W={u_height_factor:-Math.pow(2,T.overscaledZ)/S.tileSize/8};return s.extend($,pl(o,S),W)},Ss=h=>({u_matrix:h}),bh=(h,o,c)=>s.extend(Ss(h),pl(o,c)),h_=(h,o)=>({u_matrix:h,u_world:o}),d_=(h,o,c,p)=>s.extend(bh(h,o,c),{u_world:p}),f_=s.create(),Th=(h,o,c,p,_,v)=>{const T=h.transform,S=T.projection.name==="globe";let M;if(v.paint.get("circle-pitch-alignment")==="map")if(S){const k=s.globePixelsToTileUnits(T.zoom,o.canonical)*T._pixelsPerMercatorPixel;M=Float32Array.from([k,0,0,k])}else M=T.calculatePixelsToTileUnitsMatrix(c);else M=new Float32Array([T.pixelsToGLUnits[0],0,0,T.pixelsToGLUnits[1]]);const D={u_camera_to_center_distance:T.cameraToCenterDistance,u_matrix:h.translatePosMatrix(o.projMatrix,c,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:M,u_inv_rot_matrix:f_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){D.u_inv_rot_matrix=p,D.u_merc_center=_,D.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],D.u_zoom_transition=s.globeToMercatorTransition(T.zoom);const k=_[0]*s.EXTENT,B=_[1]*s.EXTENT;D.u_up_dir=T.projection.upVector(new s.CanonicalTileID(0,0,0),k,B)}return D},Eh=h=>{const o=[];return h.paint.get("circle-pitch-alignment")==="map"&&o.push("PITCH_WITH_MAP"),h.paint.get("circle-pitch-scale")==="map"&&o.push("SCALE_WITH_MAP"),o},Sh=(h,o,c,p)=>{const _=s.EXTENT/c.tileSize;return{u_matrix:h,u_camera_to_center_distance:o.getCameraToCenterDistance(p),u_extrude_scale:[o.pixelsToGLUnits[0]/_,o.pixelsToGLUnits[1]/_]}},Tc=(h,o,c=1)=>({u_matrix:h,u_color:o,u_overlay:0,u_overlay_scale:c}),np=s.create(),ip=(h,o,c,p,_,v,T)=>{const S=h.transform,M=S.projection.name==="globe",D=M?s.globePixelsToTileUnits(S.zoom,o.canonical)*S._pixelsPerMercatorPixel:wt(c,1,v),k={u_matrix:o.projMatrix,u_extrude_scale:D,u_intensity:T,u_inv_rot_matrix:np,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){k.u_inv_rot_matrix=p,k.u_merc_center=_,k.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],k.u_zoom_transition=s.globeToMercatorTransition(S.zoom);const B=_[0]*s.EXTENT,$=_[1]*s.EXTENT;k.u_up_dir=S.projection.upVector(new s.CanonicalTileID(0,0,0),B,$)}return k},p_=(h,o,c,p,_,v,T)=>{const S=h.transform,M=S.calculatePixelsToTileUnitsMatrix(o);return{u_matrix:Ch(h,o,c,p),u_pixels_to_tile_units:M,u_device_pixel_ratio:v,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_,u_texsize:gl(c)?o.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:aa(o,h.transform),u_alpha_discard_threshold:0,u_trim_offset:T}},ml=(h,o,c,p,_)=>{const v=h.transform;return{u_matrix:Ch(h,o,c,p),u_texsize:o.imageAtlasTexture.size,u_pixels_to_tile_units:v.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:_,u_image:0,u_tile_units_to_pixels:aa(o,v),u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function aa(h,o){return 1/wt(h,1,o.tileZoom)}function Ch(h,o,c,p){return h.translatePosMatrix(p||o.tileID.projMatrix,o,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function gl(h){const o=h.paint.get("line-dasharray").value;return o.value||o.kind!=="constant"}const Ah=(h,o,c,p,_,v)=>{return{u_matrix:h,u_tl_parent:o,u_scale_parent:c,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(S=_.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(T=_.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:eo(_.paint.get("raster-hue-rotate")),u_perspective_transform:v};var T,S};function eo(h){h*=Math.PI/180;const o=Math.sin(h),c=Math.cos(h);return[(2*c+1)/3,(-Math.sqrt(3)*o-c+1)/3,(Math.sqrt(3)*o-c+1)/3]}const Ec=s.create(),Mh=(h,o,c,p,_,v,T,S,M,D,k,B,$,W,K,H)=>{const Y=_.transform,F={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:Y.cameraToCenterDistance,u_rotate_symbol:+c,u_aspect_ratio:Y.width/Y.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:T,u_coord_matrix:S,u_is_text:+M,u_pitch_with_map:+p,u_texsize:D,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ec,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ec,u_up_vector:[0,-1,0]};return H.name==="globe"&&(F.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],F.u_zoom_transition=B,F.u_inv_rot_matrix=W,F.u_merc_center=$,F.u_camera_forward=Y._camera.forward(),F.u_ecef_origin=s.globeECEFOrigin(Y.globeMatrix,k.toUnwrapped()),F.u_tile_matrix=Float32Array.from(Y.globeMatrix),F.u_up_vector=K),F},Sc=(h,o,c,p,_,v,T,S,M,D,k,B,$,W,K,H,Y)=>s.extend(Mh(h,o,c,p,_,v,T,S,M,D,B,$,W,K,H,Y),{u_gamma_scale:p?_.transform.cameraToCenterDistance*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:+k}),rp=(h,o,c,p,_,v,T,S,M,D,k,B,$,W,K,H)=>s.extend(Sc(h,o,c,p,_,v,T,S,!0,M,!0,k,B,$,W,K,H),{u_texsize_icon:D,u_texture_icon:1}),Ph=(h,o,c)=>({u_matrix:h,u_opacity:o,u_color:c}),m_=(h,o,c,p,_)=>s.extend(function(v,T,S){const M=T.imageManager.getPattern(v.toString()),{width:D,height:k}=T.imageManager.getPixelSize(),B=Math.pow(2,S.tileID.overscaledZ),$=S.tileSize*Math.pow(2,T.transform.tileZoom)/B,W=$*(S.tileID.canonical.x+S.tileID.wrap*B),K=$*S.tileID.canonical.y;return{u_image:0,u_pattern_tl:M.tl,u_pattern_br:M.br,u_texsize:[D,k],u_pattern_size:M.displaySize,u_tile_units_to_pixels:1/wt(S,1,T.transform.tileZoom),u_pixel_coord_upper:[W>>16,K>>16],u_pixel_coord_lower:[65535&W,65535&K]}}(p,c,_),{u_matrix:h,u_opacity:o}),Ih={fillExtrusion:h=>({u_matrix:new s.UniformMatrix4f(h),u_lightpos:new s.Uniform3f(h),u_lightintensity:new s.Uniform1f(h),u_lightcolor:new s.Uniform3f(h),u_vertical_gradient:new s.Uniform1f(h),u_opacity:new s.Uniform1f(h),u_edge_radius:new s.Uniform1f(h),u_ao:new s.Uniform2f(h),u_tile_id:new s.Uniform3f(h),u_zoom_transition:new s.Uniform1f(h),u_inv_rot_matrix:new s.UniformMatrix4f(h),u_merc_center:new s.Uniform2f(h),u_up_dir:new s.Uniform3f(h),u_height_lift:new s.Uniform1f(h)}),fillExtrusionPattern:h=>({u_matrix:new s.UniformMatrix4f(h),u_lightpos:new s.Uniform3f(h),u_lightintensity:new s.Uniform1f(h),u_lightcolor:new s.Uniform3f(h),u_vertical_gradient:new s.Uniform1f(h),u_height_factor:new s.Uniform1f(h),u_edge_radius:new s.Uniform1f(h),u_ao:new s.Uniform2f(h),u_tile_id:new s.Uniform3f(h),u_zoom_transition:new s.Uniform1f(h),u_inv_rot_matrix:new s.UniformMatrix4f(h),u_merc_center:new s.Uniform2f(h),u_up_dir:new s.Uniform3f(h),u_height_lift:new s.Uniform1f(h),u_image:new s.Uniform1i(h),u_texsize:new s.Uniform2f(h),u_pixel_coord_upper:new s.Uniform2f(h),u_pixel_coord_lower:new s.Uniform2f(h),u_tile_units_to_pixels:new s.Uniform1f(h),u_opacity:new s.Uniform1f(h)}),fill:h=>({u_matrix:new s.UniformMatrix4f(h)}),fillPattern:h=>({u_matrix:new s.UniformMatrix4f(h),u_image:new s.Uniform1i(h),u_texsize:new s.Uniform2f(h),u_pixel_coord_upper:new s.Uniform2f(h),u_pixel_coord_lower:new s.Uniform2f(h),u_tile_units_to_pixels:new s.Uniform1f(h)}),fillOutline:h=>({u_matrix:new s.UniformMatrix4f(h),u_world:new s.Uniform2f(h)}),fillOutlinePattern:h=>({u_matrix:new s.UniformMatrix4f(h),u_world:new s.Uniform2f(h),u_image:new s.Uniform1i(h),u_texsize:new s.Uniform2f(h),u_pixel_coord_upper:new s.Uniform2f(h),u_pixel_coord_lower:new s.Uniform2f(h),u_tile_units_to_pixels:new s.Uniform1f(h)}),circle:h=>({u_camera_to_center_distance:new s.Uniform1f(h),u_extrude_scale:new s.UniformMatrix2f(h),u_device_pixel_ratio:new s.Uniform1f(h),u_matrix:new s.UniformMatrix4f(h),u_inv_rot_matrix:new s.UniformMatrix4f(h),u_merc_center:new s.Uniform2f(h),u_tile_id:new s.Uniform3f(h),u_zoom_transition:new s.Uniform1f(h),u_up_dir:new s.Uniform3f(h)}),collisionBox:h=>({u_matrix:new s.UniformMatrix4f(h),u_camera_to_center_distance:new s.Uniform1f(h),u_extrude_scale:new s.Uniform2f(h)}),collisionCircle:h=>({u_matrix:new s.UniformMatrix4f(h),u_inv_matrix:new s.UniformMatrix4f(h),u_camera_to_center_distance:new s.Uniform1f(h),u_viewport_size:new s.Uniform2f(h)}),debug:h=>({u_color:new s.UniformColor(h),u_matrix:new s.UniformMatrix4f(h),u_overlay:new s.Uniform1i(h),u_overlay_scale:new s.Uniform1f(h)}),clippingMask:h=>({u_matrix:new s.UniformMatrix4f(h)}),heatmap:h=>({u_extrude_scale:new s.Uniform1f(h),u_intensity:new s.Uniform1f(h),u_matrix:new s.UniformMatrix4f(h),u_inv_rot_matrix:new s.UniformMatrix4f(h),u_merc_center:new s.Uniform2f(h),u_tile_id:new s.Uniform3f(h),u_zoom_transition:new s.Uniform1f(h),u_up_dir:new s.Uniform3f(h)}),heatmapTexture:h=>({u_image:new s.Uniform1i(h),u_color_ramp:new s.Uniform1i(h),u_opacity:new s.Uniform1f(h)}),hillshade:h=>({u_matrix:new s.UniformMatrix4f(h),u_image:new s.Uniform1i(h),u_latrange:new s.Uniform2f(h),u_light:new s.Uniform2f(h),u_shadow:new s.UniformColor(h),u_highlight:new s.UniformColor(h),u_accent:new s.UniformColor(h)}),hillshadePrepare:h=>({u_matrix:new s.UniformMatrix4f(h),u_image:new s.Uniform1i(h),u_dimension:new s.Uniform2f(h),u_zoom:new s.Uniform1f(h),u_unpack:new s.Uniform4f(h)}),line:h=>({u_matrix:new s.UniformMatrix4f(h),u_pixels_to_tile_units:new s.UniformMatrix2f(h),u_device_pixel_ratio:new s.Uniform1f(h),u_units_to_pixels:new s.Uniform2f(h),u_dash_image:new s.Uniform1i(h),u_gradient_image:new s.Uniform1i(h),u_image_height:new s.Uniform1f(h),u_texsize:new s.Uniform2f(h),u_tile_units_to_pixels:new s.Uniform1f(h),u_alpha_discard_threshold:new s.Uniform1f(h),u_trim_offset:new s.Uniform2f(h)}),linePattern:h=>({u_matrix:new s.UniformMatrix4f(h),u_texsize:new s.Uniform2f(h),u_pixels_to_tile_units:new s.UniformMatrix2f(h),u_device_pixel_ratio:new s.Uniform1f(h),u_image:new s.Uniform1i(h),u_units_to_pixels:new s.Uniform2f(h),u_tile_units_to_pixels:new s.Uniform1f(h),u_alpha_discard_threshold:new s.Uniform1f(h)}),raster:h=>({u_matrix:new s.UniformMatrix4f(h),u_tl_parent:new s.Uniform2f(h),u_scale_parent:new s.Uniform1f(h),u_fade_t:new s.Uniform1f(h),u_opacity:new s.Uniform1f(h),u_image0:new s.Uniform1i(h),u_image1:new s.Uniform1i(h),u_brightness_low:new s.Uniform1f(h),u_brightness_high:new s.Uniform1f(h),u_saturation_factor:new s.Uniform1f(h),u_contrast_factor:new s.Uniform1f(h),u_spin_weights:new s.Uniform3f(h),u_perspective_transform:new s.Uniform2f(h)}),symbolIcon:h=>({u_is_size_zoom_constant:new s.Uniform1i(h),u_is_size_feature_constant:new s.Uniform1i(h),u_size_t:new s.Uniform1f(h),u_size:new s.Uniform1f(h),u_camera_to_center_distance:new s.Uniform1f(h),u_rotate_symbol:new s.Uniform1i(h),u_aspect_ratio:new s.Uniform1f(h),u_fade_change:new s.Uniform1f(h),u_matrix:new s.UniformMatrix4f(h),u_label_plane_matrix:new s.UniformMatrix4f(h),u_coord_matrix:new s.UniformMatrix4f(h),u_is_text:new s.Uniform1i(h),u_pitch_with_map:new s.Uniform1i(h),u_texsize:new s.Uniform2f(h),u_tile_id:new s.Uniform3f(h),u_zoom_transition:new s.Uniform1f(h),u_inv_rot_matrix:new s.UniformMatrix4f(h),u_merc_center:new s.Uniform2f(h),u_camera_forward:new s.Uniform3f(h),u_tile_matrix:new s.UniformMatrix4f(h),u_up_vector:new s.Uniform3f(h),u_ecef_origin:new s.Uniform3f(h),u_texture:new s.Uniform1i(h)}),symbolSDF:h=>({u_is_size_zoom_constant:new s.Uniform1i(h),u_is_size_feature_constant:new s.Uniform1i(h),u_size_t:new s.Uniform1f(h),u_size:new s.Uniform1f(h),u_camera_to_center_distance:new s.Uniform1f(h),u_rotate_symbol:new s.Uniform1i(h),u_aspect_ratio:new s.Uniform1f(h),u_fade_change:new s.Uniform1f(h),u_matrix:new s.UniformMatrix4f(h),u_label_plane_matrix:new s.UniformMatrix4f(h),u_coord_matrix:new s.UniformMatrix4f(h),u_is_text:new s.Uniform1i(h),u_pitch_with_map:new s.Uniform1i(h),u_texsize:new s.Uniform2f(h),u_texture:new s.Uniform1i(h),u_gamma_scale:new s.Uniform1f(h),u_device_pixel_ratio:new s.Uniform1f(h),u_tile_id:new s.Uniform3f(h),u_zoom_transition:new s.Uniform1f(h),u_inv_rot_matrix:new s.UniformMatrix4f(h),u_merc_center:new s.Uniform2f(h),u_camera_forward:new s.Uniform3f(h),u_tile_matrix:new s.UniformMatrix4f(h),u_up_vector:new s.Uniform3f(h),u_ecef_origin:new s.Uniform3f(h),u_is_halo:new s.Uniform1i(h)}),symbolTextAndIcon:h=>({u_is_size_zoom_constant:new s.Uniform1i(h),u_is_size_feature_constant:new s.Uniform1i(h),u_size_t:new s.Uniform1f(h),u_size:new s.Uniform1f(h),u_camera_to_center_distance:new s.Uniform1f(h),u_rotate_symbol:new s.Uniform1i(h),u_aspect_ratio:new s.Uniform1f(h),u_fade_change:new s.Uniform1f(h),u_matrix:new s.UniformMatrix4f(h),u_label_plane_matrix:new s.UniformMatrix4f(h),u_coord_matrix:new s.UniformMatrix4f(h),u_is_text:new s.Uniform1i(h),u_pitch_with_map:new s.Uniform1i(h),u_texsize:new s.Uniform2f(h),u_texsize_icon:new s.Uniform2f(h),u_texture:new s.Uniform1i(h),u_texture_icon:new s.Uniform1i(h),u_gamma_scale:new s.Uniform1f(h),u_device_pixel_ratio:new s.Uniform1f(h),u_is_halo:new s.Uniform1i(h)}),background:h=>({u_matrix:new s.UniformMatrix4f(h),u_opacity:new s.Uniform1f(h),u_color:new s.UniformColor(h)}),backgroundPattern:h=>({u_matrix:new s.UniformMatrix4f(h),u_opacity:new s.Uniform1f(h),u_image:new s.Uniform1i(h),u_pattern_tl:new s.Uniform2f(h),u_pattern_br:new s.Uniform2f(h),u_texsize:new s.Uniform2f(h),u_pattern_size:new s.Uniform2f(h),u_pixel_coord_upper:new s.Uniform2f(h),u_pixel_coord_lower:new s.Uniform2f(h),u_tile_units_to_pixels:new s.Uniform1f(h)}),terrainRaster:_h,terrainDepth:_h,skybox:h=>({u_matrix:new s.UniformMatrix4f(h),u_sun_direction:new s.Uniform3f(h),u_cubemap:new s.Uniform1i(h),u_opacity:new s.Uniform1f(h),u_temporal_offset:new s.Uniform1f(h)}),skyboxGradient:h=>({u_matrix:new s.UniformMatrix4f(h),u_color_ramp:new s.Uniform1i(h),u_center_direction:new s.Uniform3f(h),u_radius:new s.Uniform1f(h),u_opacity:new s.Uniform1f(h),u_temporal_offset:new s.Uniform1f(h)}),skyboxCapture:h=>({u_matrix_3f:new s.UniformMatrix3f(h),u_sun_direction:new s.Uniform3f(h),u_sun_intensity:new s.Uniform1f(h),u_color_tint_r:new s.Uniform4f(h),u_color_tint_m:new s.Uniform4f(h),u_luminance:new s.Uniform1f(h)}),globeRaster:h=>({u_proj_matrix:new s.UniformMatrix4f(h),u_globe_matrix:new s.UniformMatrix4f(h),u_normalize_matrix:new s.UniformMatrix4f(h),u_merc_matrix:new s.UniformMatrix4f(h),u_zoom_transition:new s.Uniform1f(h),u_merc_center:new s.Uniform2f(h),u_image0:new s.Uniform1i(h),u_grid_matrix:new s.UniformMatrix3f(h),u_skirt_height:new s.Uniform1f(h),u_frustum_tl:new s.Uniform3f(h),u_frustum_tr:new s.Uniform3f(h),u_frustum_br:new s.Uniform3f(h),u_frustum_bl:new s.Uniform3f(h),u_globe_pos:new s.Uniform3f(h),u_globe_radius:new s.Uniform1f(h),u_viewport:new s.Uniform2f(h)}),globeAtmosphere:h=>({u_frustum_tl:new s.Uniform3f(h),u_frustum_tr:new s.Uniform3f(h),u_frustum_br:new s.Uniform3f(h),u_frustum_bl:new s.Uniform3f(h),u_horizon:new s.Uniform1f(h),u_transition:new s.Uniform1f(h),u_fadeout_range:new s.Uniform1f(h),u_color:new s.Uniform4f(h),u_high_color:new s.Uniform4f(h),u_space_color:new s.Uniform4f(h),u_star_intensity:new s.Uniform1f(h),u_star_density:new s.Uniform1f(h),u_star_size:new s.Uniform1f(h),u_temporal_offset:new s.Uniform1f(h),u_horizon_angle:new s.Uniform1f(h),u_rotation_matrix:new s.UniformMatrix4f(h)})};let Cc;function _l(h,o,c,p,_,v,T){const S=h.context,M=S.gl,D=h.transform,k=h.useProgram("collisionBox"),B=[];let $=0,W=0;for(let ie=0;ie<p.length;ie++){const me=p[ie],ye=o.getTile(me),ge=ye.getBucket(c);if(!ge)continue;const be=xr(me,ge,D);let xe=be;_[0]===0&&_[1]===0||(xe=h.translatePosMatrix(be,ye,_,v));const Me=T?ge.textCollisionBox:ge.iconCollisionBox,Qe=ge.collisionCircleArray;if(Qe.length>0){const Ee=s.create(),je=xe;s.mul(Ee,ge.placementInvProjMatrix,D.glCoordMatrix),s.mul(Ee,Ee,ge.placementViewportMatrix),B.push({circleArray:Qe,circleOffset:W,transform:je,invTransform:Ee,projection:ge.getProjection()}),$+=Qe.length/4,W=$}Me&&(h.terrain&&h.terrain.setupElevationDraw(ye,k),k.draw(S,M.LINES,s.DepthMode.disabled,s.StencilMode.disabled,h.colorModeForRenderPass(),s.CullFaceMode.disabled,Sh(xe,D,ye,ge.getProjection()),c.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,null,D.zoom,null,[Me.collisionVertexBuffer,Me.collisionVertexBufferExt]))}if(!T||!B.length)return;const K=h.useProgram("collisionCircle"),H=new s.StructArrayLayout2f1f2i16;H.resize(4*$),H._trim();let Y=0;for(const ie of B)for(let me=0;me<ie.circleArray.length/4;me++){const ye=4*me,ge=ie.circleArray[ye+0],be=ie.circleArray[ye+1],xe=ie.circleArray[ye+2],Me=ie.circleArray[ye+3];H.emplace(Y++,ge,be,xe,Me,0),H.emplace(Y++,ge,be,xe,Me,1),H.emplace(Y++,ge,be,xe,Me,2),H.emplace(Y++,ge,be,xe,Me,3)}(!Cc||Cc.length<2*$)&&(Cc=function(ie){const me=2*ie,ye=new s.StructArrayLayout3ui6;ye.resize(me),ye._trim();for(let ge=0;ge<me;ge++){const be=6*ge;ye.uint16[be+0]=4*ge+0,ye.uint16[be+1]=4*ge+1,ye.uint16[be+2]=4*ge+2,ye.uint16[be+3]=4*ge+2,ye.uint16[be+4]=4*ge+3,ye.uint16[be+5]=4*ge+0}return ye}($));const F=S.createIndexBuffer(Cc,!0),q=S.createVertexBuffer(H,s.collisionCircleLayout.members,!0);for(const ie of B){const me={u_matrix:ie.transform,u_inv_matrix:ie.invTransform,u_camera_to_center_distance:(ne=D).getCameraToCenterDistance(ie.projection),u_viewport_size:[ne.width,ne.height]};K.draw(S,M.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,h.colorModeForRenderPass(),s.CullFaceMode.disabled,me,c.id,q,F,s.SegmentVector.simpleSegment(0,2*ie.circleOffset,ie.circleArray.length,ie.circleArray.length/2),null,D.zoom)}var ne;q.destroy(),F.destroy()}const op=s.create();function kh({width:h,height:o,anchor:c,textOffset:p,textScale:_},v){const{horizontalAlign:T,verticalAlign:S}=s.getAnchorAlignment(c),M=-(T-.5)*h,D=-(S-.5)*o,k=s.evaluateVariableOffset(c,p);return new s.Point((M/_+k[0])*v,(D/_+k[1])*v)}function g_(h,o,c,p,_,v,T,S,M,D,k){const B=h.text.placedSymbolArray,$=h.text.dynamicLayoutVertexArray,W=h.icon.dynamicLayoutVertexArray,K={},H=h.getProjection(),Y=Fn(S,H,v),F=v.elevation,q=H.upVectorScale(S.canonical,v.center.lat,v.worldSize).metersToTile;$.clear();for(let ne=0;ne<B.length;ne++){const ie=B.get(ne),{tileAnchorX:me,tileAnchorY:ye,numGlyphs:ge}=ie,be=ie.hidden||!ie.crossTileID||h.allowVerticalPlacement&&!ie.placedOrientation?null:p[ie.crossTileID];if(be){let xe=0,Me=0,Qe=0;if(F){const it=F?F.getAtTileOffset(S,me,ye):0,[bt,zt,_t]=H.upVector(S.canonical,me,ye);xe=it*bt*q,Me=it*zt*q,Qe=it*_t*q}let[Ee,je,Ie,Ke]=xi(ie.projectedAnchorX+xe,ie.projectedAnchorY+Me,ie.projectedAnchorZ+Qe,c?Y:T);const Ae=Zf(v.getCameraToCenterDistance(H),Ke);let Ne=_.evaluateSizeForFeature(h.textSizeData,D,ie)*Ae/s.ONE_EM;c&&(Ne*=h.tilePixelRatio/M);const tt=kh(be,Ne);c?({x:Ee,y:je,z:Ie}=H.projectTilePoint(me+tt.x,ye+tt.y,S.canonical),[Ee,je,Ie]=xi(Ee+xe,je+Me,Ie+Qe,T)):(o&&tt._rotate(-v.angle),Ee+=tt.x,je+=tt.y,Ie=0);const Ze=h.allowVerticalPlacement&&ie.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let it=0;it<ge;it++)s.addDynamicAttributes($,Ee,je,Ie,Ze);k&&ie.associatedIconIndex>=0&&(K[ie.associatedIconIndex]={x:Ee,y:je,z:Ie,angle:Ze})}else Fr(ge,$)}if(k){W.clear();const ne=h.icon.placedSymbolArray;for(let ie=0;ie<ne.length;ie++){const me=ne.get(ie),{numGlyphs:ye}=me,ge=K[ie];if(me.hidden||!ge)Fr(ye,W);else{const{x:be,y:xe,z:Me,angle:Qe}=ge;for(let Ee=0;Ee<ye;Ee++)s.addDynamicAttributes(W,be,xe,Me,Qe)}}h.icon.dynamicLayoutVertexBuffer.updateData(W)}h.text.dynamicLayoutVertexBuffer.updateData($)}function Dh(h,o,c){return c.iconsInText&&o?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function sp(h,o,c,p,_,v,T,S,M,D,k,B){const $=h.context,W=$.gl,K=h.transform,H=S==="map",Y=M==="map",F=H&&c.layout.get("symbol-placement")!=="point",q=H&&!Y&&!F,ne=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ie=!1;const me=h.depthModeForSublayer(0,s.DepthMode.ReadOnly),ye=[s.mercatorXfromLng(K.center.lng),s.mercatorYfromLat(K.center.lat)],ge=c.layout.get("text-variable-anchor"),be=K.projection.name==="globe",xe=[],Me=[0,-1,0];let Qe=Me;!be&&!K.mercatorFromTransition||H||(Qe=function(Ee){const je=Ee._camera.getWorldToCamera(Ee.worldSize,1),Ie=s.multiply([],je,Ee.globeMatrix);s.invert(Ie,Ie);const Ke=[0,0,0],Ae=[0,1,0,0];return s.transformMat4$1(Ae,Ae,Ie),Ke[0]=Ae[0],Ke[1]=Ae[1],Ke[2]=Ae[2],s.normalize(Ke,Ke),Ke}(K));for(const Ee of p){const je=o.getTile(Ee),Ie=je.getBucket(c);if(!Ie||Ie.projection.name==="mercator"&&be)continue;const Ke=_?Ie.text:Ie.icon;if(!Ke||Ie.fullyClipped||!Ke.segments.get().length)continue;const Ae=Ke.programConfigurations.get(c.id),Ne=_||Ie.sdfIcons,tt=_?Ie.textSizeData:Ie.iconSizeData,Ze=Y||K.pitch!==0,it=s.evaluateSizeForZoom(tt,K.zoom);let bt,zt,_t,At,Ht=[0,0],qt=null;if(_)zt=je.glyphAtlasTexture,_t=W.LINEAR,bt=je.glyphAtlasTexture.size,Ie.iconsInText&&(Ht=je.imageAtlasTexture.size,qt=je.imageAtlasTexture,At=Ze||h.options.rotating||h.options.zooming||tt.kind==="composite"||tt.kind==="camera"?W.LINEAR:W.NEAREST);else{const Po=c.layout.get("icon-size").constantOr(0)!==1||Ie.iconsNeedLinear;zt=je.imageAtlasTexture,_t=Ne||h.options.rotating||h.options.zooming||Po||Ze?W.LINEAR:W.NEAREST,bt=je.imageAtlasTexture.size}const xt=Ie.projection.name==="globe",hn=xt?Qe:Me,_n=xt?s.globeToMercatorTransition(K.zoom):0,yn=Fn(Ee,Ie.getProjection(),K),vn=K.calculatePixelsToTileUnitsMatrix(je),Fi=Fe(yn,je.tileID.canonical,Y,H,K,Ie.getProjection(),vn),bi=h.terrain&&Y&&F?s.invert(s.create(),Fi):op,Er=ei(yn,je.tileID.canonical,Y,H,K,Ie.getProjection(),vn),no=ge&&Ie.hasTextData(),On=c.layout.get("icon-text-fit")!=="none"&&no&&Ie.hasIconData();if(F){const Po=K.elevation,ts=Po?Po.getAtTileOffsetFunc(Ee,K.center.lat,K.worldSize,Ie.getProjection()):null,Is=wo(yn,je.tileID.canonical,Y,H,K,Ie.getProjection(),vn);rh(Ie,yn,h,_,Is,Er,Y,D,ts,Ee)}const xn=F||_&&ge||On,rn=h.translatePosMatrix(yn,je,v,T),ti=xn?op:Fi,Zi=h.translatePosMatrix(Er,je,v,T,!0),Ln=Ie.getProjection().createInversionMatrix(K,Ee.canonical),Qi=[];h.terrainRenderModeElevated()&&Y&&Qi.push("PITCH_WITH_MAP_TERRAIN"),xt&&Qi.push("PROJECTION_GLOBE_VIEW"),xn&&Qi.push("PROJECTED_POS_ON_VIEWPORT");const jc=Ne&&c.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ps;Ps=Ne?Ie.iconsInText?rp(tt.kind,it,q,Y,h,rn,ti,Zi,bt,Ht,Ee,_n,ye,Ln,hn,Ie.getProjection()):Sc(tt.kind,it,q,Y,h,rn,ti,Zi,_,bt,!0,Ee,_n,ye,Ln,hn,Ie.getProjection()):Mh(tt.kind,it,q,Y,h,rn,ti,Zi,_,bt,Ee,_n,ye,Ln,hn,Ie.getProjection());const Ml={program:h.useProgram(Dh(Ne,_,Ie),Ae,Qi),buffers:Ke,uniformValues:Ps,atlasTexture:zt,atlasTextureIcon:qt,atlasInterpolation:_t,atlasInterpolationIcon:At,isSDF:Ne,hasHalo:jc,tile:je,labelPlaneMatrixInv:bi};if(ne&&Ie.canOverlap){ie=!0;const Po=Ke.segments.get();for(const ts of Po)xe.push({segments:new s.SegmentVector([ts]),sortKey:ts.sortKey,state:Ml})}else xe.push({segments:Ke.segments,sortKey:0,state:Ml})}ie&&xe.sort((Ee,je)=>Ee.sortKey-je.sortKey);for(const Ee of xe){const je=Ee.state;if(h.terrain&&h.terrain.setupElevationDraw(je.tile,je.program,{useDepthForOcclusion:!be,labelPlaneMatrixInv:je.labelPlaneMatrixInv}),$.activeTexture.set(W.TEXTURE0),je.atlasTexture.bind(je.atlasInterpolation,W.CLAMP_TO_EDGE),je.atlasTextureIcon&&($.activeTexture.set(W.TEXTURE1),je.atlasTextureIcon&&je.atlasTextureIcon.bind(je.atlasInterpolationIcon,W.CLAMP_TO_EDGE)),je.isSDF){const Ie=je.uniformValues;je.hasHalo&&(Ie.u_is_halo=1,yl(je.buffers,Ee.segments,c,h,je.program,me,k,B,Ie)),Ie.u_is_halo=0}yl(je.buffers,Ee.segments,c,h,je.program,me,k,B,je.uniformValues)}}function yl(h,o,c,p,_,v,T,S,M){const D=p.context,k=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.globeExtVertexBuffer];_.draw(D,D.gl.TRIANGLES,v,T,S,s.CullFaceMode.disabled,M,c.id,h.layoutVertexBuffer,h.indexBuffer,o,c.paint,p.transform.zoom,h.programConfigurations.get(c.id),k)}function ap(h,o,c,p,_,v,T){const S=h.context.gl,M=c.paint.get("fill-pattern"),D=M&&M.constantOr(1);let k,B,$,W,K;T?(B=D&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",k=S.LINES):(B=D?"fillPattern":"fill",k=S.TRIANGLES);for(const H of p){const Y=o.getTile(H);if(D&&!Y.patternsLoaded())continue;const F=Y.getBucket(c);if(!F)continue;h.prepareDrawTile();const q=F.programConfigurations.get(c.id),ne=h.useProgram(B,q);D&&(h.context.activeTexture.set(S.TEXTURE0),Y.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),q.updatePaintBuffers());const ie=M.constantOr(null);if(ie&&Y.imageAtlas){const ye=Y.imageAtlas.patternPositions[ie.toString()];ye&&q.setConstantPatternPositions(ye)}const me=h.translatePosMatrix(H.projMatrix,Y,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(T){W=F.indexBuffer2,K=F.segments2;const ye=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];$=B==="fillOutlinePattern"&&D?d_(me,h,Y,ye):h_(me,ye)}else W=F.indexBuffer,K=F.segments,$=D?bh(me,h,Y):Ss(me);h.prepareDrawProgram(h.context,ne,H.toUnwrapped()),ne.draw(h.context,k,_,h.stencilModeForClipping(H),v,s.CullFaceMode.disabled,$,c.id,F.layoutVertexBuffer,W,K,c.paint,h.transform.zoom,q)}}function Ac(h,o,c,p,_,v,T){const S=h.context,M=S.gl,D=h.transform,k=c.paint.get("fill-extrusion-pattern"),B=k.constantOr(1),$=c.paint.get("fill-extrusion-opacity"),W=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),c.paint.get("fill-extrusion-ambient-occlusion-radius")],K=c.layout.get("fill-extrusion-edge-radius"),H=K>0&&!c.paint.get("fill-extrusion-rounded-roof"),Y=H?0:K,F=D.projection.name==="globe"?s.fillExtrusionHeightLift():0,q=D.projection.name==="globe",ne=q?s.globeToMercatorTransition(D.zoom):0,ie=[s.mercatorXfromLng(D.center.lng),s.mercatorYfromLat(D.center.lat)],me=[];q&&me.push("PROJECTION_GLOBE_VIEW"),W[0]>0&&me.push("FAUX_AO"),H&&me.push("ZERO_ROOF_RADIUS");for(const ye of p){const ge=o.getTile(ye),be=ge.getBucket(c);if(!be||be.projection.name!==D.projection.name)continue;const xe=be.programConfigurations.get(c.id),Me=h.useProgram(B?"fillExtrusionPattern":"fillExtrusion",xe,me);if(h.terrain){const Ne=h.terrain;if(h.style.terrainSetForDrapingOnly())Ne.setupElevationDraw(ge,Me,{useMeterToDem:!0});else{if(!be.enableTerrain)continue;if(Ne.setupElevationDraw(ge,Me,{useMeterToDem:!0}),lp(S,o,ye,be,c,Ne),!be.centroidVertexBuffer){const tt=Me.attributes.a_centroid_pos;tt!==void 0&&M.vertexAttrib2f(tt,0,0)}}}B&&(h.context.activeTexture.set(M.TEXTURE0),ge.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),xe.updatePaintBuffers());const Qe=k.constantOr(null);if(Qe&&ge.imageAtlas){const Ne=ge.imageAtlas.patternPositions[Qe.toString()];Ne&&xe.setConstantPatternPositions(Ne)}const Ee=h.translatePosMatrix(ye.projMatrix,ge,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),je=D.projection.createInversionMatrix(D,ye.canonical),Ie=c.paint.get("fill-extrusion-vertical-gradient"),Ke=B?tp(Ee,h,Ie,$,W,Y,ye,ge,F,ne,ie,je):wh(Ee,h,Ie,$,W,Y,ye,F,ne,ie,je);h.prepareDrawProgram(S,Me,ye.toUnwrapped());const Ae=[];h.terrain&&Ae.push(be.centroidVertexBuffer),q&&Ae.push(be.layoutVertexExtBuffer),Me.draw(S,S.gl.TRIANGLES,_,v,T,s.CullFaceMode.backCCW,Ke,c.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,c.paint,h.transform.zoom,xe,Ae)}}function lp(h,o,c,p,_,v){const T=[F=>{let q=F.canonical.x-1,ne=F.wrap;return q<0&&(q=(1<<F.canonical.z)-1,ne--),new s.OverscaledTileID(F.overscaledZ,ne,F.canonical.z,q,F.canonical.y)},F=>{let q=F.canonical.x+1,ne=F.wrap;return q===1<<F.canonical.z&&(q=0,ne++),new s.OverscaledTileID(F.overscaledZ,ne,F.canonical.z,q,F.canonical.y)},F=>new s.OverscaledTileID(F.overscaledZ,F.wrap,F.canonical.z,F.canonical.x,(F.canonical.y===0?1<<F.canonical.z:F.canonical.y)-1),F=>new s.OverscaledTileID(F.overscaledZ,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y===(1<<F.canonical.z)-1?0:F.canonical.y+1)],S=F=>{const q=o.getSource().minzoom,ne=me=>{const ye=o.getTileByID(me);if(ye&&ye.hasData())return ye.getBucket(_)},ie=[0,-1,1];for(const me of ie){if(F.overscaledZ+me<q)continue;const ye=ne(F.calculateScaledKey(F.overscaledZ+me));if(ye)return ye}},M=[0,0,0],D=(F,q)=>(M[0]=Math.min(F.min.y,q.min.y),M[1]=Math.max(F.max.y,q.max.y),M[2]=s.EXTENT-q.min.x>F.max.x?q.min.x-s.EXTENT:F.max.x,M),k=(F,q)=>(M[0]=Math.min(F.min.x,q.min.x),M[1]=Math.max(F.max.x,q.max.x),M[2]=s.EXTENT-q.min.y>F.max.y?q.min.y-s.EXTENT:F.max.y,M),B=[(F,q)=>D(F,q),(F,q)=>D(q,F),(F,q)=>k(F,q),(F,q)=>k(q,F)],$=new s.Point(0,0);let W,K,H;const Y=(F,q,ne,ie,me)=>{const ye=[[ie?ne:F,ie?F:ne,0],[ie?ne:q,ie?q:ne,0]],ge=me<0?s.EXTENT+me:me,be=[ie?ge:(F+q)/2,ie?(F+q)/2:ge,0];return ne===0&&me<0||ne!==0&&me>0?v.getForTilePoints(H,[be],!0,K):ye.push(be),v.getForTilePoints(c,ye,!0,W),Math.max(ye[0][2],ye[1][2],be[2])/v.exaggeration()};for(let F=0;F<4;F++){const q=(F<2?1:5)-F,ne=p.borders[F];if(ne.length===0)continue;const ie=H=T[F](c),me=S(ie);if(!(me&&me instanceof s.FillExtrusionBucket&&me.enableTerrain)||p.borderDoneWithNeighborZ[F]===me.canonical.z&&me.borderDoneWithNeighborZ[q]===p.canonical.z||(K=v.findDEMTileFor(ie),!K||!K.dem))continue;if(!W){const xe=v.findDEMTileFor(c);if(!xe||!xe.dem)return;W=xe}const ye=me.borders[q];let ge=0;const be=me.borderDoneWithNeighborZ[q]!==p.canonical.z;if(p.canonical.z===me.canonical.z){for(let xe=0;xe<ne.length;xe++){const Me=p.featuresOnBorder[ne[xe]],Qe=Me.borders[F];let Ee;for(;ge<ye.length&&(Ee=me.featuresOnBorder[ye[ge]],!(Ee.borders[q][1]>Qe[0]+3));)be&&me.encodeCentroid(void 0,Ee,!1),ge++;if(Ee&&ge<ye.length){const je=ge;let Ie=0;for(;!(Ee.borders[q][0]>Qe[1]-3)&&(Ie++,++ge!==ye.length);)Ee=me.featuresOnBorder[ye[ge]];if(Ee=me.featuresOnBorder[ye[je]],Me.intersectsCount()>1||Ee.intersectsCount()>1||Ie!==1){Ie!==1&&(ge=je),p.encodeCentroid(void 0,Me,!1),be&&me.encodeCentroid(void 0,Ee,!1);continue}const Ke=B[F](Me,Ee),Ae=F%2?s.EXTENT-1:0;$.x=Y(Ke[0],Math.min(s.EXTENT-1,Ke[1]),Ae,F<2,Ke[2]),$.y=0,p.encodeCentroid($,Me,!1),be&&me.encodeCentroid($,Ee,!1)}else p.encodeCentroid(void 0,Me,!1)}p.borderDoneWithNeighborZ[F]=me.canonical.z,p.needsCentroidUpdate=!0,be&&(me.borderDoneWithNeighborZ[q]=p.canonical.z,me.needsCentroidUpdate=!0)}else{for(const xe of ne)p.encodeCentroid(void 0,p.featuresOnBorder[xe],!1);if(be){for(const xe of ye)me.encodeCentroid(void 0,me.featuresOnBorder[xe],!1);me.borderDoneWithNeighborZ[q]=p.canonical.z,me.needsCentroidUpdate=!0}p.borderDoneWithNeighborZ[F]=me.canonical.z,p.needsCentroidUpdate=!0}}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(h)}const la=new s.Color(1,0,0,1),__=new s.Color(0,1,0,1),y_=new s.Color(0,0,1,1),v_=new s.Color(1,0,1,1),x_=new s.Color(0,1,1,1);function w_(h,o,c){const p=h.context,_=h.transform,v=p.gl,T=_.projection.name==="globe",S=T?["PROJECTION_GLOBE_VIEW"]:null;let M=c.projMatrix;if(T&&s.globeToMercatorTransition(_.zoom)>0){const Me=s.transitionTileAABBinECEF(c.canonical,_),Qe=s.globeDenormalizeECEF(Me);M=s.multiply(new Float32Array(16),_.globeMatrix,Qe),s.multiply(M,_.projMatrix,M)}const D=h.useProgram("debug",null,S),k=o.getTileByID(c.key);h.terrain&&h.terrain.setupElevationDraw(k,D);const B=s.DepthMode.disabled,$=s.StencilMode.disabled,W=h.colorModeForRenderPass(),K="$debug";p.activeTexture.set(v.TEXTURE0),h.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),T?k._makeGlobeTileDebugBuffers(h.context,_):k._makeDebugTileBoundsBuffers(h.context,_.projection);const H=k._tileDebugBuffer||h.debugBuffer,Y=k._tileDebugIndexBuffer||h.debugIndexBuffer,F=k._tileDebugSegments||h.debugSegments;D.draw(p,v.LINE_STRIP,B,$,W,s.CullFaceMode.disabled,Tc(M,s.Color.red),K,H,Y,F,null,null,null,[k._globeTileDebugBorderBuffer]);const q=k.latestRawTileData,ne=Math.floor((q&&q.byteLength||0)/1024),ie=o.getTile(c).tileSize,me=512/Math.min(ie,512)*(c.overscaledZ/_.zoom)*.5;let ye=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(ye+=` => ${c.overscaledZ}`),ye+=` ${ne}kb`,function(Me,Qe){Me.initDebugOverlayCanvas();const Ee=Me.debugOverlayCanvas,je=Me.context.gl,Ie=Me.debugOverlayCanvas.getContext("2d");Ie.clearRect(0,0,Ee.width,Ee.height),Ie.shadowColor="white",Ie.shadowBlur=2,Ie.lineWidth=1.5,Ie.strokeStyle="white",Ie.textBaseline="top",Ie.font="bold 36px Open Sans, sans-serif",Ie.fillText(Qe,5,5),Ie.strokeText(Qe,5,5),Me.debugOverlayTexture.update(Ee),Me.debugOverlayTexture.bind(je.LINEAR,je.CLAMP_TO_EDGE)}(h,ye);const ge=k._tileDebugTextBuffer||h.debugBuffer,be=k._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,xe=k._tileDebugTextSegments||h.debugSegments;D.draw(p,v.TRIANGLES,B,$,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,Tc(M,s.Color.transparent,me),K,ge,be,xe,null,null,null,[k._globeTileDebugTextBuffer])}function cp(h,o,c,p){ca(h,0,o+c/2,h.transform.width,c,p)}function Mc(h,o,c,p){ca(h,o-c/2,0,c,h.transform.height,p)}function ca(h,o,c,p,_,v){const T=h.context,S=T.gl;S.enable(S.SCISSOR_TEST),S.scissor(o*s.exported.devicePixelRatio,c*s.exported.devicePixelRatio,p*s.exported.devicePixelRatio,_*s.exported.devicePixelRatio),T.clear({color:v}),S.disable(S.SCISSOR_TEST)}const up=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:hp}=up;function Ao(h,o,c,p){h.emplaceBack(o,c,p)}class Pc{constructor(o){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,Ao(this.vertexArray,-1,-1,1),Ao(this.vertexArray,1,-1,1),Ao(this.vertexArray,-1,1,1),Ao(this.vertexArray,1,1,1),Ao(this.vertexArray,-1,-1,-1),Ao(this.vertexArray,1,-1,-1),Ao(this.vertexArray,-1,1,-1),Ao(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,hp),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function br(h,o,c,p,_,v){const T=h.gl,S=o.paint.get("sky-atmosphere-color"),M=o.paint.get("sky-atmosphere-halo-color"),D=o.paint.get("sky-atmosphere-sun-intensity"),k=((B,$,W,K,H)=>({u_matrix_3f:B,u_sun_direction:$,u_sun_intensity:W,u_color_tint_r:[K.r,K.g,K.b,K.a],u_color_tint_m:[H.r,H.g,H.b,H.a],u_luminance:5e-5}))(s.fromMat4(s.create$1(),p),_,D,S,M);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+v,o.skyboxTexture,0),c.draw(h,T.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,k,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const vl=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class dp{constructor(o){const c=new s.StructArrayLayout5f20;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const p=new s.StructArrayLayout3ui6;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(c,vl.members),this.indexBuffer=o.createIndexBuffer(p),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Cs={symbol:function(h,o,c,p,_){if(h.renderPass!=="translucent")return;const v=s.StencilMode.disabled,T=h.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(S,M,D,k,B,$,W){const K=M.transform,H=B==="map",Y=$==="map";for(const F of S){const q=k.getTile(F),ne=q.getBucket(D);if(!ne||!ne.text||!ne.text.segments.get().length)continue;const ie=s.evaluateSizeForZoom(ne.textSizeData,K.zoom),me=Fn(F,ne.getProjection(),K),ye=K.calculatePixelsToTileUnitsMatrix(q),ge=Fe(me,q.tileID.canonical,Y,H,K,ne.getProjection(),ye),be=D.layout.get("icon-text-fit")!=="none"&&ne.hasIconData();if(ie){const xe=Math.pow(2,K.zoom-q.tileID.overscaledZ);g_(ne,H,Y,W,s.symbolSize,K,ge,F,xe,ie,be)}}}(p,h,c,o,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),_),c.paint.get("icon-opacity").constantOr(1)!==0&&sp(h,o,c,p,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),v,T),c.paint.get("text-opacity").constantOr(1)!==0&&sp(h,o,c,p,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),v,T),o.map.showCollisionBoxes&&(_l(h,o,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),_l(h,o,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(h,o,c,p){if(h.renderPass!=="translucent")return;const _=c.paint.get("circle-opacity"),v=c.paint.get("circle-stroke-width"),T=c.paint.get("circle-stroke-opacity"),S=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(_.constantOr(1)===0&&(v.constantOr(1)===0||T.constantOr(1)===0))return;const M=h.context,D=M.gl,k=h.transform,B=h.depthModeForSublayer(0,s.DepthMode.ReadOnly),$=s.StencilMode.disabled,W=h.colorModeForRenderPass(),K=k.projection.name==="globe",H=[s.mercatorXfromLng(k.center.lng),s.mercatorYfromLat(k.center.lat)],Y=[];for(let q=0;q<p.length;q++){const ne=p[q],ie=o.getTile(ne),me=ie.getBucket(c);if(!me||me.projection.name!==k.projection.name)continue;const ye=me.programConfigurations.get(c.id),ge=Eh(c);K&&ge.push("PROJECTION_GLOBE_VIEW");const be=h.useProgram("circle",ye,ge),xe=me.layoutVertexBuffer,Me=me.globeExtVertexBuffer,Qe=me.indexBuffer,Ee=k.projection.createInversionMatrix(k,ne.canonical),je={programConfiguration:ye,program:be,layoutVertexBuffer:xe,globeExtVertexBuffer:Me,indexBuffer:Qe,uniformValues:Th(h,ne,ie,Ee,H,c),tile:ie};if(S){const Ie=me.segments.get();for(const Ke of Ie)Y.push({segments:new s.SegmentVector([Ke]),sortKey:Ke.sortKey,state:je})}else Y.push({segments:me.segments,sortKey:0,state:je})}S&&Y.sort((q,ne)=>q.sortKey-ne.sortKey);const F={useDepthForOcclusion:!K};for(const q of Y){const{programConfiguration:ne,program:ie,layoutVertexBuffer:me,globeExtVertexBuffer:ye,indexBuffer:ge,uniformValues:be,tile:xe}=q.state,Me=q.segments;h.terrain&&h.terrain.setupElevationDraw(xe,ie,F),h.prepareDrawProgram(M,ie,xe.tileID.toUnwrapped()),ie.draw(M,D.TRIANGLES,B,$,W,s.CullFaceMode.disabled,be,c.id,me,ge,Me,c.paint,k.zoom,ne,[ye])}},heatmap:function(h,o,c,p){if(c.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const _=h.context,v=_.gl,T=s.StencilMode.disabled,S=new s.ColorMode([v.ONE,v.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(W,K,H,Y){const F=W.gl,q=K.width*Y,ne=K.height*Y;W.activeTexture.set(F.TEXTURE1),W.viewport.set([0,0,q,ne]);let ie=H.heatmapFbo;if(!ie||ie&&(ie.width!==q||ie.height!==ne)){ie&&ie.destroy();const me=F.createTexture();F.bindTexture(F.TEXTURE_2D,me),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.LINEAR),ie=H.heatmapFbo=W.createFramebuffer(q,ne,!1),function(ye,ge,be,xe,Me,Qe){const Ee=ye.gl;Ee.texImage2D(Ee.TEXTURE_2D,0,ye.isWebGL2&&ye.extRenderToTextureHalfFloat?Ee.RGBA16F:Ee.RGBA,Me,Qe,0,Ee.RGBA,ye.extRenderToTextureHalfFloat?ye.isWebGL2?Ee.HALF_FLOAT:ye.extTextureHalfFloat.HALF_FLOAT_OES:Ee.UNSIGNED_BYTE,null),xe.colorAttachment.set(be)}(W,0,me,ie,q,ne)}else F.bindTexture(F.TEXTURE_2D,ie.colorAttachment.get()),W.bindFramebuffer.set(ie.framebuffer)})(_,h,c,h.transform.projection.name==="globe"?.5:.25),_.clear({color:s.Color.transparent});const M=h.transform,D=M.projection.name==="globe",k=D?["PROJECTION_GLOBE_VIEW"]:null,B=D?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,$=[s.mercatorXfromLng(M.center.lng),s.mercatorYfromLat(M.center.lat)];for(let W=0;W<p.length;W++){const K=p[W];if(o.hasRenderableParent(K))continue;const H=o.getTile(K),Y=H.getBucket(c);if(!Y||Y.projection.name!==M.projection.name)continue;const F=Y.programConfigurations.get(c.id),q=h.useProgram("heatmap",F,k),{zoom:ne}=h.transform;h.terrain&&h.terrain.setupElevationDraw(H,q),h.prepareDrawProgram(_,q,K.toUnwrapped());const ie=M.projection.createInversionMatrix(M,K.canonical);q.draw(_,v.TRIANGLES,s.DepthMode.disabled,T,S,B,ip(h,K,H,ie,$,ne,c.paint.get("heatmap-intensity")),c.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,c.paint,h.transform.zoom,F,D?[Y.globeExtVertexBuffer]:null)}_.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(_,v){const T=_.context,S=T.gl,M=v.heatmapFbo;if(!M)return;T.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,M.colorAttachment.get()),T.activeTexture.set(S.TEXTURE1);let D=v.colorRampTexture;D||(D=v.colorRampTexture=new s.Texture(T,v.colorRamp,S.RGBA)),D.bind(S.LINEAR,S.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(T,S.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,_.colorModeForRenderPass(),s.CullFaceMode.disabled,((k,B,$,W)=>({u_image:0,u_color_ramp:1,u_opacity:B.paint.get("heatmap-opacity")}))(0,v),v.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,v.paint,_.transform.zoom)}(h,c))},line:function(h,o,c,p){if(h.renderPass!=="translucent")return;const _=c.paint.get("line-opacity"),v=c.paint.get("line-width");if(_.constantOr(1)===0||v.constantOr(1)===0)return;const T=h.depthModeForSublayer(0,s.DepthMode.ReadOnly),S=h.colorModeForRenderPass(),M=h.terrain&&h.terrain.renderingToTexture?1:s.exported.devicePixelRatio,D=c.paint.get("line-dasharray"),k=D.constantOr(1),B=c.layout.get("line-cap"),$=c.paint.get("line-pattern"),W=$.constantOr(1),K=c.paint.get("line-gradient"),H=W?"linePattern":"line",Y=h.context,F=Y.gl,q=(ie=>{const me=[];gl(ie)&&me.push("RENDER_LINE_DASH"),ie.paint.get("line-gradient")&&me.push("RENDER_LINE_GRADIENT");const ye=ie.paint.get("line-trim-offset");ye[0]===0&&ye[1]===0||me.push("RENDER_LINE_TRIM_OFFSET");const ge=ie.paint.get("line-pattern").constantOr(1),be=ie.paint.get("line-opacity").constantOr(1)!==1;return!ge&&be&&me.push("RENDER_LINE_ALPHA_DISCARD"),me})(c);let ne=q.includes("RENDER_LINE_ALPHA_DISCARD");h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(ne=!1);for(const ie of p){const me=o.getTile(ie);if(W&&!me.patternsLoaded())continue;const ye=me.getBucket(c);if(!ye)continue;h.prepareDrawTile();const ge=ye.programConfigurations.get(c.id),be=h.useProgram(H,ge,q),xe=$.constantOr(null);if(xe&&me.imageAtlas){const Ne=me.imageAtlas.patternPositions[xe.toString()];Ne&&ge.setConstantPatternPositions(Ne)}const Me=D.constantOr(null),Qe=B.constantOr(null);if(!W&&Me&&Qe&&me.lineAtlas){const Ne=me.lineAtlas.getDash(Me,Qe);Ne&&ge.setConstantPatternPositions(Ne)}let[Ee,je]=c.paint.get("line-trim-offset");(Qe==="round"||Qe==="square")&&Ee!==je&&(Ee===0&&(Ee-=1),je===1&&(je+=1));const Ie=h.terrain?ie.projMatrix:null,Ke=W?ml(h,me,c,Ie,M):p_(h,me,c,Ie,ye.lineClipsArray.length,M,[Ee,je]);if(K){const Ne=ye.gradients[c.id];let tt=Ne.texture;if(c.gradientVersion!==Ne.version){let Ze=256;if(c.stepInterpolant){const it=o.getSource().maxzoom,bt=ie.canonical.z===it?Math.ceil(1<<h.transform.maxZoom-ie.canonical.z):1;Ze=s.clamp(s.nextPowerOfTwo(ye.maxLineLength/s.EXTENT*1024*bt),256,Y.maxTextureSize)}Ne.gradient=s.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Ze,image:Ne.gradient||void 0,clips:ye.lineClipsArray}),Ne.texture?Ne.texture.update(Ne.gradient):Ne.texture=new s.Texture(Y,Ne.gradient,F.RGBA),Ne.version=c.gradientVersion,tt=Ne.texture}Y.activeTexture.set(F.TEXTURE1),tt.bind(c.stepInterpolant?F.NEAREST:F.LINEAR,F.CLAMP_TO_EDGE)}k&&(Y.activeTexture.set(F.TEXTURE0),me.lineAtlasTexture.bind(F.LINEAR,F.REPEAT),ge.updatePaintBuffers()),W&&(Y.activeTexture.set(F.TEXTURE0),me.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),ge.updatePaintBuffers()),h.prepareDrawProgram(Y,be,ie.toUnwrapped());const Ae=Ne=>{be.draw(Y,F.TRIANGLES,T,Ne,S,s.CullFaceMode.disabled,Ke,c.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,c.paint,h.transform.zoom,ge,[ye.layoutVertexBuffer2])};if(ne){const Ne=h.stencilModeForClipping(ie).ref;Ne===0&&h.terrain&&Y.clear({stencil:0});const tt={func:F.EQUAL,mask:255};Ke.u_alpha_discard_threshold=.8,Ae(new s.StencilMode(tt,Ne,255,F.KEEP,F.KEEP,F.INVERT)),Ke.u_alpha_discard_threshold=0,Ae(new s.StencilMode(tt,Ne,255,F.KEEP,F.KEEP,F.KEEP))}else Ae(h.stencilModeForClipping(ie))}ne&&(h.resetStencilClippingMasks(),h.terrain&&Y.clear({stencil:0}))},fill:function(h,o,c,p){const _=c.paint.get("fill-color"),v=c.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const T=h.colorModeForRenderPass(),S=c.paint.get("fill-pattern"),M=h.opaquePassEnabledForLayer()&&!S.constantOr(1)&&_.constantOr(s.Color.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===M){const D=h.depthModeForSublayer(1,h.renderPass==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);ap(h,o,c,p,D,T,!1)}if(h.renderPass==="translucent"&&c.paint.get("fill-antialias")){const D=h.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);ap(h,o,c,p,D,T,!0)}},"fill-extrusion":function(h,o,c,p){const _=c.paint.get("fill-extrusion-opacity");if(_!==0&&h.renderPass==="translucent"){const v=new s.DepthMode(h.context.gl.LEQUAL,s.DepthMode.ReadWrite,h.depthRangeFor3D);if(_!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))Ac(h,o,c,p,v,s.StencilMode.disabled,s.ColorMode.disabled),Ac(h,o,c,p,v,h.stencilModeFor3D(),h.colorModeForRenderPass()),h.resetStencilClippingMasks();else{const T=h.colorModeForRenderPass();Ac(h,o,c,p,v,s.StencilMode.disabled,T)}}},hillshade:function(h,o,c,p){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const _=h.context,v=h.depthModeForSublayer(0,s.DepthMode.ReadOnly),T=h.colorModeForRenderPass(),S=h.terrain&&h.terrain.renderingToTexture,[M,D]=h.renderPass!=="translucent"||S?[{},p]:h.stencilConfigForOverlap(p);for(const k of D){const B=o.getTile(k);if(B.needsHillshadePrepare&&h.renderPass==="offscreen")Jf(h,B,c,v,s.StencilMode.disabled,T);else if(h.renderPass==="translucent"){const $=S&&h.terrain?h.terrain.stencilModeForRTTOverlap(k):M[k.overscaledZ];Yf(h,k,B,c,v,$,T)}}_.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,o,c,p,_,v){if(h.renderPass!=="translucent"||c.paint.get("raster-opacity")===0||!p.length)return;const T=h.context,S=T.gl,M=o.getSource(),D=h.useProgram("raster"),k=h.colorModeForRenderPass(),B=h.terrain&&h.terrain.renderingToTexture,[$,W]=M instanceof Rt||B?[{},p]:h.stencilConfigForOverlap(p),K=W[W.length-1].overscaledZ,H=!h.options.moving;for(const Y of W){const F=B?s.DepthMode.disabled:h.depthModeForSublayer(Y.overscaledZ-K,c.paint.get("raster-opacity")===1?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,S.LESS),q=Y.toUnwrapped(),ne=o.getTile(Y);if(B&&(!ne||!ne.hasData()))continue;const ie=B?Y.projMatrix:h.transform.calculateProjMatrix(q,H),me=h.terrain&&B?h.terrain.stencilModeForRTTOverlap(Y):$[Y.overscaledZ],ye=v?0:c.paint.get("raster-fade-duration");ne.registerFadeDuration(ye);const ge=o.findLoadedParent(Y,0),be=yh(ne,ge,o,h.transform,ye);let xe,Me;h.terrain&&h.terrain.prepareDrawTile();const Qe=c.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;T.activeTexture.set(S.TEXTURE0),ne.texture.bind(Qe,S.CLAMP_TO_EDGE),T.activeTexture.set(S.TEXTURE1),ge?(ge.texture.bind(Qe,S.CLAMP_TO_EDGE),xe=Math.pow(2,ge.tileID.overscaledZ-ne.tileID.overscaledZ),Me=[ne.tileID.canonical.x*xe%1,ne.tileID.canonical.y*xe%1]):ne.texture.bind(Qe,S.CLAMP_TO_EDGE),ne.texture.useMipmap&&T.extTextureFilterAnisotropic&&h.transform.pitch>20&&S.texParameterf(S.TEXTURE_2D,T.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,T.extTextureFilterAnisotropicMax);const Ee=Ah(ie,Me||[0,0],xe||1,be,c,M instanceof Rt?M.perspectiveTransform:[0,0]);if(h.prepareDrawProgram(T,D,q),M instanceof Rt)M.boundsBuffer&&M.boundsSegments&&D.draw(T,S.TRIANGLES,F,s.StencilMode.disabled,k,s.CullFaceMode.disabled,Ee,c.id,M.boundsBuffer,h.quadTriangleIndexBuffer,M.boundsSegments);else{const{tileBoundsBuffer:je,tileBoundsIndexBuffer:Ie,tileBoundsSegments:Ke}=h.getTileBoundsBuffers(ne);D.draw(T,S.TRIANGLES,F,me,k,s.CullFaceMode.disabled,Ee,c.id,je,Ie,Ke)}}h.resetStencilClippingMasks()},background:function(h,o,c,p){const _=c.paint.get("background-color"),v=c.paint.get("background-opacity");if(v===0)return;const T=h.context,S=T.gl,M=h.transform,D=M.tileSize,k=c.paint.get("background-pattern");if(h.isPatternMissing(k))return;const B=!k&&_.a===1&&v===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==B)return;const $=s.StencilMode.disabled,W=h.depthModeForSublayer(0,B==="opaque"?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),K=h.colorModeForRenderPass(),H=h.useProgram(k?"backgroundPattern":"background");let Y,F=p;F||(Y=h.getBackgroundTiles(),F=Object.values(Y).map(q=>q.tileID)),k&&(T.activeTexture.set(S.TEXTURE0),h.imageManager.bind(h.context));for(const q of F){const ne=q.toUnwrapped(),ie=p?q.projMatrix:h.transform.calculateProjMatrix(ne);h.prepareDrawTile();const me=o?o.getTile(q):Y?Y[q.key]:new s.Tile(q,D,M.zoom,h),ye=k?m_(ie,v,h,k,{tileID:q,tileSize:D}):Ph(ie,v,_);h.prepareDrawProgram(T,H,ne);const{tileBoundsBuffer:ge,tileBoundsIndexBuffer:be,tileBoundsSegments:xe}=h.getTileBoundsBuffers(me);H.draw(T,S.TRIANGLES,W,$,K,s.CullFaceMode.disabled,ye,c.id,ge,be,xe)}},sky:function(h,o,c){const p=h.transform,_=p.projection.name==="mercator"||p.projection.name==="globe"?1:s.smoothstep(7,8,p.zoom),v=c.paint.get("sky-opacity")*_;if(v===0)return;const T=h.context,S=c.paint.get("sky-type"),M=new s.DepthMode(T.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),D=h.frameCounter/1e3%1;S==="atmosphere"?h.renderPass==="offscreen"?c.needsSkyboxCapture(h)&&(function(k,B,$,W){const K=k.context,H=K.gl;let Y=B.skyboxFbo;if(!Y){Y=B.skyboxFbo=K.createFramebuffer(32,32,!1),B.skyboxGeometry=new Pc(K),B.skyboxTexture=K.gl.createTexture(),H.bindTexture(H.TEXTURE_CUBE_MAP,B.skyboxTexture),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAG_FILTER,H.LINEAR);for(let ie=0;ie<6;++ie)H.texImage2D(H.TEXTURE_CUBE_MAP_POSITIVE_X+ie,0,H.RGBA,32,32,0,H.RGBA,H.UNSIGNED_BYTE,null)}K.bindFramebuffer.set(Y.framebuffer),K.viewport.set([0,0,32,32]);const F=B.getCenter(k,!0),q=k.useProgram("skyboxCapture"),ne=new Float64Array(16);s.identity(ne),s.rotateY(ne,ne,.5*-Math.PI),br(K,B,q,ne,F,0),s.identity(ne),s.rotateY(ne,ne,.5*Math.PI),br(K,B,q,ne,F,1),s.identity(ne),s.rotateX(ne,ne,.5*-Math.PI),br(K,B,q,ne,F,2),s.identity(ne),s.rotateX(ne,ne,.5*Math.PI),br(K,B,q,ne,F,3),s.identity(ne),br(K,B,q,ne,F,4),s.identity(ne),s.rotateY(ne,ne,Math.PI),br(K,B,q,ne,F,5),K.viewport.set([0,0,k.width,k.height])}(h,c),c.markSkyboxValid(h)):h.renderPass==="sky"&&function(k,B,$,W,K){const H=k.context,Y=H.gl,F=k.transform,q=k.useProgram("skybox");H.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_CUBE_MAP,B.skyboxTexture);const ne=((ie,me,ye,ge,be)=>({u_matrix:ie,u_sun_direction:me,u_cubemap:0,u_opacity:ge,u_temporal_offset:be}))(F.skyboxMatrix,B.getCenter(k,!1),0,W,K);k.prepareDrawProgram(H,q),q.draw(H,Y.TRIANGLES,$,s.StencilMode.disabled,k.colorModeForRenderPass(),s.CullFaceMode.backCW,ne,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(h,c,M,v,D):S==="gradient"&&h.renderPass==="sky"&&function(k,B,$,W,K){const H=k.context,Y=H.gl,F=k.transform,q=k.useProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new Pc(H)),H.activeTexture.set(Y.TEXTURE0);let ne=B.colorRampTexture;ne||(ne=B.colorRampTexture=new s.Texture(H,B.colorRamp,Y.RGBA)),ne.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const ie=((me,ye,ge,be,xe)=>({u_matrix:me,u_color_ramp:0,u_center_direction:ye,u_radius:s.degToRad(ge),u_opacity:be,u_temporal_offset:xe}))(F.skyboxMatrix,B.getCenter(k,!1),B.paint.get("sky-gradient-radius"),W,K);k.prepareDrawProgram(H,q),q.draw(H,Y.TRIANGLES,$,s.StencilMode.disabled,k.colorModeForRenderPass(),s.CullFaceMode.backCW,ie,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(h,c,M,v,D)},debug:function(h,o,c){for(let p=0;p<c.length;p++)w_(h,o,c[p])},custom:function(h,o,c,p){const _=h.context,v=c.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&c.isLayerDraped()){if(h.renderPass==="offscreen"){const T=v.prerender;if(T){if(h.setCustomLayerDefaults(),_.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const S=h.transform.pointMerc;T.call(v,_.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(h.transform.zoom),[S.x,S.y],h.transform.pixelsPerMeterRatio)}else T.call(v,_.gl,h.transform.customLayerMatrix());_.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const S=v.renderToTile;if(S){const M=p[0].canonical,D=new s.MercatorCoordinate(M.x+p[0].wrap*(1<<M.z),M.y,M.z);_.setDepthMode(s.DepthMode.disabled),_.setStencilMode(s.StencilMode.disabled),_.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),S.call(v,_.gl,D),_.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),_.setColorMode(h.colorModeForRenderPass()),_.setStencilMode(s.StencilMode.disabled);const T=v.renderingMode==="3d"?new s.DepthMode(h.context.gl.LEQUAL,s.DepthMode.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,s.DepthMode.ReadOnly);if(_.setDepthMode(T),h.transform.projection.name==="globe"){const S=h.transform.pointMerc;v.render(_.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(h.transform.zoom),[S.x,S.y],h.transform.pixelsPerMeterRatio)}else v.render(_.gl,h.transform.customLayerMatrix());_.setDirty(),h.setBaseState(),_.bindFramebuffer.set(null)}}else s.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class ua{constructor(o,c,p=!1){this.context=new nt(o,p),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(o,c){const p=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new xh(this,o));const _=this._terrain;this.transform.elevation=p?_:null,_.update(o,this.transform,c)}_updateFog(o){const c=o.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,_]=c.getFovAdjustedRange(this.transform._fov);if(p>_)return void(this.transform.fogCullDistSq=null);const v=p+.78*(_-p);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(o,c){if(this.width=o*s.exported.devicePixelRatio,this.height=c*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const o=this.context,c=new s.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(s.EXTENT,0),c.emplaceBack(0,s.EXTENT),c.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(c,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const p=new s.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(s.EXTENT,0),p.emplaceBack(0,s.EXTENT),p.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=o.createVertexBuffer(p,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const _=new s.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(_,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const v=new s.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(s.EXTENT,0,s.EXTENT,0),v.emplaceBack(0,s.EXTENT,0,s.EXTENT),v.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=o.createVertexBuffer(v,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const T=new s.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(T);const S=new s.StructArrayLayout1ui2;for(const D of[0,1,3,2,0])S.emplaceBack(D);this.debugIndexBuffer=o.createIndexBuffer(S),this.emptyTexture=new s.Texture(o,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA),this.identityMat=s.create();const M=this.context.gl;this.stencilClearMode=new s.StencilMode({func:M.ALWAYS,mask:0},0,255,M.ZERO,M.ZERO,M.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new dp(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context,c=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(o,c.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,fl(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,c,p){if(!c||this.currentStencilSource===c.id||!o.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const M of p)if(this._tileClippingMaskIDs[M.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=c.id;const _=this.context,v=_.gl;this.nextStencilID+p.length>256&&this.clearStencil(),_.setColorMode(s.ColorMode.disabled),_.setDepthMode(s.DepthMode.disabled);const T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of p){const M=c.getTile(S),D=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:B,tileBoundsSegments:$}=this.getTileBoundsBuffers(M);T.draw(_,v.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:v.ALWAYS,mask:0},D,255,v.KEEP,v.KEEP,v.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,fl(S.projMatrix),"$clipping",k,B,$)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,c=this.context.gl;return new s.StencilMode({func:c.NOTEQUAL,mask:255},o,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const c=this.context.gl;return new s.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(o){const c=this.context.gl,p=o.sort((T,S)=>S.overscaledZ-T.overscaledZ),_=p[p.length-1].overscaledZ,v=p[0].overscaledZ-_+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const T={};for(let S=0;S<v;S++)T[S+_]=new s.StencilMode({func:c.GEQUAL,mask:255},S+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=v,[T,p]}return[{[_]:s.StencilMode.disabled},p]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([o.CONSTANT_COLOR,o.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(o,c,p){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new s.DepthMode(p||this.context.gl.LEQUAL,c,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,c){this.style=o,this.options=c,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const p=this.style.order,_=this.style._sourceCaches;for(const D in _){const k=_[D];k.used&&k.prepare(this.context)}const v={},T={},S={};for(const D in _){const k=_[D];v[D]=k.getVisibleCoordinates(),T[D]=v[D].slice().reverse(),S[D]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<p.length;D++)if(this.style._layers[p[D]].is3D()){this.opaquePassCutoff=D;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),!s.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const D of p){const k=this.style._layers[D],B=o._getLayerSourceCache(k);if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;const $=B?T[B.id]:void 0;(k.type==="custom"||k.isSky()||$&&$.length)&&this.renderLayer(this,B,k,$)}this.depthRangeFor3D=[0,1-(o.order.length+2)*this.numSublayers*this.depthEpsilon];const M=this.terrain;if(M&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&M.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:c.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[p[this.currentLayer]],k=o._getLayerSourceCache(D);if(D.isSky())continue;const B=k?T[k.id]:void 0;this._renderTileClippingMasks(D,k,B),this.renderLayer(this,k,D,B)}if(this.style.fog&&this.transform.projection.supportsFog&&function(D,k){const B=D.context,$=B.gl,W=D.transform,K=new s.DepthMode($.LEQUAL,s.DepthMode.ReadOnly,[0,1]),H=D.useProgram("globeAtmosphere",null,W.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Y=s.globeToMercatorTransition(W.zoom),F=k.properties.get("color").toArray01(),q=k.properties.get("high-color").toArray01(),ne=k.properties.get("space-color").toArray01PremultipliedAlpha(),ie=s.identity$1([]);s.rotateY$1(ie,ie,-s.degToRad(W._center.lng)),s.rotateX$1(ie,ie,s.degToRad(W._center.lat)),s.rotateZ$1(ie,ie,W.angle),s.rotateX$1(ie,ie,-W._pitch);const me=s.fromQuat(new Float32Array(16),ie),ye=s.mapValue(k.properties.get("star-intensity"),0,1,0,.25),ge=5e-4,be=s.mapValue(k.properties.get("horizon-blend"),0,1,ge,.25),xe=s.globeUseCustomAntiAliasing(D,B,W)&&be===ge?W.worldSize/(2*Math.PI*1.025)-1:W.globeRadius,Me=D.frameCounter/1e3%1,Qe=s.length(W.globeCenterInViewSpace),Ee=Math.sqrt(Math.pow(Qe,2)-Math.pow(xe,2)),je=Math.acos(Ee/Qe),Ie=((Ae,Ne,tt,Ze,it,bt,zt,_t,At,Ht,qt,xt,hn,_n)=>({u_frustum_tl:Ae,u_frustum_tr:Ne,u_frustum_br:tt,u_frustum_bl:Ze,u_horizon:it,u_transition:bt,u_fadeout_range:zt,u_color:_t,u_high_color:At,u_space_color:Ht,u_star_intensity:qt,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:xt,u_horizon_angle:hn,u_rotation_matrix:_n}))(W.frustumCorners.TL,W.frustumCorners.TR,W.frustumCorners.BR,W.frustumCorners.BL,W.frustumCorners.horizon,Y,be,F,q,ne,ye,Me,je,me);D.prepareDrawProgram(B,H);const Ke=D.atmosphereBuffer;Ke&&H.draw(B,$.TRIANGLES,K,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,Ie,"skybox",Ke.vertexBuffer,Ke.indexBuffer,Ke.segments)}(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const D=this.style._layers[p[this.currentLayer]],k=o._getLayerSourceCache(D);D.isSky()&&this.renderLayer(this,k,D,k?T[k.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const D=this.style._layers[p[this.currentLayer]],k=o._getLayerSourceCache(D);if(D.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(D)){if(D.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const B=k?(D.type==="symbol"?S:T)[k.id]:void 0;this._renderTileClippingMasks(D,k,k?v[k.id]:void 0),this.renderLayer(this,k,D,B),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let D=null;s.values(this.style._layers).forEach(k=>{const B=o._getLayerSourceCache(k);B&&!k.isHidden(this.transform.zoom)&&(!D||D.getSource().maxzoom<B.getSource().maxzoom)&&(D=B)}),D&&this.options.showTileBoundaries&&Cs.debug(this,D,D.getVisibleCoordinates())}this.options.showPadding&&function(D){const k=D.transform.padding;cp(D,D.transform.height-(k.top||0),3,la),cp(D,k.bottom||0,3,__),Mc(D,k.left||0,3,y_),Mc(D,D.transform.width-(k.right||0),3,v_);const B=D.transform.centerPoint;(function($,W,K,H){ca($,W-1,K-10,2,20,H),ca($,W-10,K-1,20,2,H)})(D,B.x,D.transform.height-B.y,x_)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}renderLayer(o,c,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||_&&_.length)&&(this.id=p.id,this.gpuTimingStart(p),(!o.transform.projection.unsupportedLayers||!o.transform.projection.unsupportedLayers.includes(p.type)||o.terrain&&p.type==="custom")&&Cs[p.type](o,c,p,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let p=this.gpuTimers[o.id];p||(p=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),p.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,c=o.createQueryEXT();this.deferredRenderGpuTimeQueries.push(c),o.beginQueryEXT(o.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const c={};for(const p in o){const _=o[p],v=this.context.extTimerQuery,T=v.getQueryObjectEXT(_.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(_.query),c[p]=T}return c}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.extTimerQuery;let p=0;for(const _ of o)p+=c.getQueryObjectEXT(_,c.QUERY_RESULT_EXT)/1e6,c.deleteQueryEXT(_);return p}translatePosMatrix(o,c,p,_,v){if(!p[0]&&!p[1])return o;const T=v?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(T){const D=Math.sin(T),k=Math.cos(T);p=[p[0]*k-p[1]*D,p[0]*D+p[1]*k]}const S=[v?p[0]:wt(c,p[0],this.transform.zoom),v?p[1]:wt(c,p[1],this.transform.zoom),0],M=new Float32Array(16);return s.translate(M,o,S),M}saveTileTexture(o){const c=this._tileTextures[o.size[0]];c?c.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const c=this._tileTextures[o];return c&&c.length>0?c.pop():null}isPatternMissing(o){return o===null||o!==void 0&&!this.imageManager.getPattern(o.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const o=this.terrain&&this.terrain.renderingToTexture,c=this.terrain&&this.terrain.exaggeration()===0,p=this.style&&this.style.fog,_=[];return this.terrainRenderModeElevated()&&_.push("TERRAIN"),this.transform.projection.name==="globe"&&_.push("GLOBE"),c&&_.push("ZERO_EXAGGERATION"),p&&!o&&p.getOpacity(this.transform.pitch)!==0&&_.push("FOG"),o&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}useProgram(o,c,p){this.cache=this.cache||{};const _=p||[],v=this.currentGlobalDefines().concat(_),T=Yt.cacheKey(ph[o],o,v,c);return this.cache[T]||(this.cache[T]=new Yt(this.context,o,ph[o],c,Ih[o],v)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(o,c,p){if(this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const v=_.getOpacity(this.transform.pitch),T=((S,M,D,k,B,$,W,K,H,Y,F)=>{const q=S.transform,ne=M.properties.get("color").toArray01();ne[3]=k;const ie=S.frameCounter/1e3%1;return{u_fog_matrix:D?q.calculateFogTileMatrix(D):S.identityMat,u_fog_range:M.getFovAdjustedRange(q._fov),u_fog_color:ne,u_fog_horizon_blend:M.properties.get("horizon-blend"),u_fog_temporal_offset:ie,u_frustum_tl:B,u_frustum_tr:$,u_frustum_br:W,u_frustum_bl:K,u_globe_pos:H,u_globe_radius:Y,u_viewport:F,u_globe_transition:s.globeToMercatorTransition(q.zoom),u_is_globe:+(q.projection.name==="globe")}})(this,_,p,v,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);c.setFogUniformValues(o,T)}}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){const o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){const o=this.context.gl,c=o.createTexture();return o.bindTexture(o.TEXTURE_2D,c),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,c=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const _ of p)c[_.key]=o[_.key]||new s.Tile(_,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class Ic{constructor(o=0,c=0,p=0,_=0){if(isNaN(o)||o<0||isNaN(c)||c<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=c,this.left=p,this.right=_}interpolate(o,c,p){return c.top!=null&&o.top!=null&&(this.top=s.number(o.top,c.top,p)),c.bottom!=null&&o.bottom!=null&&(this.bottom=s.number(o.bottom,c.bottom,p)),c.left!=null&&o.left!=null&&(this.left=s.number(o.left,c.left,p)),c.right!=null&&o.right!=null&&(this.right=s.number(o.right,c.right,p)),this}getCenter(o,c){const p=s.clamp((this.left+o-this.right)/2,0,o),_=s.clamp((this.top+c-this.bottom)/2,0,c);return new s.Point(p,_)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Ic(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function kc(h,o){const c=s.getColumn(h,3);s.fromQuat(h,o),s.setColumn(h,3,c)}function en(h,o){const c=s.identity$1([]);return s.rotateZ$1(c,c,-o),s.rotateX$1(c,c,-h),c}function xl(h,o){const c=[h[0],h[1],0],p=[o[0],o[1],0];if(s.length(c)>=1e-15){const T=s.normalize([],c);s.scale$2(p,T,s.dot(p,T)),o[0]=p[0],o[1]=p[1]}const _=s.cross([],o,h);if(s.len(_)<1e-15)return null;const v=Math.atan2(-_[1],_[0]);return en(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),v)}class fp{constructor(o,c){this.position=o,this.orientation=c}get position(){return this._position}set position(o){if(o){const c=o instanceof s.MercatorCoordinate?o:new s.MercatorCoordinate(o[0],o[1],o[2]);this._renderWorldCopies&&(c.x=s.wrap(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(o,c){if(this.orientation=null,!this.position)return;const p=this.position,_=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(o)):0,v=s.MercatorCoordinate.fromLngLat(o,_),T=[v.x-p.x,v.y-p.y,v.z-p.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=xl(T,c)}setPitchBearing(o,c){this.orientation=en(s.degToRad(o),s.degToRad(-c))}}class Dc{constructor(o,c){this._transform=s.identity([]),this.orientation=c,this.position=o}get mercatorPosition(){const o=this.position;return new s.MercatorCoordinate(o[0],o[1],o[2])}get position(){const o=s.getColumn(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var c;o&&s.setColumn(this._transform,3,[(c=o)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||s.identity$1([]),o&&kc(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,c){this._orientation=en(o,c),kc(this._transform,this._orientation)}forward(){const o=s.getColumn(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=s.getColumn(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=s.getColumn(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,c){const p=new Float64Array(16);return s.invert(p,this.getWorldToCamera(o,c)),p}getWorldToCameraPosition(o,c,p){const _=this.position;s.scale$2(_,_,-o);const v=new Float64Array(16);return s.fromScaling(v,[p,p,p]),s.translate(v,v,_),v[10]*=c,v}getWorldToCamera(o,c){const p=new Float64Array(16),_=new Float64Array(4),v=this.position;return s.conjugate(_,this._orientation),s.scale$2(v,v,-o),s.fromQuat(p,_),s.translate(p,p,v),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=c,p[9]*=c,p[10]*=c,p[11]*=c,p}getCameraToClipPerspective(o,c,p,_){const v=new Float64Array(16);return s.perspective(v,o,c,p,_),v}getDistanceToElevation(o,c=!1){const p=o===0?0:s.mercatorZfromAltitude(o,c?s.latFromMercatorY(this.position[1]):this.position[1]),_=this.forward();return(p-this.position[2])/_[2]}clone(){return new Dc([...this.position],[...this.orientation])}}function ha(h,o){const c=zc(h.projection,h.zoom,h.width,h.height),p=function(v,T,S,M,D){const k=new s.LngLat(S.lng-180*Mo,S.lat),B=new s.LngLat(S.lng+180*Mo,S.lat),$=v.project(k.lng,k.lat),W=v.project(B.lng,B.lat),K=-Math.atan2(W.y-$.y,W.x-$.x),H=s.MercatorCoordinate.fromLngLat(S);H.y=s.clamp(H.y,-1+Mo,1-Mo);const Y=H.toLngLat(),F=v.project(Y.lng,Y.lat),q=s.MercatorCoordinate.fromLngLat(Y);q.x+=Mo;const ne=q.toLngLat(),ie=v.project(ne.lng,ne.lat),me=Lc(ie.x-F.x,ie.y-F.y,K),ye=s.MercatorCoordinate.fromLngLat(Y);ye.y+=Mo;const ge=ye.toLngLat(),be=v.project(ge.lng,ge.lat),xe=Lc(be.x-F.x,be.y-F.y,K),Me=Math.abs(me.x)/Math.abs(xe.y),Qe=s.identity([]);s.rotateZ(Qe,Qe,-K*(1-(D?0:M)));const Ee=s.identity([]);return s.scale(Ee,Ee,[1,1-(1-Me)*M,1]),Ee[4]=-xe.x/xe.y*M,s.rotateZ(Ee,Ee,K),s.multiply(Ee,Qe,Ee),Ee}(h.projection,0,h.center,c,o),_=pp(h);return s.scale(p,p,[_,_,1]),p}function pp(h){const o=h.projection,c=zc(h.projection,h.zoom,h.width,h.height),p=mp(o,h.center),_=mp(o,s.LngLat.convert(o.center));return Math.pow(2,p*c+(1-c)*_)}function zc(h,o,c,p,_=1/0){const v=h.range;if(!v)return 0;const T=Math.min(_,Math.max(c,p)),S=Math.log(T/1024)/Math.LN2;return s.smoothstep(v[0]+S,v[1]+S,o)}const Mo=1/4e4;function mp(h,o){const c=s.clamp(o.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),p=new s.LngLat(o.lng-180*Mo,c),_=new s.LngLat(o.lng+180*Mo,c),v=h.project(p.lng,c),T=h.project(_.lng,c),S=s.MercatorCoordinate.fromLngLat(p),M=s.MercatorCoordinate.fromLngLat(_),D=T.x-v.x,k=T.y-v.y,B=M.x-S.x,$=M.y-S.y,W=Math.sqrt((B*B+$*$)/(D*D+k*k));return Math.log(W)/Math.LN2}function Lc(h,o,c){const p=Math.cos(c),_=Math.sin(c);return{x:h*p-o*_,y:h*_+o*p}}class da{constructor(o,c,p,_,v,T,S){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=o||0,this._maxZoom=c||22,this._minPitch=p??0,this._maxPitch=_??60,this.setProjection(T),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ic,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Dc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const o=new da(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(o,c=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(o||p)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=s.getProjection(this.projectionOptions);const p=!A(c,this.getProjection());return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setMercatorFromTransition(){const o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.getProjection({name:"mercator"});const c=o!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.Point(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const c=-o*Math.PI/180;var p;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(p=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(_,v,T){var S=v[0],M=v[1],D=v[2],k=v[3],B=Math.sin(T),$=Math.cos(T);_[0]=S*$+D*B,_[1]=M*$+k*B,_[2]=S*-B+D*$,_[3]=M*-B+k*$}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const c=s.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=s.degToRad(o),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const c=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const o=this._elevation;this._centerAltitude=o.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=o.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let _=0,v=0;for(let T=0;T<c.length;T++){const S=new s.Point(c[T][0]*this.width,p+c[T][1]*(this.height-p)),M=o.pointCoordinate(S);if(!M)continue;const D=1/Math.hypot(M[0]-this._camera.position[0],M[1]-this._camera.position[1]);_+=M[3]*D,v+=D}return v===0?NaN:_/v}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*c,_=this._mercatorZfromZoom(o),v=this._mercatorZfromZoom(this._maxZoom),T=Math.max(_-p,v);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let p;p=o.z<this._camera.position[2]?[c.x,c.y,c.z]:[o.x,o.y,o.z];const _=s.length(s.sub([],this._camera.position,p));return s.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let c=!1;if(o.orientation&&!s.exactEquals(o.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(o.orientation)),o.position){const p=[o.position.x,o.position.y,o.position.z];s.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,c=new fp;return c.position=new s.MercatorCoordinate(o[0],o[1],o[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(o){if(!s.length$1(o))return!1;s.normalize$1(o,o);const c=s.transformQuat([],[0,0,-1],o),p=s.transformQuat([],[0,-1,0],o);if(p[2]<0)return!1;const _=xl(c,p);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(o){const c=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;o[2]=s.clamp(o[2],_/p,_/c),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,c,p){this._unmodified=!1,this._edgeInsets.interpolate(o,c,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const c=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(o){const c=[new s.UnwrappedTileID(0,o)];if(this.renderWorldCopies){const p=this.pointCoordinate(new s.Point(0,0)),_=this.pointCoordinate(new s.Point(this.width,0)),v=this.pointCoordinate(new s.Point(this.width,this.height)),T=this.pointCoordinate(new s.Point(0,this.height)),S=Math.floor(Math.min(p.x,_.x,v.x,T.x)),M=Math.floor(Math.max(p.x,_.x,v.x,T.x)),D=1;for(let k=S-D;k<=M+D;k++)k!==0&&c.push(new s.UnwrappedTileID(k,o))}return c}coveringTiles(o){let c=this.coveringZoomLevel(o);const p=c,_=this.elevation&&!o.isTerrainDEM,v=this.projection.name==="mercator";if(o.minzoom!==void 0&&c<o.minzoom)return[];o.maxzoom!==void 0&&c>o.maxzoom&&(c=o.maxzoom);const T=this.locationCoordinate(this.center),S=this.center.lat,M=1<<c,D=[M*T.x,M*T.y,0],k=this.projection.name==="globe",B=!k,$=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,B),W=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=M*s.mercatorZfromAltitude(1,this.center.lat),H=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),Y=[M*W.x,M*W.y,H*(B?1:K)],F=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),q=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,ne=o.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ie=o.isTerrainDEM?-ne:this._elevation?this._elevation.getMinElevationBelowMSL():0,me=this.projection.isReprojectedInTileSpace?pp(this):1,ye=Ae=>{const tt=new s.MercatorCoordinate(Ae.x+25e-6,Ae.y,Ae.z),Ze=new s.MercatorCoordinate(Ae.x,Ae.y+25e-6,Ae.z),it=Ae.toLngLat(),bt=tt.toLngLat(),zt=Ze.toLngLat(),_t=this.locationCoordinate(it),At=this.locationCoordinate(bt),Ht=this.locationCoordinate(zt),qt=Math.hypot(At.x-_t.x,At.y-_t.y),xt=Math.hypot(Ht.x-_t.x,Ht.y-_t.y);return Math.sqrt(qt*xt)*me/25e-6},ge=Ae=>{const Ne=ne,tt=ie;return{aabb:s.tileAABB(this,M,0,0,0,Ae,tt,Ne,this.projection),zoom:0,x:0,y:0,minZ:tt,maxZ:Ne,wrap:Ae,fullyVisible:!1}},be=[];let xe=[];const Me=c,Qe=o.reparseOverscaled?p:c,Ee=Ae=>Ae*Ae,je=Ee((H-this._centerAltitude)*K),Ie=Ae=>{if(!this._elevation||!Ae.tileID||!v)return;const Ne=this._elevation.getMinMaxForTile(Ae.tileID),tt=Ae.aabb;Ne?(tt.min[2]=Ne.min,tt.max[2]=Ne.max,tt.center[2]=(tt.min[2]+tt.max[2])/2):(Ae.shouldSplit=Ke(Ae),Ae.shouldSplit||(tt.min[2]=tt.max[2]=tt.center[2]=this._centerAltitude))},Ke=Ae=>{if(Ae.zoom<q)return!0;if(Ae.zoom===Me)return!1;if(Ae.shouldSplit!=null)return Ae.shouldSplit;const Ne=Ae.aabb.distanceX(Y),tt=Ae.aabb.distanceY(Y);let Ze=je,it=1;if(k){Ze=Ee(Ae.aabb.distanceZ(Y));const _t=Math.pow(2,Ae.zoom),At=s.latFromMercatorY((Ae.y+1)/_t),Ht=s.latFromMercatorY(Ae.y/_t),qt=Math.min(Math.max(S,At),Ht),xt=s.circumferenceAtLatitude(qt)/s.circumferenceAtLatitude(S);if(it=qt===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,xt/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&Ae.zoom===Me-1&&xt>=.9)return!0}else if(_&&(Ze=Ee(Ae.aabb.distanceZ(Y)*K)),this.projection.isReprojectedInTileSpace&&p<=5){const _t=Math.pow(2,Ae.zoom),At=ye(new s.MercatorCoordinate((Ae.x+.5)/_t,(Ae.y+.5)/_t));it=At>.85?1:At}const bt=Ne*Ne+tt*tt+Ze,zt=Ee((1<<Me-Ae.zoom)*F*it*((_t,At)=>{if(At*Ee(.707)<_t)return 1;const Ht=Math.sqrt(At/_t);return Ht/(1.4144271570014144+(Math.pow(1.1,Ht-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ze,je),bt));return bt<zt};if(this.renderWorldCopies)for(let Ae=1;Ae<=3;Ae++)be.push(ge(-Ae)),be.push(ge(Ae));for(be.push(ge(0));be.length>0;){const Ae=be.pop(),Ne=Ae.x,tt=Ae.y;let Ze=Ae.fullyVisible;if(!Ze){const it=Ae.aabb.intersects($);if(it===0)continue;Ze=it===2}if(Ae.zoom!==Me&&Ke(Ae))for(let it=0;it<4;it++){const bt=(Ne<<1)+it%2,zt=(tt<<1)+(it>>1),_t={aabb:v?Ae.aabb.quadrant(it):s.tileAABB(this,M,Ae.zoom+1,bt,zt,Ae.wrap,Ae.minZ,Ae.maxZ,this.projection),zoom:Ae.zoom+1,x:bt,y:zt,wrap:Ae.wrap,fullyVisible:Ze,tileID:void 0,shouldSplit:void 0,minZ:Ae.minZ,maxZ:Ae.maxZ};_&&!k&&(_t.tileID=new s.OverscaledTileID(Ae.zoom+1===Me?Qe:Ae.zoom+1,Ae.wrap,Ae.zoom+1,bt,zt),Ie(_t)),be.push(_t)}else{const it=Ae.zoom===Me?Qe:Ae.zoom;if(o.minzoom&&o.minzoom>it)continue;const bt=D[0]-(.5+Ne+(Ae.wrap<<Ae.zoom))*(1<<c-Ae.zoom),zt=D[1]-.5-tt,_t=Ae.tileID?Ae.tileID:new s.OverscaledTileID(it,Ae.wrap,Ae.zoom,Ne,tt);xe.push({tileID:_t,distanceSq:bt*bt+zt*zt})}}if(this.fogCullDistSq){const Ae=this.fogCullDistSq,Ne=this.horizonLineFromTop();xe=xe.filter(tt=>{const Ze=[0,0,0,1],it=[s.EXTENT,s.EXTENT,0,1],bt=this.calculateFogTileMatrix(tt.tileID.toUnwrapped());s.transformMat4$1(Ze,Ze,bt),s.transformMat4$1(it,it,bt);const zt=s.getAABBPointSquareDist(Ze,it);if(zt===0)return!0;let _t=!1;const At=this._elevation;if(At&&zt>Ae&&Ne!==0){const Ht=this.calculateProjMatrix(tt.tileID.toUnwrapped());let qt;o.isTerrainDEM||(qt=At.getMinMaxForTile(tt.tileID)),qt||(qt={min:ie,max:ne});const xt=s.furthestTileCorner(this.rotation),hn=[xt[0]*s.EXTENT,xt[1]*s.EXTENT,qt.max];s.transformMat4(hn,hn,Ht),_t=(1-hn[1])*this.height*.5<Ne}return zt<Ae||_t})}return xe.sort((Ae,Ne)=>Ae.distanceSq-Ne.distanceSq).map(Ae=>Ae.tileID)}resize(o,c){this.width=o,this.height=c,this.pixelsToGLUnits=[2/o,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const c=s.clamp(o.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),p=this.projection.project(o.lng,c);return new s.Point(p.x*this.worldSize,p.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,c){let p,_;const v=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;p=(c.x-v.x)/S,_=(c.y-v.y)/S}else{const S=this.pointCoordinate(c),M=this.pointCoordinate(v);p=S.x-M.x,_=S.y-M.y}const T=this.locationCoordinate(o);this.setLocation(new s.MercatorCoordinate(T.x-p,T.y-_))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this.projection.locationPoint(this,o,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,c){const p=c?s.mercatorZfromAltitude(c,o.lat):void 0,_=this.projection.project(o.lng,o.lat);return new s.MercatorCoordinate(_.x,_.y,p)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,c){const p=c??this._centerAltitude,_=[o.x,o.y,0,1],v=[o.x,o.y,1,1];s.transformMat4$1(_,_,this.pixelMatrixInverse),s.transformMat4$1(v,v,this.pixelMatrixInverse);const T=v[3];s.scale$1(_,_,1/_[3]),s.scale$1(v,v,1/T);const S=_[2],M=v[2];return{p0:_,p1:v,t:S===M?0:(p-S)/(M-S)}}screenPointToMercatorRay(o){const c=[o.x,o.y,0,1],p=[o.x,o.y,1,1];return s.transformMat4$1(c,c,this.pixelMatrixInverse),s.transformMat4$1(p,p,this.pixelMatrixInverse),s.scale$1(c,c,1/c[3]),s.scale$1(p,p,1/p[3]),c[2]=s.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,p[2]=s.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,s.scale$1(c,c,1/this.worldSize),s.scale$1(p,p,1/this.worldSize),new s.Ray([c[0],c[1],c[2]],s.normalize([],s.sub([],p,c)))}rayIntersectionCoordinate(o){const{p0:c,p1:p,t:_}=o,v=s.mercatorZfromAltitude(c[2],this._center.lat),T=s.mercatorZfromAltitude(p[2],this._center.lat);return new s.MercatorCoordinate(s.number(c[0],p[0],_)/this.worldSize,s.number(c[1],p[1],_)/this.worldSize,s.number(v,T,_))}pointCoordinate(o,c=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,c)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);let c=this.projection.pointCoordinate3D(this,o.x,o.y);if(c)return new s.MercatorCoordinate(c[0],c[1],c[2]);let p=0,_=this.horizonLineFromTop();if(o.y>_)return this.pointCoordinate(o);const v=.02*_,T=o.clone();for(let S=0;S<10&&_-p>v;S++){T.y=s.number(p,_,.66);const M=this.projection.pointCoordinate3D(this,T.x,T.y);M?(_=T.y,c=M):p=T.y}return c?new s.MercatorCoordinate(c[0],c[1],c[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(o);const c=this.pointCoordinate(o);return c.y>=0&&c.y<=1}_coordinatePoint(o,c){const p=c&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,_=[o.x*this.worldSize,o.y*this.worldSize,p+o.toAltitude(),1];return s.transformMat4$1(_,_,this.pixelMatrix),_[3]>0?new s.Point(_[0]/_[3],_[1]/_[3]):new s.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:o,left:c}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,v=this.pointLocation3D(new s.Point(c,o)),T=this.pointLocation3D(new s.Point(_,o)),S=this.pointLocation3D(new s.Point(_,p)),M=this.pointLocation3D(new s.Point(c,p));let D=Math.min(v.lng,T.lng,S.lng,M.lng),k=Math.max(v.lng,T.lng,S.lng,M.lng),B=Math.min(v.lat,T.lat,S.lat,M.lat),$=Math.max(v.lat,T.lat,S.lat,M.lat);const W=Math.pow(2,-this.zoom)/16*270,K=this.projection.name==="globe"?1:4,H=(Y,F,q,ne,ie)=>{const me=(Y+q)/2,ye=(F+ne)/2,ge=new s.Point(me,ye),{lng:be,lat:xe}=this.pointLocation3D(ge),Me=Math.max(0,D-be,B-xe,be-k,xe-$);D=Math.min(D,be),k=Math.max(k,be),B=Math.min(B,xe),$=Math.max($,xe),(ie<K||Me>W)&&(H(Y,F,me,ye,ie+1),H(me,ye,q,ne,ie+1))};if(H(c,o,_,o,1),H(_,o,_,p,1),H(_,p,c,p,1),H(c,p,c,o,1),this.projection.name==="globe"){const[Y,F]=s.polesInViewport(this);Y?($=90,k=180,D=-180):F&&(B=-90,k=180,D=-180)}return new s.LngLatBounds(new s.LngLat(D,B),new s.LngLat(k,$))}_getBoundsRectangular(o,c){const{top:p,left:_}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,S=new s.Point(_,p),M=new s.Point(T,p),D=new s.Point(T,v),k=new s.Point(_,v);let B=this.pointCoordinate(S,o),$=this.pointCoordinate(M,o);const W=this.pointCoordinate(D,c),K=this.pointCoordinate(k,c),H=(Y,F)=>(F.y-Y.y)/(F.x-Y.x);return B.y>1&&$.y>=0?B=new s.MercatorCoordinate((1-K.y)/H(K,B)+K.x,1):B.y<0&&$.y<=1&&(B=new s.MercatorCoordinate(-K.y/H(K,B)+K.x,0)),$.y>1&&B.y>=0?$=new s.MercatorCoordinate((1-W.y)/H(W,$)+W.x,1):$.y<0&&B.y<=1&&($=new s.MercatorCoordinate(-W.y/H(W,$)+W.x,0)),new s.LngLatBounds().extend(this.coordinateLocation(B)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(W))}_getBoundsRectangularTerrain(){const o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=o.visibleDemTiles.reduce((p,_)=>{if(_.dem){const v=_.dem.tree;p.min=Math.min(p.min,v.minimums[0]),p.max=Math.max(p.max,v.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*o.exaggeration(),c.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-c*(1-this._horizonShift);return o?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,c){return this.projection.createTileMatrix(this,c,o)}calculateDistanceTileData(o){const c=o.key,p=this._distanceTileDataCache;if(p[c])return p[c];const _=o.canonical,v=1/this.height,T=this.cameraWorldSize,S=T/this.zoomScale(_.z),M=(_.x+Math.pow(2,_.z)*o.wrap)*S,D=_.y*S,k=this.point;k.x*=T/this.worldSize,k.y*=T/this.worldSize;const B=this.angle,$=Math.sin(-B),W=-Math.cos(-B);return p[c]={bearing:[$,W],center:[(k.x-M)*v,(k.y-D)*v],scale:S/s.EXTENT*v},p[c]}calculateFogTileMatrix(o){const c=o.key,p=this._fogTileMatrixCache;if(p[c])return p[c];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return s.multiply(_,this.worldToFogMatrix,_),p[c]=new Float32Array(_),p[c]}calculateProjMatrix(o,c=!1){const p=o.key,_=c?this._alignedProjMatrixCache:this._projMatrixCache;if(_[p])return _[p];const v=this.calculatePosMatrix(o,this.worldSize);return s.multiply(v,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,v),_[p]=new Float32Array(v),_[p]}calculatePixelsToTileUnitsMatrix(o){const c=o.tileID.key,p=this._pixelsToTileUnitsCache;if(p[c])return p[c];const _=function(v,T){const{scale:S}=v.tileTransform,M=S*s.EXTENT/(v.tileSize*Math.pow(2,T.zoom-v.tileID.overscaledZ+v.tileID.canonical.z));return D=new Float32Array(4),$=(k=T.inverseAdjustmentMatrix)[1],W=k[2],K=k[3],Y=(B=[M,M])[1],D[0]=k[0]*(H=B[0]),D[1]=$*H,D[2]=W*Y,D[3]=K*Y,D;var D,k,B,$,W,K,H,Y}(o,this);return p[c]=_,p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const o=1/this.worldSize,c=s.fromScaling([],[o,o,o]);return s.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const o=this._elevation;this._updateCameraState();const c=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(c),_=this._camera.forward(),v=s.mercatorZfromAltitude(1,this._center.lat);p[2]/=v,_[2]/=v,s.normalize(_,_);const T=o.raycast(p,_,o.exaggeration());if(T){const S=s.scaleAndAdd([],p,_,T),M=new s.MercatorCoordinate(S[0],S[1],s.mercatorZfromAltitude(S[2],s.latFromMercatorY(S[1]))),D=(M.z+s.length([M.x-p[0],M.y-p[1],M.z-p[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=M.toAltitude(),this._center=this.coordinateLocation(M),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;const c=this._elevation,p=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(p),v=c.getAtPointOrZero(new s.MercatorCoordinate(..._)),T=this.pixelsPerMeter/this.worldSize*v,S=this._minimumHeightOverTerrain(),M=_[2]-T;if(M<=S)if(M<0||o){const D=this.locationCoordinate(this._center,this._centerAltitude),k=[_[0],_[1],D.z-_[2]],B=s.length(k);k[2]-=(S-M)/this._pixelsPerMercatorPixel;const $=s.length(k);if($===0)return;s.scale$2(k,k,B/$*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],D.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){const $=this.center;return $.lat=s.clamp($.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&($.lng=s.clamp($.lng,this.minLng,this.maxLng)),this.center=$,void(this._constraining=!1)}const c=this._unmodified,{x:p,y:_}=this.point;let v=0,T=p,S=_;const M=this.width/2,D=this.height/2,k=this.worldMinY*this.scale,B=this.worldMaxY*this.scale;if(_-D<k&&(S=k+D),_+D>B&&(S=B-D),B-k<this.height&&(v=Math.max(v,this.height/(B-k)),S=(B+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const $=this.worldMinX*this.scale,W=this.worldMaxX*this.scale,K=this.worldSize/2-($+W)/2;T=(p+K+this.worldSize)%this.worldSize-K,T-M<$&&(T=$+M),T+M>W&&(T=W-M),W-$<this.width&&(v=Math.max(v,this.width/(W-$)),T=(W+$)/2)}T===p&&S===_||(this.center=this.unproject(new s.Point(T,S))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.mercatorZfromAltitude(1,this.center.lat)/s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE));const p=zc(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this.projection.zAxisUnit==="meters"?c:1,v=this._camera.getWorldToCamera(this.worldSize,_),T=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);T[8]=2*-o.x/this.width,T[9]=2*o.y/this.height;let S=s.mul([],T,v);if(this.projection.isReprojectedInTileSpace){const ye=this.locationCoordinate(this.center),ge=s.identity([]);s.translate(ge,ge,[ye.x*this.worldSize,ye.y*this.worldSize,0]),s.multiply(ge,ge,ha(this)),s.translate(ge,ge,[-ye.x*this.worldSize,-ye.y*this.worldSize,0]),s.multiply(S,S,ge),this.inverseAdjustmentMatrix=function(be){const xe=ha(be,!0);return ze([],[xe[0],xe[1],xe[4],xe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],S,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=S,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const M=s.invert([],T);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(M,this.horizonLineFromTop(),this.height);const D=new Float32Array(16);s.identity(D),s.scale(D,D,[1,-1,1]),s.rotateX(D,D,this._pitch),s.rotateZ(D,D,this.angle);const k=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),B=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;k[8]=2*-o.x/this.width,k[9]=2*(o.y+B)/this.height,this.skyboxMatrix=s.multiply(D,k,D);const $=this.point,W=$.x,K=$.y,H=this.width%2/2,Y=this.height%2/2,F=Math.cos(this.angle),q=Math.sin(this.angle),ne=W-Math.round(W)+F*H+q*Y,ie=K-Math.round(K)+F*Y+q*H,me=new Float64Array(S);if(s.translate(me,me,[ne>.5?ne-1:ne,ie>.5?ie-1:ie,0]),this.alignedProjMatrix=me,S=s.create(),s.scale(S,S,[this.width/2,-this.height/2,1]),s.translate(S,S,[1,-1,0]),this.labelPlaneMatrix=S,S=s.create(),s.scale(S,S,[1,-1,1]),s.translate(S,S,[-1,-1,0]),s.scale(S,S,[2/this.width,2/this.height,1]),this.glCoordMatrix=S,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},S=s.invert(new Float64Array(16),this.pixelMatrix),!S)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=S,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.calculateGlobeMatrix(this);const ye=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(ye,ye,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=S;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,p=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,v=[o,o,c];s.scale$2(v,v,_),s.scale$2(p,p,-1),s.multiply$2(p,p,v);const T=s.create();s.translate(T,T,p),s.scale(T,T,v),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,c,_)}_computeCameraPosition(o){const c=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),_=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-o/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-p[0]*v,_.y/this.worldSize-p[1]*v,o/this.worldSize*this._centerAltitude-p[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],_=o[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(v=Math.min((c-p)/_,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,o,v),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,c=this._camera.forward(),{pitch:p,bearing:_}=this._camera.getPitchBearing(),v=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),S=Math.max((o[2]-v)/Math.cos(p),T),M=this._zoomFromMercatorZ(S);s.scaleAndAdd(o,o,c,S),this._pitch=s.clamp(p,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(_,-Math.PI,Math.PI),this._setZoom(s.clamp(M,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}zoomFromMercatorZAdjusted(o){let c=0,p=s.GLOBE_ZOOM_THRESHOLD_MAX,_=0,v=1/0;for(;p-c>1e-6&&p>c;){const T=c+.5*(p-c),S=this.tileSize*Math.pow(2,T),M=this.getCameraToCenterDistance(this.projection,T,S),D=this.scaleZoom(M/(o*this.tileSize)),k=Math.abs(T-D);k<v&&(v=k,_=T),T<D?c=T:p=T}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,c){const p=Math.min(o.x,c.x),_=Math.max(o.x,c.x),v=Math.min(o.y,c.y),T=Math.max(o.y,c.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new s.Point(p,v),new s.Point(_,T),new s.Point(p,T),new s.Point(_,v)],M=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const k of S){const B=this.pointRayIntersection(k);if(B.t<0)return!0;const $=this.rayIntersectionCoordinate(B);if($.x<M||$.y<0||$.x>D||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.Point(0,0),new s.Point(this.width,this.height))}zoomDeltaToMovement(o,c){const p=s.length(s.sub([],this._camera.position,o)),_=this._zoomFromMercatorZ(p)+c;return p-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const o=function([c,p,_],v){const T=[c,p,_,1];s.transformMat4$1(T,T,v);const S=T[3]=Math.max(T[3],1e-6);return T[0]/=S,T[1]/=S,T[2]/=S,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.Point(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,o))}}getCameraToCenterDistance(o,c=this.zoom,p=this.worldSize){const _=zc(o,c,this.width,this.height,1024),v=o.pixelSpaceConversion(this.center.lat,p,_);return .5/Math.tan(.5*this._fov)*this.height*v}getWorldToCameraMatrix(){const o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.multiply(o,o,this.globeMatrix),o}}function fa(h,o){let c=!1,p=null;const _=()=>{p=null,c&&(h(),p=setTimeout(_,o),c=!1)};return()=>(c=!0,p||_(),p)}class zh{constructor(o){this._hashName=o&&encodeURIComponent(o),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=fa(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,s.window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const o=this._map;if(!o)return"";const c=wl(o);if(this._hashName){const p=this._hashName;let _=!1;const v=s.window.location.hash.slice(1).split("&").map(T=>{const S=T.split("=")[0];return S===p?(_=!0,`${S}=${c}`):T}).filter(T=>T);return _||v.push(`${p}=${c}`),`#${v.join("&")}`}return`#${c}`}_getCurrentHash(){const o=s.window.location.hash.replace("#","");if(this._hashName){let c;return o.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(c=p)}),(c&&c[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(p=>isNaN(p))){const p=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(c[3]||0):o.getBearing();return o.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:p,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,o)}}function wl(h,o){const c=h.getCenter(),p=Math.round(100*h.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,_),T=Math.round(c.lng*v)/v,S=Math.round(c.lat*v)/v,M=h.getBearing(),D=h.getPitch();let k=o?`/${T}/${S}/${p}`:`${p}/${S}/${T}`;return(M||D)&&(k+="/"+Math.round(10*M)/10),D&&(k+=`/${Math.round(D)}`),k}const bl={linearity:.3,easing:s.bezier(0,0,.3,1)},Rc=s.extend({deceleration:2500,maxSpeed:1400},bl),Bc=s.extend({deceleration:20,maxSpeed:1400},bl),pt=s.extend({deceleration:1e3,maxSpeed:360},bl),Or=s.extend({deceleration:1e3,maxSpeed:90},bl);class gp{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,c=s.exported.now();for(;o.length>0&&c-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)c.zoom+=v.zoomDelta||0,c.bearing+=v.bearingDelta||0,c.pitch+=v.pitchDelta||0,v.panDelta&&c.pan._add(v.panDelta),v.around&&(c.around=v.around),v.pinchAround&&(c.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(c.pan.mag()){const v=El(c.pan.mag(),p,s.extend({},Rc,o||{}));_.offset=c.pan.mult(v.amount/c.pan.mag()),_.center=this._map.transform.center,Tl(_,v)}if(c.zoom){const v=El(c.zoom,p,Bc);_.zoom=this._map.transform.zoom+v.amount,Tl(_,v)}if(c.bearing){const v=El(c.bearing,p,pt);_.bearing=this._map.transform.bearing+s.clamp(v.amount,-179,179),Tl(_,v)}if(c.pitch){const v=El(c.pitch,p,Or);_.pitch=this._map.transform.pitch+v.amount,Tl(_,v)}if(_.zoom||_.bearing){const v=c.pinchAround===void 0?c.around:c.pinchAround;_.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function Tl(h,o){(!h.duration||h.duration<o.duration)&&(h.duration=o.duration,h.easing=o.easing)}function El(h,o,c){const{maxSpeed:p,linearity:_,deceleration:v}=c,T=s.clamp(h*_/(o/1e3),-p,p),S=Math.abs(T)/(v*_);return{easing:c.easing,duration:1e3*S,amount:T*(S/2)}}class wi extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,p,_={}){const v=Be(c.getCanvasContainer(),p),T=c.unproject(v);super(o,s.extend({point:v,lngLat:T,originalEvent:p},_)),this._defaultPrevented=!1,this.target=c}}class Sl extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,p){const _=o==="touchend"?p.changedTouches:p.touches,v=at(c.getCanvasContainer(),_),T=v.map(M=>c.unproject(M)),S=v.reduce((M,D,k,B)=>M.add(D.div(B.length)),new s.Point(0,0));super(o,{points:v,point:S,lngLats:T,lngLat:c.unproject(S),originalEvent:p}),this._defaultPrevented=!1}}class Fc extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,p){super(o,{originalEvent:p}),this._defaultPrevented=!1}}class Lh{constructor(o,c){this._map=o,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new Fc(o.type,this._map,o))}mousedown(o,c){return this._mousedownPos=c,this._firePreventable(new wi(o.type,this._map,o))}mouseup(o){this._map.fire(new wi(o.type,this._map,o))}preclick(o){const c=s.extend({},o);c.type="preclick",this._map.fire(new wi(c.type,this._map,c))}click(o,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(o),this._map.fire(new wi(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new wi(o.type,this._map,o))}mouseover(o){this._map.fire(new wi(o.type,this._map,o))}mouseout(o){this._map.fire(new wi(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Sl(o.type,this._map,o))}touchmove(o){this._map.fire(new Sl(o.type,this._map,o))}touchend(o){this._map.fire(new Sl(o.type,this._map,o))}touchcancel(o){this._map.fire(new Sl(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Oc{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new wi(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new wi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new wi(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _p{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,c){this.isEnabled()&&o.shiftKey&&o.button===0&&(ae(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(o,c){if(!this._active)return;const p=c,_=this._startPos,v=this._lastPos;if(!_||!v||v.equals(p)||!this._box&&p.dist(_)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=G("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const T=Math.min(_.x,p.x),S=Math.max(_.x,p.x),M=Math.min(_.y,p.y),D=Math.max(_.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${M}px)`,this._box.style.width=S-T+"px",this._box.style.height=D-M+"px")})}mouseupWindow(o,c){if(!this._active)return;const p=this._startPos,_=c;if(p&&o.button===0){if(this.reset(),oe(),p.x!==_.x||p.y!==_.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:v=>v.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),J(),delete this._startPos,delete this._lastPos}_fireEvent(o,c){return this._map.fire(new s.Event(o,{originalEvent:c}))}}function Uc(h,o){const c={};for(let p=0;p<h.length;p++)c[h[p].identifier]=o[p];return c}class pa{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,c,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const v=new s.Point(0,0);for(const T of _)v._add(T);return v.div(_.length)}(c),this.touches=Uc(p,c)))}touchmove(o,c,p){if(this.aborted||!this.centroid)return;const _=Uc(p,c);for(const v in this.touches){const T=_[v];(!T||T.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(o,c,p){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Rh{constructor(o){this.singleTap=new pa(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,c,p){this.singleTap.touchstart(o,c,p)}touchmove(o,c,p){this.singleTap.touchmove(o,c,p)}touchend(o,c,p){const _=this.singleTap.touchend(o,c,p);if(_){const v=o.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(_)<30;if(v&&T||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class b_{constructor(){this._zoomIn=new Rh({numTouches:1,numTaps:2}),this._zoomOut=new Rh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,c,p){this._zoomIn.touchstart(o,c,p),this._zoomOut.touchstart(o,c,p)}touchmove(o,c,p){this._zoomIn.touchmove(o,c,p),this._zoomOut.touchmove(o,c,p)}touchend(o,c,p){const _=this._zoomIn.touchend(o,c,p),v=this._zoomOut.touchend(o,c,p);return _?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(_)},{originalEvent:o})}):v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(v)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const yp={0:1,2:2};class ma{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,c){return!1}_move(o,c){return{}}mousedown(o,c){if(this._lastPoint)return;const p=Ye(o);this._correctButton(o,p)&&(this._lastPoint=c,this._eventButton=p)}mousemoveWindow(o,c){const p=this._lastPoint;if(p){if(o.preventDefault(),this._eventButton!=null&&function(_,v){const T=yp[v];return _.buttons===void 0||(_.buttons&T)!==T}(o,this._eventButton))this.reset();else if(this._moved||!(c.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(p,c)}}mouseupWindow(o){this._lastPoint&&Ye(o)===this._eventButton&&(this._moved&&oe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bh extends ma{mousedown(o,c){super.mousedown(o,c),this._lastPoint&&(this._active=!0)}_correctButton(o,c){return c===0&&!o.ctrlKey}_move(o,c){return{around:c,panDelta:c.sub(o)}}}class Fh extends ma{_correctButton(o,c){return c===0&&o.ctrlKey||c===2}_move(o,c){const p=.8*(c.x-o.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(o){o.preventDefault()}}class Oh extends ma{_correctButton(o,c){return c===0&&o.ctrlKey||c===2}_move(o,c){const p=-.5*(c.y-o.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(o){o.preventDefault()}}class Vc{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.Point(0,0)}touchstart(o,c,p){return this._calculateTransform(o,c,p)}touchmove(o,c,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!s.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,c,p)}}touchend(o,c,p){this._calculateTransform(o,c,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,c,p){p.length>0&&(this._active=!0);const _=Uc(p,c),v=new s.Point(0,0),T=new s.Point(0,0);let S=0;for(const D in _){const k=_[D],B=this._touches[D];B&&(v._add(k),T._add(k.sub(B)),S++,_[D]=k)}if(this._touches=_,S<this._minTouches||!T.mag())return;const M=T.div(S);return this._sum._add(M),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(S),panDelta:M}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=G("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Cl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,c,p){return{}}touchstart(o,c,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([c[0],c[1]]))}touchmove(o,c,p){const _=this._firstTwoTouches;if(!_)return;o.preventDefault();const[v,T]=_,S=Al(p,c,v),M=Al(p,c,T);if(!S||!M)return;const D=this._aroundCenter?null:S.add(M).div(2);return this._move([S,M],D,o)}touchend(o,c,p){if(!this._firstTwoTouches)return;const[_,v]=this._firstTwoTouches,T=Al(p,c,_),S=Al(p,c,v);T&&S||(this._active&&oe(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Al(h,o,c){for(let p=0;p<h.length;p++)if(h[p].identifier===c)return o[p]}function Uh(h,o){return Math.log(h/o)/Math.LN2}class vp extends Cl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,c){const p=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Uh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Uh(this._distance,p),pinchAround:c}}}function Vh(h,o){return 180*h.angleWith(o)/Math.PI}class xp extends Cl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,c){const p=this._vector;if(this._vector=o[0].sub(o[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Vh(this._vector,p),pinchAround:c}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const c=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const _=Vh(o,p);return Math.abs(_)<c}}function es(h){return Math.abs(h.y)>Math.abs(h.x)}class wp extends Cl{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,es(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,c,p){const _=this._lastPoints;if(!_)return;const v=o[0].sub(_[0]),T=o[1].sub(_[1]);return this._map._cooperativeGestures&&!s.isFullscreen()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(v,T,p.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(v.y+T.y)/2*-.5})}gestureBeginsVertically(o,c,p){if(this._valid!==void 0)return this._valid;const _=o.mag()>=2,v=c.mag()>=2;if(!_&&!v)return;if(!_||!v)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const T=o.y>0==c.y>0;return es(o)&&es(c)&&T}}const bp={panStep:100,bearingStep:15,pitchStep:10};class T_{constructor(){const o=bp;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let c=0,p=0,_=0,v=0,T=0;switch(o.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:o.shiftKey?p=-1:(o.preventDefault(),v=-1);break;case 39:o.shiftKey?p=1:(o.preventDefault(),v=1);break;case 38:o.shiftKey?_=1:(o.preventDefault(),T=-1);break;case 40:o.shiftKey?_=-1:(o.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:S=>{const M=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Tp,zoom:c?Math.round(M)+c*(o.shiftKey?2:1):M,bearing:S.getBearing()+p*this._bearingStep,pitch:S.getPitch()+_*this._pitchStep,offset:[-v*this._panStep,-T*this._panStep],center:S.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Tp(h){return h*(2-h)}const Nh=4.000244140625;class Ep{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||s.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=o.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const p=s.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,c!==0&&c%Nh==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(_*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),o.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=o,this._delta-=c,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Be(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>Nh?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&D!==0&&(D=1/D);const k=c(),B=Math.pow(2,k),$=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom($*D))),this._type==="wheel"&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:c(),_=this._startZoom,v=this._easing;let T,S=!1;if(this._type==="wheel"&&_&&v){const M=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),D=v(M);T=s.number(_,p,D),M<1?this._frameId||(this._frameId=!0):S=!0}else T=p,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:T-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let c=s.ease;if(this._prevEase){const p=this._prevEase,_=(s.exported.now()-p.start)/p.duration,v=p.easing(_+.01)-p.easing(_),T=.27/Math.sqrt(v*v+1e-4)*.01,S=Math.sqrt(.0729-T*T);c=s.bezier(T,S,.25,1)}return this._prevEase={start:s.exported.now(),duration:o,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=G("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Sp{constructor(o,c){this._clickZoom=o,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Bi{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,c){return o.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(o.shiftKey?-1:1),around:p.unproject(c)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class E_{constructor(){this._tap=new Rh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,c,p){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=c[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(o,c,p))}touchmove(o,c,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=c[0],v=_.y-this._swipePoint.y;return this._swipePoint=_,o.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(o,c,p)}touchend(o,c,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(o,c,p)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cp{constructor(o,c,p){this._el=o,this._mousePan=c,this._touchPan=p}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class S_{constructor(o,c,p){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=c,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class C_{constructor(o,c,p,_){this._el=o,this._touchZoom=c,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Tr=h=>h.zoom||h.drag||h.pitch||h.rotate;class Ap extends s.Event{}class A_{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,c){const p=s.sub([],c,o);this.radius=s.length(p[2]<0?s.div([],p,this.constants):[p[0],p[1],0])}projectRay(o){s.div(o,o,this.constants),s.normalize(o,o),s.mul$1(o,o,this.constants);const c=s.scale$2([],o,this.radius);if(c[2]>0){const p=s.scale$2([],[0,0,1],s.dot(c,[0,0,1])),_=s.scale$2([],s.normalize([],[c[0],c[1],0]),this.radius),v=s.add([],c,s.scale$2([],s.sub([],s.add([],_,p),c),2));c[0]=v[0],c[1]=v[1]}return c}}function Ur(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class to{constructor(o,c){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new gp(o),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new A_,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),s.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[_,v,T]of this._listeners)_.addEventListener(v,_===s.window.document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[o,c,p]of this._listeners)o.removeEventListener(c,o===s.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(o){const c=this._map,p=c.getCanvasContainer();this._add("mapEvent",new Lh(c,o));const _=c.boxZoom=new _p(c,o);this._add("boxZoom",_);const v=new b_,T=new Bi;c.doubleClickZoom=new Sp(T,v),this._add("tapZoom",v),this._add("clickZoom",T);const S=new E_;this._add("tapDragZoom",S);const M=c.touchPitch=new wp(c);this._add("touchPitch",M);const D=new Fh(o),k=new Oh(o);c.dragRotate=new S_(o,D,k),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const B=new Bh(o),$=new Vc(c,o);c.dragPan=new Cp(p,B,$),this._add("mousePan",B),this._add("touchPan",$,["touchZoom","touchRotate"]);const W=new xp,K=new vp;c.touchZoomRotate=new C_(p,K,W,S),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Oc(c));const H=c.scrollZoom=new Ep(c,this);this._add("scrollZoom",H,["mousePan"]);const Y=c.keyboard=new T_;this._add("keyboard",Y);for(const F of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[F]&&c[F].enable(o[F])}_add(o,c,p){this._handlers.push({handlerName:o,handler:c,allowed:p}),this._handlersById[o]=c}stop(o){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Tr(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,c,p){for(const _ in o)if(_!==p&&(!c||c.indexOf(_)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const c=[];for(const p of o)this._el.contains(p.target)&&c.push(p);return c}handleEvent(o,c){this._updatingCamera=!0;const p=o.type==="renderFrame",_=p?void 0:o,v={needsRenderFrame:!1},T={},S={},M=o.touches?this._getMapTouches(o.touches):void 0,D=M?at(this._el,M):p?void 0:Be(this._el,o);for(const{handlerName:$,handler:W,allowed:K}of this._handlers){if(!W.isEnabled())continue;let H;this._blockedByActive(S,K,$)?W.reset():W[c||o.type]&&(H=W[c||o.type](o,D,M),this.mergeHandlerResult(v,T,H,$,_),H&&H.needsRenderFrame&&this._triggerRenderFrame()),(H||W.isActive())&&(S[$]=W)}const k={};for(const $ in this._previousActiveHandlers)S[$]||(k[$]=_);this._previousActiveHandlers=S,(Object.keys(k).length||Ur(v))&&(this._changes.push([v,T,k]),this._triggerRenderFrame()),(Object.keys(S).length||Ur(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=v;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(o,c,p,_,v){if(!p)return;s.extend(o,p);const T={handlerName:_,originalEvent:p.originalEvent||v};p.zoomDelta!==void 0&&(c.zoom=T),p.panDelta!==void 0&&(c.drag=T),p.pitchDelta!==void 0&&(c.pitch=T),p.bearingDelta!==void 0&&(c.rotate=T)}_applyChanges(){const o={},c={},p={};for(const[_,v,T]of this._changes)_.panDelta&&(o.panDelta=(o.panDelta||new s.Point(0,0))._add(_.panDelta)),_.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(o.around=_.around),_.aroundCoord!==void 0&&(o.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(o.pinchAround=_.pinchAround),_.noInertia&&(o.noInertia=_.noInertia),s.extend(c,v),s.extend(p,T);this._updateMapTransform(o,c,p),this._changes=[]}_updateMapTransform(o,c,p){const _=this._map,v=_.transform,T=q=>[q.x,q.y,q.z];if((q=>{const ne=this._eventsInProgress.drag;return ne&&!this._handlersById[ne.handlerName].isActive()})()&&!Ur(o)){const q=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",q!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&_._stop(!0),!Ur(o))return void this._fireEvents(c,p,!0);let{panDelta:S,zoomDelta:M,bearingDelta:D,pitchDelta:k,around:B,aroundCoord:$,pinchAround:W}=o;v._isCameraConstrained&&(M>0&&(M=0),v._isCameraConstrained=!1),W!==void 0&&(B=W),(M||(q=>c[q]&&!this._eventsInProgress[q])("drag"))&&B&&(this._dragOrigin=T(v.pointCoordinate3D(B)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",_._stop(!0),B=B||_.transform.centerPoint,D&&(v.bearing+=D),k&&(v.pitch+=k),v._updateCameraState();const K=[0,0,0];if(S)if(v.projection.name==="mercator"){const q=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(B).dir),ne=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(B.sub(S)).dir);K[0]=ne[0]-q[0],K[1]=ne[1]-q[1]}else{const q=v.pointCoordinate(B);if(v.projection.name==="globe"){S=S.rotate(-v.angle);const ne=v._pixelsPerMercatorPixel/v.worldSize;K[0]=-S.x*s.mercatorScale(s.latFromMercatorY(q.y))*ne,K[1]=-S.y*s.mercatorScale(v.center.lat)*ne}else{const ne=v.pointCoordinate(B.sub(S));q&&ne&&(K[0]=ne.x-q.x,K[1]=ne.y-q.y)}}const H=v.zoom,Y=[0,0,0];if(M){const q=T($||v.pointCoordinate3D(B)),ne={dir:s.normalize([],s.sub([],q,v._camera.position))};if(ne.dir[2]<0){const ie=v.zoomDeltaToMovement(q,M);s.scale$2(Y,ne.dir,ie)}}const F=s.add(K,K,Y);v._translateCameraConstrained(F),M&&Math.abs(v.zoom-H)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(c,p,!0)}_fireEvents(o,c,p){const _=Tr(this._eventsInProgress),v=Tr(o),T={};for(const k in o){const{originalEvent:B}=o[k];this._eventsInProgress[k]||(T[`${k}start`]=B),this._eventsInProgress[k]=o[k]}!_&&v&&this._fireEvent("movestart",v.originalEvent);for(const k in T)this._fireEvent(k,T[k]);v&&this._fireEvent("move",v.originalEvent);for(const k in o){const{originalEvent:B}=o[k];this._fireEvent(k,B)}const S={};let M;for(const k in this._eventsInProgress){const{handlerName:B,originalEvent:$}=this._eventsInProgress[k];this._handlersById[B].isActive()||(delete this._eventsInProgress[k],M=c[B]||$,S[`${k}end`]=M)}for(const k in S)this._fireEvent(k,S[k]);const D=Tr(this._eventsInProgress);if(p&&(_||v)&&!D){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;k?(B(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:M})):(this._map.fire(new s.Event("moveend",{originalEvent:M})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,c){this._map.fire(new s.Event(o,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new Ap("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const As="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Nc extends s.Evented{constructor(o,c){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,c){return this.jumpTo({center:o},c)}panBy(o,c,p){return o=s.Point.convert(o).mult(-1),this.panTo(this.transform.center,s.extend({offset:o},c),p)}panTo(o,c,p){return this.easeTo(s.extend({center:o},c),p)}getZoom(){return this.transform.zoom}setZoom(o,c){return this.jumpTo({zoom:o},c),this}zoomTo(o,c,p){return this.easeTo(s.extend({zoom:o},c),p)}zoomIn(o,c){return this.zoomTo(this.getZoom()+1,o,c),this}zoomOut(o,c){return this.zoomTo(this.getZoom()-1,o,c),this}getBearing(){return this.transform.bearing}setBearing(o,c){return this.jumpTo({bearing:o},c),this}getPadding(){return this.transform.padding}setPadding(o,c){return this.jumpTo({padding:o},c),this}rotateTo(o,c,p){return this.easeTo(s.extend({bearing:o},c),p)}resetNorth(o,c){return this.rotateTo(0,s.extend({duration:1e3},o),c),this}resetNorthPitch(o,c){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},o),c),this}snapToNorth(o,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,c):this}getPitch(){return this.transform.pitch}setPitch(o,c){return this.jumpTo({pitch:o},c),this}cameraForBounds(o,c){o=s.LngLatBounds.convert(o);const p=c&&c.bearing||0,_=c&&c.pitch||0,v=o.getNorthWest(),T=o.getSouthEast();return this._cameraForBounds(this.transform,v,T,p,_,c)}_extendCameraOptions(o){const c={top:0,bottom:0,right:0,left:0};if(typeof(o=s.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=="number"){const p=o.padding;o.padding={top:p,bottom:p,right:p,left:p}}return o.padding=s.extend(c,o.padding),o}_minimumAABBFrustumDistance(o,c){const p=c.max[0]-c.min[0],_=c.max[1]-c.min[1];return p/_>o.aspect?p/(2*Math.tan(.5*o.fovX)*o.aspect):_/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,c,p,_,v,T){const S=o.clone(),M=this._extendCameraOptions(T);S.bearing=_,S.pitch=v;const D=s.LngLat.convert(c),k=s.LngLat.convert(p),B=.5*(D.lat+k.lat),$=.5*(D.lng+k.lng),W=s.latLngToECEF(B,$),K=s.normalize([],W),H=s.normalize([],s.cross([],K,[0,1,0])),Y=s.cross([],H,K),F=[H[0],H[1],H[2],0,Y[0],Y[1],Y[2],0,K[0],K[1],K[2],0,0,0,0,1],q=[W,s.latLngToECEF(D.lat,D.lng),s.latLngToECEF(k.lat,D.lng),s.latLngToECEF(k.lat,k.lng),s.latLngToECEF(D.lat,k.lng),s.latLngToECEF(B,D.lng),s.latLngToECEF(B,k.lng),s.latLngToECEF(D.lat,$),s.latLngToECEF(k.lat,$)];let ne=s.Aabb.fromPoints(q.map(Ze=>[s.dot(H,Ze),s.dot(Y,Ze),s.dot(K,Ze)]));const ie=s.transformMat4([],ne.center,F);s.squaredLength(ie)===0&&s.set(ie,0,0,1),s.normalize(ie,ie),s.scale$2(ie,ie,s.GLOBE_RADIUS),S.center=s.ecefToLatLng(ie);const me=S.getWorldToCameraMatrix(),ye=s.invert(new Float64Array(16),me);ne=s.Aabb.applyTransform(ne,s.multiply([],me,F)),s.transformMat4(ie,ie,me);const ge=.5*(ne.max[2]-ne.min[2]),be=this._minimumAABBFrustumDistance(S,ne),xe=s.scale$2([],[0,0,1],ge),Me=s.add(xe,ie,xe),Qe=be+(S.pitch===0?0:s.distance(ie,Me)),Ee=S.globeCenterInViewSpace,je=s.sub([],ie,[Ee[0],Ee[1],Ee[2]]);s.normalize(je,je),s.scale$2(je,je,Qe);const Ie=s.add([],ie,je);s.transformMat4(Ie,Ie,ye);const Ke=s.earthRadius/s.GLOBE_RADIUS,Ae=s.length(Ie),Ne=s.mercatorZfromAltitude(Math.max(Ae*Ke-s.earthRadius,Number.EPSILON),0),tt=Math.min(S.zoomFromMercatorZAdjusted(Ne),M.maxZoom);return tt>.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(S.setProjection({name:"mercator"}),S.zoom=tt,this._cameraForBounds(S,c,p,_,v,T)):{center:S.center,zoom:tt,bearing:_,pitch:v}}queryTerrainElevation(o,c){const p=this.transform.elevation;return p?(c=s.extend({},{exaggerated:!0},c),p.getAtPoint(s.MercatorCoordinate.fromLngLat(o),null,c.exaggerated)):null}_cameraForBounds(o,c,p,_,v,T){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,c,p,_,v,T);const S=o.clone(),M=this._extendCameraOptions(T),D=S.padding;S.bearing=_,S.pitch=v;const k=s.LngLat.convert(c),B=s.LngLat.convert(p),$=new s.LngLat(k.lng,B.lat),W=new s.LngLat(B.lng,k.lat),K=S.project(k),H=S.project(B),Y=this.queryTerrainElevation(k),F=this.queryTerrainElevation(B),q=this.queryTerrainElevation($),ne=this.queryTerrainElevation(W),ie=[[K.x,K.y,Math.min(Y||0,F||0,q||0,ne||0)],[H.x,H.y,Math.max(Y||0,F||0,q||0,ne||0)]];let me=s.Aabb.fromPoints(ie);const ye=S.getWorldToCameraMatrix(),ge=s.invert(new Float64Array(16),ye);me=s.Aabb.applyTransform(me,ye);const be=s.sub([],me.max,me.min),xe=D.left||0,Me=D.right||0,Qe=D.bottom||0,Ee=D.top||0,{left:je,right:Ie,top:Ke,bottom:Ae}=M.padding,Ne=.5*(xe+Me),tt=.5*(Ee+Qe),Ze=Math.min(S.scaleZoom(S.scale*Math.min((S.width-(xe+Me+je+Ie))/be[0],(S.height-(Qe+Ee+Ae+Ke))/be[1])),M.maxZoom),it=S.scale/S.zoomScale(Ze);me=new s.Aabb([me.min[0]-(je+Ne)*it,me.min[1]-(Ae+tt)*it,me.min[2]],[me.max[0]+(Ie+Ne)*it,me.max[1]+(Ke+tt)*it,me.max[2]]);const bt=.5*be[2],zt=this._minimumAABBFrustumDistance(S,me),_t=[0,0,1,0];s.transformMat4$1(_t,_t,ye),s.normalize$2(_t,_t);const At=s.scale$2([],_t,zt+bt),Ht=s.add([],me.center,At),qt=(typeof M.offset.x=="number"&&typeof M.offset.y=="number"?new s.Point(M.offset.x,M.offset.y):s.Point.convert(M.offset)).rotate(-s.degToRad(_));me.center[0]-=qt.x*it,me.center[1]+=qt.y*it,s.transformMat4(me.center,me.center,ge),s.transformMat4(Ht,Ht,ge);const xt=[me.center[0],me.center[1],Ht[2]*S.pixelsPerMeter];s.scale$2(xt,xt,1/S.worldSize);const hn=s.lngFromMercatorX(xt[0]),_n=s.latFromMercatorY(xt[1]),yn=Math.min(S._zoomFromMercatorZ(xt[2]),M.maxZoom),vn=new s.LngLat(hn,_n);return S.mercatorFromTransition&&yn<.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(S.setProjection({name:"globe"}),S.zoom=yn,this._cameraForBounds(S,c,p,_,v,T)):{center:vn,zoom:yn,bearing:_,pitch:v}}fitBounds(o,c,p){const _=this.cameraForBounds(o,c);return this._fitInternal(_,c,p)}fitScreenCoordinates(o,c,p,_,v){const T=s.Point.convert(o),S=s.Point.convert(c),M=new s.Point(Math.min(T.x,S.x),Math.min(T.y,S.y)),D=new s.Point(Math.max(T.x,S.x),Math.max(T.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,S))return this;const k=this.transform.pointLocation3D(M),B=this.transform.pointLocation3D(D),$=this.transform.pointLocation3D(new s.Point(M.x,D.y)),W=this.transform.pointLocation3D(new s.Point(D.x,M.y)),K=[Math.min(k.lng,B.lng,$.lng,W.lng),Math.min(k.lat,B.lat,$.lat,W.lat)],H=[Math.max(k.lng,B.lng,$.lng,W.lng),Math.max(k.lat,B.lat,$.lat,W.lat)],Y=_&&_.pitch?_.pitch:this.getPitch(),F=this._cameraForBounds(this.transform,K,H,p,Y,_);return this._fitInternal(F,_,v)}_fitInternal(o,c,p){return o?(delete(c=s.extend(o,c)).padding,c.linear?this.easeTo(c,p):this.flyTo(c,p)):this}jumpTo(o,c){this.stop();const p=o.preloadOnly?this.transform.clone():this.transform;let _=!1,v=!1,T=!1;return"zoom"in o&&p.zoom!==+o.zoom&&(_=!0,p.zoom=+o.zoom),o.center!==void 0&&(p.center=s.LngLat.convert(o.center)),"bearing"in o&&p.bearing!==+o.bearing&&(v=!0,p.bearing=+o.bearing),"pitch"in o&&p.pitch!==+o.pitch&&(T=!0,p.pitch=+o.pitch),o.padding==null||p.isPaddingEqual(o.padding)||(p.padding=o.padding),o.preloadOnly?(this._preloadTiles(p),this):(this.fire(new s.Event("movestart",c)).fire(new s.Event("move",c)),_&&this.fire(new s.Event("zoomstart",c)).fire(new s.Event("zoom",c)).fire(new s.Event("zoomend",c)),v&&this.fire(new s.Event("rotatestart",c)).fire(new s.Event("rotate",c)).fire(new s.Event("rotateend",c)),T&&this.fire(new s.Event("pitchstart",c)).fire(new s.Event("pitch",c)).fire(new s.Event("pitchend",c)),this.fire(new s.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(As),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,c){const p=this.transform;if(!p.projection.supportsFreeCamera)return s.warnOnce(As),this;this.stop();const _=p.zoom,v=p.pitch,T=p.bearing;p.setFreeCameraOptions(o);const S=_!==p.zoom,M=v!==p.pitch,D=T!==p.bearing;return this.fire(new s.Event("movestart",c)).fire(new s.Event("move",c)),S&&this.fire(new s.Event("zoomstart",c)).fire(new s.Event("zoom",c)).fire(new s.Event("zoomend",c)),D&&this.fire(new s.Event("rotatestart",c)).fire(new s.Event("rotate",c)).fire(new s.Event("rotateend",c)),M&&this.fire(new s.Event("pitchstart",c)).fire(new s.Event("pitch",c)).fire(new s.Event("pitchend",c)),this.fire(new s.Event("moveend",c)),this}easeTo(o,c){this._stop(!1,o.easeId),((o=s.extend({offset:[0,0],duration:500,easing:s.ease},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);const p=this.transform,_=this.getZoom(),v=this.getBearing(),T=this.getPitch(),S=this.getPadding(),M="zoom"in o?+o.zoom:_,D="bearing"in o?this._normalizeBearing(o.bearing,v):v,k="pitch"in o?+o.pitch:T,B="padding"in o?o.padding:p.padding,$=s.Point.convert(o.offset);let W,K,H;if(p.projection.name==="globe"){const xe=s.MercatorCoordinate.fromLngLat(p.center),Me=$.rotate(-p.angle);xe.x+=Me.x/p.worldSize,xe.y+=Me.y/p.worldSize;const Qe=xe.toLngLat(),Ee=s.LngLat.convert(o.center||Qe);this._normalizeCenter(Ee),W=p.centerPoint.add(Me),K=new s.Point(xe.x,xe.y).mult(p.worldSize),H=new s.Point(s.mercatorXfromLng(Ee.lng),s.mercatorYfromLat(Ee.lat)).mult(p.worldSize).sub(K)}else{W=p.centerPoint.add($);const xe=p.pointLocation(W),Me=s.LngLat.convert(o.center||xe);this._normalizeCenter(Me),K=p.project(xe),H=p.project(Me).sub(K)}const Y=p.zoomScale(M-_);let F,q;o.around&&(F=s.LngLat.convert(o.around),q=p.locationPoint(F));const ne=this._zooming||M!==_,ie=this._rotating||v!==D,me=this._pitching||k!==T,ye=!p.isPaddingEqual(B),ge=xe=>Me=>{if(ne&&(xe.zoom=s.number(_,M,Me)),ie&&(xe.bearing=s.number(v,D,Me)),me&&(xe.pitch=s.number(T,k,Me)),ye&&(xe.interpolatePadding(S,B,Me),W=xe.centerPoint.add($)),F)xe.setLocationAtPoint(F,q);else{const Qe=xe.zoomScale(xe.zoom-_),Ee=M>_?Math.min(2,Y):Math.max(.5,Y),je=Math.pow(Ee,1-Me),Ie=xe.unproject(K.add(H.mult(Me*je)).mult(Qe));xe.setLocationAtPoint(xe.renderWorldCopies?Ie.wrap():Ie,W)}return o.preloadOnly||this._fireMoveEvents(c),xe};if(o.preloadOnly){const xe=this._emulate(ge,o.duration,p);return this._preloadTiles(xe),this}const be={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ne,this._rotating=ie,this._pitching=me,this._padding=ye,this._easeId=o.easeId,this._prepareEase(c,o.noMoveStart,be),this._ease(ge(p),xe=>{p.recenterOnTerrain(),this._afterEase(c,xe)},o),this}_prepareEase(o,c,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||p.moving||this.fire(new s.Event("movestart",o)),this._zooming&&!p.zooming&&this.fire(new s.Event("zoomstart",o)),this._rotating&&!p.rotating&&this.fire(new s.Event("rotatestart",o)),this._pitching&&!p.pitching&&this.fire(new s.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new s.Event("move",o)),this._zooming&&this.fire(new s.Event("zoom",o)),this._rotating&&this.fire(new s.Event("rotate",o)),this._pitching&&this.fire(new s.Event("pitch",o))}_afterEase(o,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,_=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new s.Event("zoomend",o)),_&&this.fire(new s.Event("rotateend",o)),v&&this.fire(new s.Event("pitchend",o)),this.fire(new s.Event("moveend",o))}flyTo(o,c){if(this._prefersReducedMotion(o)){const Ze=s.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ze,c)}this.stop(),o=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},o);const p=this.transform,_=this.getZoom(),v=this.getBearing(),T=this.getPitch(),S=this.getPadding(),M="zoom"in o?s.clamp(+o.zoom,p.minZoom,p.maxZoom):_,D="bearing"in o?this._normalizeBearing(o.bearing,v):v,k="pitch"in o?+o.pitch:T,B="padding"in o?o.padding:p.padding,$=p.zoomScale(M-_),W=s.Point.convert(o.offset);let K=p.centerPoint.add(W);const H=p.pointLocation(K),Y=s.LngLat.convert(o.center||H);this._normalizeCenter(Y);const F=p.project(H),q=p.project(Y).sub(F);let ne=o.curve;const ie=Math.max(p.width,p.height),me=ie/$,ye=q.mag();if("minZoom"in o){const Ze=s.clamp(Math.min(o.minZoom,_,M),p.minZoom,p.maxZoom),it=ie/p.zoomScale(Ze-_);ne=Math.sqrt(it/ye*2)}const ge=ne*ne;function be(Ze){const it=(me*me-ie*ie+(Ze?-1:1)*ge*ge*ye*ye)/(2*(Ze?me:ie)*ge*ye);return Math.log(Math.sqrt(it*it+1)-it)}function xe(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function Me(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}const Qe=be(0);let Ee=function(Ze){return Me(Qe)/Me(Qe+ne*Ze)},je=function(Ze){return ie*((Me(Qe)*(xe(it=Qe+ne*Ze)/Me(it))-xe(Qe))/ge)/ye;var it},Ie=(be(1)-Qe)/ne;if(Math.abs(ye)<1e-6||!isFinite(Ie)){if(Math.abs(ie-me)<1e-6)return this.easeTo(o,c);const Ze=me<ie?-1:1;Ie=Math.abs(Math.log(me/ie))/ne,je=function(){return 0},Ee=function(it){return Math.exp(Ze*ne*it)}}o.duration="duration"in o?+o.duration:1e3*Ie/("screenSpeed"in o?+o.screenSpeed/ne:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const Ke=v!==D,Ae=k!==T,Ne=!p.isPaddingEqual(B),tt=Ze=>it=>{const bt=it*Ie,zt=1/Ee(bt);Ze.zoom=it===1?M:_+Ze.scaleZoom(zt),Ke&&(Ze.bearing=s.number(v,D,it)),Ae&&(Ze.pitch=s.number(T,k,it)),Ne&&(Ze.interpolatePadding(S,B,it),K=Ze.centerPoint.add(W));const _t=it===1?Y:Ze.unproject(F.add(q.mult(je(bt))).mult(zt));return Ze.setLocationAtPoint(Ze.renderWorldCopies?_t.wrap():_t,K),Ze._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(c),Ze};if(o.preloadOnly){const Ze=this._emulate(tt,o.duration,p);return this._preloadTiles(Ze),this}return this._zooming=!0,this._rotating=Ke,this._pitching=Ae,this._padding=Ne,this._prepareEase(c,!1),this._ease(tt(p),()=>this._afterEase(c),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,c)}if(!o){const p=this.handlers;p&&p.stop(!1)}return this}_ease(o,c,p){p.animate===!1||p.duration===0?(o(1),c()):(this._easeStart=s.exported.now(),this._easeOptions=p,this._onEaseFrame=o,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,c){o=s.wrap(o,-180,180);const p=Math.abs(o-c);return Math.abs(o-360-c)<p&&(o-=360),Math.abs(o+360-c)<p&&(o+=360),o}_normalizeCenter(o){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const p=o.lng-c.center.lng;o.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&s.exported.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,c,p){const _=Math.ceil(15*c/1e3),v=[],T=o(p.clone());for(let S=0;S<=_;S++){const M=T(S/_);v.push(M.clone())}return v}}class mt{constructor(o={}){this.options=o,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const c=this.options&&this.options.compact;return this._map=o,this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=G("button","mapboxgl-ctrl-attrib-button",this._container),G("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=G("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,c){const p=this._map._getUIString(`AttributionControl.${c}`);o.setAttribute("aria-label",p),o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(o){const p=c.reduce((_,v,T)=>(v.value&&(_+=`${v.key}=${v.value}${T<c.length-1?"&":""}`),_),"?");o.href=`${s.config.FEEDBACK_URL}/${p}#${wl(this._map,!0)}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const c=this._map.style._sourceCaches;for(const _ in c){const v=c[_];if(v.used){const T=v.getSource();T.attribution&&o.indexOf(T.attribution)<0&&o.push(T.attribution)}}o.sort((_,v)=>_.length-v.length),o=o.filter((_,v)=>{for(let T=v+1;T<o.length;T++)if(o[T].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const p=o.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,o.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class jh{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=G("div","mapboxgl-ctrl");const c=G("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const c in o){const p=o[c].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const c=o[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Gh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const c=++this._id;return this._queue.push({callback:o,id:c,cancelled:!1}),c}remove(o){const c=this._currentlyRunning,p=c?this._queue.concat(c):this._queue;for(const _ of p)if(_.id===o)return void(_.cancelled=!0)}run(o=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const p of c)if(!p.cancelled&&(p.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ga(h,o,c){if(h=new s.LngLat(h.lng,h.lat),o){const p=new s.LngLat(h.lng-360,h.lat),_=new s.LngLat(h.lng+360,h.lat),v=360*Math.ceil(Math.abs(h.lng-c.center.lng)/360),T=c.locationPoint(h).distSqr(o),S=o.x<0||o.y<0||o.x>c.width||o.y>c.height;c.locationPoint(p).distSqr(o)<T&&(S||Math.abs(p.lng-c.center.lng)<v)?h=p:c.locationPoint(_).distSqr(o)<T&&(S||Math.abs(_.lng-c.center.lng)<v)&&(h=_)}for(;Math.abs(h.lng-c.center.lng)>180;){const p=c.locationPoint(h);if(p.x>=0&&p.y>=0&&p.x<=c.width&&p.y<=c.height)break;h.lng>c.center.lng?h.lng-=360:h.lng+=360}return h}const Ms={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class dt extends s.Evented{constructor(o,c){if(super(),(o instanceof s.window.HTMLElement||c)&&(o=s.extend({element:o},c)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=o&&o.occludedOpacity||.2,o&&o.element)this._element=o.element,this._offset=s.Point.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=G("div");const _=41,v=27,T=re("svg",{display:"block",height:_*this._scale+"px",width:v*this._scale+"px",viewBox:`0 0 ${v} ${_}`},this._element),S=re("radialGradient",{id:"shadowGradient"},re("defs",{},T));re("stop",{offset:"10%","stop-opacity":.4},S),re("stop",{offset:"100%","stop-opacity":.05},S),re("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),re("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),re("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),re("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=s.Point.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const p=this._element.classList;for(const _ in Ms)p.remove(`mapboxgl-marker-anchor-${_}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=s.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const c=o.code,p=o.charCode||o.keyCode;c!=="Space"&&c!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(o){const c=o.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map,c=this._pos;if(!o||!c)return!1;const p=o.unproject(c),_=o.getFreeCameraOptions();if(!_.position)return!1;const v=_.position.toLngLat();return v.distanceTo(p)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const c=this._pos;if(!c||c.x<0||c.x>o.transform.width||c.y<0||c.y>o.transform.height)return void this._clearFadeTimer();const p=o.unproject(c);let _;o._showingGlobe()&&s.isLngLatBehindGlobe(o.transform,this._lngLat)?_=0:(_=1-o._queryFogOpacity(p),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${Ms[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const o=this._pos,c=this._map,p=this.getPitchAlignment();if(!c||!o||p!=="map")return"";if(!c._showingGlobe()){const M=c.getPitch();return M?`rotateX(${M}deg)`:""}const _=s.radToDeg(s.globeTiltAtLngLat(c.transform,this._lngLat)),v=o.sub(s.globeCenterToScreenPoint(c.transform)),T=Math.abs(v.x)+Math.abs(v.y);if(T===0)return"";const S=_/T;return`rotateX(${-v.y*S}deg) rotateY(${v.x*S}deg)`}_calculateZTransform(){const o=this._pos,c=this._map;if(!c||!o)return"";let p=0;const _=this.getRotationAlignment();if(_==="map")if(c._showingGlobe()){const v=c.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),T=c.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);p=s.radToDeg(Math.atan2(T.y,T.x))-90}else p=-c.getBearing();else if(_==="horizon"){const v=s.smoothstep(4,6,c.getZoom()),T=s.globeCenterToScreenPoint(c.transform);T.y+=v*c.transform.height;const S=o.sub(T),M=s.radToDeg(Math.atan2(S.y,S.x));p=(M>90?M-270:M+90)*(1-v)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(o){s.window.cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=ga(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),o===!0?this._updateFrameId=s.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=s.Point.convert(o),this._update(),this}_onMove(o){const c=this._map;if(!c)return;const p=this._pointerdownPos,_=this._positionDelta;if(p&&_){if(!this._isDragging){const v=this._clickTolerance||c._clickTolerance;if(o.point.dist(p)<v)return;this._isDragging=!0}this._pos=o.point.sub(_),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(o){const c=this._map,p=this._pos;c&&p&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(p),this._pointerdownPos=o.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const c=this._map;return c&&(o?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const $h={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},M_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Mp(h=new s.Point(0,0),o="bottom"){if(typeof h=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(o){case"top":return new s.Point(0,h);case"top-left":return new s.Point(c,c);case"top-right":return new s.Point(-c,c);case"bottom":return new s.Point(0,-h);case"bottom-left":return new s.Point(c,-c);case"bottom-right":return new s.Point(-c,-c);case"left":return new s.Point(h,0);case"right":return new s.Point(-h,0)}return new s.Point(0,0)}return h instanceof s.Point||Array.isArray(h)?s.Point.convert(h):s.Point.convert(h[o]||[0,0])}class Zh{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const c=s.easeCubicInOut((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,c,p){this._start=this.getValue(c),this._end=o,this._startTime=c,this._endTime=c+p}}const Pp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Ip={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},P_={showCompass:!0,showZoom:!0,visualizePitch:!1};class I_{constructor(o,c,p=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Fh({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,p&&(this.mousePitch=new Oh({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(o,c){this.mouseRotate.mousedown(o,c),this.mousePitch&&this.mousePitch.mousedown(o,c),ae()}move(o,c){const p=this.map,_=this.mouseRotate.mousemoveWindow(o,c),v=_&&_.bearingDelta;if(v&&p.setBearing(p.getBearing()+v),this.mousePitch){const T=this.mousePitch.mousemoveWindow(o,c),S=T&&T.pitchDelta;S&&p.setPitch(p.getPitch()+S)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){J(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(s.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),Be(this.element,o)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,Be(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=at(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=at(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const qh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Wh={maxWidth:100,unit:"metric"},Xh={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},_a={version:s.version,supported:z,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends Nc{constructor(h){if(s.LivePerformanceUtils.mark(s.PerformanceMarkers.create),(h=s.extend({},Ip,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(h.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new da(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._useWebGL2=h.useWebGL2,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._optimizeForTerrain=h.optimizeForTerrain,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new Gh,this._domRenderTaskQueue=new Gh,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.uniqueId(),this._locale=s.extend({},Pp,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Zh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.RequestManager(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,typeof h.container=="string"){if(this._container=s.window.document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),s.window!==void 0&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new to(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this._hash=h.hash&&new zh(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,s.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),h.attributionControl&&this.addControl(new mt({customAttribution:h.customAttribution})),this._logoControl=new jh,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new s.Event(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new s.Event(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(h,o){if(o===void 0&&(o=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=h.onAdd(this);this._controls.push(h);const p=this._controlPositions[o];return o.indexOf("bottom")!==-1?p.insertBefore(c,p.firstChild):p.appendChild(c),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(h);return o>-1&&this._controls.splice(o,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new s.Event("movestart",h)).fire(new s.Event("move",h)),this.fire(new s.Event("resize",h)),o&&this.fire(new s.Event("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(s.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?s.window.navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(o=>o==="auto"?s.window.navigator.language:o):h}setLanguage(h){const o=this._parseLanguage(h);if(!this.style||o===this._language)return this;this._language=o,this.style._reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,o=h.projection.name;let c;o==="globe"&&h.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?(h.setMercatorFromTransition(),c=!0):o==="mercator"&&h.zoom<s.GLOBE_ZOOM_THRESHOLD_MAX&&(h.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,o){return this._updateProjection(h||o||{name:"mercator"})}_updateProjection(h){let o;if(o=h.name==="globe"&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),o){this.painter.clearBackgroundTiles();for(const c in this.style._sourceCaches)this.style._sourceCaches[c].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(h){return this.transform.locationPoint3D(s.LngLat.convert(h))}unproject(h){return this.transform.pointLocation3D(s.Point.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,o,c){if(h==="mouseenter"||h==="mouseover"){let p=!1;const _=T=>{const S=o.filter(D=>this.getLayer(D)),M=S.length?this.queryRenderedFeatures(T.point,{layers:S}):[];M.length?p||(p=!0,c.call(this,new wi(h,this,T.originalEvent,{features:M}))):p=!1},v=()=>{p=!1};return{layers:new Set(o),listener:c,delegates:{mousemove:_,mouseout:v}}}if(h==="mouseleave"||h==="mouseout"){let p=!1;const _=T=>{const S=o.filter(M=>this.getLayer(M));(S.length?this.queryRenderedFeatures(T.point,{layers:S}):[]).length?p=!0:p&&(p=!1,c.call(this,new wi(h,this,T.originalEvent)))},v=T=>{p&&(p=!1,c.call(this,new wi(h,this,T.originalEvent)))};return{layers:new Set(o),listener:c,delegates:{mousemove:_,mouseout:v}}}{const p=_=>{const v=o.filter(S=>this.getLayer(S)),T=v.length?this.queryRenderedFeatures(_.point,{layers:v}):[];T.length&&(_.features=T,c.call(this,_),delete _.features)};return{layers:new Set(o),listener:c,delegates:{[h]:p}}}}on(h,o,c){if(c===void 0)return super.on(h,o);Array.isArray(o)||(o=[o]);const p=this._createDelegatedListener(h,o,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(h,o,c){if(c===void 0)return super.once(h,o);Array.isArray(o)||(o=[o]);const p=this._createDelegatedListener(h,o,c);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(h,o,c){if(c===void 0)return super.off(h,o);o=new Set(Array.isArray(o)?o:[o]);const p=(v,T)=>{if(v.size!==T.size)return!1;for(const S of v)if(!T.has(S))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[h]:void 0;return _&&(v=>{for(let T=0;T<v.length;T++){const S=v[T];if(S.listener===c&&p(S.layers,o)){for(const M in S.delegates)this.off(M,S.delegates[M]);return v.splice(T,1),this}}})(_),this}queryRenderedFeatures(h,o){return this.style?(o!==void 0||h===void 0||h instanceof s.Point||Array.isArray(h)||(o=h,h=void 0),this.style.queryRenderedFeatures(h=h||[[0,0],[this.transform.width,this.transform.height]],o=o||{},this.transform)):[]}querySourceFeatures(h,o){return this.style.querySourceFeatures(h,o)}isPointOnSurface(h){const{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&s.warnOnce(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.Point.convert(h))}setStyle(h,o){return(o=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(h,o))}_getUIString(h){const o=this._locale[h];if(o==null)throw new Error(`Missing UI string '${h}'`);return o}_updateStyle(h,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h&&(this.style=new Qr(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Qr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,o){if(typeof h=="string"){const c=this._requestManager.normalizeStyleURL(h),p=this._requestManager.transformRequest(c,s.ResourceType.Style);s.getJSON(p,(_,v)=>{_?this.fire(new s.ErrorEvent(_)):v&&this._updateDiff(v,o)})}else typeof h=="object"&&this._updateDiff(h,o)}_updateDiff(h,o){try{this.style.setState(h)&&this._update(!0)}catch(c){s.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(h,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(h,o){return this._lazyInitEmptyStyle(),this.style.addSource(h,o),this._update(!0)}isSourceLoaded(h){return!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){const h=this.style&&this.style._sourceCaches;for(const o in h){const c=h[o]._tiles;for(const p in c){const _=c[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(h,o,c){this._lazyInitEmptyStyle(),this.style.addSourceType(h,o,c)}removeSource(h){return this.style.removeSource(h),this._updateTerrain(),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,o,{pixelRatio:c=1,sdf:p=!1,stretchX:_,stretchY:v,content:T}={}){if(this._lazyInitEmptyStyle(),o instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&o instanceof s.window.ImageBitmap){const{width:S,height:M,data:D}=s.exported.getImageData(o);this.style.addImage(h,{data:new s.RGBAImage({width:S,height:M},D),pixelRatio:c,stretchX:_,stretchY:v,content:T,sdf:p,version:0})}else if(o.width===void 0||o.height===void 0)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:M}=o,D=o;this.style.addImage(h,{data:new s.RGBAImage({width:S,height:M},new Uint8Array(D.data)),pixelRatio:c,stretchX:_,stretchY:v,content:T,sdf:p,version:0,userImage:D}),D.onAdd&&D.onAdd(this,h)}}updateImage(h,o){const c=this.style.getImage(h);if(!c)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=o instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&o instanceof s.window.ImageBitmap?s.exported.getImageData(o):o,{width:_,height:v}=p;_!==void 0&&v!==void 0?_===c.data.width&&v===c.data.height?(c.data.replace(p.data,!(o instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&o instanceof s.window.ImageBitmap)),this.style.updateImage(h,c)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${_}, ${v})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,o){s.getImage(this._requestManager.transformRequest(h,s.ResourceType.Image),(c,p)=>{o(c,p instanceof s.window.HTMLImageElement?s.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(h,o){return this._lazyInitEmptyStyle(),this.style.addLayer(h,o),this._update(!0)}moveLayer(h,o){return this.style.moveLayer(h,o),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,o,c){return this.style.setLayerZoomRange(h,o,c),this._update(!0)}setFilter(h,o,c={}){return this.style.setFilter(h,o,c),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,o,c,p={}){return this.style.setPaintProperty(h,o,c,p),this._update(!0)}getPaintProperty(h,o){return this.style.getPaintProperty(h,o)}setLayoutProperty(h,o,c,p={}){return this.style.setLayoutProperty(h,o,c,p),this._update(!0)}getLayoutProperty(h,o){return this.style.getLayoutProperty(h,o)}setLight(h,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,o),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(h),this.transform):0}setFeatureState(h,o){return this.style.setFeatureState(h,o),this._update()}removeFeatureState(h,o){return this.style.removeFeatureState(h,o),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let c,p,_,v=this._container;for(;v&&(!p||!_);){const T=s.window.getComputedStyle(v).transform;T&&T!=="none"&&(c=T.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(p=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(_=c[3])),v=v.parentElement}this._containerWidth=p?Math.abs(h/p):h,this._containerHeight=_?Math.abs(o/_):o}_detectMissingCSS(){s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=G("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=G("div","mapboxgl-canvas-container",h);this._interactive&&o.classList.add("mapboxgl-interactive"),this._canvas=G("canvas","mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=G("div","mapboxgl-control-container",h),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{p[_]=G("div",`mapboxgl-ctrl-${_}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,o){const c=s.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(h),this._canvas.height=c*Math.ceil(o),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${o}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const o=this._markers.indexOf(h);o!==-1&&this._markers.splice(o,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const o=this._popups.indexOf(h);o!==-1&&this._popups.splice(o,1)}_setupPainter(){const h=s.extend({},z.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._useWebGL2&&this._canvas.getContext("webgl2",h),c=o||this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);c?(this._useWebGL2&&!o&&s.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),s.storeAuthState(c,!0),this.painter=new ua(c,this.transform,!!o),this.on("data",p=>{p.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.exported$1.testSupport(c)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let o;const c=this.painter.context.extTimerQuery,p=s.exported.now();if(this.listens("gpu-timing-frame")&&(o=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],s.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],s.window.performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,M=this.transform.pitch,D=s.exported.now(),k=new s.EvaluationParameters(S,{now:D,fadeDuration:_,pitch:M,transition:this.style.getTransition()});this.style.update(k)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let v=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),v=this._updateAverageElevation(p),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):v=this._updateAverageElevation(p),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const S=s.exported.now()-p;c.endQueryEXT(c.TIME_ELAPSED_EXT,o),setTimeout(()=>{const M=c.getQueryObjectEXT(o,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(o),this.fire(new s.Event("gpu-timing-frame",{cpuTime:S,gpuTime:M})),s.window.performance.mark("frame-gpu",{startTime:p,detail:{gpuTime:M}})},50)}if(this.listens("gpu-timing-layer")){const S=this.painter.collectGpuTimers();setTimeout(()=>{const M=this.painter.queryGpuTimers(S);this.fire(new s.Event("gpu-timing-layer",{layerTimes:M}))},50)}if(this.listens("gpu-timing-deferred-render")){const S=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const M=this.painter.queryGpuTimeDeferredRender(S);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:M}))},50)}const T=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(T||this._repaint)this.triggerRepaint();else{const S=!this.isMoving()&&this.loaded();if(S&&(v=this._updateAverageElevation(p,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),S&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const M=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:M})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,s.LivePerformanceUtils.mark(s.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&s.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const o of this._markers)h&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(const o of this._popups)!h||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(h,o=!1){const c=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);if((o||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation(),v=!1;this.transform.elevation&&(v=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=h;const T=Math.abs(p-_);if(T>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(_),c(_);this._averageElevation.easeTo(_,h,300)}else if(T>1e-4)return this._averageElevation.jumpTo(_),c(_)}return!!this._averageElevation.isEasing(h)&&c(this._averageElevation.getValue(h))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===s.AUTH_ERR_MSG||h.status===401)){const o=this.painter.context.gl;s.storeAuthState(o,!1),this._logoControl instanceof jh&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const c=this.painter.context.gl,p=c.createFramebuffer();function _(v){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,v,0);const T=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,T),T}return c.bindFramebuffer(c.FRAMEBUFFER,p),this._canvasPixelComparison(_(h),o.canvasCopies.map(_),o.timeStamps)}_canvasPixelComparison(h,o,c){let p=c[1]-c[0];const _=h.length/4;for(let v=0;v<o.length;v++){const T=o[v];let S=0;for(let M=0;M<T.length;M+=4)T[M]===h[M]&&T[M+1]===h[M+1]&&T[M+2]===h[M+2]&&T[M+3]===h[M+3]&&(S+=1);p+=(c[v+2]-c[v+1])*(1-S/_)}return p}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),s.window!==void 0&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1),s.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=s.exported.frame(o=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(o)}))}_preloadTiles(h){const o=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(o,(c,p)=>c._preloadTiles(h,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){s.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,h&&this._update())}_setCacheLimits(h,o){s.setCacheLimits(h,o)}get version(){return s.version}},NavigationControl:class{constructor(h){this.options=s.extend({},P_,h),this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),G("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),G("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:o}):c.resetNorth({},{originalEvent:o}))}),this._compassIcon=G("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const o=h.getZoom(),c=o===h.getMaxZoom(),p=o===h.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new I_(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,o){const c=G("button",h,this._container);return c.type="button",c.addEventListener("click",o),c}_setButtonTitle(h,o){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${o}`);h.setAttribute("aria-label",c),h.firstElementChild&&h.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends s.Evented{constructor(h){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},qh,h),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=fa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const o=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,h(c)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):s.window.navigator.permissions!==void 0?s.window.navigator.permissions.query({name:"geolocation"}).then(c=>o(c.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(h){const o=this._map.getMaxBounds(),c=h.coords;return!!o&&(c.longitude<o.getWest()||c.longitude>o.getEast()||c.latitude<o.getSouth()||c.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",h)),this._finish()}}_updateCamera(h){const o=new s.LngLat(h.coords.longitude,h.coords.latitude),c=h.coords.accuracy,p=this._map.getBearing(),_=s.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(c),_,{geolocateSource:!0})}_updateMarker(h){if(h){const o=new s.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,o=s.mercatorZfromAltitude(1,h._center.lat)*h.worldSize,c=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=G("button","mapboxgl-ctrl-geolocate",this._container),G("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=G("div","mapboxgl-user-location"),this._dotElement.appendChild(G("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(G("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new dt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=G("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new dt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};s.window.DeviceMotionEvent!==void 0&&typeof s.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:mt,ScaleControl:class{constructor(h){this.options=s.extend({},Wh,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,o=this._map,c=o._containerHeight/2,p=o._containerWidth/2-h/2,_=o.unproject([p,c]),v=o.unproject([p+h,c]),T=_.distanceTo(v);if(this.options.unit==="imperial"){const S=3.2808*T;S>5280?this._setScale(h,S/5280,"mile"):this._setScale(h,S,"foot")}else this.options.unit==="nautical"?this._setScale(h,T/1852,"nautical-mile"):T>=1e3?this._setScale(h,T/1e3,"kilometer"):this._setScale(h,T,"meter")}_setScale(h,o,c){this._map._requestDomTask(()=>{const p=function(v){const T=Math.pow(10,`${Math.floor(v)}`.length-1);let S=v/T;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(M){const D=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*D)/D}(S),T*S}(o),_=p/o;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(p):`${p}&nbsp;${Xh[c]}`,this._container.style.width=h*_+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=G("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof s.window.HTMLElement?this._container=h.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=G("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=G("button","mapboxgl-ctrl-fullscreen",this._controlContainer);G("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(h){super(),this.options=s.extend(Object.create($h),h),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=s.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(s.window.document.createTextNode(h))}setHTML(h){const o=s.window.document.createDocumentFragment(),c=s.window.document.createElement("body");let p;for(c.innerHTML=h;p=c.firstChild,p;)o.appendChild(p);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=G("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(h),this.options.closeButton){const c=this._closeButton=G("button","mapboxgl-popup-close-button",o);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let o;return this._classList.delete(h)?o=!1:(this._classList.add(h),o=!0),this._updateClassList(),o}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const o=this._map,c=this._container,p=this._pos;if(!o||!c||!p)return"bottom";const _=c.offsetWidth,v=c.offsetHeight,T=p.x<_/2,S=p.x>o.transform.width-_/2;if(p.y+h<v)return T?"top-left":S?"top-right":"top";if(p.y>o.transform.height-v){if(T)return"bottom-left";if(S)return"bottom-right"}return T?"left":S?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),h.className=o.join(" ")}_update(h){const o=this._map,c=this._content;if(!o||!this._lngLat&&!this._trackPointer||!c)return;let p=this._container;if(p||(p=this._container=G("div","mapboxgl-popup",o.getContainer()),this._tip=G("div","mapboxgl-popup-tip",p),p.appendChild(c)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ga(this._lngLat,this._pos,o.transform)),!this._trackPointer||h){const _=this._pos=this._trackPointer&&h?h:o.project(this._lngLat),v=Mp(this.options.offset),T=this._anchor=this._getAnchor(v.y),S=Mp(this.options.offset,T),M=_.add(S).round();o._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${Ms[T]} translate(${M.x}px,${M.y}px)`)})}if(!this._marker&&o._showingGlobe()){const _=s.isLngLatBehindGlobe(o.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(M_);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:dt,Style:Qr,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:fp,Evented:s.Evented,config:s.config,prewarm:function(){Jo().acquire(kn)},clearPrewarmedResources:function(){const h=vi;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(kn),vi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(h){s.config.ACCESS_TOKEN=h},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(h){s.config.API_URL=h},get workerCount(){return Nn.workerCount},set workerCount(h){Nn.workerCount=h},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){s.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){s.clearTileCache(h)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return _a});var E=g;return E})})(VC);var $L=VC.exports;const Cv=pE($L);function ZL({setSelectedPartner:t}){const i=De.useRef(null),l=De.useRef(null),[d,g]=De.useState(0),[w,E]=De.useState(52.7),[s,A]=De.useState(2.7);De.useEffect(()=>{l.current||(t(zm[0]),l.current=new Cv.Map({container:i.current,style:{version:8,name:"Mapbox Country Boundaries",sources:{"country-boundaries":{type:"vector",url:"mapbox://mapbox.country-boundaries-v1"}},layers:[{id:"world-country-boundaries",source:"country-boundaries","source-layer":"country_boundaries",type:"fill",filter:["all",["==",["get","disputed"],"false"],["any",["==","all",["get","worldview"]],["in","US",["get","worldview"]]]],paint:{"fill-color":"rgba(237, 65, 5, 0.3)","fill-outline-color":"rgba(255, 255, 255, 0.1)"}},...zm.map((j,G)=>({id:`layer-${j.title}`,source:"country-boundaries","source-layer":"country_boundaries",type:"fill",filter:["all",["==",["get","disputed"],"false"],["match",["get","iso_3166_1"],[...j.countries],!0,!1]],paint:{"fill-color":"rgba(237, 65, 5, 1)","fill-outline-color":"rgba(255, 255, 255, 0.5)","fill-opacity":G===0?1:0,"fill-opacity-transition":{duration:500}}}))]},center:[d,w],zoom:s}),l.current.on("load",()=>{zm.forEach(j=>{const G=document.createElement("img");G.src=j.marker,G.className="marker",G.addEventListener("click",()=>z(j)),new Cv.Marker({element:G,anchor:"bottom"}).setLngLat({lng:j.coordinates.longitude,lat:j.coordinates.latitude}).addTo(l.current)})}))}),De.useEffect(()=>{l.current&&l.current.on("move",()=>{g(l.current.getCenter().lng.toFixed(4)),E(l.current.getCenter().lat.toFixed(4)),A(l.current.getZoom().toFixed(2))})});const z=j=>{console.log("changeLayer",j),t(j),V(),setTimeout(()=>{l.current.setPaintProperty(`layer-${j.title}`,"fill-opacity",1)},100)},V=()=>{zm.forEach(j=>{l.current.setPaintProperty(`layer-${j.title}`,"fill-opacity",0)})};return qe.jsx("div",{ref:i,className:"map-container"})}const jC=De.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"}),Qg=De.createContext({}),e_=De.createContext(null),t_=typeof document<"u",Tg=t_?De.useLayoutEffect:De.useEffect,GC=De.createContext({strict:!1});function qL(t,i,l,d){const{visualElement:g}=De.useContext(Qg),w=De.useContext(GC),E=De.useContext(e_),s=De.useContext(jC).reducedMotion,A=De.useRef();d=d||w.renderer,!A.current&&d&&(A.current=d(t,{visualState:i,parent:g,props:l,presenceContext:E,blockInitialAnimation:E?E.initial===!1:!1,reducedMotionConfig:s}));const z=A.current;return De.useInsertionEffect(()=>{z&&z.update(l,E)}),Tg(()=>{z&&z.render()}),De.useEffect(()=>{z&&z.updateFeatures()}),(window.HandoffAppearAnimations?Tg:De.useEffect)(()=>{z&&z.animationState&&z.animationState.animateChanges()}),z}function Au(t){return typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function WL(t,i,l){return De.useCallback(d=>{d&&t.mount&&t.mount(d),i&&(d?i.mount(d):i.unmount()),l&&(typeof l=="function"?l(d):Au(l)&&(l.current=d))},[i])}function If(t){return typeof t=="string"||Array.isArray(t)}function n_(t){return typeof t=="object"&&typeof t.start=="function"}const Nx=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],jx=["initial",...Nx];function i_(t){return n_(t.animate)||jx.some(i=>If(t[i]))}function $C(t){return!!(i_(t)||t.variants)}function XL(t,i){if(i_(t)){const{initial:l,animate:d}=t;return{initial:l===!1||If(l)?l:void 0,animate:If(d)?d:void 0}}return t.inherit!==!1?i:{}}function HL(t){const{initial:i,animate:l}=XL(t,De.useContext(Qg));return De.useMemo(()=>({initial:i,animate:l}),[h2(i),h2(l)])}function h2(t){return Array.isArray(t)?t.join(" "):t}const d2={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},kf={};for(const t in d2)kf[t]={isEnabled:i=>d2[t].some(l=>!!i[l])};function KL(t){for(const i in t)kf[i]={...kf[i],...t[i]}}const Gx=De.createContext({}),ZC=De.createContext({}),YL=Symbol.for("motionComponentSymbol");function JL({preloadedFeatures:t,createVisualElement:i,useRender:l,useVisualState:d,Component:g}){t&&KL(t);function w(s,A){let z;const V={...De.useContext(jC),...s,layoutId:QL(s)},{isStatic:j}=V,G=HL(s),re=d(s,j);if(!j&&t_){G.visualElement=qL(g,re,V,i);const he=De.useContext(ZC),ve=De.useContext(GC).strict;G.visualElement&&(z=G.visualElement.loadFeatures(V,ve,t,he))}return De.createElement(Qg.Provider,{value:G},z&&G.visualElement?De.createElement(z,{visualElement:G.visualElement,...V}):null,l(g,s,WL(re,G.visualElement,A),re,j,G.visualElement))}const E=De.forwardRef(w);return E[YL]=g,E}function QL({layoutId:t}){const i=De.useContext(Gx).id;return i&&t!==void 0?i+"-"+t:t}function eR(t){function i(d,g={}){return JL(t(d,g))}if(typeof Proxy>"u")return i;const l=new Map;return new Proxy(i,{get:(d,g)=>(l.has(g)||l.set(g,i(g)),l.get(g))})}const tR=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function $x(t){return typeof t!="string"||t.includes("-")?!1:!!(tR.indexOf(t)>-1||/[A-Z]/.test(t))}const Eg={};function nR(t){Object.assign(Eg,t)}const Vf=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],dc=new Set(Vf);function qC(t,{layout:i,layoutId:l}){return dc.has(t)||t.startsWith("origin")||(i||l!==void 0)&&(!!Eg[t]||t==="opacity")}const Lr=t=>!!(t&&t.getVelocity),iR={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},rR=Vf.length;function oR(t,{enableHardwareAcceleration:i=!0,allowTransformNone:l=!0},d,g){let w="";for(let E=0;E<rR;E++){const s=Vf[E];if(t[s]!==void 0){const A=iR[s]||s;w+=`${A}(${t[s]}) `}}return i&&!t.z&&(w+="translateZ(0)"),w=w.trim(),g?w=g(t,d?"":w):l&&d&&(w="none"),w}const WC=t=>i=>typeof i=="string"&&i.startsWith(t),XC=WC("--"),Av=WC("var(--"),sR=/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,aR=(t,i)=>i&&typeof t=="number"?i.transform(t):t,Ka=(t,i,l)=>Math.min(Math.max(l,t),i),fc={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},af={...fc,transform:t=>Ka(0,1,t)},Lm={...fc,default:1},lf=t=>Math.round(t*1e5)/1e5,r_=/(-)?([\d]*\.?[\d])+/g,HC=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,lR=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function Nf(t){return typeof t=="string"}const jf=t=>({test:i=>Nf(i)&&i.endsWith(t)&&i.split(" ").length===1,parse:parseFloat,transform:i=>`${i}${t}`}),Ia=jf("deg"),gs=jf("%"),Gt=jf("px"),cR=jf("vh"),uR=jf("vw"),f2={...gs,parse:t=>gs.parse(t)/100,transform:t=>gs.transform(t*100)},p2={...fc,transform:Math.round},KC={borderWidth:Gt,borderTopWidth:Gt,borderRightWidth:Gt,borderBottomWidth:Gt,borderLeftWidth:Gt,borderRadius:Gt,radius:Gt,borderTopLeftRadius:Gt,borderTopRightRadius:Gt,borderBottomRightRadius:Gt,borderBottomLeftRadius:Gt,width:Gt,maxWidth:Gt,height:Gt,maxHeight:Gt,size:Gt,top:Gt,right:Gt,bottom:Gt,left:Gt,padding:Gt,paddingTop:Gt,paddingRight:Gt,paddingBottom:Gt,paddingLeft:Gt,margin:Gt,marginTop:Gt,marginRight:Gt,marginBottom:Gt,marginLeft:Gt,rotate:Ia,rotateX:Ia,rotateY:Ia,rotateZ:Ia,scale:Lm,scaleX:Lm,scaleY:Lm,scaleZ:Lm,skew:Ia,skewX:Ia,skewY:Ia,distance:Gt,translateX:Gt,translateY:Gt,translateZ:Gt,x:Gt,y:Gt,z:Gt,perspective:Gt,transformPerspective:Gt,opacity:af,originX:f2,originY:f2,originZ:Gt,zIndex:p2,fillOpacity:af,strokeOpacity:af,numOctaves:p2};function Zx(t,i,l,d){const{style:g,vars:w,transform:E,transformOrigin:s}=t;let A=!1,z=!1,V=!0;for(const j in i){const G=i[j];if(XC(j)){w[j]=G;continue}const re=KC[j],he=aR(G,re);if(dc.has(j)){if(A=!0,E[j]=he,!V)continue;G!==(re.default||0)&&(V=!1)}else j.startsWith("origin")?(z=!0,s[j]=he):g[j]=he}if(i.transform||(A||d?g.transform=oR(t.transform,l,V,d):g.transform&&(g.transform="none")),z){const{originX:j="50%",originY:G="50%",originZ:re=0}=s;g.transformOrigin=`${j} ${G} ${re}`}}const qx=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function YC(t,i,l){for(const d in i)!Lr(i[d])&&!qC(d,l)&&(t[d]=i[d])}function hR({transformTemplate:t},i,l){return De.useMemo(()=>{const d=qx();return Zx(d,i,{enableHardwareAcceleration:!l},t),Object.assign({},d.vars,d.style)},[i])}function dR(t,i,l){const d=t.style||{},g={};return YC(g,d,t),Object.assign(g,hR(t,i,l)),t.transformValues?t.transformValues(g):g}function fR(t,i,l){const d={},g=dR(t,i,l);return t.drag&&t.dragListener!==!1&&(d.draggable=!1,g.userSelect=g.WebkitUserSelect=g.WebkitTouchCallout="none",g.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(d.tabIndex=0),d.style=g,d}const pR=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onLayoutAnimationStart","onLayoutAnimationComplete","onLayoutMeasure","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","ignoreStrict","viewport"]);function Sg(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||pR.has(t)}let JC=t=>!Sg(t);function mR(t){t&&(JC=i=>i.startsWith("on")?!Sg(i):t(i))}try{mR(require("@emotion/is-prop-valid").default)}catch{}function gR(t,i,l){const d={};for(const g in t)g==="values"&&typeof t.values=="object"||(JC(g)||l===!0&&Sg(g)||!i&&!Sg(g)||t.draggable&&g.startsWith("onDrag"))&&(d[g]=t[g]);return d}function m2(t,i,l){return typeof t=="string"?t:Gt.transform(i+l*t)}function _R(t,i,l){const d=m2(i,t.x,t.width),g=m2(l,t.y,t.height);return`${d} ${g}`}const yR={offset:"stroke-dashoffset",array:"stroke-dasharray"},vR={offset:"strokeDashoffset",array:"strokeDasharray"};function xR(t,i,l=1,d=0,g=!0){t.pathLength=1;const w=g?yR:vR;t[w.offset]=Gt.transform(-d);const E=Gt.transform(i),s=Gt.transform(l);t[w.array]=`${E} ${s}`}function Wx(t,{attrX:i,attrY:l,attrScale:d,originX:g,originY:w,pathLength:E,pathSpacing:s=1,pathOffset:A=0,...z},V,j,G){if(Zx(t,z,V,G),j){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:re,style:he,dimensions:ve}=t;re.transform&&(ve&&(he.transform=re.transform),delete re.transform),ve&&(g!==void 0||w!==void 0||he.transform)&&(he.transformOrigin=_R(ve,g!==void 0?g:.5,w!==void 0?w:.5)),i!==void 0&&(re.x=i),l!==void 0&&(re.y=l),d!==void 0&&(re.scale=d),E!==void 0&&xR(re,E,s,A,!1)}const QC=()=>({...qx(),attrs:{}}),Xx=t=>typeof t=="string"&&t.toLowerCase()==="svg";function wR(t,i,l,d){const g=De.useMemo(()=>{const w=QC();return Wx(w,i,{enableHardwareAcceleration:!1},Xx(d),t.transformTemplate),{...w.attrs,style:{...w.style}}},[i]);if(t.style){const w={};YC(w,t.style,t),g.style={...w,...g.style}}return g}function bR(t=!1){return(l,d,g,{latestValues:w},E)=>{const A=($x(l)?wR:fR)(d,w,E,l),V={...gR(d,typeof l=="string",t),...A,ref:g},{children:j}=d,G=De.useMemo(()=>Lr(j)?j.get():j,[j]);return De.createElement(l,{...V,children:G})}}const Hx=t=>t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();function eA(t,{style:i,vars:l},d,g){Object.assign(t.style,i,g&&g.getProjectionStyles(d));for(const w in l)t.style.setProperty(w,l[w])}const tA=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function nA(t,i,l,d){eA(t,i,void 0,d);for(const g in i.attrs)t.setAttribute(tA.has(g)?g:Hx(g),i.attrs[g])}function Kx(t,i){const{style:l}=t,d={};for(const g in l)(Lr(l[g])||i.style&&Lr(i.style[g])||qC(g,t))&&(d[g]=l[g]);return d}function iA(t,i){const l=Kx(t,i);for(const d in t)if(Lr(t[d])||Lr(i[d])){const g=Vf.indexOf(d)!==-1?"attr"+d.charAt(0).toUpperCase()+d.substring(1):d;l[g]=t[d]}return l}function Yx(t,i,l,d={},g={}){return typeof i=="function"&&(i=i(l!==void 0?l:t.custom,d,g)),typeof i=="string"&&(i=t.variants&&t.variants[i]),typeof i=="function"&&(i=i(l!==void 0?l:t.custom,d,g)),i}function rA(t){const i=De.useRef(null);return i.current===null&&(i.current=t()),i.current}const Cg=t=>Array.isArray(t),TR=t=>!!(t&&typeof t=="object"&&t.mix&&t.toValue),ER=t=>Cg(t)?t[t.length-1]||0:t;function Km(t){const i=Lr(t)?t.get():t;return TR(i)?i.toValue():i}function SR({scrapeMotionValuesFromProps:t,createRenderState:i,onMount:l},d,g,w){const E={latestValues:CR(d,g,w,t),renderState:i()};return l&&(E.mount=s=>l(d,s,E)),E}const oA=t=>(i,l)=>{const d=De.useContext(Qg),g=De.useContext(e_),w=()=>SR(t,i,d,g);return l?w():rA(w)};function CR(t,i,l,d){const g={},w=d(t,{});for(const G in w)g[G]=Km(w[G]);let{initial:E,animate:s}=t;const A=i_(t),z=$C(t);i&&z&&!A&&t.inherit!==!1&&(E===void 0&&(E=i.initial),s===void 0&&(s=i.animate));let V=l?l.initial===!1:!1;V=V||E===!1;const j=V?s:E;return j&&typeof j!="boolean"&&!n_(j)&&(Array.isArray(j)?j:[j]).forEach(re=>{const he=Yx(t,re);if(!he)return;const{transitionEnd:ve,transition:Ue,...ae}=he;for(const J in ae){let se=ae[J];if(Array.isArray(se)){const oe=V?se.length-1:0;se=se[oe]}se!==null&&(g[J]=se)}for(const J in ve)g[J]=ve[J]}),g}const AR={useVisualState:oA({scrapeMotionValuesFromProps:iA,createRenderState:QC,onMount:(t,i,{renderState:l,latestValues:d})=>{try{l.dimensions=typeof i.getBBox=="function"?i.getBBox():i.getBoundingClientRect()}catch{l.dimensions={x:0,y:0,width:0,height:0}}Wx(l,d,{enableHardwareAcceleration:!1},Xx(i.tagName),t.transformTemplate),nA(i,l)}})},MR={useVisualState:oA({scrapeMotionValuesFromProps:Kx,createRenderState:qx})};function PR(t,{forwardMotionProps:i=!1},l,d){return{...$x(t)?AR:MR,preloadedFeatures:l,useRender:bR(i),createVisualElement:d,Component:t}}function js(t,i,l,d={passive:!0}){return t.addEventListener(i,l,d),()=>t.removeEventListener(i,l)}const sA=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1;function o_(t,i="page"){return{point:{x:t[i+"X"],y:t[i+"Y"]}}}const IR=t=>i=>sA(i)&&t(i,o_(i));function Zs(t,i,l,d){return js(t,i,IR(l),d)}const kR=(t,i)=>l=>i(t(l)),qa=(...t)=>t.reduce(kR);function aA(t){let i=null;return()=>{const l=()=>{i=null};return i===null?(i=t,l):!1}}const g2=aA("dragHorizontal"),_2=aA("dragVertical");function lA(t){let i=!1;if(t==="y")i=_2();else if(t==="x")i=g2();else{const l=g2(),d=_2();l&&d?i=()=>{l(),d()}:(l&&l(),d&&d())}return i}function cA(){const t=lA(!0);return t?(t(),!1):!0}class tl{constructor(i){this.isMounted=!1,this.node=i}update(){}}function DR(t){let i=[],l=[],d=0,g=!1,w=!1;const E=new WeakSet,s={schedule:(A,z=!1,V=!1)=>{const j=V&&g,G=j?i:l;return z&&E.add(A),G.indexOf(A)===-1&&(G.push(A),j&&g&&(d=i.length)),A},cancel:A=>{const z=l.indexOf(A);z!==-1&&l.splice(z,1),E.delete(A)},process:A=>{if(g){w=!0;return}if(g=!0,[i,l]=[l,i],l.length=0,d=i.length,d)for(let z=0;z<d;z++){const V=i[z];V(A),E.has(V)&&(s.schedule(V),t())}g=!1,w&&(w=!1,s.process(A))}};return s}const li={delta:0,timestamp:0,isProcessing:!1},zR=40;let Mv=!0,Df=!1;const s_=["read","update","preRender","render","postRender"],Ou=s_.reduce((t,i)=>(t[i]=DR(()=>Df=!0),t),{}),LR=t=>Ou[t].process(li),uA=t=>{Df=!1,li.delta=Mv?1e3/60:Math.max(Math.min(t-li.timestamp,zR),1),li.timestamp=t,li.isProcessing=!0,s_.forEach(LR),li.isProcessing=!1,Df&&(Mv=!1,requestAnimationFrame(uA))},RR=()=>{Df=!0,Mv=!0,li.isProcessing||requestAnimationFrame(uA)},Qn=s_.reduce((t,i)=>{const l=Ou[i];return t[i]=(d,g=!1,w=!1)=>(Df||RR(),l.schedule(d,g,w)),t},{});function Ys(t){s_.forEach(i=>Ou[i].cancel(t))}function y2(t,i){const l="pointer"+(i?"enter":"leave"),d="onHover"+(i?"Start":"End"),g=(w,E)=>{if(w.type==="touch"||cA())return;const s=t.getProps();t.animationState&&s.whileHover&&t.animationState.setActive("whileHover",i),s[d]&&Qn.update(()=>s[d](w,E))};return Zs(t.current,l,g,{passive:!t.getProps()[d]})}class BR extends tl{mount(){this.unmount=qa(y2(this.node,!0),y2(this.node,!1))}unmount(){}}class FR extends tl{constructor(){super(...arguments),this.isActive=!1}onFocus(){let i=!1;try{i=this.node.current.matches(":focus-visible")}catch{i=!0}!i||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=qa(js(this.node.current,"focus",()=>this.onFocus()),js(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const hA=(t,i)=>i?t===i?!0:hA(t,i.parentElement):!1,Li=t=>t;function m0(t,i){if(!i)return;const l=new PointerEvent("pointer"+t);i(l,o_(l))}class OR extends tl{constructor(){super(...arguments),this.removeStartListeners=Li,this.removeEndListeners=Li,this.removeAccessibleListeners=Li,this.startPointerPress=(i,l)=>{if(this.removeEndListeners(),this.isPressing)return;const d=this.node.getProps(),w=Zs(window,"pointerup",(s,A)=>{if(!this.checkPressEnd())return;const{onTap:z,onTapCancel:V}=this.node.getProps();Qn.update(()=>{hA(this.node.current,s.target)?z&&z(s,A):V&&V(s,A)})},{passive:!(d.onTap||d.onPointerUp)}),E=Zs(window,"pointercancel",(s,A)=>this.cancelPress(s,A),{passive:!(d.onTapCancel||d.onPointerCancel)});this.removeEndListeners=qa(w,E),this.startPress(i,l)},this.startAccessiblePress=()=>{const i=w=>{if(w.key!=="Enter"||this.isPressing)return;const E=s=>{s.key!=="Enter"||!this.checkPressEnd()||m0("up",(A,z)=>{const{onTap:V}=this.node.getProps();V&&Qn.update(()=>V(A,z))})};this.removeEndListeners(),this.removeEndListeners=js(this.node.current,"keyup",E),m0("down",(s,A)=>{this.startPress(s,A)})},l=js(this.node.current,"keydown",i),d=()=>{this.isPressing&&m0("cancel",(w,E)=>this.cancelPress(w,E))},g=js(this.node.current,"blur",d);this.removeAccessibleListeners=qa(l,g)}}startPress(i,l){this.isPressing=!0;const{onTapStart:d,whileTap:g}=this.node.getProps();g&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),d&&Qn.update(()=>d(i,l))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!cA()}cancelPress(i,l){if(!this.checkPressEnd())return;const{onTapCancel:d}=this.node.getProps();d&&Qn.update(()=>d(i,l))}mount(){const i=this.node.getProps(),l=Zs(this.node.current,"pointerdown",this.startPointerPress,{passive:!(i.onTapStart||i.onPointerStart)}),d=js(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=qa(l,d)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const Pv=new WeakMap,g0=new WeakMap,UR=t=>{const i=Pv.get(t.target);i&&i(t)},VR=t=>{t.forEach(UR)};function NR({root:t,...i}){const l=t||document;g0.has(l)||g0.set(l,{});const d=g0.get(l),g=JSON.stringify(i);return d[g]||(d[g]=new IntersectionObserver(VR,{root:t,...i})),d[g]}function jR(t,i,l){const d=NR(i);return Pv.set(t,l),d.observe(t),()=>{Pv.delete(t),d.unobserve(t)}}const GR={some:0,all:1};class $R extends tl{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:i={}}=this.node.getProps(),{root:l,margin:d,amount:g="some",once:w}=i,E={root:l?l.current:void 0,rootMargin:d,threshold:typeof g=="number"?g:GR[g]},s=A=>{const{isIntersecting:z}=A;if(this.isInView===z||(this.isInView=z,w&&!z&&this.hasEnteredView))return;z&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",z);const{onViewportEnter:V,onViewportLeave:j}=this.node.getProps(),G=z?V:j;G&&G(A)};return jR(this.node.current,E,s)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:i,prevProps:l}=this.node;["amount","margin","root"].some(ZR(i,l))&&this.startObserver()}unmount(){}}function ZR({viewport:t={}},{viewport:i={}}={}){return l=>t[l]!==i[l]}const qR={inView:{Feature:$R},tap:{Feature:OR},focus:{Feature:FR},hover:{Feature:BR}};function dA(t,i){if(!Array.isArray(i))return!1;const l=i.length;if(l!==t.length)return!1;for(let d=0;d<l;d++)if(i[d]!==t[d])return!1;return!0}function WR(t){const i={};return t.values.forEach((l,d)=>i[d]=l.get()),i}function XR(t){const i={};return t.values.forEach((l,d)=>i[d]=l.getVelocity()),i}function a_(t,i,l){const d=t.getProps();return Yx(d,i,l!==void 0?l:d.custom,WR(t),XR(t))}const HR="framerAppearId",KR="data-"+Hx(HR);let YR=Li,Jx=Li;const Wa=t=>t*1e3,qs=t=>t/1e3,JR={current:!1},fA=t=>Array.isArray(t)&&typeof t[0]=="number";function pA(t){return!!(!t||typeof t=="string"&&mA[t]||fA(t)||Array.isArray(t)&&t.every(pA))}const Hd=([t,i,l,d])=>`cubic-bezier(${t}, ${i}, ${l}, ${d})`,mA={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Hd([0,.65,.55,1]),circOut:Hd([.55,0,1,.45]),backIn:Hd([.31,.01,.66,-.59]),backOut:Hd([.33,1.53,.69,.99])};function gA(t){if(t)return fA(t)?Hd(t):Array.isArray(t)?t.map(gA):mA[t]}function QR(t,i,l,{delay:d=0,duration:g,repeat:w=0,repeatType:E="loop",ease:s,times:A}={}){const z={[i]:l};A&&(z.offset=A);const V=gA(s);return Array.isArray(V)&&(z.easing=V),t.animate(z,{delay:d,duration:g,easing:Array.isArray(V)?"linear":V,fill:"both",iterations:w+1,direction:E==="reverse"?"alternate":"normal"})}const v2={waapi:()=>Object.hasOwnProperty.call(Element.prototype,"animate")},_0={},_A={};for(const t in v2)_A[t]=()=>(_0[t]===void 0&&(_0[t]=v2[t]()),_0[t]);function e3(t,{repeat:i,repeatType:l="loop"}){const d=i&&l!=="loop"&&i%2===1?0:t.length-1;return t[d]}const yA=(t,i,l)=>(((1-3*l+3*i)*t+(3*l-6*i))*t+3*i)*t,t3=1e-7,n3=12;function i3(t,i,l,d,g){let w,E,s=0;do E=i+(l-i)/2,w=yA(E,d,g)-t,w>0?l=E:i=E;while(Math.abs(w)>t3&&++s<n3);return E}function Gf(t,i,l,d){if(t===i&&l===d)return Li;const g=w=>i3(w,0,1,t,l);return w=>w===0||w===1?w:yA(g(w),i,d)}const r3=Gf(.42,0,1,1),o3=Gf(0,0,.58,1),vA=Gf(.42,0,.58,1),s3=t=>Array.isArray(t)&&typeof t[0]!="number",xA=t=>i=>i<=.5?t(2*i)/2:(2-t(2*(1-i)))/2,wA=t=>i=>1-t(1-i),bA=t=>1-Math.sin(Math.acos(t)),Qx=wA(bA),a3=xA(Qx),TA=Gf(.33,1.53,.69,.99),e1=wA(TA),l3=xA(e1),c3=t=>(t*=2)<1?.5*e1(t):.5*(2-Math.pow(2,-10*(t-1))),u3={linear:Li,easeIn:r3,easeInOut:vA,easeOut:o3,circIn:bA,circInOut:a3,circOut:Qx,backIn:e1,backInOut:l3,backOut:TA,anticipate:c3},x2=t=>{if(Array.isArray(t)){Jx(t.length===4);const[i,l,d,g]=t;return Gf(i,l,d,g)}else if(typeof t=="string")return u3[t];return t},t1=(t,i)=>l=>!!(Nf(l)&&lR.test(l)&&l.startsWith(t)||i&&Object.prototype.hasOwnProperty.call(l,i)),EA=(t,i,l)=>d=>{if(!Nf(d))return d;const[g,w,E,s]=d.match(r_);return{[t]:parseFloat(g),[i]:parseFloat(w),[l]:parseFloat(E),alpha:s!==void 0?parseFloat(s):1}},h3=t=>Ka(0,255,t),y0={...fc,transform:t=>Math.round(h3(t))},Ql={test:t1("rgb","red"),parse:EA("red","green","blue"),transform:({red:t,green:i,blue:l,alpha:d=1})=>"rgba("+y0.transform(t)+", "+y0.transform(i)+", "+y0.transform(l)+", "+lf(af.transform(d))+")"};function d3(t){let i="",l="",d="",g="";return t.length>5?(i=t.substring(1,3),l=t.substring(3,5),d=t.substring(5,7),g=t.substring(7,9)):(i=t.substring(1,2),l=t.substring(2,3),d=t.substring(3,4),g=t.substring(4,5),i+=i,l+=l,d+=d,g+=g),{red:parseInt(i,16),green:parseInt(l,16),blue:parseInt(d,16),alpha:g?parseInt(g,16)/255:1}}const Iv={test:t1("#"),parse:d3,transform:Ql.transform},Mu={test:t1("hsl","hue"),parse:EA("hue","saturation","lightness"),transform:({hue:t,saturation:i,lightness:l,alpha:d=1})=>"hsla("+Math.round(t)+", "+gs.transform(lf(i))+", "+gs.transform(lf(l))+", "+lf(af.transform(d))+")"},pr={test:t=>Ql.test(t)||Iv.test(t)||Mu.test(t),parse:t=>Ql.test(t)?Ql.parse(t):Mu.test(t)?Mu.parse(t):Iv.parse(t),transform:t=>Nf(t)?t:t.hasOwnProperty("red")?Ql.transform(t):Mu.transform(t)},ui=(t,i,l)=>-l*t+l*i+t;function v0(t,i,l){return l<0&&(l+=1),l>1&&(l-=1),l<1/6?t+(i-t)*6*l:l<1/2?i:l<2/3?t+(i-t)*(2/3-l)*6:t}function f3({hue:t,saturation:i,lightness:l,alpha:d}){t/=360,i/=100,l/=100;let g=0,w=0,E=0;if(!i)g=w=E=l;else{const s=l<.5?l*(1+i):l+i-l*i,A=2*l-s;g=v0(A,s,t+1/3),w=v0(A,s,t),E=v0(A,s,t-1/3)}return{red:Math.round(g*255),green:Math.round(w*255),blue:Math.round(E*255),alpha:d}}const x0=(t,i,l)=>{const d=t*t;return Math.sqrt(Math.max(0,l*(i*i-d)+d))},p3=[Iv,Ql,Mu],m3=t=>p3.find(i=>i.test(t));function w2(t){const i=m3(t);let l=i.parse(t);return i===Mu&&(l=f3(l)),l}const SA=(t,i)=>{const l=w2(t),d=w2(i),g={...l};return w=>(g.red=x0(l.red,d.red,w),g.green=x0(l.green,d.green,w),g.blue=x0(l.blue,d.blue,w),g.alpha=ui(l.alpha,d.alpha,w),Ql.transform(g))};function g3(t){var i,l;return isNaN(t)&&Nf(t)&&(((i=t.match(r_))===null||i===void 0?void 0:i.length)||0)+(((l=t.match(HC))===null||l===void 0?void 0:l.length)||0)>0}const CA={regex:sR,countKey:"Vars",token:"${v}",parse:Li},AA={regex:HC,countKey:"Colors",token:"${c}",parse:pr.parse},MA={regex:r_,countKey:"Numbers",token:"${n}",parse:fc.parse};function w0(t,{regex:i,countKey:l,token:d,parse:g}){const w=t.tokenised.match(i);w&&(t["num"+l]=w.length,t.tokenised=t.tokenised.replace(i,d),t.values.push(...w.map(g)))}function Ag(t){const i=t.toString(),l={value:i,tokenised:i,values:[],numVars:0,numColors:0,numNumbers:0};return l.value.includes("var(--")&&w0(l,CA),w0(l,AA),w0(l,MA),l}function PA(t){return Ag(t).values}function IA(t){const{values:i,numColors:l,numVars:d,tokenised:g}=Ag(t),w=i.length;return E=>{let s=g;for(let A=0;A<w;A++)A<d?s=s.replace(CA.token,E[A]):A<d+l?s=s.replace(AA.token,pr.transform(E[A])):s=s.replace(MA.token,lf(E[A]));return s}}const _3=t=>typeof t=="number"?0:t;function y3(t){const i=PA(t);return IA(t)(i.map(_3))}const Ya={test:g3,parse:PA,createTransformer:IA,getAnimatableNone:y3},kA=(t,i)=>l=>`${l>0?i:t}`;function DA(t,i){return typeof t=="number"?l=>ui(t,i,l):pr.test(t)?SA(t,i):t.startsWith("var(")?kA(t,i):LA(t,i)}const zA=(t,i)=>{const l=[...t],d=l.length,g=t.map((w,E)=>DA(w,i[E]));return w=>{for(let E=0;E<d;E++)l[E]=g[E](w);return l}},v3=(t,i)=>{const l={...t,...i},d={};for(const g in l)t[g]!==void 0&&i[g]!==void 0&&(d[g]=DA(t[g],i[g]));return g=>{for(const w in d)l[w]=d[w](g);return l}},LA=(t,i)=>{const l=Ya.createTransformer(i),d=Ag(t),g=Ag(i);return d.numVars===g.numVars&&d.numColors===g.numColors&&d.numNumbers>=g.numNumbers?qa(zA(d.values,g.values),l):kA(t,i)},zf=(t,i,l)=>{const d=i-t;return d===0?1:(l-t)/d},b2=(t,i)=>l=>ui(t,i,l);function x3(t){return typeof t=="number"?b2:typeof t=="string"?pr.test(t)?SA:LA:Array.isArray(t)?zA:typeof t=="object"?v3:b2}function w3(t,i,l){const d=[],g=l||x3(t[0]),w=t.length-1;for(let E=0;E<w;E++){let s=g(t[E],t[E+1]);if(i){const A=Array.isArray(i)?i[E]||Li:i;s=qa(A,s)}d.push(s)}return d}function RA(t,i,{clamp:l=!0,ease:d,mixer:g}={}){const w=t.length;if(Jx(w===i.length),w===1)return()=>i[0];t[0]>t[w-1]&&(t=[...t].reverse(),i=[...i].reverse());const E=w3(i,d,g),s=E.length,A=z=>{let V=0;if(s>1)for(;V<t.length-2&&!(z<t[V+1]);V++);const j=zf(t[V],t[V+1],z);return E[V](j)};return l?z=>A(Ka(t[0],t[w-1],z)):A}function b3(t,i){const l=t[t.length-1];for(let d=1;d<=i;d++){const g=zf(0,i,d);t.push(ui(l,1,g))}}function T3(t){const i=[0];return b3(i,t.length-1),i}function E3(t,i){return t.map(l=>l*i)}function S3(t,i){return t.map(()=>i||vA).splice(0,t.length-1)}function Mg({duration:t=300,keyframes:i,times:l,ease:d="easeInOut"}){const g=s3(d)?d.map(x2):x2(d),w={done:!1,value:i[0]},E=E3(l&&l.length===i.length?l:T3(i),t),s=RA(E,i,{ease:Array.isArray(g)?g:S3(i,g)});return{calculatedDuration:t,next:A=>(w.value=s(A),w.done=A>=t,w)}}function BA(t,i){return i?t*(1e3/i):0}const C3=5;function FA(t,i,l){const d=Math.max(i-C3,0);return BA(l-t(d),i-d)}const b0=.001,A3=.01,T2=10,M3=.05,P3=1;function I3({duration:t=800,bounce:i=.25,velocity:l=0,mass:d=1}){let g,w;YR(t<=Wa(T2));let E=1-i;E=Ka(M3,P3,E),t=Ka(A3,T2,qs(t)),E<1?(g=z=>{const V=z*E,j=V*t,G=V-l,re=kv(z,E),he=Math.exp(-j);return b0-G/re*he},w=z=>{const j=z*E*t,G=j*l+l,re=Math.pow(E,2)*Math.pow(z,2)*t,he=Math.exp(-j),ve=kv(Math.pow(z,2),E);return(-g(z)+b0>0?-1:1)*((G-re)*he)/ve}):(g=z=>{const V=Math.exp(-z*t),j=(z-l)*t+1;return-b0+V*j},w=z=>{const V=Math.exp(-z*t),j=(l-z)*(t*t);return V*j});const s=5/t,A=D3(g,w,s);if(t=Wa(t),isNaN(A))return{stiffness:100,damping:10,duration:t};{const z=Math.pow(A,2)*d;return{stiffness:z,damping:E*2*Math.sqrt(d*z),duration:t}}}const k3=12;function D3(t,i,l){let d=l;for(let g=1;g<k3;g++)d=d-t(d)/i(d);return d}function kv(t,i){return t*Math.sqrt(1-i*i)}const z3=["duration","bounce"],L3=["stiffness","damping","mass"];function E2(t,i){return i.some(l=>t[l]!==void 0)}function R3(t){let i={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...t};if(!E2(t,L3)&&E2(t,z3)){const l=I3(t);i={...i,...l,velocity:0,mass:1},i.isResolvedFromDuration=!0}return i}function OA({keyframes:t,restDelta:i,restSpeed:l,...d}){const g=t[0],w=t[t.length-1],E={done:!1,value:g},{stiffness:s,damping:A,mass:z,velocity:V,duration:j,isResolvedFromDuration:G}=R3(d),re=V?-qs(V):0,he=A/(2*Math.sqrt(s*z)),ve=w-g,Ue=qs(Math.sqrt(s/z)),ae=Math.abs(ve)<5;l||(l=ae?.01:2),i||(i=ae?.005:.5);let J;if(he<1){const se=kv(Ue,he);J=oe=>{const Be=Math.exp(-he*Ue*oe);return w-Be*((re+he*Ue*ve)/se*Math.sin(se*oe)+ve*Math.cos(se*oe))}}else if(he===1)J=se=>w-Math.exp(-Ue*se)*(ve+(re+Ue*ve)*se);else{const se=Ue*Math.sqrt(he*he-1);J=oe=>{const Be=Math.exp(-he*Ue*oe),at=Math.min(se*oe,300);return w-Be*((re+he*Ue*ve)*Math.sinh(at)+se*ve*Math.cosh(at))/se}}return{calculatedDuration:G&&j||null,next:se=>{const oe=J(se);if(G)E.done=se>=j;else{let Be=re;se!==0&&(he<1?Be=FA(J,se,oe):Be=0);const at=Math.abs(Be)<=l,Ye=Math.abs(w-oe)<=i;E.done=at&&Ye}return E.value=E.done?w:oe,E}}}function S2({keyframes:t,velocity:i=0,power:l=.8,timeConstant:d=325,bounceDamping:g=10,bounceStiffness:w=500,modifyTarget:E,min:s,max:A,restDelta:z=.5,restSpeed:V}){const j=t[0],G={done:!1,value:j},re=He=>s!==void 0&&He<s||A!==void 0&&He>A,he=He=>s===void 0?A:A===void 0||Math.abs(s-He)<Math.abs(A-He)?s:A;let ve=l*i;const Ue=j+ve,ae=E===void 0?Ue:E(Ue);ae!==Ue&&(ve=ae-j);const J=He=>-ve*Math.exp(-He/d),se=He=>ae+J(He),oe=He=>{const ze=J(He),kt=se(He);G.done=Math.abs(ze)<=z,G.value=G.done?ae:kt};let Be,at;const Ye=He=>{re(G.value)&&(Be=He,at=OA({keyframes:[G.value,he(G.value)],velocity:FA(se,He,G.value),damping:g,stiffness:w,restDelta:z,restSpeed:V}))};return Ye(0),{calculatedDuration:null,next:He=>{let ze=!1;return!at&&Be===void 0&&(ze=!0,oe(He),Ye(He)),Be!==void 0&&He>Be?at.next(He-Be):(!ze&&oe(He),G)}}}const B3=t=>{const i=({timestamp:l})=>t(l);return{start:()=>Qn.update(i,!0),stop:()=>Ys(i),now:()=>li.isProcessing?li.timestamp:performance.now()}},C2=2e4;function A2(t){let i=0;const l=50;let d=t.next(i);for(;!d.done&&i<C2;)i+=l,d=t.next(i);return i>=C2?1/0:i}const F3={decay:S2,inertia:S2,tween:Mg,keyframes:Mg,spring:OA};function Pg({autoplay:t=!0,delay:i=0,driver:l=B3,keyframes:d,type:g="keyframes",repeat:w=0,repeatDelay:E=0,repeatType:s="loop",onPlay:A,onStop:z,onComplete:V,onUpdate:j,...G}){let re=1,he=!1,ve,Ue;const ae=()=>{ve&&ve(),Ue=new Promise(wt=>{ve=wt})};ae();let J;const se=F3[g]||Mg;let oe;se!==Mg&&typeof d[0]!="number"&&(oe=RA([0,100],d,{clamp:!1}),d=[0,100]);const Be=se({...G,keyframes:d});let at;s==="mirror"&&(at=se({...G,keyframes:[...d].reverse(),velocity:-(G.velocity||0)}));let Ye="idle",He=null,ze=null,kt=null;Be.calculatedDuration===null&&w&&(Be.calculatedDuration=A2(Be));const{calculatedDuration:dn}=Be;let gt=1/0,Jt=1/0;dn!==null&&(gt=dn+E,Jt=gt*(w+1)-E);let Sn=0;const un=wt=>{if(ze===null)return;re>0&&(ze=Math.min(ze,wt)),re<0&&(ze=Math.min(wt-Jt/re,ze)),He!==null?Sn=He:Sn=Math.round(wt-ze)*re;const nn=Sn-i*(re>=0?1:-1),fn=re>=0?nn<0:nn>Jt;Sn=Math.max(nn,0),Ye==="finished"&&He===null&&(Sn=Jt);let Qt=Sn,mi=Be;if(w){const cr=Sn/gt;let ur=Math.floor(cr),Lt=cr%1;!Lt&&cr>=1&&(Lt=1),Lt===1&&ur--,ur=Math.min(ur,w+1);const Rr=!!(ur%2);Rr&&(s==="reverse"?(Lt=1-Lt,E&&(Lt-=E/gt)):s==="mirror"&&(mi=at));let yi=Ka(0,1,Lt);Sn>Jt&&(yi=s==="reverse"&&Rr?1:0),Qt=yi*gt}const Un=fn?{done:!1,value:d[0]}:mi.next(Qt);oe&&(Un.value=oe(Un.value));let{done:gi}=Un;!fn&&dn!==null&&(gi=re>=0?Sn>=Jt:Sn<=0);const ji=He===null&&(Ye==="finished"||Ye==="running"&&gi);return j&&j(Un.value),ji&&Xe(),Un},Bn=()=>{J&&J.stop(),J=void 0},Xn=()=>{Ye="idle",Bn(),ae(),ze=kt=null},Xe=()=>{Ye="finished",V&&V(),Bn(),ae()},Mt=()=>{if(he)return;J||(J=l(un));const wt=J.now();A&&A(),He!==null?ze=wt-He:(!ze||Ye==="finished")&&(ze=wt),kt=ze,He=null,Ye="running",J.start()};t&&Mt();const Tt={then(wt,nn){return Ue.then(wt,nn)},get time(){return qs(Sn)},set time(wt){wt=Wa(wt),Sn=wt,He!==null||!J||re===0?He=wt:ze=J.now()-wt/re},get duration(){const wt=Be.calculatedDuration===null?A2(Be):Be.calculatedDuration;return qs(wt)},get speed(){return re},set speed(wt){wt===re||!J||(re=wt,Tt.time=qs(Sn))},get state(){return Ye},play:Mt,pause:()=>{Ye="paused",He=Sn},stop:()=>{he=!0,Ye!=="idle"&&(Ye="idle",z&&z(),Xn())},cancel:()=>{kt!==null&&un(kt),Xn()},complete:()=>{Ye="finished"},sample:wt=>(ze=0,un(wt))};return Tt}const O3=new Set(["opacity","clipPath","filter","transform","backgroundColor"]),Rm=10,U3=2e4,V3=(t,i)=>i.type==="spring"||t==="backgroundColor"||!pA(i.ease);function N3(t,i,{onUpdate:l,onComplete:d,...g}){if(!(_A.waapi()&&O3.has(i)&&!g.repeatDelay&&g.repeatType!=="mirror"&&g.damping!==0&&g.type!=="inertia"))return!1;let E=!1,s,A;const z=()=>{A=new Promise(ae=>{s=ae})};z();let{keyframes:V,duration:j=300,ease:G,times:re}=g;if(V3(i,g)){const ae=Pg({...g,repeat:0,delay:0});let J={done:!1,value:V[0]};const se=[];let oe=0;for(;!J.done&&oe<U3;)J=ae.sample(oe),se.push(J.value),oe+=Rm;re=void 0,V=se,j=oe-Rm,G="linear"}const he=QR(t.owner.current,i,V,{...g,duration:j,ease:G,times:re}),ve=()=>he.cancel(),Ue=()=>{Qn.update(ve),s(),z()};return he.onfinish=()=>{t.set(e3(V,g)),d&&d(),Ue()},{then(ae,J){return A.then(ae,J)},get time(){return qs(he.currentTime||0)},set time(ae){he.currentTime=Wa(ae)},get speed(){return he.playbackRate},set speed(ae){he.playbackRate=ae},get duration(){return qs(j)},play:()=>{E||(he.play(),Ys(ve))},pause:()=>he.pause(),stop:()=>{if(E=!0,he.playState==="idle")return;const{currentTime:ae}=he;if(ae){const J=Pg({...g,autoplay:!1});t.setWithVelocity(J.sample(ae-Rm).value,J.sample(ae).value,Rm)}Ue()},complete:()=>he.finish(),cancel:Ue}}function j3({keyframes:t,delay:i,onUpdate:l,onComplete:d}){const g=()=>(l&&l(t[t.length-1]),d&&d(),{time:0,speed:1,duration:0,play:Li,pause:Li,stop:Li,then:w=>(w(),Promise.resolve()),cancel:Li,complete:Li});return i?Pg({keyframes:[0,1],duration:0,delay:i,onComplete:g}):g()}const G3={type:"spring",stiffness:500,damping:25,restSpeed:10},$3=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),Z3={type:"keyframes",duration:.8},q3={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},W3=(t,{keyframes:i})=>i.length>2?Z3:dc.has(t)?t.startsWith("scale")?$3(i[1]):G3:q3,Dv=(t,i)=>t==="zIndex"?!1:!!(typeof i=="number"||Array.isArray(i)||typeof i=="string"&&(Ya.test(i)||i==="0")&&!i.startsWith("url(")),X3=new Set(["brightness","contrast","saturate","opacity"]);function H3(t){const[i,l]=t.slice(0,-1).split("(");if(i==="drop-shadow")return t;const[d]=l.match(r_)||[];if(!d)return t;const g=l.replace(d,"");let w=X3.has(i)?1:0;return d!==l&&(w*=100),i+"("+w+g+")"}const K3=/([a-z-]*)\(.*?\)/g,zv={...Ya,getAnimatableNone:t=>{const i=t.match(K3);return i?i.map(H3).join(" "):t}},Y3={...KC,color:pr,backgroundColor:pr,outlineColor:pr,fill:pr,stroke:pr,borderColor:pr,borderTopColor:pr,borderRightColor:pr,borderBottomColor:pr,borderLeftColor:pr,filter:zv,WebkitFilter:zv},n1=t=>Y3[t];function UA(t,i){let l=n1(t);return l!==zv&&(l=Ya),l.getAnimatableNone?l.getAnimatableNone(i):void 0}const VA=t=>/^0[^.\s]+$/.test(t);function J3(t){if(typeof t=="number")return t===0;if(t!==null)return t==="none"||t==="0"||VA(t)}function Q3(t,i,l,d){const g=Dv(i,l);let w;Array.isArray(l)?w=[...l]:w=[null,l];const E=d.from!==void 0?d.from:t.get();let s;const A=[];for(let z=0;z<w.length;z++)w[z]===null&&(w[z]=z===0?E:w[z-1]),J3(w[z])&&A.push(z),typeof w[z]=="string"&&w[z]!=="none"&&w[z]!=="0"&&(s=w[z]);if(g&&A.length&&s)for(let z=0;z<A.length;z++){const V=A[z];w[V]=UA(i,s)}return w}function eB({when:t,delay:i,delayChildren:l,staggerChildren:d,staggerDirection:g,repeat:w,repeatType:E,repeatDelay:s,from:A,elapsed:z,...V}){return!!Object.keys(V).length}function NA(t,i){return t[i]||t.default||t}const i1=(t,i,l,d={})=>g=>{const w=NA(d,t)||{},E=w.delay||d.delay||0;let{elapsed:s=0}=d;s=s-Wa(E);const A=Q3(i,t,l,w),z=A[0],V=A[A.length-1],j=Dv(t,z),G=Dv(t,V);let re={keyframes:A,velocity:i.getVelocity(),ease:"easeOut",...w,delay:-s,onUpdate:he=>{i.set(he),w.onUpdate&&w.onUpdate(he)},onComplete:()=>{g(),w.onComplete&&w.onComplete()}};if(eB(w)||(re={...re,...W3(t,re)}),re.duration&&(re.duration=Wa(re.duration)),re.repeatDelay&&(re.repeatDelay=Wa(re.repeatDelay)),!j||!G||JR.current||w.type===!1)return j3(re);if(i.owner&&i.owner.current instanceof HTMLElement&&!i.owner.getProps().onUpdate){const he=N3(i,t,re);if(he)return he}return Pg(re)};function Ig(t){return!!(Lr(t)&&t.add)}const tB=t=>/^\-?\d*\.?\d+$/.test(t);function r1(t,i){t.indexOf(i)===-1&&t.push(i)}function o1(t,i){const l=t.indexOf(i);l>-1&&t.splice(l,1)}class s1{constructor(){this.subscriptions=[]}add(i){return r1(this.subscriptions,i),()=>o1(this.subscriptions,i)}notify(i,l,d){const g=this.subscriptions.length;if(g)if(g===1)this.subscriptions[0](i,l,d);else for(let w=0;w<g;w++){const E=this.subscriptions[w];E&&E(i,l,d)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const nB=t=>!isNaN(parseFloat(t));class iB{constructor(i,l={}){this.version="10.12.18",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(d,g=!0)=>{this.prev=this.current,this.current=d;const{delta:w,timestamp:E}=li;this.lastUpdated!==E&&(this.timeDelta=w,this.lastUpdated=E,Qn.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),g&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>Qn.postRender(this.velocityCheck),this.velocityCheck=({timestamp:d})=>{d!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=i,this.canTrackVelocity=nB(this.current),this.owner=l.owner}onChange(i){return this.on("change",i)}on(i,l){this.events[i]||(this.events[i]=new s1);const d=this.events[i].add(l);return i==="change"?()=>{d(),Qn.read(()=>{this.events.change.getSize()||this.stop()})}:d}clearListeners(){for(const i in this.events)this.events[i].clear()}attach(i,l){this.passiveEffect=i,this.stopPassiveEffect=l}set(i,l=!0){!l||!this.passiveEffect?this.updateAndNotify(i,l):this.passiveEffect(i,this.updateAndNotify)}setWithVelocity(i,l,d){this.set(l),this.prev=i,this.timeDelta=d}jump(i){this.updateAndNotify(i),this.prev=i,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?BA(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(i){return this.stop(),new Promise(l=>{this.hasAnimated=!0,this.animation=i(l),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Xu(t,i){return new iB(t,i)}const jA=t=>i=>i.test(t),rB={test:t=>t==="auto",parse:t=>t},GA=[fc,Gt,gs,Ia,uR,cR,rB],Gd=t=>GA.find(jA(t)),oB=[...GA,pr,Ya],sB=t=>oB.find(jA(t));function aB(t,i,l){t.hasValue(i)?t.getValue(i).set(l):t.addValue(i,Xu(l))}function lB(t,i){const l=a_(t,i);let{transitionEnd:d={},transition:g={},...w}=l?t.makeTargetAnimatable(l,!1):{};w={...w,...d};for(const E in w){const s=ER(w[E]);aB(t,E,s)}}function cB(t,i,l){var d,g;const w=Object.keys(i).filter(s=>!t.hasValue(s)),E=w.length;if(E)for(let s=0;s<E;s++){const A=w[s],z=i[A];let V=null;Array.isArray(z)&&(V=z[0]),V===null&&(V=(g=(d=l[A])!==null&&d!==void 0?d:t.readValue(A))!==null&&g!==void 0?g:i[A]),V!=null&&(typeof V=="string"&&(tB(V)||VA(V))?V=parseFloat(V):!sB(V)&&Ya.test(z)&&(V=UA(A,z)),t.addValue(A,Xu(V,{owner:t})),l[A]===void 0&&(l[A]=V),V!==null&&t.setBaseTarget(A,V))}}function uB(t,i){return i?(i[t]||i.default||i).from:void 0}function hB(t,i,l){const d={};for(const g in t){const w=uB(g,i);if(w!==void 0)d[g]=w;else{const E=l.getValue(g);E&&(d[g]=E.get())}}return d}function dB({protectedKeys:t,needsAnimating:i},l){const d=t.hasOwnProperty(l)&&i[l]!==!0;return i[l]=!1,d}function $A(t,i,{delay:l=0,transitionOverride:d,type:g}={}){let{transition:w=t.getDefaultTransition(),transitionEnd:E,...s}=t.makeTargetAnimatable(i);const A=t.getValue("willChange");d&&(w=d);const z=[],V=g&&t.animationState&&t.animationState.getState()[g];for(const j in s){const G=t.getValue(j),re=s[j];if(!G||re===void 0||V&&dB(V,j))continue;const he={delay:l,elapsed:0,...w};if(window.HandoffAppearAnimations&&!G.hasAnimated){const Ue=t.getProps()[KR];Ue&&(he.elapsed=window.HandoffAppearAnimations(Ue,j,G,Qn))}G.start(i1(j,G,re,t.shouldReduceMotion&&dc.has(j)?{type:!1}:he));const ve=G.animation;Ig(A)&&(A.add(j),ve.then(()=>A.remove(j))),z.push(ve)}return E&&Promise.all(z).then(()=>{E&&lB(t,E)}),z}function Lv(t,i,l={}){const d=a_(t,i,l.custom);let{transition:g=t.getDefaultTransition()||{}}=d||{};l.transitionOverride&&(g=l.transitionOverride);const w=d?()=>Promise.all($A(t,d,l)):()=>Promise.resolve(),E=t.variantChildren&&t.variantChildren.size?(A=0)=>{const{delayChildren:z=0,staggerChildren:V,staggerDirection:j}=g;return fB(t,i,z+A,V,j,l)}:()=>Promise.resolve(),{when:s}=g;if(s){const[A,z]=s==="beforeChildren"?[w,E]:[E,w];return A().then(()=>z())}else return Promise.all([w(),E(l.delay)])}function fB(t,i,l=0,d=0,g=1,w){const E=[],s=(t.variantChildren.size-1)*d,A=g===1?(z=0)=>z*d:(z=0)=>s-z*d;return Array.from(t.variantChildren).sort(pB).forEach((z,V)=>{z.notify("AnimationStart",i),E.push(Lv(z,i,{...w,delay:l+A(V)}).then(()=>z.notify("AnimationComplete",i)))}),Promise.all(E)}function pB(t,i){return t.sortNodePosition(i)}function mB(t,i,l={}){t.notify("AnimationStart",i);let d;if(Array.isArray(i)){const g=i.map(w=>Lv(t,w,l));d=Promise.all(g)}else if(typeof i=="string")d=Lv(t,i,l);else{const g=typeof i=="function"?a_(t,i,l.custom):i;d=Promise.all($A(t,g,l))}return d.then(()=>t.notify("AnimationComplete",i))}const gB=[...Nx].reverse(),_B=Nx.length;function yB(t){return i=>Promise.all(i.map(({animation:l,options:d})=>mB(t,l,d)))}function vB(t){let i=yB(t);const l=wB();let d=!0;const g=(A,z)=>{const V=a_(t,z);if(V){const{transition:j,transitionEnd:G,...re}=V;A={...A,...re,...G}}return A};function w(A){i=A(t)}function E(A,z){const V=t.getProps(),j=t.getVariantContext(!0)||{},G=[],re=new Set;let he={},ve=1/0;for(let ae=0;ae<_B;ae++){const J=gB[ae],se=l[J],oe=V[J]!==void 0?V[J]:j[J],Be=If(oe),at=J===z?se.isActive:null;at===!1&&(ve=ae);let Ye=oe===j[J]&&oe!==V[J]&&Be;if(Ye&&d&&t.manuallyAnimateOnMount&&(Ye=!1),se.protectedKeys={...he},!se.isActive&&at===null||!oe&&!se.prevProp||n_(oe)||typeof oe=="boolean")continue;const He=xB(se.prevProp,oe);let ze=He||J===z&&se.isActive&&!Ye&&Be||ae>ve&&Be;const kt=Array.isArray(oe)?oe:[oe];let dn=kt.reduce(g,{});at===!1&&(dn={});const{prevResolvedValues:gt={}}=se,Jt={...gt,...dn},Sn=un=>{ze=!0,re.delete(un),se.needsAnimating[un]=!0};for(const un in Jt){const Bn=dn[un],Xn=gt[un];he.hasOwnProperty(un)||(Bn!==Xn?Cg(Bn)&&Cg(Xn)?!dA(Bn,Xn)||He?Sn(un):se.protectedKeys[un]=!0:Bn!==void 0?Sn(un):re.add(un):Bn!==void 0&&re.has(un)?Sn(un):se.protectedKeys[un]=!0)}se.prevProp=oe,se.prevResolvedValues=dn,se.isActive&&(he={...he,...dn}),d&&t.blockInitialAnimation&&(ze=!1),ze&&!Ye&&G.push(...kt.map(un=>({animation:un,options:{type:J,...A}})))}if(re.size){const ae={};re.forEach(J=>{const se=t.getBaseTarget(J);se!==void 0&&(ae[J]=se)}),G.push({animation:ae})}let Ue=!!G.length;return d&&V.initial===!1&&!t.manuallyAnimateOnMount&&(Ue=!1),d=!1,Ue?i(G):Promise.resolve()}function s(A,z,V){var j;if(l[A].isActive===z)return Promise.resolve();(j=t.variantChildren)===null||j===void 0||j.forEach(re=>{var he;return(he=re.animationState)===null||he===void 0?void 0:he.setActive(A,z)}),l[A].isActive=z;const G=E(V,A);for(const re in l)l[re].protectedKeys={};return G}return{animateChanges:E,setActive:s,setAnimateFunction:w,getState:()=>l}}function xB(t,i){return typeof i=="string"?i!==t:Array.isArray(i)?!dA(i,t):!1}function Gl(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function wB(){return{animate:Gl(!0),whileInView:Gl(),whileHover:Gl(),whileTap:Gl(),whileDrag:Gl(),whileFocus:Gl(),exit:Gl()}}class bB extends tl{constructor(i){super(i),i.animationState||(i.animationState=vB(i))}updateAnimationControlsSubscription(){const{animate:i}=this.node.getProps();this.unmount(),n_(i)&&(this.unmount=i.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:i}=this.node.getProps(),{animate:l}=this.node.prevProps||{};i!==l&&this.updateAnimationControlsSubscription()}unmount(){}}let TB=0;class EB extends tl{constructor(){super(...arguments),this.id=TB++}update(){if(!this.node.presenceContext)return;const{isPresent:i,onExitComplete:l,custom:d}=this.node.presenceContext,{isPresent:g}=this.node.prevPresenceContext||{};if(!this.node.animationState||i===g)return;const w=this.node.animationState.setActive("exit",!i,{custom:d??this.node.getProps().custom});l&&!i&&w.then(()=>l(this.id))}mount(){const{register:i}=this.node.presenceContext||{};i&&(this.unmount=i(this.id))}unmount(){}}const SB={animation:{Feature:bB},exit:{Feature:EB}},M2=(t,i)=>Math.abs(t-i);function CB(t,i){const l=M2(t.x,i.x),d=M2(t.y,i.y);return Math.sqrt(l**2+d**2)}class ZA{constructor(i,l,{transformPagePoint:d}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const z=E0(this.lastMoveEventInfo,this.history),V=this.startEvent!==null,j=CB(z.offset,{x:0,y:0})>=3;if(!V&&!j)return;const{point:G}=z,{timestamp:re}=li;this.history.push({...G,timestamp:re});const{onStart:he,onMove:ve}=this.handlers;V||(he&&he(this.lastMoveEvent,z),this.startEvent=this.lastMoveEvent),ve&&ve(this.lastMoveEvent,z)},this.handlePointerMove=(z,V)=>{this.lastMoveEvent=z,this.lastMoveEventInfo=T0(V,this.transformPagePoint),Qn.update(this.updatePoint,!0)},this.handlePointerUp=(z,V)=>{if(this.end(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const{onEnd:j,onSessionEnd:G}=this.handlers,re=E0(z.type==="pointercancel"?this.lastMoveEventInfo:T0(V,this.transformPagePoint),this.history);this.startEvent&&j&&j(z,re),G&&G(z,re)},!sA(i))return;this.handlers=l,this.transformPagePoint=d;const g=o_(i),w=T0(g,this.transformPagePoint),{point:E}=w,{timestamp:s}=li;this.history=[{...E,timestamp:s}];const{onSessionStart:A}=l;A&&A(i,E0(w,this.history)),this.removeListeners=qa(Zs(window,"pointermove",this.handlePointerMove),Zs(window,"pointerup",this.handlePointerUp),Zs(window,"pointercancel",this.handlePointerUp))}updateHandlers(i){this.handlers=i}end(){this.removeListeners&&this.removeListeners(),Ys(this.updatePoint)}}function T0(t,i){return i?{point:i(t.point)}:t}function P2(t,i){return{x:t.x-i.x,y:t.y-i.y}}function E0({point:t},i){return{point:t,delta:P2(t,qA(i)),offset:P2(t,AB(i)),velocity:MB(i,.1)}}function AB(t){return t[0]}function qA(t){return t[t.length-1]}function MB(t,i){if(t.length<2)return{x:0,y:0};let l=t.length-1,d=null;const g=qA(t);for(;l>=0&&(d=t[l],!(g.timestamp-d.timestamp>Wa(i)));)l--;if(!d)return{x:0,y:0};const w=qs(g.timestamp-d.timestamp);if(w===0)return{x:0,y:0};const E={x:(g.x-d.x)/w,y:(g.y-d.y)/w};return E.x===1/0&&(E.x=0),E.y===1/0&&(E.y=0),E}function Wr(t){return t.max-t.min}function Rv(t,i=0,l=.01){return Math.abs(t-i)<=l}function I2(t,i,l,d=.5){t.origin=d,t.originPoint=ui(i.min,i.max,t.origin),t.scale=Wr(l)/Wr(i),(Rv(t.scale,1,1e-4)||isNaN(t.scale))&&(t.scale=1),t.translate=ui(l.min,l.max,t.origin)-t.originPoint,(Rv(t.translate)||isNaN(t.translate))&&(t.translate=0)}function cf(t,i,l,d){I2(t.x,i.x,l.x,d?d.originX:void 0),I2(t.y,i.y,l.y,d?d.originY:void 0)}function k2(t,i,l){t.min=l.min+i.min,t.max=t.min+Wr(i)}function PB(t,i,l){k2(t.x,i.x,l.x),k2(t.y,i.y,l.y)}function D2(t,i,l){t.min=i.min-l.min,t.max=t.min+Wr(i)}function uf(t,i,l){D2(t.x,i.x,l.x),D2(t.y,i.y,l.y)}function IB(t,{min:i,max:l},d){return i!==void 0&&t<i?t=d?ui(i,t,d.min):Math.max(t,i):l!==void 0&&t>l&&(t=d?ui(l,t,d.max):Math.min(t,l)),t}function z2(t,i,l){return{min:i!==void 0?t.min+i:void 0,max:l!==void 0?t.max+l-(t.max-t.min):void 0}}function kB(t,{top:i,left:l,bottom:d,right:g}){return{x:z2(t.x,l,g),y:z2(t.y,i,d)}}function L2(t,i){let l=i.min-t.min,d=i.max-t.max;return i.max-i.min<t.max-t.min&&([l,d]=[d,l]),{min:l,max:d}}function DB(t,i){return{x:L2(t.x,i.x),y:L2(t.y,i.y)}}function zB(t,i){let l=.5;const d=Wr(t),g=Wr(i);return g>d?l=zf(i.min,i.max-d,t.min):d>g&&(l=zf(t.min,t.max-g,i.min)),Ka(0,1,l)}function LB(t,i){const l={};return i.min!==void 0&&(l.min=i.min-t.min),i.max!==void 0&&(l.max=i.max-t.min),l}const Bv=.35;function RB(t=Bv){return t===!1?t=0:t===!0&&(t=Bv),{x:R2(t,"left","right"),y:R2(t,"top","bottom")}}function R2(t,i,l){return{min:B2(t,i),max:B2(t,l)}}function B2(t,i){return typeof t=="number"?t:t[i]||0}const F2=()=>({translate:0,scale:1,origin:0,originPoint:0}),Pu=()=>({x:F2(),y:F2()}),O2=()=>({min:0,max:0}),Si=()=>({x:O2(),y:O2()});function ds(t){return[t("x"),t("y")]}function WA({top:t,left:i,right:l,bottom:d}){return{x:{min:i,max:l},y:{min:t,max:d}}}function BB({x:t,y:i}){return{top:i.min,right:t.max,bottom:i.max,left:t.min}}function FB(t,i){if(!i)return t;const l=i({x:t.left,y:t.top}),d=i({x:t.right,y:t.bottom});return{top:l.y,left:l.x,bottom:d.y,right:d.x}}function S0(t){return t===void 0||t===1}function Fv({scale:t,scaleX:i,scaleY:l}){return!S0(t)||!S0(i)||!S0(l)}function ql(t){return Fv(t)||XA(t)||t.z||t.rotate||t.rotateX||t.rotateY}function XA(t){return U2(t.x)||U2(t.y)}function U2(t){return t&&t!=="0%"}function kg(t,i,l){const d=t-l,g=i*d;return l+g}function V2(t,i,l,d,g){return g!==void 0&&(t=kg(t,g,d)),kg(t,l,d)+i}function Ov(t,i=0,l=1,d,g){t.min=V2(t.min,i,l,d,g),t.max=V2(t.max,i,l,d,g)}function HA(t,{x:i,y:l}){Ov(t.x,i.translate,i.scale,i.originPoint),Ov(t.y,l.translate,l.scale,l.originPoint)}function OB(t,i,l,d=!1){const g=l.length;if(!g)return;i.x=i.y=1;let w,E;for(let s=0;s<g;s++){w=l[s],E=w.projectionDelta;const A=w.instance;A&&A.style&&A.style.display==="contents"||(d&&w.options.layoutScroll&&w.scroll&&w!==w.root&&Iu(t,{x:-w.scroll.offset.x,y:-w.scroll.offset.y}),E&&(i.x*=E.x.scale,i.y*=E.y.scale,HA(t,E)),d&&ql(w.latestValues)&&Iu(t,w.latestValues))}i.x=N2(i.x),i.y=N2(i.y)}function N2(t){return Number.isInteger(t)||t>1.0000000000001||t<.999999999999?t:1}function za(t,i){t.min=t.min+i,t.max=t.max+i}function j2(t,i,[l,d,g]){const w=i[g]!==void 0?i[g]:.5,E=ui(t.min,t.max,w);Ov(t,i[l],i[d],E,i.scale)}const UB=["x","scaleX","originX"],VB=["y","scaleY","originY"];function Iu(t,i){j2(t.x,i,UB),j2(t.y,i,VB)}function KA(t,i){return WA(FB(t.getBoundingClientRect(),i))}function NB(t,i,l){const d=KA(t,l),{scroll:g}=i;return g&&(za(d.x,g.offset.x),za(d.y,g.offset.y)),d}const jB=new WeakMap;class GB{constructor(i){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Si(),this.visualElement=i}start(i,{snapToCursor:l=!1}={}){const{presenceContext:d}=this.visualElement;if(d&&d.isPresent===!1)return;const g=A=>{this.stopAnimation(),l&&this.snapToCursor(o_(A,"page").point)},w=(A,z)=>{const{drag:V,dragPropagation:j,onDragStart:G}=this.getProps();if(V&&!j&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=lA(V),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),ds(he=>{let ve=this.getAxisMotionValue(he).get()||0;if(gs.test(ve)){const{projection:Ue}=this.visualElement;if(Ue&&Ue.layout){const ae=Ue.layout.layoutBox[he];ae&&(ve=Wr(ae)*(parseFloat(ve)/100))}}this.originPoint[he]=ve}),G&&Qn.update(()=>G(A,z),!1,!0);const{animationState:re}=this.visualElement;re&&re.setActive("whileDrag",!0)},E=(A,z)=>{const{dragPropagation:V,dragDirectionLock:j,onDirectionLock:G,onDrag:re}=this.getProps();if(!V&&!this.openGlobalLock)return;const{offset:he}=z;if(j&&this.currentDirection===null){this.currentDirection=$B(he),this.currentDirection!==null&&G&&G(this.currentDirection);return}this.updateAxis("x",z.point,he),this.updateAxis("y",z.point,he),this.visualElement.render(),re&&re(A,z)},s=(A,z)=>this.stop(A,z);this.panSession=new ZA(i,{onSessionStart:g,onStart:w,onMove:E,onSessionEnd:s},{transformPagePoint:this.visualElement.getTransformPagePoint()})}stop(i,l){const d=this.isDragging;if(this.cancel(),!d)return;const{velocity:g}=l;this.startAnimation(g);const{onDragEnd:w}=this.getProps();w&&Qn.update(()=>w(i,l))}cancel(){this.isDragging=!1;const{projection:i,animationState:l}=this.visualElement;i&&(i.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:d}=this.getProps();!d&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),l&&l.setActive("whileDrag",!1)}updateAxis(i,l,d){const{drag:g}=this.getProps();if(!d||!Bm(i,g,this.currentDirection))return;const w=this.getAxisMotionValue(i);let E=this.originPoint[i]+d[i];this.constraints&&this.constraints[i]&&(E=IB(E,this.constraints[i],this.elastic[i])),w.set(E)}resolveConstraints(){const{dragConstraints:i,dragElastic:l}=this.getProps(),{layout:d}=this.visualElement.projection||{},g=this.constraints;i&&Au(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&d?this.constraints=kB(d.layoutBox,i):this.constraints=!1,this.elastic=RB(l),g!==this.constraints&&d&&this.constraints&&!this.hasMutatedConstraints&&ds(w=>{this.getAxisMotionValue(w)&&(this.constraints[w]=LB(d.layoutBox[w],this.constraints[w]))})}resolveRefConstraints(){const{dragConstraints:i,onMeasureDragConstraints:l}=this.getProps();if(!i||!Au(i))return!1;const d=i.current,{projection:g}=this.visualElement;if(!g||!g.layout)return!1;const w=NB(d,g.root,this.visualElement.getTransformPagePoint());let E=DB(g.layout.layoutBox,w);if(l){const s=l(BB(E));this.hasMutatedConstraints=!!s,s&&(E=WA(s))}return E}startAnimation(i){const{drag:l,dragMomentum:d,dragElastic:g,dragTransition:w,dragSnapToOrigin:E,onDragTransitionEnd:s}=this.getProps(),A=this.constraints||{},z=ds(V=>{if(!Bm(V,l,this.currentDirection))return;let j=A&&A[V]||{};E&&(j={min:0,max:0});const G=g?200:1e6,re=g?40:1e7,he={type:"inertia",velocity:d?i[V]:0,bounceStiffness:G,bounceDamping:re,timeConstant:750,restDelta:1,restSpeed:10,...w,...j};return this.startAxisValueAnimation(V,he)});return Promise.all(z).then(s)}startAxisValueAnimation(i,l){const d=this.getAxisMotionValue(i);return d.start(i1(i,d,0,l))}stopAnimation(){ds(i=>this.getAxisMotionValue(i).stop())}getAxisMotionValue(i){const l="_drag"+i.toUpperCase(),d=this.visualElement.getProps(),g=d[l];return g||this.visualElement.getValue(i,(d.initial?d.initial[i]:void 0)||0)}snapToCursor(i){ds(l=>{const{drag:d}=this.getProps();if(!Bm(l,d,this.currentDirection))return;const{projection:g}=this.visualElement,w=this.getAxisMotionValue(l);if(g&&g.layout){const{min:E,max:s}=g.layout.layoutBox[l];w.set(i[l]-ui(E,s,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:i,dragConstraints:l}=this.getProps(),{projection:d}=this.visualElement;if(!Au(l)||!d||!this.constraints)return;this.stopAnimation();const g={x:0,y:0};ds(E=>{const s=this.getAxisMotionValue(E);if(s){const A=s.get();g[E]=zB({min:A,max:A},this.constraints[E])}});const{transformTemplate:w}=this.visualElement.getProps();this.visualElement.current.style.transform=w?w({},""):"none",d.root&&d.root.updateScroll(),d.updateLayout(),this.resolveConstraints(),ds(E=>{if(!Bm(E,i,null))return;const s=this.getAxisMotionValue(E),{min:A,max:z}=this.constraints[E];s.set(ui(A,z,g[E]))})}addListeners(){if(!this.visualElement.current)return;jB.set(this.visualElement,this);const i=this.visualElement.current,l=Zs(i,"pointerdown",A=>{const{drag:z,dragListener:V=!0}=this.getProps();z&&V&&this.start(A)}),d=()=>{const{dragConstraints:A}=this.getProps();Au(A)&&(this.constraints=this.resolveRefConstraints())},{projection:g}=this.visualElement,w=g.addEventListener("measure",d);g&&!g.layout&&(g.root&&g.root.updateScroll(),g.updateLayout()),d();const E=js(window,"resize",()=>this.scalePositionWithinConstraints()),s=g.addEventListener("didUpdate",({delta:A,hasLayoutChanged:z})=>{this.isDragging&&z&&(ds(V=>{const j=this.getAxisMotionValue(V);j&&(this.originPoint[V]+=A[V].translate,j.set(j.get()+A[V].translate))}),this.visualElement.render())});return()=>{E(),l(),w(),s&&s()}}getProps(){const i=this.visualElement.getProps(),{drag:l=!1,dragDirectionLock:d=!1,dragPropagation:g=!1,dragConstraints:w=!1,dragElastic:E=Bv,dragMomentum:s=!0}=i;return{...i,drag:l,dragDirectionLock:d,dragPropagation:g,dragConstraints:w,dragElastic:E,dragMomentum:s}}}function Bm(t,i,l){return(i===!0||i===t)&&(l===null||l===t)}function $B(t,i=10){let l=null;return Math.abs(t.y)>i?l="y":Math.abs(t.x)>i&&(l="x"),l}class ZB extends tl{constructor(i){super(i),this.removeGroupControls=Li,this.removeListeners=Li,this.controls=new GB(i)}mount(){const{dragControls:i}=this.node.getProps();i&&(this.removeGroupControls=i.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Li}unmount(){this.removeGroupControls(),this.removeListeners()}}const G2=t=>(i,l)=>{t&&Qn.update(()=>t(i,l))};class qB extends tl{constructor(){super(...arguments),this.removePointerDownListener=Li}onPointerDown(i){this.session=new ZA(i,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint()})}createPanHandlers(){const{onPanSessionStart:i,onPanStart:l,onPan:d,onPanEnd:g}=this.node.getProps();return{onSessionStart:G2(i),onStart:G2(l),onMove:d,onEnd:(w,E)=>{delete this.session,g&&Qn.update(()=>g(w,E))}}}mount(){this.removePointerDownListener=Zs(this.node.current,"pointerdown",i=>this.onPointerDown(i))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function WB(){const t=De.useContext(e_);if(t===null)return[!0,null];const{isPresent:i,onExitComplete:l,register:d}=t,g=De.useId();return De.useEffect(()=>d(g),[]),!i&&l?[!1,()=>l&&l(g)]:[!0]}const Ym={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function $2(t,i){return i.max===i.min?0:t/(i.max-i.min)*100}const $d={correct:(t,i)=>{if(!i.target)return t;if(typeof t=="string")if(Gt.test(t))t=parseFloat(t);else return t;const l=$2(t,i.target.x),d=$2(t,i.target.y);return`${l}% ${d}%`}},XB={correct:(t,{treeScale:i,projectionDelta:l})=>{const d=t,g=Ya.parse(t);if(g.length>5)return d;const w=Ya.createTransformer(t),E=typeof g[0]!="number"?1:0,s=l.x.scale*i.x,A=l.y.scale*i.y;g[0+E]/=s,g[1+E]/=A;const z=ui(s,A,.5);return typeof g[2+E]=="number"&&(g[2+E]/=z),typeof g[3+E]=="number"&&(g[3+E]/=z),w(g)}};class HB extends zg.Component{componentDidMount(){const{visualElement:i,layoutGroup:l,switchLayoutGroup:d,layoutId:g}=this.props,{projection:w}=i;nR(KB),w&&(l.group&&l.group.add(w),d&&d.register&&g&&d.register(w),w.root.didUpdate(),w.addEventListener("animationComplete",()=>{this.safeToRemove()}),w.setOptions({...w.options,onExitComplete:()=>this.safeToRemove()})),Ym.hasEverUpdated=!0}getSnapshotBeforeUpdate(i){const{layoutDependency:l,visualElement:d,drag:g,isPresent:w}=this.props,E=d.projection;return E&&(E.isPresent=w,g||i.layoutDependency!==l||l===void 0?E.willUpdate():this.safeToRemove(),i.isPresent!==w&&(w?E.promote():E.relegate()||Qn.postRender(()=>{const s=E.getStack();(!s||!s.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:i}=this.props.visualElement;i&&(i.root.didUpdate(),queueMicrotask(()=>{!i.currentAnimation&&i.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:i,layoutGroup:l,switchLayoutGroup:d}=this.props,{projection:g}=i;g&&(g.scheduleCheckAfterUnmount(),l&&l.group&&l.group.remove(g),d&&d.deregister&&d.deregister(g))}safeToRemove(){const{safeToRemove:i}=this.props;i&&i()}render(){return null}}function YA(t){const[i,l]=WB(),d=De.useContext(Gx);return zg.createElement(HB,{...t,layoutGroup:d,switchLayoutGroup:De.useContext(ZC),isPresent:i,safeToRemove:l})}const KB={borderRadius:{...$d,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:$d,borderTopRightRadius:$d,borderBottomLeftRadius:$d,borderBottomRightRadius:$d,boxShadow:XB},JA=["TopLeft","TopRight","BottomLeft","BottomRight"],YB=JA.length,Z2=t=>typeof t=="string"?parseFloat(t):t,q2=t=>typeof t=="number"||Gt.test(t);function JB(t,i,l,d,g,w){g?(t.opacity=ui(0,l.opacity!==void 0?l.opacity:1,QB(d)),t.opacityExit=ui(i.opacity!==void 0?i.opacity:1,0,eF(d))):w&&(t.opacity=ui(i.opacity!==void 0?i.opacity:1,l.opacity!==void 0?l.opacity:1,d));for(let E=0;E<YB;E++){const s=`border${JA[E]}Radius`;let A=W2(i,s),z=W2(l,s);if(A===void 0&&z===void 0)continue;A||(A=0),z||(z=0),A===0||z===0||q2(A)===q2(z)?(t[s]=Math.max(ui(Z2(A),Z2(z),d),0),(gs.test(z)||gs.test(A))&&(t[s]+="%")):t[s]=z}(i.rotate||l.rotate)&&(t.rotate=ui(i.rotate||0,l.rotate||0,d))}function W2(t,i){return t[i]!==void 0?t[i]:t.borderRadius}const QB=QA(0,.5,Qx),eF=QA(.5,.95,Li);function QA(t,i,l){return d=>d<t?0:d>i?1:l(zf(t,i,d))}function X2(t,i){t.min=i.min,t.max=i.max}function ao(t,i){X2(t.x,i.x),X2(t.y,i.y)}function H2(t,i,l,d,g){return t-=i,t=kg(t,1/l,d),g!==void 0&&(t=kg(t,1/g,d)),t}function tF(t,i=0,l=1,d=.5,g,w=t,E=t){if(gs.test(i)&&(i=parseFloat(i),i=ui(E.min,E.max,i/100)-E.min),typeof i!="number")return;let s=ui(w.min,w.max,d);t===w&&(s-=i),t.min=H2(t.min,i,l,s,g),t.max=H2(t.max,i,l,s,g)}function K2(t,i,[l,d,g],w,E){tF(t,i[l],i[d],i[g],i.scale,w,E)}const nF=["x","scaleX","originX"],iF=["y","scaleY","originY"];function Y2(t,i,l,d){K2(t.x,i,nF,l?l.x:void 0,d?d.x:void 0),K2(t.y,i,iF,l?l.y:void 0,d?d.y:void 0)}function J2(t){return t.translate===0&&t.scale===1}function eM(t){return J2(t.x)&&J2(t.y)}function Uv(t,i){return t.x.min===i.x.min&&t.x.max===i.x.max&&t.y.min===i.y.min&&t.y.max===i.y.max}function Q2(t){return Wr(t.x)/Wr(t.y)}class rF{constructor(){this.members=[]}add(i){r1(this.members,i),i.scheduleRender()}remove(i){if(o1(this.members,i),i===this.prevLead&&(this.prevLead=void 0),i===this.lead){const l=this.members[this.members.length-1];l&&this.promote(l)}}relegate(i){const l=this.members.findIndex(g=>i===g);if(l===0)return!1;let d;for(let g=l;g>=0;g--){const w=this.members[g];if(w.isPresent!==!1){d=w;break}}return d?(this.promote(d),!0):!1}promote(i,l){const d=this.lead;if(i!==d&&(this.prevLead=d,this.lead=i,i.show(),d)){d.instance&&d.scheduleRender(),i.scheduleRender(),i.resumeFrom=d,l&&(i.resumeFrom.preserveOpacity=!0),d.snapshot&&(i.snapshot=d.snapshot,i.snapshot.latestValues=d.animationValues||d.latestValues),i.root&&i.root.isUpdating&&(i.isLayoutDirty=!0);const{crossfade:g}=i.options;g===!1&&d.hide()}}exitAnimationComplete(){this.members.forEach(i=>{const{options:l,resumingFrom:d}=i;l.onExitComplete&&l.onExitComplete(),d&&d.options.onExitComplete&&d.options.onExitComplete()})}scheduleRender(){this.members.forEach(i=>{i.instance&&i.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function eE(t,i,l){let d="";const g=t.x.translate/i.x,w=t.y.translate/i.y;if((g||w)&&(d=`translate3d(${g}px, ${w}px, 0) `),(i.x!==1||i.y!==1)&&(d+=`scale(${1/i.x}, ${1/i.y}) `),l){const{rotate:A,rotateX:z,rotateY:V}=l;A&&(d+=`rotate(${A}deg) `),z&&(d+=`rotateX(${z}deg) `),V&&(d+=`rotateY(${V}deg) `)}const E=t.x.scale*i.x,s=t.y.scale*i.y;return(E!==1||s!==1)&&(d+=`scale(${E}, ${s})`),d||"none"}const oF=(t,i)=>t.depth-i.depth;class sF{constructor(){this.children=[],this.isDirty=!1}add(i){r1(this.children,i),this.isDirty=!0}remove(i){o1(this.children,i),this.isDirty=!0}forEach(i){this.isDirty&&this.children.sort(oF),this.isDirty=!1,this.children.forEach(i)}}function aF(t,i){const l=performance.now(),d=({timestamp:g})=>{const w=g-l;w>=i&&(Ys(d),t(w-i))};return Qn.read(d,!0),()=>Ys(d)}function lF(t){window.MotionDebug&&window.MotionDebug.record(t)}function cF(t){return t instanceof SVGElement&&t.tagName!=="svg"}function uF(t,i,l){const d=Lr(t)?t:Xu(t);return d.start(i1("",d,i,l)),d.animation}const tE=["","X","Y","Z"],nE=1e3;let hF=0;const Wl={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function tM({attachResizeListener:t,defaultParent:i,measureScroll:l,checkIsScrollRoot:d,resetTransform:g}){return class{constructor(E={},s=i==null?void 0:i()){this.id=hF++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{Wl.totalNodes=Wl.resolvedTargetDeltas=Wl.recalculatedProjection=0,this.nodes.forEach(pF),this.nodes.forEach(vF),this.nodes.forEach(xF),this.nodes.forEach(mF),lF(Wl)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=E,this.root=s?s.root||s:this,this.path=s?[...s.path,s]:[],this.parent=s,this.depth=s?s.depth+1:0;for(let A=0;A<this.path.length;A++)this.path[A].shouldResetTransform=!0;this.root===this&&(this.nodes=new sF)}addEventListener(E,s){return this.eventHandlers.has(E)||this.eventHandlers.set(E,new s1),this.eventHandlers.get(E).add(s)}notifyListeners(E,...s){const A=this.eventHandlers.get(E);A&&A.notify(...s)}hasListeners(E){return this.eventHandlers.has(E)}mount(E,s=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=cF(E),this.instance=E;const{layoutId:A,layout:z,visualElement:V}=this.options;if(V&&!V.current&&V.mount(E),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),s&&(z||A)&&(this.isLayoutDirty=!0),t){let j;const G=()=>this.root.updateBlockedByResize=!1;t(E,()=>{this.root.updateBlockedByResize=!0,j&&j(),j=aF(G,250),Ym.hasAnimatedSinceResize&&(Ym.hasAnimatedSinceResize=!1,this.nodes.forEach(rE))})}A&&this.root.registerSharedNode(A,this),this.options.animate!==!1&&V&&(A||z)&&this.addEventListener("didUpdate",({delta:j,hasLayoutChanged:G,hasRelativeTargetChanged:re,layout:he})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const ve=this.options.transition||V.getDefaultTransition()||SF,{onLayoutAnimationStart:Ue,onLayoutAnimationComplete:ae}=V.getProps(),J=!this.targetLayout||!Uv(this.targetLayout,he)||re,se=!G&&re;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||se||G&&(J||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(j,se);const oe={...NA(ve,"layout"),onPlay:Ue,onComplete:ae};(V.shouldReduceMotion||this.options.layoutRoot)&&(oe.delay=0,oe.type=!1),this.startAnimation(oe)}else G||rE(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=he})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const E=this.getStack();E&&E.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Ys(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(wF),this.animationId++)}getTransformTemplate(){const{visualElement:E}=this.options;return E&&E.getProps().transformTemplate}willUpdate(E=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let V=0;V<this.path.length;V++){const j=this.path[V];j.shouldResetTransform=!0,j.updateScroll("snapshot"),j.options.layoutRoot&&j.willUpdate(!1)}const{layoutId:s,layout:A}=this.options;if(s===void 0&&!A)return;const z=this.getTransformTemplate();this.prevTransformTemplateValue=z?z(this.latestValues,""):void 0,this.updateSnapshot(),E&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(iE);return}this.isUpdating||this.nodes.forEach(_F),this.isUpdating=!1,this.nodes.forEach(yF),this.nodes.forEach(dF),this.nodes.forEach(fF),this.clearAllSnapshots();const s=performance.now();li.delta=Ka(0,1e3/60,s-li.timestamp),li.timestamp=s,li.isProcessing=!0,Ou.update.process(li),Ou.preRender.process(li),Ou.render.process(li),li.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(gF),this.sharedNodes.forEach(bF)}scheduleUpdateProjection(){Qn.preRender(this.updateProjection,!1,!0)}scheduleCheckAfterUnmount(){Qn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let A=0;A<this.path.length;A++)this.path[A].updateScroll();const E=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Si(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:s}=this.options;s&&s.notify("LayoutMeasure",this.layout.layoutBox,E?E.layoutBox:void 0)}updateScroll(E="measure"){let s=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===E&&(s=!1),s&&(this.scroll={animationId:this.root.animationId,phase:E,isRoot:d(this.instance),offset:l(this.instance)})}resetTransform(){if(!g)return;const E=this.isLayoutDirty||this.shouldResetTransform,s=this.projectionDelta&&!eM(this.projectionDelta),A=this.getTransformTemplate(),z=A?A(this.latestValues,""):void 0,V=z!==this.prevTransformTemplateValue;E&&(s||ql(this.latestValues)||V)&&(g(this.instance,z),this.shouldResetTransform=!1,this.scheduleRender())}measure(E=!0){const s=this.measurePageBox();let A=this.removeElementScroll(s);return E&&(A=this.removeTransform(A)),CF(A),{animationId:this.root.animationId,measuredBox:s,layoutBox:A,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:E}=this.options;if(!E)return Si();const s=E.measureViewportBox(),{scroll:A}=this.root;return A&&(za(s.x,A.offset.x),za(s.y,A.offset.y)),s}removeElementScroll(E){const s=Si();ao(s,E);for(let A=0;A<this.path.length;A++){const z=this.path[A],{scroll:V,options:j}=z;if(z!==this.root&&V&&j.layoutScroll){if(V.isRoot){ao(s,E);const{scroll:G}=this.root;G&&(za(s.x,-G.offset.x),za(s.y,-G.offset.y))}za(s.x,V.offset.x),za(s.y,V.offset.y)}}return s}applyTransform(E,s=!1){const A=Si();ao(A,E);for(let z=0;z<this.path.length;z++){const V=this.path[z];!s&&V.options.layoutScroll&&V.scroll&&V!==V.root&&Iu(A,{x:-V.scroll.offset.x,y:-V.scroll.offset.y}),ql(V.latestValues)&&Iu(A,V.latestValues)}return ql(this.latestValues)&&Iu(A,this.latestValues),A}removeTransform(E){const s=Si();ao(s,E);for(let A=0;A<this.path.length;A++){const z=this.path[A];if(!z.instance||!ql(z.latestValues))continue;Fv(z.latestValues)&&z.updateSnapshot();const V=Si(),j=z.measurePageBox();ao(V,j),Y2(s,z.latestValues,z.snapshot?z.snapshot.layoutBox:void 0,V)}return ql(this.latestValues)&&Y2(s,this.latestValues),s}setTargetDelta(E){this.targetDelta=E,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(E){this.options={...this.options,...E,crossfade:E.crossfade!==void 0?E.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==li.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(E=!1){var s;const A=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=A.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=A.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=A.isSharedProjectionDirty);const z=!!this.resumingFrom||this!==A;if(!(E||z&&this.isSharedProjectionDirty||this.isProjectionDirty||!((s=this.parent)===null||s===void 0)&&s.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:j,layoutId:G}=this.options;if(!(!this.layout||!(j||G))){if(this.resolvedRelativeTargetAt=li.timestamp,!this.targetDelta&&!this.relativeTarget){const re=this.getClosestProjectingParent();re&&re.layout&&this.animationProgress!==1?(this.relativeParent=re,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Si(),this.relativeTargetOrigin=Si(),uf(this.relativeTargetOrigin,this.layout.layoutBox,re.layout.layoutBox),ao(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Si(),this.targetWithTransforms=Si()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),PB(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):ao(this.target,this.layout.layoutBox),HA(this.target,this.targetDelta)):ao(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const re=this.getClosestProjectingParent();re&&!!re.resumingFrom==!!this.resumingFrom&&!re.options.layoutScroll&&re.target&&this.animationProgress!==1?(this.relativeParent=re,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Si(),this.relativeTargetOrigin=Si(),uf(this.relativeTargetOrigin,this.target,re.target),ao(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Wl.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||Fv(this.parent.latestValues)||XA(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var E;const s=this.getLead(),A=!!this.resumingFrom||this!==s;let z=!0;if((this.isProjectionDirty||!((E=this.parent)===null||E===void 0)&&E.isProjectionDirty)&&(z=!1),A&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(z=!1),this.resolvedRelativeTargetAt===li.timestamp&&(z=!1),z)return;const{layout:V,layoutId:j}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(V||j))return;ao(this.layoutCorrected,this.layout.layoutBox);const G=this.treeScale.x,re=this.treeScale.y;OB(this.layoutCorrected,this.treeScale,this.path,A),s.layout&&!s.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(s.target=s.layout.layoutBox);const{target:he}=s;if(!he){this.projectionTransform&&(this.projectionDelta=Pu(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=Pu(),this.projectionDeltaWithTransform=Pu());const ve=this.projectionTransform;cf(this.projectionDelta,this.layoutCorrected,he,this.latestValues),this.projectionTransform=eE(this.projectionDelta,this.treeScale),(this.projectionTransform!==ve||this.treeScale.x!==G||this.treeScale.y!==re)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",he)),Wl.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(E=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),E){const s=this.getStack();s&&s.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(E,s=!1){const A=this.snapshot,z=A?A.latestValues:{},V={...this.latestValues},j=Pu();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!s;const G=Si(),re=A?A.source:void 0,he=this.layout?this.layout.source:void 0,ve=re!==he,Ue=this.getStack(),ae=!Ue||Ue.members.length<=1,J=!!(ve&&!ae&&this.options.crossfade===!0&&!this.path.some(EF));this.animationProgress=0;let se;this.mixTargetDelta=oe=>{const Be=oe/1e3;oE(j.x,E.x,Be),oE(j.y,E.y,Be),this.setTargetDelta(j),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(uf(G,this.layout.layoutBox,this.relativeParent.layout.layoutBox),TF(this.relativeTarget,this.relativeTargetOrigin,G,Be),se&&Uv(this.relativeTarget,se)&&(this.isProjectionDirty=!1),se||(se=Si()),ao(se,this.relativeTarget)),ve&&(this.animationValues=V,JB(V,z,this.latestValues,Be,J,ae)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Be},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(E){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Ys(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Qn.update(()=>{Ym.hasAnimatedSinceResize=!0,this.currentAnimation=uF(0,nE,{...E,onUpdate:s=>{this.mixTargetDelta(s),E.onUpdate&&E.onUpdate(s)},onComplete:()=>{E.onComplete&&E.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const E=this.getStack();E&&E.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(nE),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const E=this.getLead();let{targetWithTransforms:s,target:A,layout:z,latestValues:V}=E;if(!(!s||!A||!z)){if(this!==E&&this.layout&&z&&nM(this.options.animationType,this.layout.layoutBox,z.layoutBox)){A=this.target||Si();const j=Wr(this.layout.layoutBox.x);A.x.min=E.target.x.min,A.x.max=A.x.min+j;const G=Wr(this.layout.layoutBox.y);A.y.min=E.target.y.min,A.y.max=A.y.min+G}ao(s,A),Iu(s,V),cf(this.projectionDeltaWithTransform,this.layoutCorrected,s,V)}}registerSharedNode(E,s){this.sharedNodes.has(E)||this.sharedNodes.set(E,new rF),this.sharedNodes.get(E).add(s);const z=s.options.initialPromotionConfig;s.promote({transition:z?z.transition:void 0,preserveFollowOpacity:z&&z.shouldPreserveFollowOpacity?z.shouldPreserveFollowOpacity(s):void 0})}isLead(){const E=this.getStack();return E?E.lead===this:!0}getLead(){var E;const{layoutId:s}=this.options;return s?((E=this.getStack())===null||E===void 0?void 0:E.lead)||this:this}getPrevLead(){var E;const{layoutId:s}=this.options;return s?(E=this.getStack())===null||E===void 0?void 0:E.prevLead:void 0}getStack(){const{layoutId:E}=this.options;if(E)return this.root.sharedNodes.get(E)}promote({needsReset:E,transition:s,preserveFollowOpacity:A}={}){const z=this.getStack();z&&z.promote(this,A),E&&(this.projectionDelta=void 0,this.needsReset=!0),s&&this.setOptions({transition:s})}relegate(){const E=this.getStack();return E?E.relegate(this):!1}resetRotation(){const{visualElement:E}=this.options;if(!E)return;let s=!1;const{latestValues:A}=E;if((A.rotate||A.rotateX||A.rotateY||A.rotateZ)&&(s=!0),!s)return;const z={};for(let V=0;V<tE.length;V++){const j="rotate"+tE[V];A[j]&&(z[j]=A[j],E.setStaticValue(j,0))}E.render();for(const V in z)E.setStaticValue(V,z[V]);E.scheduleRender()}getProjectionStyles(E={}){var s,A;const z={};if(!this.instance||this.isSVG)return z;if(this.isVisible)z.visibility="";else return{visibility:"hidden"};const V=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,z.opacity="",z.pointerEvents=Km(E.pointerEvents)||"",z.transform=V?V(this.latestValues,""):"none",z;const j=this.getLead();if(!this.projectionDelta||!this.layout||!j.target){const ve={};return this.options.layoutId&&(ve.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,ve.pointerEvents=Km(E.pointerEvents)||""),this.hasProjected&&!ql(this.latestValues)&&(ve.transform=V?V({},""):"none",this.hasProjected=!1),ve}const G=j.animationValues||j.latestValues;this.applyTransformsToTarget(),z.transform=eE(this.projectionDeltaWithTransform,this.treeScale,G),V&&(z.transform=V(G,z.transform));const{x:re,y:he}=this.projectionDelta;z.transformOrigin=`${re.origin*100}% ${he.origin*100}% 0`,j.animationValues?z.opacity=j===this?(A=(s=G.opacity)!==null&&s!==void 0?s:this.latestValues.opacity)!==null&&A!==void 0?A:1:this.preserveOpacity?this.latestValues.opacity:G.opacityExit:z.opacity=j===this?G.opacity!==void 0?G.opacity:"":G.opacityExit!==void 0?G.opacityExit:0;for(const ve in Eg){if(G[ve]===void 0)continue;const{correct:Ue,applyTo:ae}=Eg[ve],J=z.transform==="none"?G[ve]:Ue(G[ve],j);if(ae){const se=ae.length;for(let oe=0;oe<se;oe++)z[ae[oe]]=J}else z[ve]=J}return this.options.layoutId&&(z.pointerEvents=j===this?Km(E.pointerEvents)||"":"none"),z}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(E=>{var s;return(s=E.currentAnimation)===null||s===void 0?void 0:s.stop()}),this.root.nodes.forEach(iE),this.root.sharedNodes.clear()}}}function dF(t){t.updateLayout()}function fF(t){var i;const l=((i=t.resumeFrom)===null||i===void 0?void 0:i.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&l&&t.hasListeners("didUpdate")){const{layoutBox:d,measuredBox:g}=t.layout,{animationType:w}=t.options,E=l.source!==t.layout.source;w==="size"?ds(j=>{const G=E?l.measuredBox[j]:l.layoutBox[j],re=Wr(G);G.min=d[j].min,G.max=G.min+re}):nM(w,l.layoutBox,d)&&ds(j=>{const G=E?l.measuredBox[j]:l.layoutBox[j],re=Wr(d[j]);G.max=G.min+re,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[j].max=t.relativeTarget[j].min+re)});const s=Pu();cf(s,d,l.layoutBox);const A=Pu();E?cf(A,t.applyTransform(g,!0),l.measuredBox):cf(A,d,l.layoutBox);const z=!eM(s);let V=!1;if(!t.resumeFrom){const j=t.getClosestProjectingParent();if(j&&!j.resumeFrom){const{snapshot:G,layout:re}=j;if(G&&re){const he=Si();uf(he,l.layoutBox,G.layoutBox);const ve=Si();uf(ve,d,re.layoutBox),Uv(he,ve)||(V=!0),j.options.layoutRoot&&(t.relativeTarget=ve,t.relativeTargetOrigin=he,t.relativeParent=j)}}}t.notifyListeners("didUpdate",{layout:d,snapshot:l,delta:A,layoutDelta:s,hasLayoutChanged:z,hasRelativeTargetChanged:V})}else if(t.isLead()){const{onExitComplete:d}=t.options;d&&d()}t.options.transition=void 0}function pF(t){Wl.totalNodes++,t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function mF(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function gF(t){t.clearSnapshot()}function iE(t){t.clearMeasurements()}function _F(t){t.isLayoutDirty=!1}function yF(t){const{visualElement:i}=t.options;i&&i.getProps().onBeforeLayoutMeasure&&i.notify("BeforeLayoutMeasure"),t.resetTransform()}function rE(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function vF(t){t.resolveTargetDelta()}function xF(t){t.calcProjection()}function wF(t){t.resetRotation()}function bF(t){t.removeLeadSnapshot()}function oE(t,i,l){t.translate=ui(i.translate,0,l),t.scale=ui(i.scale,1,l),t.origin=i.origin,t.originPoint=i.originPoint}function sE(t,i,l,d){t.min=ui(i.min,l.min,d),t.max=ui(i.max,l.max,d)}function TF(t,i,l,d){sE(t.x,i.x,l.x,d),sE(t.y,i.y,l.y,d)}function EF(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const SF={duration:.45,ease:[.4,0,.1,1]};function aE(t){t.min=Math.round(t.min),t.max=Math.round(t.max)}function CF(t){aE(t.x),aE(t.y)}function nM(t,i,l){return t==="position"||t==="preserve-aspect"&&!Rv(Q2(i),Q2(l),.2)}const AF=tM({attachResizeListener:(t,i)=>js(t,"resize",i),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),C0={current:void 0},iM=tM({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!C0.current){const t=new AF({});t.mount(window),t.setOptions({layoutScroll:!0}),C0.current=t}return C0.current},resetTransform:(t,i)=>{t.style.transform=i!==void 0?i:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),MF={pan:{Feature:qB},drag:{Feature:ZB,ProjectionNode:iM,MeasureLayout:YA}},PF=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function IF(t){const i=PF.exec(t);if(!i)return[,];const[,l,d]=i;return[l,d]}function Vv(t,i,l=1){const[d,g]=IF(t);if(!d)return;const w=window.getComputedStyle(i).getPropertyValue(d);return w?w.trim():Av(g)?Vv(g,i,l+1):g}function kF(t,{...i},l){const d=t.current;if(!(d instanceof Element))return{target:i,transitionEnd:l};l&&(l={...l}),t.values.forEach(g=>{const w=g.get();if(!Av(w))return;const E=Vv(w,d);E&&g.set(E)});for(const g in i){const w=i[g];if(!Av(w))continue;const E=Vv(w,d);E&&(i[g]=E,l||(l={}),l[g]===void 0&&(l[g]=w))}return{target:i,transitionEnd:l}}const DF=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),rM=t=>DF.has(t),zF=t=>Object.keys(t).some(rM),lE=t=>t===fc||t===Gt,cE=(t,i)=>parseFloat(t.split(", ")[i]),uE=(t,i)=>(l,{transform:d})=>{if(d==="none"||!d)return 0;const g=d.match(/^matrix3d\((.+)\)$/);if(g)return cE(g[1],i);{const w=d.match(/^matrix\((.+)\)$/);return w?cE(w[1],t):0}},LF=new Set(["x","y","z"]),RF=Vf.filter(t=>!LF.has(t));function BF(t){const i=[];return RF.forEach(l=>{const d=t.getValue(l);d!==void 0&&(i.push([l,d.get()]),d.set(l.startsWith("scale")?1:0))}),i.length&&t.render(),i}const hE={width:({x:t},{paddingLeft:i="0",paddingRight:l="0"})=>t.max-t.min-parseFloat(i)-parseFloat(l),height:({y:t},{paddingTop:i="0",paddingBottom:l="0"})=>t.max-t.min-parseFloat(i)-parseFloat(l),top:(t,{top:i})=>parseFloat(i),left:(t,{left:i})=>parseFloat(i),bottom:({y:t},{top:i})=>parseFloat(i)+(t.max-t.min),right:({x:t},{left:i})=>parseFloat(i)+(t.max-t.min),x:uE(4,13),y:uE(5,14)},FF=(t,i,l)=>{const d=i.measureViewportBox(),g=i.current,w=getComputedStyle(g),{display:E}=w,s={};E==="none"&&i.setStaticValue("display",t.display||"block"),l.forEach(z=>{s[z]=hE[z](d,w)}),i.render();const A=i.measureViewportBox();return l.forEach(z=>{const V=i.getValue(z);V&&V.jump(s[z]),t[z]=hE[z](A,w)}),t},OF=(t,i,l={},d={})=>{i={...i},d={...d};const g=Object.keys(i).filter(rM);let w=[],E=!1;const s=[];if(g.forEach(A=>{const z=t.getValue(A);if(!t.hasValue(A))return;let V=l[A],j=Gd(V);const G=i[A];let re;if(Cg(G)){const he=G.length,ve=G[0]===null?1:0;V=G[ve],j=Gd(V);for(let Ue=ve;Ue<he&&G[Ue]!==null;Ue++)re?Jx(Gd(G[Ue])===re):re=Gd(G[Ue])}else re=Gd(G);if(j!==re)if(lE(j)&&lE(re)){const he=z.get();typeof he=="string"&&z.set(parseFloat(he)),typeof G=="string"?i[A]=parseFloat(G):Array.isArray(G)&&re===Gt&&(i[A]=G.map(parseFloat))}else j!=null&&j.transform&&(re!=null&&re.transform)&&(V===0||G===0)?V===0?z.set(re.transform(V)):i[A]=j.transform(G):(E||(w=BF(t),E=!0),s.push(A),d[A]=d[A]!==void 0?d[A]:i[A],z.jump(G))}),s.length){const A=s.indexOf("height")>=0?window.pageYOffset:null,z=FF(i,t,s);return w.length&&w.forEach(([V,j])=>{t.getValue(V).set(j)}),t.render(),t_&&A!==null&&window.scrollTo({top:A}),{target:z,transitionEnd:d}}else return{target:i,transitionEnd:d}};function UF(t,i,l,d){return zF(i)?OF(t,i,l,d):{target:i,transitionEnd:d}}const VF=(t,i,l,d)=>{const g=kF(t,i,d);return i=g.target,d=g.transitionEnd,UF(t,i,l,d)},Nv={current:null},oM={current:!1};function NF(){if(oM.current=!0,!!t_)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),i=()=>Nv.current=t.matches;t.addListener(i),i()}else Nv.current=!1}function jF(t,i,l){const{willChange:d}=i;for(const g in i){const w=i[g],E=l[g];if(Lr(w))t.addValue(g,w),Ig(d)&&d.add(g);else if(Lr(E))t.addValue(g,Xu(w,{owner:t})),Ig(d)&&d.remove(g);else if(E!==w)if(t.hasValue(g)){const s=t.getValue(g);!s.hasAnimated&&s.set(w)}else{const s=t.getStaticValue(g);t.addValue(g,Xu(s!==void 0?s:w,{owner:t}))}}for(const g in l)i[g]===void 0&&t.removeValue(g);return i}const dE=new WeakMap,sM=Object.keys(kf),GF=sM.length,fE=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],$F=jx.length;class ZF{constructor({parent:i,props:l,presenceContext:d,reducedMotionConfig:g,visualState:w},E={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>Qn.render(this.render,!1,!0);const{latestValues:s,renderState:A}=w;this.latestValues=s,this.baseTarget={...s},this.initialValues=l.initial?{...s}:{},this.renderState=A,this.parent=i,this.props=l,this.presenceContext=d,this.depth=i?i.depth+1:0,this.reducedMotionConfig=g,this.options=E,this.isControllingVariants=i_(l),this.isVariantNode=$C(l),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(i&&i.current);const{willChange:z,...V}=this.scrapeMotionValuesFromProps(l,{});for(const j in V){const G=V[j];s[j]!==void 0&&Lr(G)&&(G.set(s[j],!1),Ig(z)&&z.add(j))}}scrapeMotionValuesFromProps(i,l){return{}}mount(i){this.current=i,dE.set(i,this),this.projection&&!this.projection.instance&&this.projection.mount(i),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((l,d)=>this.bindToMotionValue(d,l)),oM.current||NF(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Nv.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){dE.delete(this.current),this.projection&&this.projection.unmount(),Ys(this.notifyUpdate),Ys(this.render),this.valueSubscriptions.forEach(i=>i()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const i in this.events)this.events[i].clear();for(const i in this.features)this.features[i].unmount();this.current=null}bindToMotionValue(i,l){const d=dc.has(i),g=l.on("change",E=>{this.latestValues[i]=E,this.props.onUpdate&&Qn.update(this.notifyUpdate,!1,!0),d&&this.projection&&(this.projection.isTransformDirty=!0)}),w=l.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(i,()=>{g(),w()})}sortNodePosition(i){return!this.current||!this.sortInstanceNodePosition||this.type!==i.type?0:this.sortInstanceNodePosition(this.current,i.current)}loadFeatures({children:i,...l},d,g,w){let E,s;for(let A=0;A<GF;A++){const z=sM[A],{isEnabled:V,Feature:j,ProjectionNode:G,MeasureLayout:re}=kf[z];G&&(E=G),V(l)&&(!this.features[z]&&j&&(this.features[z]=new j(this)),re&&(s=re))}if(!this.projection&&E){this.projection=new E(this.latestValues,this.parent&&this.parent.projection);const{layoutId:A,layout:z,drag:V,dragConstraints:j,layoutScroll:G,layoutRoot:re}=l;this.projection.setOptions({layoutId:A,layout:z,alwaysMeasureLayout:!!V||j&&Au(j),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof z=="string"?z:"both",initialPromotionConfig:w,layoutScroll:G,layoutRoot:re})}return s}updateFeatures(){for(const i in this.features){const l=this.features[i];l.isMounted?l.update():(l.mount(),l.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Si()}getStaticValue(i){return this.latestValues[i]}setStaticValue(i,l){this.latestValues[i]=l}makeTargetAnimatable(i,l=!0){return this.makeTargetAnimatableFromInstance(i,this.props,l)}update(i,l){(i.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=i,this.prevPresenceContext=this.presenceContext,this.presenceContext=l;for(let d=0;d<fE.length;d++){const g=fE[d];this.propEventSubscriptions[g]&&(this.propEventSubscriptions[g](),delete this.propEventSubscriptions[g]);const w=i["on"+g];w&&(this.propEventSubscriptions[g]=this.on(g,w))}this.prevMotionValues=jF(this,this.scrapeMotionValuesFromProps(i,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(i){return this.props.variants?this.props.variants[i]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(i=!1){if(i)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const d=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(d.initial=this.props.initial),d}const l={};for(let d=0;d<$F;d++){const g=jx[d],w=this.props[g];(If(w)||w===!1)&&(l[g]=w)}return l}addVariantChild(i){const l=this.getClosestVariantNode();if(l)return l.variantChildren&&l.variantChildren.add(i),()=>l.variantChildren.delete(i)}addValue(i,l){l!==this.values.get(i)&&(this.removeValue(i),this.bindToMotionValue(i,l)),this.values.set(i,l),this.latestValues[i]=l.get()}removeValue(i){this.values.delete(i);const l=this.valueSubscriptions.get(i);l&&(l(),this.valueSubscriptions.delete(i)),delete this.latestValues[i],this.removeValueFromRenderState(i,this.renderState)}hasValue(i){return this.values.has(i)}getValue(i,l){if(this.props.values&&this.props.values[i])return this.props.values[i];let d=this.values.get(i);return d===void 0&&l!==void 0&&(d=Xu(l,{owner:this}),this.addValue(i,d)),d}readValue(i){return this.latestValues[i]!==void 0||!this.current?this.latestValues[i]:this.readValueFromInstance(this.current,i,this.options)}setBaseTarget(i,l){this.baseTarget[i]=l}getBaseTarget(i){var l;const{initial:d}=this.props,g=typeof d=="string"||typeof d=="object"?(l=Yx(this.props,d))===null||l===void 0?void 0:l[i]:void 0;if(d&&g!==void 0)return g;const w=this.getBaseTargetFromProps(this.props,i);return w!==void 0&&!Lr(w)?w:this.initialValues[i]!==void 0&&g===void 0?void 0:this.baseTarget[i]}on(i,l){return this.events[i]||(this.events[i]=new s1),this.events[i].add(l)}notify(i,...l){this.events[i]&&this.events[i].notify(...l)}}class aM extends ZF{sortInstanceNodePosition(i,l){return i.compareDocumentPosition(l)&2?1:-1}getBaseTargetFromProps(i,l){return i.style?i.style[l]:void 0}removeValueFromRenderState(i,{vars:l,style:d}){delete l[i],delete d[i]}makeTargetAnimatableFromInstance({transition:i,transitionEnd:l,...d},{transformValues:g},w){let E=hB(d,i||{},this);if(g&&(l&&(l=g(l)),d&&(d=g(d)),E&&(E=g(E))),w){cB(this,d,E);const s=VF(this,d,E,l);l=s.transitionEnd,d=s.target}return{transition:i,transitionEnd:l,...d}}}function qF(t){return window.getComputedStyle(t)}class WF extends aM{readValueFromInstance(i,l){if(dc.has(l)){const d=n1(l);return d&&d.default||0}else{const d=qF(i),g=(XC(l)?d.getPropertyValue(l):d[l])||0;return typeof g=="string"?g.trim():g}}measureInstanceViewportBox(i,{transformPagePoint:l}){return KA(i,l)}build(i,l,d,g){Zx(i,l,d,g.transformTemplate)}scrapeMotionValuesFromProps(i,l){return Kx(i,l)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:i}=this.props;Lr(i)&&(this.childSubscription=i.on("change",l=>{this.current&&(this.current.textContent=`${l}`)}))}renderInstance(i,l,d,g){eA(i,l,d,g)}}class XF extends aM{constructor(){super(...arguments),this.isSVGTag=!1}getBaseTargetFromProps(i,l){return i[l]}readValueFromInstance(i,l){if(dc.has(l)){const d=n1(l);return d&&d.default||0}return l=tA.has(l)?l:Hx(l),i.getAttribute(l)}measureInstanceViewportBox(){return Si()}scrapeMotionValuesFromProps(i,l){return iA(i,l)}build(i,l,d,g){Wx(i,l,d,this.isSVGTag,g.transformTemplate)}renderInstance(i,l,d,g){nA(i,l,d,g)}mount(i){this.isSVGTag=Xx(i.tagName),super.mount(i)}}const HF=(t,i)=>$x(t)?new XF(i,{enableHardwareAcceleration:!1}):new WF(i,{enableHardwareAcceleration:!0}),KF={layout:{ProjectionNode:iM,MeasureLayout:YA}},YF={...SB,...qR,...MF,...KF},lM=eR((t,i)=>PR(t,i,YF,HF));function cM(){const t=De.useRef(!1);return Tg(()=>(t.current=!0,()=>{t.current=!1}),[]),t}function JF(){const t=cM(),[i,l]=De.useState(0),d=De.useCallback(()=>{t.current&&l(i+1)},[i]);return[De.useCallback(()=>Qn.postRender(d),[d]),i]}class QF extends De.Component{getSnapshotBeforeUpdate(i){const l=this.props.childRef.current;if(l&&i.isPresent&&!this.props.isPresent){const d=this.props.sizeRef.current;d.height=l.offsetHeight||0,d.width=l.offsetWidth||0,d.top=l.offsetTop,d.left=l.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function eO({children:t,isPresent:i}){const l=De.useId(),d=De.useRef(null),g=De.useRef({width:0,height:0,top:0,left:0});return De.useInsertionEffect(()=>{const{width:w,height:E,top:s,left:A}=g.current;if(i||!d.current||!w||!E)return;d.current.dataset.motionPopId=l;const z=document.createElement("style");return document.head.appendChild(z),z.sheet&&z.sheet.insertRule(`
          [data-motion-pop-id="${l}"] {
            position: absolute !important;
            width: ${w}px !important;
            height: ${E}px !important;
            top: ${s}px !important;
            left: ${A}px !important;
          }
        `),()=>{document.head.removeChild(z)}},[i]),De.createElement(QF,{isPresent:i,childRef:d,sizeRef:g},De.cloneElement(t,{ref:d}))}const A0=({children:t,initial:i,isPresent:l,onExitComplete:d,custom:g,presenceAffectsLayout:w,mode:E})=>{const s=rA(tO),A=De.useId(),z=De.useMemo(()=>({id:A,initial:i,isPresent:l,custom:g,onExitComplete:V=>{s.set(V,!0);for(const j of s.values())if(!j)return;d&&d()},register:V=>(s.set(V,!1),()=>s.delete(V))}),w?void 0:[l]);return De.useMemo(()=>{s.forEach((V,j)=>s.set(j,!1))},[l]),De.useEffect(()=>{!l&&!s.size&&d&&d()},[l]),E==="popLayout"&&(t=De.createElement(eO,{isPresent:l},t)),De.createElement(e_.Provider,{value:z},t)};function tO(){return new Map}function nO(t){return De.useEffect(()=>()=>t(),[])}const du=t=>t.key||"";function iO(t,i){t.forEach(l=>{const d=du(l);i.set(d,l)})}function rO(t){const i=[];return De.Children.forEach(t,l=>{De.isValidElement(l)&&i.push(l)}),i}const uM=({children:t,custom:i,initial:l=!0,onExitComplete:d,exitBeforeEnter:g,presenceAffectsLayout:w=!0,mode:E="sync"})=>{const s=De.useContext(Gx).forceRender||JF()[0],A=cM(),z=rO(t);let V=z;const j=De.useRef(new Map).current,G=De.useRef(V),re=De.useRef(new Map).current,he=De.useRef(!0);if(Tg(()=>{he.current=!1,iO(z,re),G.current=V}),nO(()=>{he.current=!0,re.clear(),j.clear()}),he.current)return De.createElement(De.Fragment,null,V.map(J=>De.createElement(A0,{key:du(J),isPresent:!0,initial:l?void 0:!1,presenceAffectsLayout:w,mode:E},J)));V=[...V];const ve=G.current.map(du),Ue=z.map(du),ae=ve.length;for(let J=0;J<ae;J++){const se=ve[J];Ue.indexOf(se)===-1&&!j.has(se)&&j.set(se,void 0)}return E==="wait"&&j.size&&(V=[]),j.forEach((J,se)=>{if(Ue.indexOf(se)!==-1)return;const oe=re.get(se);if(!oe)return;const Be=ve.indexOf(se);let at=J;if(!at){const Ye=()=>{re.delete(se),j.delete(se);const He=G.current.findIndex(ze=>ze.key===se);if(G.current.splice(He,1),!j.size){if(G.current=z,A.current===!1)return;s(),d&&d()}};at=De.createElement(A0,{key:du(oe),isPresent:!1,onExitComplete:Ye,custom:i,presenceAffectsLayout:w,mode:E},oe),j.set(se,at)}V.splice(Be,0,at)}),V=V.map(J=>{const se=J.key;return j.has(se)?J:De.createElement(A0,{key:du(J),isPresent:!0,presenceAffectsLayout:w,mode:E},J)}),De.createElement(De.Fragment,null,j.size?V:V.map(J=>De.cloneElement(J)))};function oO({selectedPartner:t}){return qe.jsxs("div",{className:"description-container",children:[qe.jsx(uM,{mode:"wait",children:qe.jsx(lM.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:t&&qe.jsxs("div",{children:[qe.jsx("h2",{className:"partner-title",children:qe.jsx("img",{src:t.logo,alt:`${t.title} Logo`})}),qe.jsx("p",{className:"partner-description",children:t.description})]})},t&&t.title?t.title:"empty")}),qe.jsx(Jl,{to:"/services",className:"btn-link",children:"Get to known our services"})]})}function sO(){Cv.accessToken="pk.eyJ1IjoicGVkcm9jZXNhZSIsImEiOiJjbGpjdmkwbXgyazBtM2VxemxucnY5NG9oIn0.8N4qFLStOQmBDtoqSsK4Vg";const[t,i]=De.useState(null);return De.useEffect(()=>{console.log("Partner Selected:",t)},[t]),qe.jsxs(qe.Fragment,{children:[qe.jsx(Jg,{}),qe.jsx("main",{children:qe.jsxs("section",{className:"row",children:[qe.jsx("div",{className:"col partner-details",children:qe.jsx(oO,{selectedPartner:t})}),qe.jsx("div",{className:"col map",children:qe.jsx(ZL,{setSelectedPartner:i})})]})})]})}function aO(){const[t,i]=De.useState(u2[0]);return qe.jsxs(qe.Fragment,{children:[qe.jsx(Jg,{}),qe.jsx("ul",{className:"services-list",children:u2.map(l=>qe.jsx("li",{onClick:()=>i(l),className:l.short===t.short?"active":"",children:l.short},l.short))}),qe.jsx("main",{children:qe.jsxs("section",{className:"row service-details",children:[qe.jsx("div",{className:"col services-image",style:{backgroundImage:`url(${t.image})`,backgroundRepeat:"no-repeat",backgroundSize:"cover",minHeight:"300px",transition:"background-image 0.5s ease-out"}}),qe.jsxs("div",{className:"col services-detail",children:[qe.jsx("div",{children:qe.jsx(uM,{mode:"wait",children:qe.jsxs(lM.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[qe.jsx("h2",{children:t.title}),qe.jsx("em",{children:t.pitch}),qe.jsx("p",{children:t.description}),qe.jsx("ul",{children:t.list.map(l=>qe.jsx("li",{children:l},l))})]},t&&t.short?t.short:"empty")})}),qe.jsx("br",{}),qe.jsx("br",{}),qe.jsx(Jl,{to:"/about",className:"btn-link",children:"Get to known more about us"})]})]})})]})}const lO=SL([{path:"/",element:qe.jsx(GL,{})},{path:"/services",element:qe.jsx(aO,{})},{path:"/partners",element:qe.jsx(sO,{})},{path:"/about",element:qe.jsx(jL,{})}]);M0.createRoot(document.getElementById("root")).render(qe.jsx(zg.StrictMode,{children:qe.jsx(_L,{router:lO})}));
